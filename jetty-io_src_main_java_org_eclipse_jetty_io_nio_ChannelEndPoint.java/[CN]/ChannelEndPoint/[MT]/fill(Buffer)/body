{
  Buffer buf=buffer.buffer();
  int len=0;
  if (buf instanceof NIOBuffer) {
    final NIOBuffer nbuf=(NIOBuffer)buf;
    final ByteBuffer bbuf=nbuf.getByteBuffer();
synchronized (bbuf) {
      try {
        bbuf.position(buffer.putIndex());
        len=_channel.read(bbuf);
        if (len < 0 && isOpen() && !isInputShutdown()) {
          try {
            shutdownInput();
          }
 catch (          IOException x) {
            Log.ignore(x);
            try {
              close();
            }
 catch (            IOException xx) {
              Log.ignore(xx);
            }
          }
        }
      }
 catch (      IOException x) {
        try {
          close();
        }
 catch (        IOException xx) {
          Log.ignore(xx);
        }
        throw x;
      }
 finally {
        buffer.setPutIndex(bbuf.position());
        bbuf.position(0);
      }
    }
  }
 else {
    throw new IOException("Not Implemented");
  }
  return len;
}
