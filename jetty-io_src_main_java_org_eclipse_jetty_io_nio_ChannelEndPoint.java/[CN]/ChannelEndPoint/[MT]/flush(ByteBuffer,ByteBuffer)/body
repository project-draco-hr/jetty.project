{
  int len;
  if (buffer == null || buffer.remaining() == 0)   len=flush(header);
 else   if (header == null || header.remaining() == 0)   len=flush(buffer);
 else   if (_channel instanceof GatheringByteChannel)   len=(int)((GatheringByteChannel)_channel).write(new ByteBuffer[]{header,buffer},0,2);
 else {
    len=flush(header);
    if (header.remaining() == 0)     len+=flush(buffer);
  }
  return len;
}
