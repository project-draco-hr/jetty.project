{
  ByteArrayEndPoint endPoint=new ByteArrayEndPoint("",16);
  HttpDestinationOverHTTP destination=new HttpDestinationOverHTTP(client,new Origin("http","localhost",8080));
  HttpConnectionOverHTTP connection=new HttpConnectionOverHTTP(endPoint,destination);
  Request request=client.newRequest(URI.create("http://localhost/"));
  final CountDownLatch failureLatch=new CountDownLatch(2);
  request.listener(new Request.Listener.Adapter(){
    @Override public void onFailure(    Request request,    Throwable x){
      failureLatch.countDown();
    }
  }
);
  connection.send(request,new Response.Listener.Adapter(){
    @Override public void onComplete(    Result result){
      Assert.assertTrue(result.isFailed());
      failureLatch.countDown();
    }
  }
);
  endPoint.shutdownOutput();
  endPoint.takeOutputString();
  Assert.assertTrue(failureLatch.await(5,TimeUnit.SECONDS));
}
