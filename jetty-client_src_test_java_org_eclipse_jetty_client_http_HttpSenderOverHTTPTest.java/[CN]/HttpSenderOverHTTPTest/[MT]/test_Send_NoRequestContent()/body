{
  ByteArrayEndPoint endPoint=new ByteArrayEndPoint();
  HttpDestinationOverHTTP destination=new HttpDestinationOverHTTP(client,new Origin("http","localhost",8080));
  HttpConnectionOverHTTP connection=new HttpConnectionOverHTTP(endPoint,destination);
  Request request=client.newRequest(URI.create("http://localhost/"));
  final CountDownLatch headersLatch=new CountDownLatch(1);
  final CountDownLatch successLatch=new CountDownLatch(1);
  request.listener(new Request.Listener.Adapter(){
    @Override public void onHeaders(    Request request){
      headersLatch.countDown();
    }
    @Override public void onSuccess(    Request request){
      successLatch.countDown();
    }
  }
);
  connection.send(request,null);
  String requestString=endPoint.takeOutputString();
  Assert.assertTrue(requestString.startsWith("GET "));
  Assert.assertTrue(requestString.endsWith("\r\n\r\n"));
  Assert.assertTrue(headersLatch.await(5,TimeUnit.SECONDS));
  Assert.assertTrue(successLatch.await(5,TimeUnit.SECONDS));
}
