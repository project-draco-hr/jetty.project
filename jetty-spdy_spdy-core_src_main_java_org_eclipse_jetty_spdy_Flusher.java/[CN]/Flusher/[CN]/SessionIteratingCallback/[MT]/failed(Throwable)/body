{
  List<StandardSession.FrameBytes> frameBytesToFail=new ArrayList<>();
synchronized (lock) {
    failure=x;
    if (LOG.isDebugEnabled()) {
      String logMessage=String.format("Failed write of %s, failing all %d frame(s) in queue",this,queue.size());
      LOG.debug(logMessage,x);
    }
    frameBytesToFail.addAll(queue);
    queue.clear();
  }
  for (  FrameBytes frame : active)   frame.failed(x);
  active.clear();
  for (  StandardSession.FrameBytes fb : frameBytesToFail)   fb.failed(x);
  super.failed(x);
}
