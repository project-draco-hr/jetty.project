{
  Throwable failure;
synchronized (lock) {
    failure=this.failure;
    if (failure == null) {
      if (frameBytes instanceof StandardSession.ControlFrameBytes)       queue.add(frameBytes);
 else {
        int index=queue.size();
        while (index > 0) {
          StandardSession.FrameBytes element=queue.getUnsafe(index - 1);
          if (element.compareTo(frameBytes) >= 0)           break;
          --index;
        }
        queue.add(index,frameBytes);
      }
    }
  }
  if (failure == null)   flush();
 else   frameBytes.failed(new SPDYException(failure));
}
