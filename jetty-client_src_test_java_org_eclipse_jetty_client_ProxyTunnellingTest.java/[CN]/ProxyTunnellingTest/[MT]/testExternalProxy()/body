{
  String proxyHost="81.208.25.53";
  int proxyPort=3128;
  try {
    new Socket(proxyHost,proxyPort).close();
  }
 catch (  IOException x) {
    Assume.assumeNoException(x);
  }
  startSSLServer(new AbstractHandler(){
    public void handle(    String target,    Request baseRequest,    HttpServletRequest request,    HttpServletResponse response) throws IOException, ServletException {
      throw new ServletException();
    }
  }
);
  HttpClient httpClient=new HttpClient();
  httpClient.setProxy(new Address(proxyHost,proxyPort));
  httpClient.registerListener(RedirectListener.class.getName());
  httpClient.start();
  try {
    ContentExchange exchange=new ContentExchange(true);
    exchange.setTimeout(5000);
    exchange.setURL("https://www.google.com");
    httpClient.send(exchange);
    assertEquals(HttpExchange.STATUS_COMPLETED,exchange.waitForDone());
    assertEquals(200,exchange.getResponseStatus());
  }
  finally {
    httpClient.stop();
  }
}
