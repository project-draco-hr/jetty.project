{
  final CountDownLatch synLatch=new CountDownLatch(1);
  final CountDownLatch dataLatch=new CountDownLatch(1);
  final CountDownLatch rstLatch=new CountDownLatch(1);
  Session session=startClient(startServer(new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      try {
        assertTrue(synLatch.await(5,TimeUnit.SECONDS));
        stream.getSession().rst(new RstInfo(stream.getId(),StreamStatus.REFUSED_STREAM));
        return new StreamFrameListener.Adapter(){
          @Override public void onData(          Stream stream,          DataInfo dataInfo){
            dataLatch.countDown();
          }
        }
;
      }
 catch (      InterruptedException x) {
        x.printStackTrace();
        return null;
      }
    }
  }
),new SessionFrameListener.Adapter(){
    @Override public void onRst(    Session session,    RstInfo rstInfo){
      rstLatch.countDown();
    }
  }
);
  Stream stream=session.syn(new SynInfo(false),null).get(5,TimeUnit.SECONDS);
  stream.data(new StringDataInfo("data",true),5,TimeUnit.SECONDS,new Callback.Adapter<Void>(){
    @Override public void completed(    Void context){
      synLatch.countDown();
    }
  }
);
  assertTrue("rstLatch didn't count down",rstLatch.await(5,TimeUnit.SECONDS));
  assertTrue("stream is expected to be reset",stream.isReset());
  assertFalse("dataLatch shouln't be count down",dataLatch.await(1,TimeUnit.SECONDS));
}
