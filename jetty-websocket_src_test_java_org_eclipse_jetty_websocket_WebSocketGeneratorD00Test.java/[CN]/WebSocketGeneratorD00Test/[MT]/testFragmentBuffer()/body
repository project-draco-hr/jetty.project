{
  byte[] b=new byte[3001];
  for (int i=0; i < b.length; i++)   b[i]=(byte)('0' + (i % 10));
  _generator.addFrame((byte)0x0,(byte)0xf,b,0,b.length,0);
  _generator.flush();
  assertEquals(0x8f,_out.get() & 0xff);
  assertEquals(0x7e,_out.get() & 0xff);
  int m=0;
  int frag=((_out.get() & 0xff) << 8) | _out.get() & 0xff;
  for (int i=0; i < frag; i++) {
    assertEquals("b=" + i,'0' + (m % 10),0xff & _out.get());
    m++;
  }
  assertEquals(0x8f,_out.get() & 0xff);
  assertEquals(0x7e,_out.get() & 0xff);
  frag=((_out.get() & 0xff) << 8) | _out.get() & 0xff;
  for (int i=0; i < frag; i++) {
    assertEquals("b=" + i,'0' + (m % 10),0xff & _out.get());
    m++;
  }
  assertEquals(0x0f,_out.get() & 0xff);
  assertEquals(0x7e,_out.get() & 0xff);
  frag=((_out.get() & 0xff) << 8) | _out.get() & 0xff;
  for (int i=0; i < frag; i++) {
    assertEquals("b=" + i,'0' + (m % 10),0xff & _out.get());
    m++;
  }
  assertEquals(b.length,m);
}
