{
  Socket client=newClient();
  client.setSoTimeout(3000);
  SocketChannel server=_connector.accept();
  server.configureBlocking(false);
  _manager.register(server);
  client.getOutputStream().write("HelloWorld".getBytes("UTF-8"));
  for (  char c : "HelloWorld".toCharArray()) {
    int b=client.getInputStream().read();
    assertTrue(b > 0);
    assertEquals(c,(char)b);
  }
  _lastEndp.setMaxIdleTime(500);
  long start=System.currentTimeMillis();
  int b=client.getInputStream().read();
  assertEquals(-1,b);
  long idle=System.currentTimeMillis() - start;
  assertThat(idle,Matchers.greaterThan(400L));
  assertThat(idle,Matchers.lessThan(3000L));
  if (_lastEndp.isOpen()) {
    assertTrue(_lastEndp.isOutputShutdown());
    Thread.sleep(2000);
  }
  assertFalse(_lastEndp.isOpen());
}
