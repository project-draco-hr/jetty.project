{
  Socket client=newClient();
  client.setSoTimeout(30000);
  SocketChannel server=_connector.accept();
  server.configureBlocking(false);
  _manager.register(server);
  int writes=1000000;
  final CountDownLatch latch=new CountDownLatch(writes);
  final InputStream in=new BufferedInputStream(client.getInputStream());
  new Thread(){
    public void run(){
      try {
        while (latch.getCount() > 0) {
          for (          char c : "HelloWorld".toCharArray()) {
            int b=in.read();
            assertTrue(b > 0);
            assertEquals(c,(char)b);
          }
          latch.countDown();
        }
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
.start();
  byte[] bytes="HelloWorld".getBytes("UTF-8");
  for (int i=0; i < writes; i++)   client.getOutputStream().write(bytes);
  assertTrue(latch.await(100,TimeUnit.SECONDS));
}
