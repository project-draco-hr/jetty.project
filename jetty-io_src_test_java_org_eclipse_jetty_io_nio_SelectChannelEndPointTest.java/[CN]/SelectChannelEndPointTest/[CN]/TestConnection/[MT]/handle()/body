{
  boolean progress=true;
  while (progress) {
    progress=false;
    _in.compact();
    if (_in.space() > 0 && _endp.fill(_in) > 0) {
      progress=true;
      ((AsyncEndPoint)_endp).cancelIdle();
    }
    if (_blockAt > 0 && _in.length() > 0 && _in.length() < _blockAt) {
      _endp.blockReadable(10000);
      if (_in.space() > 0 && _endp.fill(_in) > 0)       progress=true;
    }
    if (_echo && _in.hasContent() && _in.skip(_out.put(_in)) > 0)     progress=true;
    if (_out.hasContent() && _endp.flush(_out) > 0)     progress=true;
    _out.compact();
    if (!_out.hasContent() && _endp.isInputShutdown())     _endp.shutdownOutput();
  }
  return this;
}
