{
  List<X509Certificate> chainRoots=new ArrayList<X509Certificate>();
  for (int i=0; i < certificates.length - 1; i++) {
    if (!((X509Certificate)certificates[i + 1]).getSubjectDN().equals(((X509Certificate)certificates[i]).getIssuerDN())) {
      chainRoots.add((X509Certificate)certificates[i]);
    }
  }
  chainRoots.add((X509Certificate)certificates[certificates.length - 1]);
  return chainRoots.toArray(new X509Certificate[chainRoots.size()]);
}
