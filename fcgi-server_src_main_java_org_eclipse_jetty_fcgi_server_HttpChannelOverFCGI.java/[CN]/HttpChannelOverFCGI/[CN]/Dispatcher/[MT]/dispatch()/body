{
  while (true) {
    State current=state.get();
switch (current) {
case IDLE:
{
        if (!state.compareAndSet(current,State.DISPATCH))         continue;
        executor.execute(this);
        return;
      }
case DISPATCH:
case EXECUTE:
{
      if (state.compareAndSet(current,State.SCHEDULE))       return;
      continue;
    }
case SCHEDULE:
{
    return;
  }
default :
{
  throw new IllegalStateException();
}
}
}
}
