{
  if (LOG.isDebugEnabled())   LOG.debug("Queued change {}",change);
  out:   while (true) {
    State state=_state.get();
switch (state) {
case PROCESSING:
      if (!_state.compareAndSet(State.PROCESSING,State.LOCKED))       continue;
    _addChanges.add(change);
  _state.set(State.PROCESSING);
break out;
case CHANGING:
if (!_state.compareAndSet(State.CHANGING,State.LOCKED)) continue;
_addChanges.add(change);
_state.set(State.CHANGING);
break out;
case SELECTING:
if (!_state.compareAndSet(State.SELECTING,State.LOCKED)) continue;
_addChanges.add(change);
_selector.wakeup();
_state.set(State.PROCESSING);
break out;
case LOCKED:
Thread.yield();
continue;
}
}
}
