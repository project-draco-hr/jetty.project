{
  try {
    Object attachment=key.attachment();
    if (attachment instanceof SelectableAsyncEndPoint) {
      key.interestOps(0);
      ((SelectableAsyncEndPoint)attachment).onSelected();
    }
 else     if (key.isConnectable()) {
      SocketChannel channel=(SocketChannel)key.channel();
      try {
        boolean connected=channel.finishConnect();
        if (connected) {
          AsyncEndPoint endpoint=createEndPoint(channel,key);
          key.attach(endpoint);
        }
 else {
          throw new ConnectException();
        }
      }
 catch (      Exception x) {
        connectionFailed(channel,x,attachment);
        key.cancel();
      }
    }
 else {
      throw new IllegalStateException();
    }
  }
 catch (  CancelledKeyException x) {
    LOG.debug("Ignoring cancelled key for channel",key.channel());
  }
}
