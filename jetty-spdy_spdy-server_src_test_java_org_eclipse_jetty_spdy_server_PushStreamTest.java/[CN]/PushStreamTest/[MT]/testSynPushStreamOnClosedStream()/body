{
  final CountDownLatch pushStreamFailedLatch=new CountDownLatch(1);
  Session clientSession=startClient(startServer(new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      stream.reply(new ReplyInfo(true),new Callback.Adapter());
      stream.push(new PushInfo(1,TimeUnit.SECONDS,new Fields(),false),new Promise.Adapter<Stream>(){
        @Override public void failed(        Throwable x){
          pushStreamFailedLatch.countDown();
        }
      }
);
      return super.onSyn(stream,synInfo);
    }
  }
),new SessionFrameListener.Adapter());
  clientSession.syn(new SynInfo(new Fields(),true),null);
  assertThat("pushStream push has failed",pushStreamFailedLatch.await(5,TimeUnit.SECONDS),is(true));
}
