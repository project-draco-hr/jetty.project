{
  try {
    HttpConnectionOverHTTP connection=getHttpConnection();
    EndPoint endPoint=connection.getEndPoint();
    boolean looping=false;
    while (true) {
      if (connection.isClosed()) {
        if (LOG.isDebugEnabled())         LOG.debug("{} closed",connection);
        releaseBuffer(buffer);
        return;
      }
      if (!looping && !parse(buffer))       return;
      int read=endPoint.fill(buffer);
      if (LOG.isDebugEnabled())       LOG.debug("Read {} bytes from {}",read,endPoint);
      if (read > 0) {
        if (!parse(buffer))         return;
      }
 else       if (read == 0) {
        releaseBuffer(buffer);
        fillInterested();
        return;
      }
 else {
        releaseBuffer(buffer);
        shutdown();
        return;
      }
      looping=true;
    }
  }
 catch (  Throwable x) {
    if (LOG.isDebugEnabled())     LOG.debug(x);
    releaseBuffer(buffer);
    failAndClose(x);
  }
}
