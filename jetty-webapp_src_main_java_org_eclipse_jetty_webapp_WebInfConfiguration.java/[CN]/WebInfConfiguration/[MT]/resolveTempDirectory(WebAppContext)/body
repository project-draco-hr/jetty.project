{
  File tmpDir=context.getTempDirectory();
  if (tmpDir != null && tmpDir.isDirectory() && tmpDir.canWrite()) {
    context.setAttribute(TEMPDIR_CONFIGURED,Boolean.TRUE);
    return;
  }
  File servletTmpDir=asFile(context.getAttribute(WebAppContext.TEMPDIR));
  if (servletTmpDir != null && servletTmpDir.isDirectory() && servletTmpDir.canWrite()) {
    tmpDir=servletTmpDir;
    context.setAttribute(WebAppContext.TEMPDIR,tmpDir);
    context.setTempDirectory(tmpDir);
    return;
  }
  try {
    File work=new File(System.getProperty("jetty.base"),"work");
    if (work.exists() && work.canWrite() && work.isDirectory()) {
      makeTempDirectory(work,context,false);
    }
 else {
      File baseTemp=asFile(context.getAttribute(WebAppContext.BASETEMPDIR));
      if (baseTemp != null && baseTemp.isDirectory() && baseTemp.canWrite()) {
        makeTempDirectory(baseTemp,context,false);
      }
 else {
        makeTempDirectory(new File(System.getProperty("java.io.tmpdir")),context,true);
      }
    }
  }
 catch (  Exception e) {
    tmpDir=null;
    LOG.ignore(e);
  }
  if (context.getTempDirectory() == null) {
    try {
      tmpDir=File.createTempFile("JettyContext","");
      if (tmpDir.exists())       IO.delete(tmpDir);
      tmpDir.mkdir();
      tmpDir.deleteOnExit();
      context.setTempDirectory(tmpDir);
    }
 catch (    IOException e) {
      tmpDir=null;
      throw new IllegalStateException("Cannot create tmp dir in " + System.getProperty("java.io.tmpdir") + " for context "+ context,e);
    }
  }
}
