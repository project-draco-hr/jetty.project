{
  int capacity=1024 * 1024;
  int iterations=30;
  byte[] bytes=new byte[capacity];
  new Random().nextBytes(bytes);
  ByteBuffer buffer=BufferUtil.allocate(capacity);
  BufferUtil.append(buffer,bytes,0,capacity);
  long start=System.nanoTime();
  for (int i=0; i < iterations; i++) {
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    long startRun=System.nanoTime();
    BufferUtil.writeTo(buffer.asReadOnlyBuffer(),out);
    long elapsedRun=System.nanoTime() - startRun;
    LOG.warn("run elapsed={}ms",elapsedRun / 1000);
    assertThat("Bytes in out equal bytes in buffer",Arrays.equals(bytes,out.toByteArray()),is(true));
  }
  long elapsed=System.nanoTime() - start;
  LOG.warn("elapsed={}ms average={}ms",elapsed / 1000,elapsed / iterations / 1000);
}
