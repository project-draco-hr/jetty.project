{
switch (state) {
case STATUS_LINE:
{
      this.response=new ClientUpgradeResponse();
      Matcher mat=PAT_STATUS_LINE.matcher(line);
      if (!mat.matches()) {
        throw new ParseException("Unexpected HTTP upgrade response status line [" + line + "]");
      }
      try {
        response.setStatusCode(Integer.parseInt(mat.group(1)));
      }
 catch (      NumberFormatException e) {
        throw new ParseException("Unexpected HTTP upgrade response status code",e);
      }
      response.setStatusReason(mat.group(2));
      state=State.HEADER;
      break;
    }
case HEADER:
{
    if (StringUtil.isBlank(line)) {
      state=State.END;
      return parseHeader(line);
    }
    Matcher header=PAT_HEADER.matcher(line);
    if (header.matches()) {
      String headerName=header.group(1);
      String headerValue=header.group(2);
      response.addHeader(headerName,headerValue);
    }
    break;
  }
case END:
state=State.STATUS_LINE;
return true;
}
return false;
}
