{
  if (prefaceSent.compareAndSet(false,true)) {
    HashMap<Integer,Integer> settings=new HashMap<>();
    getSession().settings(new SettingsFrame(settings,false),this);
  }
 else {
    client.addSession(getSession());
    promise.succeeded(getSession());
  }
}
