{
  int left=size;
  while (left > 0) {
    int val=inputStream.read();
    try {
      if (left % 10 == 0)       Thread.sleep(1);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    if (val == (-1)) {
      Assert.fail(String.format("Encountered an early EOL (expected another %,d bytes)",left));
    }
    stream.write(val);
    left--;
  }
  return size - left;
}
