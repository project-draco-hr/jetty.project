{
  long now=System.currentTimeMillis();
  long end=now + maxIdleTime;
  ByteBuffer content=_content;
  ByteBuffer buffer=_buffer;
  if (content != null && content.length() > 0 || buffer != null && buffer.length() > 0 || isBufferFull()) {
    flushBuffer();
    while (now < end && (content != null && content.length() > 0 || buffer != null && buffer.length() > 0) && _endp.isOpen() && !_endp.isOutputShutdown()) {
      blockForOutput(end - now);
      now=System.currentTimeMillis();
    }
  }
}
