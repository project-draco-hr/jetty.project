{
  if (close)   _persistent=false;
  if (isCommitted()) {
    LOG.debug("sendError on committed: {} {}",code,reason);
  }
 else {
    LOG.debug("sendError: {} {}",code,reason);
    setResponse(code,reason);
    if (content != null) {
      completeHeader(null,false);
      addContent(new View(new ByteArrayBuffer(content)),Generator.LAST);
    }
 else {
      completeHeader(null,true);
    }
    complete();
  }
}
