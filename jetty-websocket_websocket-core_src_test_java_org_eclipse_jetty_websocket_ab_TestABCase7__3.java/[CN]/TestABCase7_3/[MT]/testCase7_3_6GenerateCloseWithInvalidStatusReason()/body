{
  StringBuilder message=new StringBuilder();
  for (int i=0; i < 124; ++i) {
    message.append("*");
  }
  byte[] messageBytes=message.toString().getBytes();
  WebSocketFrame closeFrame=FrameBuilder.close().asFrame();
  ByteBuffer bb=ByteBuffer.allocate(WebSocketFrame.MAX_CONTROL_PAYLOAD + 1);
  bb.putChar((char)1000);
  bb.put(messageBytes);
  BufferUtil.flipToFlush(bb,0);
  closeFrame.setPayload(BufferUtil.toArray(bb));
  Generator generator=new Generator(policy);
  ByteBuffer actual=ByteBuffer.allocate(32);
  generator.generate(actual,closeFrame);
}
