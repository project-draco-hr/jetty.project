{
  ShutdownMonitor.getInstance().setExitVm(false);
  System.setProperty("DEBUG","true");
  ShutdownMonitor.getInstance().setPort(0);
  TestableServer server=new TestableServer();
  server.setStopAtShutdown(false);
  server.start();
  assertTrue(!ShutdownThread.isRegistered(server));
  assertTrue(ShutdownMonitor.isRegistered(server));
  String key=ShutdownMonitor.getInstance().getKey();
  int port=ShutdownMonitor.getInstance().getPort();
  stop("stop",port,key,true);
  assertTrue(!ShutdownMonitor.getInstance().isAlive());
  assertTrue(!server.stopped);
  assertTrue(!server.destroyed);
  assertTrue(!ShutdownThread.isRegistered(server));
  assertTrue(ShutdownMonitor.isRegistered(server));
}
