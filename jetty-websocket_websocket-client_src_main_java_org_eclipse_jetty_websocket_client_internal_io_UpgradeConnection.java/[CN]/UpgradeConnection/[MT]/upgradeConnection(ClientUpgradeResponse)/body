{
  EndPoint endp=getEndPoint();
  Executor executor=getExecutor();
  WebSocketClientConnection connection=new WebSocketClientConnection(endp,executor,client);
  EventDriver websocket=client.getWebSocket();
  WebSocketPolicy policy=client.getPolicy();
  String acceptedSubProtocol=response.getAcceptedSubProtocol();
  WebSocketSession session=new WebSocketSession(websocket,connection,policy,acceptedSubProtocol);
  connection.setSession(session);
  List<Extension> extensions=client.getFactory().initExtensions(response.getExtensions());
  IncomingFrames incoming=session;
  OutgoingFrames outgoing=connection;
  if (extensions != null) {
    connection.getParser().configureFromExtensions(extensions);
    connection.getGenerator().configureFromExtensions(extensions);
    Iterator<Extension> extIter;
    extIter=extensions.iterator();
    while (extIter.hasNext()) {
      Extension ext=extIter.next();
      ext.setNextOutgoingFrames(outgoing);
      outgoing=ext;
    }
    Collections.reverse(extensions);
    extIter=extensions.iterator();
    while (extIter.hasNext()) {
      Extension ext=extIter.next();
      ext.setNextIncomingFrames(incoming);
      incoming=ext;
    }
  }
  session.setOutgoing(outgoing);
  connection.getParser().setIncomingFramesHandler(incoming);
  endp.setConnection(connection);
  connection.onOpen();
}
