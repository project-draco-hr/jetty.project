{
  super(endp,executor);
  this.client=client;
  this.bufferPool=client.getFactory().getBufferPool();
  this.scheduler=client.getFactory().getScheduler();
  this.parser=new HttpResponseHeaderParser();
  try {
    this.request=(ClientUpgradeRequest)client.getUpgradeRequest();
  }
 catch (  ClassCastException e) {
    client.failed(null,new RuntimeException("Invalid Upgrade Request structure",e));
  }
}
