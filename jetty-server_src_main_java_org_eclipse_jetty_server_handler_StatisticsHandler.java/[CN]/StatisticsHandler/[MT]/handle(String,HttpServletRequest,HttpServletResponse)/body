{
  final Request base_request=(request instanceof Request) ? ((Request)request) : HttpConnection.getCurrentConnection().getRequest();
  final Response base_response=(response instanceof Response) ? ((Response)response) : HttpConnection.getCurrentConnection().getResponse();
  long timestamp0=base_request.getTimeStamp();
  long timestamp1=timestamp0;
  try {
synchronized (this) {
      AsyncRequest asyncContextState=base_request.getAsyncRequest();
      if (asyncContextState == null) {
        _requests++;
      }
 else {
        if (asyncContextState.isInitial())         _requests++;
 else {
          timestamp1=System.currentTimeMillis();
        }
      }
      _requestsActive++;
      if (_requestsActive > _requestsActiveMax)       _requestsActiveMax=_requestsActive;
    }
    super.handle(target,request,response);
  }
  finally {
synchronized (this) {
      _requestsActive--;
      if (_requestsActive < 0)       _requestsActive=0;
      if (_requestsActive < _requestsActiveMin)       _requestsActiveMin=_requestsActive;
      long duration=System.currentTimeMillis() - timestamp1;
      _requestsActiveDurationTotal+=duration;
      if (_requestsActiveDurationMin == 0 || duration < _requestsActiveDurationMin)       _requestsActiveDurationMin=duration;
      if (duration > _requestsActiveDurationMax)       _requestsActiveDurationMax=duration;
      if (base_request.isAsyncStarted()) {
        Object list=base_request.getAttribute(COMPLETE_HANDLER_ATTR);
        base_request.setAttribute(COMPLETE_HANDLER_ATTR,LazyList.add(list,this));
      }
 else {
        duration=System.currentTimeMillis() - timestamp0;
        addRequestsDurationTotal(duration);
switch (base_response.getStatus() / 100) {
case 1:
          _responses1xx++;
        break;
case 2:
      _responses2xx++;
    break;
case 3:
  _responses3xx++;
break;
case 4:
_responses4xx++;
break;
case 5:
_responses5xx++;
break;
}
_responsesBytesTotal+=base_response.getContentCount();
}
}
}
}
