{
  try {
    ByteBuffer buffer=BufferUtil.allocate(8);
    int filled=getEndPoint().fill(buffer);
    LOG.debug("Read SOCKS4 connect response, {} bytes",filled);
    if (filled != 8)     throw new IOException("Invalid response from SOCKS4 proxy");
    int result=buffer.get(1);
    if (result == 0x5A)     tunnel();
 else     throw new IOException("SOCKS4 tunnel failed with code " + result);
  }
 catch (  Throwable x) {
    failed(x);
  }
}
