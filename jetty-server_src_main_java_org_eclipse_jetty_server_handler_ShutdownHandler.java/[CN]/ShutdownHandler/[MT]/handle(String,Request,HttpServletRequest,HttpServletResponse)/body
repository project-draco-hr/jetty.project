{
  if (!target.equals("/shutdown")) {
    return;
  }
  if (!request.getMethod().equals("POST")) {
    response.sendError(HttpServletResponse.SC_BAD_REQUEST);
    return;
  }
  if (!hasCorrectSecurityToken(request)) {
    LOG.warn("Unauthorized shutdown attempt from " + getRemoteAddr(request));
    response.sendError(HttpServletResponse.SC_UNAUTHORIZED);
    return;
  }
  if (!requestFromLocalhost(request)) {
    LOG.warn("Unauthorized shutdown attempt from " + getRemoteAddr(request));
    response.sendError(HttpServletResponse.SC_UNAUTHORIZED);
    return;
  }
  LOG.info("Shutting down by request from " + getRemoteAddr(request));
  try {
    shutdownServer();
  }
 catch (  Exception e) {
    throw new RuntimeException("Shutting down server",e);
  }
}
