{
  _debug=LOG.isDebugEnabled();
  LOG.debug("{} fill",_session);
  ByteBuffer bbuf=((NIOBuffer)buffer).getByteBuffer();
  int size=buffer.length();
synchronized (bbuf) {
    bbuf.position(buffer.putIndex());
    try {
      unwrap(bbuf);
      process(bbuf,null);
    }
  finally {
      buffer.setPutIndex(bbuf.position());
      bbuf.position(0);
    }
  }
  int filled=buffer.length() - size;
  if (filled == 0 && isInputShutdown())   return -1;
  return filled;
}
