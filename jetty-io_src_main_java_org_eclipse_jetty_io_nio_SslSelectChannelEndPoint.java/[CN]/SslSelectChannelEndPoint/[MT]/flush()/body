{
  LOG.debug(_session + " flush");
  if (!isOpen())   throw new EofException();
  if (isBufferingOutput()) {
    int flushed=super.flush(_outNIOBuffer);
    if (_debug)     LOG.debug(_session + " flushed " + flushed+ " left="+ _outNIOBuffer.length());
  }
 else   if (_engine.isOutboundDone() && super.isOpen()) {
    if (_debug)     LOG.debug(_session + " flush shutdownOutput");
    try {
      super.shutdownOutput();
    }
 catch (    IOException e) {
      LOG.ignore(e);
    }
  }
  freeOutBuffer();
}
