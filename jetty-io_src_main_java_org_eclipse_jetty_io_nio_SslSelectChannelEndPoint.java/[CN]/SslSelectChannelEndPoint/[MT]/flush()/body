{
  if (isBufferingOutput()) {
    int flushed=super.flush(_outNIOBuffer);
    if (_debug)     LOG.debug(_session + " flushed " + flushed+ " left="+ _outNIOBuffer.length());
  }
 else   if (_closing) {
    if (_engine.isOutboundDone() && !super.isOutputShutdown()) {
      if (_debug)       LOG.debug(_session + " flush shutdownOutput");
      super.shutdownOutput();
    }
 else {
      if (_debug)       LOG.debug(_session + " flush closeOutbound");
      _engine.closeOutbound();
    }
  }
}
