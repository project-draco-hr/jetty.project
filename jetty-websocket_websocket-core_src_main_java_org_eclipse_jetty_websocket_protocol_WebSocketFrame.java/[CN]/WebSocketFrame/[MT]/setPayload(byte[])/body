{
  if (buf == null) {
    data=null;
    return this;
  }
  if (opcode.isControlFrame()) {
    if (buf.length > WebSocketFrame.MAX_CONTROL_PAYLOAD) {
      throw new ProtocolException("Control Payloads can not exceed 125 bytes in length.");
    }
  }
  int len=buf.length;
  data=ByteBuffer.allocate(len);
  BufferUtil.clearToFill(data);
  data.put(buf,0,len);
  BufferUtil.flipToFlush(data,0);
  BufferUtil.flipToFill(data);
  return this;
}
