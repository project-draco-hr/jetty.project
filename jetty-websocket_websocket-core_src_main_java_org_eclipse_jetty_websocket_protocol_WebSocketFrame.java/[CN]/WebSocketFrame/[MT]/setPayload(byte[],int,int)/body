{
  if (opcode.isControlFrame()) {
    if (len > WebSocketFrame.MAX_CONTROL_PAYLOAD) {
      throw new ProtocolException("Control Payloads can not exceed 125 bytes in length.");
    }
  }
  this.payload=ByteBuffer.allocate(len);
  this.payload.put(buf,offset,len);
  this.payload.flip();
  this.setPayloadLength(len);
}
