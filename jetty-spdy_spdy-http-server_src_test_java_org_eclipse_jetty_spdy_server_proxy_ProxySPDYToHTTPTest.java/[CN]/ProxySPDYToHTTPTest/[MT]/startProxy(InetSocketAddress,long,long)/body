{
  proxy=new Server();
  ProxyEngineSelector proxyEngineSelector=new ProxyEngineSelector();
  HttpClient httpClient=new HttpClient();
  httpClient.start();
  httpClient.setIdleTimeout(proxyEngineTimeout);
  HTTPProxyEngine httpProxyEngine=new HTTPProxyEngine(httpClient);
  proxyEngineSelector.putProxyEngine("http/1.1",httpProxyEngine);
  proxyEngineSelector.putProxyServerInfo("localhost",new ProxyEngineSelector.ProxyServerInfo("http/1.1",address.getHostName(),address.getPort()));
  proxyConnector=new HTTPSPDYProxyServerConnector(proxy,sslContextFactory,proxyEngineSelector);
  proxyConnector.setPort(0);
  proxyConnector.setIdleTimeout(proxyConnectorTimeout);
  proxy.addConnector(proxyConnector);
  proxy.start();
  return new InetSocketAddress("localhost",proxyConnector.getLocalPort());
}
