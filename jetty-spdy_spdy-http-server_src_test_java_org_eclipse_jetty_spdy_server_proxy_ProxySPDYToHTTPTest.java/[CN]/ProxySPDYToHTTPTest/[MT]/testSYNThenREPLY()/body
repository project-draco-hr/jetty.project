{
  final String header="foo";
  InetSocketAddress proxyAddress=startProxy(startServer(new TestServerHandler(header,null)),30000,30000);
  Session client=factory.newSPDYClient(version).connect(proxyAddress,null);
  final CountDownLatch replyLatch=new CountDownLatch(1);
  Fields headers=SPDYTestUtils.createHeaders("localhost",proxyAddress.getPort(),version,"GET","/");
  headers.put(header,"bar");
  headers.put("connection","close");
  client.syn(new SynInfo(headers,true),new StreamFrameListener.Adapter(){
    @Override public void onReply(    Stream stream,    ReplyInfo replyInfo){
      Fields headers=replyInfo.getHeaders();
      assertThat("Version header is set",headers.get(HTTPSPDYHeader.VERSION.name(version)),is(notNullValue()));
      assertThat("Custom set header foo is set on response",headers.get(header),is(notNullValue()));
      assertThat("HOP headers like connection are removed before forwarding",headers.get("connection"),is(nullValue()));
      replyLatch.countDown();
    }
  }
);
  assertThat("Reply is send to SPDY client",replyLatch.await(5,TimeUnit.SECONDS),is(true));
}
