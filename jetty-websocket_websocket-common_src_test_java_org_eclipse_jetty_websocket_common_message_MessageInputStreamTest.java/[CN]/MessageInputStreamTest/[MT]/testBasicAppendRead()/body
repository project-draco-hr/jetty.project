{
  LocalWebSocketConnection conn=new LocalWebSocketConnection(testname);
  try (MessageInputStream stream=new MessageInputStream(conn)){
    ByteBuffer payload=BufferUtil.toBuffer("Hello World",StandardCharsets.UTF_8);
    System.out.printf("payload = %s%n",BufferUtil.toDetailString(payload));
    boolean fin=true;
    stream.appendMessage(payload,fin);
    byte buf[]=new byte[32];
    int len=stream.read(buf);
    String message=new String(buf,0,len,StandardCharsets.UTF_8);
    Assert.assertThat("Message",message,is("Hello World"));
  }
 }
