{
  Server server=new Server();
  WebAppContext wac=new WebAppContext();
  wac.setServer(server);
  InjectionCollection injections=new InjectionCollection();
  wac.setAttribute(InjectionCollection.INJECTION_COLLECTION,injections);
  wac.setAttribute(MetaData.METADATA,new MetaData(wac));
  InitialContext ic=new InitialContext();
  Context comp=(Context)ic.lookup("java:comp");
  Context env=comp.createSubcontext("env");
  org.eclipse.jetty.plus.jndi.EnvEntry resourceA=new org.eclipse.jetty.plus.jndi.EnvEntry(server,"resA",new Integer(1000),false);
  org.eclipse.jetty.plus.jndi.EnvEntry resourceB=new org.eclipse.jetty.plus.jndi.EnvEntry(server,"resB",new Integer(2000),false);
  AnnotationIntrospector parser=new AnnotationIntrospector();
  ResourceAnnotationHandler handler=new ResourceAnnotationHandler(wac);
  parser.registerHandler(handler);
  parser.introspect(ResourceA.class);
  parser.introspect(ResourceB.class);
  assertEquals(resourceB.getObjectToBind(),env.lookup("myf"));
  assertEquals(resourceA.getObjectToBind(),env.lookup("mye"));
  assertEquals(resourceA.getObjectToBind(),env.lookup("resA"));
  assertEquals(resourceA.getObjectToBind(),env.lookup("org.eclipse.jetty.annotations.resources.ResourceA/g"));
  assertEquals(resourceA.getObjectToBind(),env.lookup("org.eclipse.jetty.annotations.resources.ResourceA/h"));
  assertEquals(resourceB.getObjectToBind(),env.lookup("org.eclipse.jetty.annotations.resources.ResourceB/f"));
  assertEquals(resourceB.getObjectToBind(),env.lookup("org.eclipse.jetty.annotations.resources.ResourceA/n"));
  assertNotNull(injections);
  List<Injection> resBInjections=injections.getInjections(ResourceB.class.getCanonicalName());
  assertNotNull(resBInjections);
  assertEquals(1,resBInjections.size());
  Injection fi=resBInjections.get(0);
  assertEquals("f",fi.getTarget().getName());
  List<Injection> resAInjections=injections.getInjections(ResourceA.class.getCanonicalName());
  assertNotNull(resAInjections);
  assertEquals(7,resAInjections.size());
  int fieldCount=0;
  int methodCount=0;
  for (  Injection x : resAInjections) {
    if (x.isField())     fieldCount++;
 else     methodCount++;
  }
  assertEquals(4,fieldCount);
  assertEquals(3,methodCount);
  ResourceB binst=new ResourceB();
  injections.inject(binst);
  Field f=ResourceB.class.getDeclaredField("f");
  f.setAccessible(true);
  assertEquals(resourceB.getObjectToBind(),f.get(binst));
  f=ResourceA.class.getDeclaredField("g");
  f.setAccessible(true);
  assertEquals(resourceA.getObjectToBind(),f.get(binst));
  f=ResourceA.class.getDeclaredField("j");
  f.setAccessible(true);
  assertEquals(resourceA.getObjectToBind(),f.get(binst));
  f=ResourceA.class.getDeclaredField("n");
  f.setAccessible(true);
  assertEquals(resourceB.getObjectToBind(),f.get(binst));
  comp.destroySubcontext("env");
}
