{
  if (isSecure()) {
    request.setScheme(HttpScheme.HTTPS.asString());
    SslConnection.DecryptedEndPoint ssl_endp=(SslConnection.DecryptedEndPoint)request.getHttpChannel().getEndPoint();
    SslConnection sslConnection=ssl_endp.getSslConnection();
    SSLEngine sslEngine=sslConnection.getSSLEngine();
    SslCertificates.customize(sslEngine,request);
  }
  request.setTimeStamp(System.currentTimeMillis());
  if (isForwarded())   checkForwardedHeaders(request);
}
