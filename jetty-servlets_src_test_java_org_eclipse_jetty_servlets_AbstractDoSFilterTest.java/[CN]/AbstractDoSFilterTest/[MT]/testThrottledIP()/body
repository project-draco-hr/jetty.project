{
  Thread other=new Thread(){
    public void run(){
      try {
        String request="GET /ctx/dos/sleeper HTTP/1.1\r\nHost: localhost\r\n\r\n";
        String last="GET /ctx/dos/sleeper?sleep=3000 HTTP/1.1\r\nHost: localhost\r\nConnection: close\r\n\r\n";
        String responses=doRequests(request + request + request+ request,1,0,0,last);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
;
  other.start();
  Thread.sleep(1500);
  String request="GET /ctx/dos/test HTTP/1.1\r\nHost: localhost\r\n\r\n";
  String last="GET /ctx/dos/test HTTP/1.1\r\nHost: localhost\r\nConnection: close\r\n\r\n";
  String responses=doRequests(request + request + request+ request,1,0,0,last);
  assertEquals("200 OK responses",5,count(responses,"HTTP/1.1 200 OK"));
  assertEquals("delayed responses",1,count(responses,"DoSFilter: delayed"));
  assertEquals("throttled responses",1,count(responses,"DoSFilter: throttled"));
  assertEquals("unavailable responses",0,count(responses,"DoSFilter: unavailable"));
  other.join();
}
