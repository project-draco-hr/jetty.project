{
  LOG.debug("{} complete",this);
  if (_state.isCompleting()) {
    _state.completed();
    if (isExpecting100Continue()) {
      LOG.debug("100-Continue response not sent");
      _expect100Continue=false;
      if (!isCommitted())       _response.addHeader(HttpHeader.CONNECTION.toString(),HttpHeaderValue.CLOSE.toString());
 else       LOG.warn("Cannot send 'Connection: close' for 100-Continue, response is already committed");
    }
    if (!_response.isCommitted() && !_request.isHandled())     _response.sendError(Response.SC_NOT_FOUND,null,null);
    _request.setHandled(true);
    try {
      _response.getHttpOutput().close();
    }
 catch (    IOException x) {
      LOG.debug("Could not write response",x);
    }
  }
  return _request.getHttpInput().isShutdown();
}
