{
  _requests++;
  boolean persistent;
switch (_version) {
case HTTP_0_9:
    persistent=false;
  break;
case HTTP_1_0:
persistent=_request.getHttpFields().contains(HttpHeader.CONNECTION,HttpHeaderValue.KEEP_ALIVE.asString());
if (persistent) _response.getHttpFields().add(HttpHeader.CONNECTION,HttpHeaderValue.KEEP_ALIVE);
if (_server.getSendDateHeader()) _response.getHttpFields().putDateField(HttpHeader.DATE.toString(),_request.getTimeStamp());
break;
case HTTP_1_1:
persistent=!_request.getHttpFields().contains(HttpHeader.CONNECTION,HttpHeaderValue.CLOSE.asString());
if (!persistent) _response.getHttpFields().add(HttpHeader.CONNECTION,HttpHeaderValue.CLOSE);
if (_server.getSendDateHeader()) _response.getHttpFields().putDateField(HttpHeader.DATE.toString(),_request.getTimeStamp());
if (!_host) {
commitError(HttpStatus.BAD_REQUEST_400,"No Host Header",null);
return true;
}
if (_expect) {
commitError(HttpStatus.EXPECTATION_FAILED_417,null,null);
return true;
}
break;
default :
throw new IllegalStateException();
}
_request.setPersistent(persistent);
if (_expect100Continue) return true;
return false;
}
