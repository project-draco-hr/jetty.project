{
  _requests++;
switch (_version) {
case HTTP_0_9:
    break;
case HTTP_1_0:
  if (persistent)   _responseFields.add(HttpHeader.CONNECTION,HttpHeaderValue.KEEP_ALIVE);
if (_server.getSendDateHeader()) _responseFields.putDateField(HttpHeader.DATE.toString(),_request.getTimeStamp());
break;
case HTTP_1_1:
if (!persistent) _responseFields.add(HttpHeader.CONNECTION,HttpHeaderValue.CLOSE);
if (_server.getSendDateHeader()) _responseFields.putDateField(HttpHeader.DATE.toString(),_request.getTimeStamp());
if (!_host) {
LOG.debug("!host {}",this);
_responseFields.put(HttpHeader.CONNECTION,HttpHeaderValue.CLOSE);
_in.shutdownInput();
sendError(HttpStatus.BAD_REQUEST_400,"No Host Header",null,true);
_state.complete();
return true;
}
if (_expect) {
LOG.debug("!expectation {}",this);
_responseFields.put(HttpHeader.CONNECTION,HttpHeaderValue.CLOSE);
_in.shutdownInput();
sendError(HttpStatus.EXPECTATION_FAILED_417,null,null,true);
_state.complete();
return true;
}
break;
default :
}
if (_expect100Continue) return true;
return false;
}
