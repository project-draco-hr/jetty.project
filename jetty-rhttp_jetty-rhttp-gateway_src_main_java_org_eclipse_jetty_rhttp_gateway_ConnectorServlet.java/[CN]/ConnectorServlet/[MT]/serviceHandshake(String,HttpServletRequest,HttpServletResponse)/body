{
  ClientDelegate client=gateway.getClientDelegate(targetId);
  if (client != null)   throw new IOException("Client with targetId " + targetId + " is already connected");
  client=gateway.newClientDelegate(targetId);
  ClientDelegate existing=gateway.addClientDelegate(targetId,client);
  if (existing != null)   throw new IOException("Client with targetId " + targetId + " is already connected");
  flush(client,httpRequest,httpResponse);
}
