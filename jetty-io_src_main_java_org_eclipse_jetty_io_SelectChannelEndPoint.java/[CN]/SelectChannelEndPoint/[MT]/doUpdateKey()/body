{
synchronized (this) {
    _changing=false;
    if (getChannel().isOpen()) {
      if (_interestOps > 0) {
        if (_key == null || !_key.isValid()) {
          SelectableChannel sc=(SelectableChannel)getChannel();
          if (sc.isRegistered()) {
            updateKey();
          }
 else {
            try {
              _key=((SelectableChannel)getChannel()).register(_selector.getSelector(),_interestOps,this);
            }
 catch (            Exception e) {
              LOG.ignore(e);
              if (_key != null && _key.isValid()) {
                _key.cancel();
              }
              if (_open) {
                _selector.destroyEndPoint(this);
              }
              _open=false;
              _key=null;
            }
          }
        }
 else {
          _key.interestOps(_interestOps);
        }
      }
 else {
        if (_key != null && _key.isValid())         _key.interestOps(0);
 else         _key=null;
      }
    }
 else {
      if (_key != null && _key.isValid())       _key.cancel();
      if (_open) {
        _open=false;
        _selector.destroyEndPoint(this);
      }
      _key=null;
    }
  }
}
