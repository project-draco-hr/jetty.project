{
  int readyOps=_key.readyOps();
  int oldInterestOps;
  int newInterestOps;
  try (Locker.Lock lock=_locker.lock()){
    _updatePending=true;
    oldInterestOps=_desiredInterestOps;
    newInterestOps=oldInterestOps & ~readyOps;
    _desiredInterestOps=newInterestOps;
  }
   if (LOG.isDebugEnabled())   LOG.debug("onSelected {}->{} for {}",oldInterestOps,newInterestOps,this);
  boolean readable=(readyOps & SelectionKey.OP_READ) != 0;
  boolean writable=(readyOps & SelectionKey.OP_WRITE) != 0;
  if (readable && getFillInterest().isCallbackNonBlocking()) {
    getFillInterest().fillable();
    readable=false;
  }
  if (writable && getWriteFlusher().isCallbackNonBlocking()) {
    getWriteFlusher().completeWrite();
    writable=false;
  }
  return readable ? (writable ? _runFillableCompleteWrite : _runFillable) : (writable ? _runCompleteWrite : null);
}
