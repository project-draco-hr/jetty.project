{
  Set<String> result=Collections.emptySet();
  short version=stream.getSession().getVersion();
  String scheme=requestHeaders.get(HTTPSPDYHeader.SCHEME.name(version)).value();
  String host=requestHeaders.get(HTTPSPDYHeader.HOST.name(version)).value();
  String origin=new StringBuilder(scheme).append("://").append(host).toString();
  String url=requestHeaders.get(HTTPSPDYHeader.URI.name(version)).value();
  String absoluteURL=new StringBuilder(origin).append(url).toString();
  logger.debug("Applying push strategy for {}",absoluteURL);
  if (isValidMethod(requestHeaders.get(HTTPSPDYHeader.METHOD.name(version)).value())) {
    if (isMainResource(url,responseHeaders)) {
      result=pushResources(absoluteURL);
    }
 else     if (isPushResource(url,responseHeaders)) {
      Headers.Header referrerHeader=requestHeaders.get("referer");
      if (referrerHeader != null) {
        String referrer=referrerHeader.value();
        Set<String> pushResources=resources.get(referrer);
        if (pushResources == null || !pushResources.contains(url))         buildMetadata(origin,url,referrer);
 else         result=pushResources(absoluteURL);
      }
    }
  }
  logger.debug("Push resources for {}: {}",absoluteURL,result);
  return result;
}
