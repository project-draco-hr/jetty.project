{
  String url=requestHeaders.get("url").value();
  if (!hasQueryString(url)) {
    if (isMainResource(url,responseHeaders)) {
      return pushResources(url);
    }
 else     if (isPushResource(url,responseHeaders)) {
      String referrer=requestHeaders.get("referer").value();
      Set<String> pushResources=resources.get(referrer);
      if (pushResources == null || !pushResources.contains(url)) {
        buildMetadata(url,referrer);
      }
 else {
        return pushResources(url);
      }
    }
  }
  return Collections.emptySet();
}
