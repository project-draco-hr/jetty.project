{
  if (referrer.startsWith(origin) || isPushOriginAllowed(origin)) {
    Set<String> pushResources=resources.get(referrer);
    if (pushResources == null) {
      pushResources=Collections.newSetFromMap(new ConcurrentHashMap<String,Boolean>());
      Set<String> existing=resources.putIfAbsent(referrer,pushResources);
      if (existing != null)       pushResources=existing;
    }
    if (pushResources.size() < getMaxAssociatedResources()) {
      pushResources.add(url);
      logger.debug("Stored push metadata for {}: {}",referrer,pushResources);
    }
 else {
      logger.debug("Skipped store of push metadata {} for {}: max associated resources ({}) reached",url,referrer,maxAssociatedResources);
    }
  }
}
