{
  if (referrer.startsWith(origin) || isPushOriginAllowed(origin)) {
    Set<String> pushResources=resources.get(referrer);
    if (pushResources == null) {
      pushResources=Collections.newSetFromMap(new ConcurrentHashMap<String,Boolean>());
      Set<String> existing=resources.putIfAbsent(referrer,pushResources);
      if (existing != null)       pushResources=existing;
    }
    pushResources.add(url);
    logger.debug("Built push metadata for {}: {}",referrer,pushResources);
  }
}
