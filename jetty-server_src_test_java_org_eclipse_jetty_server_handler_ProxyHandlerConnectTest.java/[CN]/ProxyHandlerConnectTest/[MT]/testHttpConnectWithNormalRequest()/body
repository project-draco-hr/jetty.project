{
  String request="" + "CONNECT localhost:" + serverConnector.getLocalPort() + " HTTP/1.1\r\n"+ "Host: localhost\r\n"+ "\r\n";
  Socket socket=new Socket("localhost",proxyConnector.getLocalPort());
  try {
    OutputStream output=socket.getOutputStream();
    output.write(request.getBytes("UTF-8"));
    output.flush();
    InputStream input=socket.getInputStream();
    Response response=readResponse(input);
    System.err.println(response);
    assertEquals("200",response.code);
    String echoURI="GET /echo";
    request="" + echoURI + " HTTP/1.1\r\n"+ "Host: localhost\r\n"+ "\r\n";
    output.write(request.getBytes("UTF-8"));
    output.flush();
    response=readResponse(input);
    System.err.println(response);
    assertEquals("200",response.code);
    assertEquals(echoURI,response.body);
  }
  finally {
    socket.close();
  }
}
