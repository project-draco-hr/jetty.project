{
  String request="" + "CONNECT localhost:" + serverConnector.getLocalPort() + " HTTP/1.1\r\n"+ "Host: localhost\r\n"+ "\r\n";
  Socket socket=new Socket("localhost",proxyConnector.getLocalPort());
  try {
    OutputStream output=socket.getOutputStream();
    output.write(request.getBytes("UTF-8"));
    output.flush();
    InputStream input=socket.getInputStream();
    Response response=readResponse(input);
    System.err.println(response);
    assertEquals("200",response.code);
    request="" + "GET /close HTTP/1.1\r\n" + "Host: localhost\r\n"+ "\r\n";
    output.write(request.getBytes("UTF-8"));
    output.flush();
    int read=input.read();
    assertEquals(-1,read);
  }
  finally {
    socket.close();
  }
}
