{
  int remaining=buffer.remaining();
  if (data == null) {
    if (remaining < length) {
      data=new byte[remaining];
      buffer.get(data);
      return false;
    }
 else {
      data=new byte[length];
      buffer.get(data);
      return true;
    }
  }
 else {
    int accumulated=data.length;
    int needed=length - accumulated;
    if (remaining < needed) {
      byte[] local=new byte[accumulated + remaining];
      System.arraycopy(data,0,local,0,accumulated);
      buffer.get(local,accumulated,remaining);
      data=local;
      return false;
    }
 else {
      byte[] local=new byte[length];
      System.arraycopy(data,0,local,0,accumulated);
      buffer.get(local,accumulated,needed);
      data=local;
      return true;
    }
  }
}
