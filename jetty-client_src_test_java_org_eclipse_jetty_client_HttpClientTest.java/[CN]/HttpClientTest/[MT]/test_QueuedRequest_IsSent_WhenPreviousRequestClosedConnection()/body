{
  start(new EmptyServerHandler());
  client.setMaxConnectionsPerAddress(1);
  final long idleTimeout=1000;
  client.setIdleTimeout(idleTimeout);
  final CountDownLatch latch=new CountDownLatch(3);
  client.newRequest("localhost",connector.getLocalPort()).scheme(scheme).listener(new Request.Listener.Empty(){
    @Override public void onBegin(    Request request){
      try {
        TimeUnit.MILLISECONDS.sleep(2 * idleTimeout);
      }
 catch (      InterruptedException x) {
        x.printStackTrace();
      }
    }
    @Override public void onFailure(    Request request,    Throwable failure){
      latch.countDown();
    }
  }
).onResponseFailure(new Response.FailureListener(){
    @Override public void onFailure(    Response response,    Throwable failure){
      latch.countDown();
    }
  }
).send(null);
  client.newRequest("localhost",connector.getLocalPort()).scheme(scheme).onResponseSuccess(new Response.SuccessListener(){
    @Override public void onSuccess(    Response response){
      Assert.assertEquals(200,response.getStatus());
      latch.countDown();
    }
  }
).send(null);
  Assert.assertTrue(latch.await(5 * idleTimeout,TimeUnit.MILLISECONDS));
}
