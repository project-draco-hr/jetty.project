{
  start(new EmptyHandler());
  String scheme="http";
  String host="localhost";
  int port=connector.getLocalPort();
  String path="/";
  Response response=client.GET(scheme + "://" + host+ ":"+ port+ path).get(5,TimeUnit.SECONDS);
  Assert.assertEquals(200,response.status());
  HttpDestination destination=(HttpDestination)client.getDestination(scheme,host,port);
  HttpConnection connection=(HttpConnection)destination.getIdleConnections().peek();
  Assert.assertNotNull(connection);
  client.getCookieStore().addCookie(destination,new HttpCookie("foo","bar",null,path));
  client.stop();
  Assert.assertEquals(0,client.getDestinations().size());
  Assert.assertEquals(0,destination.getIdleConnections().size());
  Assert.assertEquals(0,destination.getActiveConnections().size());
  Assert.assertEquals(0,client.getCookieStore().getCookies(destination,path).size());
  Assert.assertFalse(connection.getEndPoint().isOpen());
}
