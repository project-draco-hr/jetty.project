{
  ByteBuffer header=BufferUtil.allocate(8096);
  Info info=new Info(200);
  HttpGenerator gen=new HttpGenerator();
  info.getHttpFields().add("Last-Modified",HttpFields.__01Jan1970);
  HttpGenerator.Result result=gen.generate(info,null,null,null,null,Action.COMPLETE);
  assertEquals(HttpGenerator.State.COMMITTING_COMPLETING,gen.getState());
  assertEquals(HttpGenerator.Result.NEED_HEADER,result);
  result=gen.generate(info,header,null,null,null,null);
  assertEquals(HttpGenerator.Result.FLUSH,result);
  String head=BufferUtil.toString(header);
  BufferUtil.clear(header);
  result=gen.generate(info,null,null,null,null,null);
  assertEquals(HttpGenerator.Result.OK,result);
  assertEquals(HttpGenerator.State.END,gen.getState());
  assertEquals(0,gen.getContentPrepared());
  assertThat(head,containsString("HTTP/1.1 200 OK"));
  assertThat(head,containsString("Last-Modified: Thu, 01 Jan 1970 00?00?00 GMT"));
  assertThat(head,containsString("Content-Length: 0"));
}
