{
  if (streamId < 0)   throw new IllegalArgumentException("Invalid stream id: " + streamId);
  int dataLength=data.remaining();
  if (dataLength <= maxLength && dataLength <= Frame.MAX_LENGTH) {
    generateFrame(lease,streamId,data,last);
    return;
  }
  int length=Math.min(maxLength,dataLength);
  int dataBytesPerFrame=Frame.MAX_LENGTH;
  int frames=length / dataBytesPerFrame;
  if (frames * dataBytesPerFrame != length)   ++frames;
  int begin=data.position();
  int end=data.limit();
  for (int i=1; i <= frames; ++i) {
    int limit=begin + Math.min(dataBytesPerFrame * i,length);
    data.limit(limit);
    ByteBuffer slice=data.slice();
    data.position(limit);
    generateFrame(lease,streamId,slice,i == frames && last && limit == end);
  }
  data.limit(end);
}
