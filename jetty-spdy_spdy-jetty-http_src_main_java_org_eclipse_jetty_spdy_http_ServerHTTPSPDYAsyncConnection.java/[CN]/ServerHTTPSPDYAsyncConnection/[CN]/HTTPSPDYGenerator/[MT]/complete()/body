{
  Buffer content=getContentBuffer();
  if (content != null) {
    closed=true;
    _state=STATE_END;
    flush(getMaxIdleTime());
  }
 else   if (!closed) {
    closed=true;
    _state=STATE_END;
    stream.data(new ByteBufferDataInfo(ZERO_BYTES,true));
  }
}
