{
  String jetty_home=System.getProperty("jetty.home","..");
  System.setProperty("jetty.home",jetty_home);
  Server server=new Server();
  MBeanContainer mbContainer=new MBeanContainer(ManagementFactory.getPlatformMBeanServer());
  server.getContainer().addEventListener(mbContainer);
  server.addBean(mbContainer);
  mbContainer.addBean(Log.getLog());
  QueuedThreadPool threadPool=new QueuedThreadPool();
  threadPool.setMaxThreads(100);
  server.setThreadPool(threadPool);
  Connector connector=new SelectChannelConnector();
  connector.setPort(8080);
  connector.setMaxIdleTime(30000);
  server.setConnectors(new Connector[]{connector});
  SslSelectChannelConnector ssl_connector=new SslSelectChannelConnector();
  ssl_connector.setPort(8443);
  ssl_connector.setKeystore(jetty_home + "/etc/keystore");
  ssl_connector.setPassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
  ssl_connector.setKeyPassword("OBF:1u2u1wml1z7s1z7a1wnl1u2g");
  ssl_connector.setTruststore(jetty_home + "/etc/keystore");
  ssl_connector.setTrustPassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
  server.addConnector(ssl_connector);
  HandlerCollection handlers=new HandlerCollection();
  ContextHandlerCollection contexts=new ContextHandlerCollection();
  RequestLogHandler requestLogHandler=new RequestLogHandler();
  handlers.setHandlers(new Handler[]{contexts,new DefaultHandler(),requestLogHandler});
  server.setHandler(handlers);
  ContextDeployer deployer0=new ContextDeployer();
  deployer0.setContexts(contexts);
  deployer0.setConfigurationDir(jetty_home + "/contexts");
  deployer0.setScanInterval(1);
  server.addBean(deployer0);
  WebAppDeployer deployer1=new WebAppDeployer();
  deployer1.setContexts(contexts);
  deployer1.setWebAppDir(jetty_home + "/webapps");
  deployer1.setParentLoaderPriority(false);
  deployer1.setExtract(true);
  deployer1.setAllowDuplicates(false);
  deployer1.setDefaultsDescriptor(jetty_home + "/etc/webdefault.xml");
  server.addBean(deployer1);
  HashLoginService login=new HashLoginService();
  login.setName("Test Realm");
  login.setConfig(jetty_home + "/etc/realm.properties");
  server.addBean(login);
  NCSARequestLog requestLog=new NCSARequestLog(jetty_home + "/logs/jetty-yyyy_mm_dd.log");
  requestLog.setExtended(false);
  requestLogHandler.setRequestLog(requestLog);
  server.setStopAtShutdown(true);
  server.setSendServerVersion(true);
  server.start();
  server.join();
}
