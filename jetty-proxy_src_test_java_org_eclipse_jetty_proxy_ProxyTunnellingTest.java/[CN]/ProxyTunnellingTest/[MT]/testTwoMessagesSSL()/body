{
  startSSLServer(new ServerHandler());
  startProxy();
  HttpClient httpClient=new HttpClient(sslContextFactory);
  httpClient.setProxyConfiguration(new ProxyConfiguration("localhost",proxyPort()));
  httpClient.start();
  try {
    String body="BODY";
    ContentResponse response1=httpClient.newRequest("localhost",serverConnector.getLocalPort()).scheme(HttpScheme.HTTPS.asString()).method(HttpMethod.GET).path("/echo?body=" + URLEncoder.encode(body,"UTF-8")).send();
    String content=response1.getContentAsString();
    assertEquals(body,content);
    content="body=" + body;
    ContentResponse response2=httpClient.newRequest("localhost",serverConnector.getLocalPort()).scheme(HttpScheme.HTTPS.asString()).method(HttpMethod.POST).path("/echo").header(HttpHeader.CONTENT_TYPE,MimeTypes.Type.FORM_ENCODED.asString()).header(HttpHeader.CONTENT_LENGTH,String.valueOf(content.length())).content(new StringContentProvider(content)).send();
    content=response2.getContentAsString();
    assertEquals(body,content);
  }
  finally {
    httpClient.stop();
  }
}
