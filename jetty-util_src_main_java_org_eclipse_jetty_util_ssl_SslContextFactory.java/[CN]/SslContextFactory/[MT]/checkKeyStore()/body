{
  if (_context != null)   return;
  if (_keyStore == null && _keyStoreInputStream == null && _keyStorePath == null)   throw new IllegalStateException("SSL doesn't have a valid keystore");
  if (_trustStore == null && _trustStoreInputStream == null && _trustStorePath == null) {
    _trustStore=_keyStore;
    _trustStorePath=_keyStorePath;
    _trustStoreInputStream=_keyStoreInputStream;
    _trustStoreType=_keyStoreType;
    _trustStoreProvider=_keyStoreProvider;
    _trustStorePassword=_keyStorePassword;
    _trustManagerFactoryAlgorithm=_keyManagerFactoryAlgorithm;
  }
  if (_keyStoreInputStream != null && _keyStoreInputStream == _trustStoreInputStream) {
    try {
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      IO.copy(_keyStoreInputStream,baos);
      _keyStoreInputStream.close();
      _keyStoreInputStream=new ByteArrayInputStream(baos.toByteArray());
      _trustStoreInputStream=new ByteArrayInputStream(baos.toByteArray());
    }
 catch (    Exception ex) {
      throw new IllegalStateException(ex);
    }
  }
}
