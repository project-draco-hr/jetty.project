{
  AvailableHandler ah=new AvailableHandler();
  configureServer(ah);
  Socket client=newSocket(HOST,_connector.getLocalPort());
  try {
    OutputStream os=client.getOutputStream();
    InputStream is=client.getInputStream();
    os.write(("GET /data?writes=1024&block=256 HTTP/1.1\r\n" + "host: " + HOST + ":"+ _connector.getLocalPort()+ "\r\n"+ "connection: close\r\n"+ "content-type: unknown\r\n"+ "content-length: 30\r\n"+ "\r\n").getBytes());
    os.flush();
    Thread.sleep(500);
    os.write(("1234567890").getBytes());
    os.flush();
    ah._ex.exchange(null);
    os.write(("abcdefghijklmnopqrst").getBytes());
    os.flush();
    Thread.sleep(500);
    ah._ex.exchange(null);
    BufferedReader reader=new BufferedReader(new InputStreamReader(is));
    while (reader.readLine().length() > 0)     ;
    assertEquals(10,Integer.parseInt(reader.readLine()));
    assertEquals(0,Integer.parseInt(reader.readLine()));
    assertEquals(20,Integer.parseInt(reader.readLine()));
    assertEquals(0,Integer.parseInt(reader.readLine()));
    assertEquals("1234567890abcdefghijklmnopqrst",reader.readLine());
  }
  finally {
    client.close();
  }
}
