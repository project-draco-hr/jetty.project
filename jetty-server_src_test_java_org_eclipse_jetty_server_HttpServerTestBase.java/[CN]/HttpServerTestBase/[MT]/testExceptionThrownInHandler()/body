{
  configureServer(new AbstractHandler(){
    @Override public void handle(    String target,    Request baseRequest,    HttpServletRequest request,    HttpServletResponse response) throws IOException, ServletException {
      throw new ServletException("TEST handler exception");
    }
  }
);
  StringBuffer request=new StringBuffer("GET / HTTP/1.0\r\n");
  request.append("Host: localhost\r\n\r\n");
  Socket client=newSocket(HOST,_connector.getLocalPort());
  OutputStream os=client.getOutputStream();
  try {
    ((StdErrLog)Log.getLogger(HttpChannel.class)).setHideStacks(true);
    Log.getLogger(HttpChannel.class).info("Expecting ServletException: TEST handler exception...");
    os.write(request.toString().getBytes());
    os.flush();
    String response=readResponse(client);
    assertThat("response code is 500",response.contains("500"),is(true));
  }
  finally {
    ((StdErrLog)Log.getLogger(HttpChannel.class)).setHideStacks(false);
  }
}
