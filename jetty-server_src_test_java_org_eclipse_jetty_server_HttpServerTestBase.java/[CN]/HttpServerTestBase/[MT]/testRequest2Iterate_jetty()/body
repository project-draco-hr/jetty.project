{
  byte[] bytes=REQUEST2.getBytes();
  Server server=startServer(new EchoHandler());
  try {
    for (int i=0; i < bytes.length; i+=3) {
      int[] points=new int[]{i};
      StringBuilder message=new StringBuilder();
      message.append("iteration #").append(i + 1);
      Arrays.sort(points);
      Socket client=new Socket(HOST,port);
      OutputStream os=client.getOutputStream();
      writeFragments(bytes,points,message,os);
      String response=readResponse(client);
      client.close();
      assertEquals("response for " + i + " "+ message.toString(),RESPONSE2,response);
    }
  }
  finally {
    server.stop();
  }
}
