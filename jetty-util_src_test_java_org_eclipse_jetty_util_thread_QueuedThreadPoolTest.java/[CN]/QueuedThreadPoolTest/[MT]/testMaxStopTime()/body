{
  QueuedThreadPool tp=new QueuedThreadPool();
  tp.setMaxStopTimeMs(500);
  tp.start();
  tp.dispatch(new Runnable(){
    public void run(){
      while (true) {
        try {
          Thread.sleep(10000);
        }
 catch (        InterruptedException ie) {
        }
      }
    }
  }
);
  long beforeStop=System.currentTimeMillis();
  tp.stop();
  long afterStop=System.currentTimeMillis();
  assertTrue(tp.isStopped());
  assertTrue(afterStop - beforeStop < 1000);
}
