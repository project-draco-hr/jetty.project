{
  ContextHandler handler=app.getContextHandler();
  if (handler == null) {
    throw new NullPointerException("No Handler created for App: " + app);
  }
  if (handler instanceof WebAppContext) {
    WebAppContext webapp=(WebAppContext)handler;
    webapp.setInitParameter("org.jboss.weld.environment.container.class","org.jboss.weld.environment.jetty.JettyContainer");
    Reference ref=new Reference("javax.enterprise.inject.spi.BeanManager","org.jboss.weld.resources.ManagerObjectFactory",null);
    new Resource(webapp,"BeanManager",ref);
    webapp.addSystemClass("org.jboss.weld.");
    webapp.addSystemClass("org.jboss.classfilewriter.");
    webapp.addSystemClass("org.jboss.logging.");
    webapp.addSystemClass("com.google.common.");
    webapp.addServerClass("-org.jboss.weld.");
    webapp.addServerClass("-org.jboss.classfilewriter.");
    webapp.addServerClass("-org.jboss.logging.");
    webapp.addServerClass("-com.google.common.");
  }
}
