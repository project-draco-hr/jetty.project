{
  if (!frame.hasPayload()) {
    return BufferUtil.EMPTY_BUFFER;
  }
  ByteBuffer buffer;
  if (frame.getPayload().remaining() <= windowSize) {
    buffer=frame.getPayload().slice();
    frame.getPayload().position(frame.getPayload().limit());
  }
 else {
    buffer=frame.getPayload().slice();
    buffer.limit(windowSize);
    int offset=frame.getPayload().position();
    int newpos=Math.min(offset + windowSize,frame.getPayload().limit());
    frame.getPayload().position(newpos);
  }
  return buffer;
}
