{
  payloadLength=getFrame().getPayloadLength();
  if (payloadLength == 0) {
    return true;
  }
  if ((payloadLength == 1) || (payloadLength > 125)) {
    throw new ProtocolException("Close: invalid payload length: " + payloadLength);
  }
  if (payload == null) {
    getPolicy().assertValidTextMessageSize(payloadLength);
    payload=ByteBuffer.allocate(payloadLength);
  }
  while (buffer.hasRemaining()) {
    copyBuffer(buffer,payload,payload.remaining());
    if (payload.position() >= payloadLength) {
      frame.setPayload(payload);
      frame.assertValidPerPolicy(getPolicy().getBehavior());
      return true;
    }
  }
  return false;
}
