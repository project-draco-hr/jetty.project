{
synchronized (lock()) {
    ByteBuffer content=null;
    while (content == null) {
      content=_inputQ.peekUnsafe();
      while (content != null && !content.hasRemaining()) {
        _inputQ.pollUnsafe();
        onContentConsumed(content);
        content=_inputQ.peekUnsafe();
      }
      if (content == null) {
        onAllContentConsumed();
        if (_earlyEOF)         throw new EofException();
        if (_inputEOF) {
          onEof();
          return -1;
        }
        blockForContent();
      }
    }
    int l=Math.min(len,content.remaining());
    content.get(b,off,l);
    return l;
  }
}
