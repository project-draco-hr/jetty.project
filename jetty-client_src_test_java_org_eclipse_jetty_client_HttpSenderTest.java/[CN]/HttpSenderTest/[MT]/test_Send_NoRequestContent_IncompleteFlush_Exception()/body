{
  ByteArrayEndPoint endPoint=new ByteArrayEndPoint("",16);
  HttpDestination destination=new HttpDestination(client,"http","localhost",8080);
  HttpConnection connection=new HttpConnection(client,endPoint,destination);
  Request request=client.newRequest(URI.create("http://localhost/"));
  final CountDownLatch failureLatch=new CountDownLatch(2);
  request.onRequestFailure(new Request.FailureListener(){
    @Override public void onFailure(    Request request,    Throwable x){
      failureLatch.countDown();
    }
  }
);
  connection.send(request,new Response.Listener.Empty(){
    @Override public void onComplete(    Result result){
      Assert.assertTrue(result.isFailed());
      failureLatch.countDown();
    }
  }
);
  endPoint.shutdownOutput();
  endPoint.takeOutputString();
  Assert.assertTrue(failureLatch.await(5,TimeUnit.SECONDS));
}
