{
  BasicDBObject invalidQuery=new BasicDBObject();
  invalidQuery.put(MongoSessionManager.__ACCESSED,new BasicDBObject("$lt",System.currentTimeMillis() - _purgeInvalidAge));
  invalidQuery.put(MongoSessionManager.__VALID,__valid_false);
  DBCursor oldSessions=_sessions.find(invalidQuery,new BasicDBObject(MongoSessionManager.__ID,1));
  for (  DBObject session : oldSessions) {
    String id=(String)session.get("id");
    __log.debug("MongoSessionIdManager:purging invalid " + id);
    _sessions.remove(session);
  }
  if (_purgeValidAge != 0) {
    BasicDBObject validQuery=new BasicDBObject();
    validQuery.put(MongoSessionManager.__ACCESSED,new BasicDBObject("$lt",System.currentTimeMillis() - _purgeValidAge));
    validQuery.put(MongoSessionManager.__VALID,__valid_false);
    oldSessions=_sessions.find(invalidQuery,new BasicDBObject(MongoSessionManager.__ID,1));
    for (    DBObject session : oldSessions) {
      String id=(String)session.get(MongoSessionManager.__ID);
      __log.debug("MongoSessionIdManager:purging valid " + id);
      _sessions.remove(session);
    }
  }
}
