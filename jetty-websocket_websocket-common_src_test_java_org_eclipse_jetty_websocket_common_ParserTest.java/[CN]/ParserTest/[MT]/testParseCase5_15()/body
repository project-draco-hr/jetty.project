{
  List<WebSocketFrame> send=new ArrayList<>();
  send.add(new WebSocketFrame(OpCode.TEXT).setPayload("fragment1").setFin(false));
  send.add(new WebSocketFrame(OpCode.CONTINUATION).setPayload("fragment2").setFin(true));
  send.add(new WebSocketFrame(OpCode.CONTINUATION).setPayload("fragment3").setFin(false));
  send.add(new WebSocketFrame(OpCode.TEXT).setPayload("fragment4").setFin(true));
  send.add(new CloseInfo(StatusCode.NORMAL).asFrame());
  ByteBuffer completeBuf=UnitGenerator.generate(send);
  UnitParser parser=new UnitParser();
  IncomingFramesCapture capture=new IncomingFramesCapture();
  parser.setIncomingFramesHandler(capture);
  parseQuietly(parser,completeBuf);
  capture.assertErrorCount(1);
  capture.assertHasFrame(OpCode.TEXT,2);
}
