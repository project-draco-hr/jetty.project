{
  if (_inNIOBuffer.hasContent())   _inNIOBuffer.compact();
 else   _inNIOBuffer.clear();
  int total_filled=0;
  while (_inNIOBuffer.space() > 0 && super.isOpen()) {
    try {
      int filled=super.fill(_inNIOBuffer);
      if (filled <= 0)       break;
      total_filled+=filled;
    }
 catch (    IOException e) {
      if (_inNIOBuffer.length() == 0)       throw e;
      break;
    }
  }
  if (_inNIOBuffer.length() == 0) {
    if (!isOpen())     throw new org.eclipse.jetty.io.EofException();
    return false;
  }
  try {
    _inBuffer.position(_inNIOBuffer.getIndex());
    _inBuffer.limit(_inNIOBuffer.putIndex());
    _result=null;
    _last="unwrap";
    _result=_engine.unwrap(_inBuffer,buffer);
    _inNIOBuffer.skip(_result.bytesConsumed());
  }
  finally {
    _inBuffer.position(0);
    _inBuffer.limit(_inBuffer.capacity());
  }
switch (_result.getStatus()) {
case BUFFER_OVERFLOW:
case BUFFER_UNDERFLOW:
    if (Log.isDebugEnabled())     Log.debug("unwrap {}",_result);
  return (total_filled > 0);
case CLOSED:
_closing=true;
case OK:
return total_filled > 0 || _result.bytesConsumed() > 0 || _result.bytesProduced() > 0;
default :
Log.warn("unwrap " + _result);
throw new IOException(_result.toString());
}
}
