{
  if (_writer == null) {
    if (_gzStream != null)     throw new IllegalStateException("getOutputStream() called");
    if (getResponse().isCommitted() || _noGzip)     return getResponse().getWriter();
    _gzStream=newGzipStream(_request,(HttpServletResponse)getResponse(),_contentLength,_bufferSize,_minGzipSize);
    _writer=newWriter(_gzStream,getCharacterEncoding());
  }
  return _writer;
}
