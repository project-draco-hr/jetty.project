{
  loop:   while (true) {
    State state=_state.get();
switch (state) {
case PROCESSING:
      int size=_runChanges.size();
    for (int i=0; i < size; i++)     runChange(_runChanges.get(i));
  _runChanges.clear();
if (!_state.compareAndSet(state,State.LOCKED)) continue;
if (_addChanges.isEmpty()) {
_state.set(State.SELECTING);
break loop;
}
List<Runnable> tmp=_runChanges;
_runChanges=_addChanges;
_addChanges=tmp;
_state.set(State.PROCESSING);
continue;
case LOCKED:
Thread.yield();
continue;
default :
throw new IllegalStateException();
}
}
}
