{
  final Object attachment=key.attachment();
  try {
    if (attachment instanceof SelectableEndPoint) {
      Runnable task=((SelectableEndPoint)attachment).onSelected();
      if (task != null)       _selectorManager.getExecutor().execute(task);
    }
 else     if (key.isConnectable()) {
      processConnect(key,(Connect)attachment);
    }
 else     if (key.isAcceptable()) {
      processAccept(key);
    }
 else {
      throw new IllegalStateException();
    }
  }
 catch (  CancelledKeyException x) {
    SelectorManager.LOG.debug("Ignoring cancelled key for channel {}",key.channel());
    if (attachment instanceof EndPoint)     closeNoExceptions((EndPoint)attachment);
  }
catch (  Throwable x) {
    SelectorManager.LOG.warn("Could not process key for channel " + key.channel(),x);
    if (attachment instanceof EndPoint)     closeNoExceptions((EndPoint)attachment);
  }
}
