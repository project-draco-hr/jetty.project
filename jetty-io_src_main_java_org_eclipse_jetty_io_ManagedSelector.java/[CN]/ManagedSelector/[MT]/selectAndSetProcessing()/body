{
  if (LOG.isDebugEnabled())   LOG.debug("Selector loop waiting on select");
  int selected=_selector.select();
  if (LOG.isDebugEnabled())   LOG.debug("Selector loop woken up from select, {}/{} selected",selected,_selector.keys().size());
  out:   while (true) {
switch (_state.get()) {
case SELECTING:
      if (_state.compareAndSet(State.SELECTING,State.PROCESSING))       continue;
    break out;
case PROCESSING:
  break out;
case LOCKED:
Thread.yield();
continue;
default :
throw new IllegalStateException();
}
}
_selectedKeys=_selector.selectedKeys();
_selections=_selectedKeys.iterator();
}
