{
  BlockheadClient client=new BlockheadClient(server.getServerUri());
  client.setProtocols("onConnect");
  client.setTimeout(TimeUnit.MILLISECONDS,800);
  try {
    client.connect();
    client.sendStandardRequest();
    client.expectUpgradeResponse();
    client.sleep(TimeUnit.SECONDS,1);
    client.write(WebSocketFrame.text("Hello"));
    IncomingFramesCapture capture=client.readFrames(2,TimeUnit.SECONDS,2);
    Assert.assertThat("frames[0].opcode",capture.getFrames().get(0).getOpCode(),is(OpCode.TEXT));
    Assert.assertThat("frames[1].opcode",capture.getFrames().get(1).getOpCode(),is(OpCode.CLOSE));
  }
  finally {
    client.close();
  }
}
