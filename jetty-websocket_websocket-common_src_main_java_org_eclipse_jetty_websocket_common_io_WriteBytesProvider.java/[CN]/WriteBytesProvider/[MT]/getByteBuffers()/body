{
  List<ByteBuffer> bufs=null;
  int count=0;
synchronized (this) {
    for (; count < gatheredBufferLimit; count++) {
      if (active == null) {
        if (queue.isEmpty()) {
          return bufs;
        }
        active=queue.pop();
        if (bufs == null) {
          bufs=new ArrayList<>();
        }
        bufs.add(active.getHeaderBytes());
        count++;
      }
      if (bufs == null) {
        bufs=new ArrayList<>();
      }
      bufs.add(active.getPayloadWindow());
      if (active.isDone()) {
        past.add(active);
        active=null;
      }
    }
  }
  LOG.debug("Collected {} ByteBuffers",bufs.size());
  return bufs;
}
