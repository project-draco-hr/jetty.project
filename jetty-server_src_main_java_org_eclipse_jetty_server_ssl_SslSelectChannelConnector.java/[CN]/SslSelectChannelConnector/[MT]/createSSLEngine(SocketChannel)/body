{
  try {
    SSLEngine engine;
    if (channel != null && _sslContextFactory.isSessionCachingEnabled()) {
      String peerHost=channel.socket().getInetAddress().getHostAddress();
      int peerPort=channel.socket().getPort();
      engine=_sslContextFactory.getSslContext().createSSLEngine(peerHost,peerPort);
    }
 else {
      engine=_sslContextFactory.getSslContext().createSSLEngine();
    }
    customizeEngine(engine);
    return engine;
  }
 catch (  Exception x) {
    Log.warn("Error creating SSLEngine -- closing this connector",x);
    close();
    throw new IllegalStateException(x);
  }
}
