{
  SSLEngine engine=null;
  if (channel == null) {
    engine=createSSLEngine();
  }
 else {
    try {
      InetSocketAddress remoteAddr=(InetSocketAddress)channel.socket().getRemoteSocketAddress();
      String peerHost=remoteAddr.getHostName();
      int peerPort=remoteAddr.getPort();
      engine=_sslContextFactory.getSslContext().createSSLEngine(peerHost,peerPort);
      customizeEngine(engine);
    }
 catch (    Exception e) {
      Log.warn("Error creating sslEngine -- closing this connector",e);
      close();
      throw new IllegalStateException(e);
    }
  }
  return engine;
}
