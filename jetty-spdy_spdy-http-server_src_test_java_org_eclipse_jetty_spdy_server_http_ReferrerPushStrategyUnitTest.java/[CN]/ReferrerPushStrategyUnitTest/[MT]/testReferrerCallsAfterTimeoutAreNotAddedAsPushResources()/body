{
  Fields requestHeaders=getBaseHeaders(VERSION);
  int referrerCallTimeout=1000;
  referrerPushStrategy.setReferrerPushPeriod(referrerCallTimeout);
  setMockExpectations();
  String referrerUrl=fillPushStrategyCache(requestHeaders);
  Thread.sleep(referrerCallTimeout + 1);
  requestHeaders.put(HTTPSPDYHeader.URI.name(VERSION),"image2.jpg");
  requestHeaders.put("referer",referrerUrl);
  Set<String> pushResources=referrerPushStrategy.apply(stream,requestHeaders,new Fields());
  assertThat("pushResources is empty",pushResources.size(),is(0));
  requestHeaders.put(HTTPSPDYHeader.URI.name(VERSION),MAIN_URI);
  pushResources=referrerPushStrategy.apply(stream,requestHeaders,new Fields());
  assertThat("pushResources contains two elements image.jpg and style.css",pushResources.size(),is(2));
}
