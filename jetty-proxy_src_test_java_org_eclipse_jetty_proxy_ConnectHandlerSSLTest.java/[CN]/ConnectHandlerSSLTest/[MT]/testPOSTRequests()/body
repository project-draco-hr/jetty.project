{
  String hostPort="localhost:" + ((Connector.NetConnector)serverConnector).getLocalPort();
  String request="" + "CONNECT " + hostPort + " HTTP/1.1\r\n"+ "Host: "+ hostPort+ "\r\n"+ "\r\n";
  Socket socket=newSocket();
  try {
    OutputStream output=socket.getOutputStream();
    BufferedReader input=new BufferedReader(new InputStreamReader(socket.getInputStream()));
    output.write(request.getBytes("UTF-8"));
    output.flush();
    Response response=readResponse(input);
    assertEquals("200",response.getCode());
    assertFalse(input.ready());
    SSLSocket sslSocket=wrapSocket(socket);
    try {
      output=sslSocket.getOutputStream();
      input=new BufferedReader(new InputStreamReader(sslSocket.getInputStream()));
      for (int i=0; i < 10; ++i) {
        request="" + "POST /echo?param=" + i + " HTTP/1.1\r\n"+ "Host: "+ hostPort+ "\r\n"+ "Content-Length: 5\r\n"+ "\r\n"+ "HELLO";
        output.write(request.getBytes("UTF-8"));
        output.flush();
        response=readResponse(input);
        assertEquals("200",response.getCode());
        assertEquals("POST /echo?param=" + i + "\r\nHELLO",response.getBody());
      }
    }
  finally {
      sslSocket.close();
    }
  }
  finally {
    socket.close();
  }
}
