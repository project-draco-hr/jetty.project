{
  StringBuilder result=new StringBuilder();
  Matcher matcher=__propertyPattern.matcher(text);
  int start=0;
  while (matcher.find(start)) {
    int match=matcher.start();
    result.append(text.substring(start,match));
    String name=matcher.group(1);
    String dftValue=null;
    int bar=name.indexOf('|');
    if (bar > 0) {
      dftValue=name.substring(bar + 1).trim();
      name=name.substring(0,bar).trim();
    }
    String value=resolve(properties,name);
    if (value == null)     value=dftValue;
    result.append(value);
    start=matcher.end();
  }
  result.append(text.substring(start,text.length()));
  String r=result.toString();
  return r.isEmpty() ? null : r;
}
