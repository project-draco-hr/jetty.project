{
  if (LOG.isDebugEnabled()) {
    LOG.debug("output({}, {})",context,frame);
  }
synchronized (queue) {
    FrameBytes<C> bytes=null;
    if (frame.getType().isControl()) {
      bytes=new ControlFrameBytes<C>(this,context,frame);
    }
 else {
      bytes=new DataFrameBytes<C>(this,context,frame);
    }
    scheduleTimeout(bytes);
    if (isOpen()) {
      if (frame.getOpCode() == OpCode.PING) {
        queue.prepend(bytes);
      }
 else {
        queue.append(bytes);
      }
    }
  }
  flush();
}
