{
  List<ByteBuffer> buffers=null;
synchronized (writeBytes) {
    if (flushing) {
      LOG.debug("Actively flushing");
      return;
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug(".flush() - flushing={} - writeBytes={}",flushing,writeBytes);
    }
    if (!isOpen()) {
      writeBytes.failAll(new WebSocketException("Connection closed"));
      return;
    }
    buffers=writeBytes.getByteBuffers();
    if ((buffers == null) || (buffers.size() <= 0)) {
      return;
    }
    flushing=true;
  }
  write(buffers);
}
