{
  if (LOG.isDebugEnabled()) {
    LOG.debug("output({})",frame);
  }
  Future<SendResult> future=null;
synchronized (queue) {
    FrameBytes bytes=null;
    if (frame.getType().isControl()) {
      bytes=new ControlFrameBytes(this,frame);
    }
 else {
      bytes=new DataFrameBytes(this,frame);
    }
    future=bytes;
    scheduleTimeout(bytes);
    if (isOpen()) {
      if (frame.getOpCode() == OpCode.PING) {
        queue.prepend(bytes);
      }
 else {
        queue.append(bytes);
      }
    }
  }
  flush();
  return future;
}
