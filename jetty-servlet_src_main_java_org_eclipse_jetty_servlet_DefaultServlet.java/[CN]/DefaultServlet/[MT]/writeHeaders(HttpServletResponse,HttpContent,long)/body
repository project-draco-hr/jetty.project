{
  if (content.getContentType() != null && response.getContentType() == null)   response.setContentType(content.getContentType().toString());
  if (response instanceof Response) {
    Response r=(Response)response;
    HttpFields fields=r.getHttpFields();
    if (content.getLastModified() != null)     fields.put(HttpHeaders.LAST_MODIFIED_BUFFER,content.getLastModified());
 else     if (content.getResource() != null) {
      long lml=content.getResource().lastModified();
      if (lml != -1)       fields.putDateField(HttpHeaders.LAST_MODIFIED_BUFFER,lml);
    }
    if (count != -1)     r.setLongContentLength(count);
    writeOptionHeaders(fields);
    if (_etags)     fields.put(HttpHeaders.ETAG_BUFFER,content.getETag());
  }
 else {
    long lml=content.getResource().lastModified();
    if (lml >= 0)     response.setDateHeader(HttpHeaders.LAST_MODIFIED,lml);
    if (count != -1) {
      if (count < Integer.MAX_VALUE)       response.setContentLength((int)count);
 else       response.setHeader(HttpHeaders.CONTENT_LENGTH,Long.toString(count));
    }
    writeOptionHeaders(response);
    if (_etags)     response.setHeader(HttpHeaders.ETAG,content.getETag().toString());
  }
}
