{
  try {
    if (!HttpMethod.HEAD.is(request.getMethod())) {
      String ifms=request.getHeader(HttpHeader.IF_MODIFIED_SINCE.asString());
      if (ifms != null) {
        Response r=Response.getResponse(response);
        if (content != null) {
          String mdlm=content.getLastModified();
          if (mdlm != null) {
            if (ifms.equals(mdlm)) {
              r.reset(true);
              r.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
              r.flushBuffer();
              return false;
            }
          }
        }
        long ifmsl=request.getDateHeader(HttpHeader.IF_MODIFIED_SINCE.asString());
        if (ifmsl != -1) {
          if (resource.lastModified() / 1000 <= ifmsl / 1000) {
            r.reset(true);
            r.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
            r.flushBuffer();
            return false;
          }
        }
      }
      long date=request.getDateHeader(HttpHeader.IF_UNMODIFIED_SINCE.asString());
      if (date != -1) {
        if (resource.lastModified() / 1000 > date / 1000) {
          response.sendError(HttpServletResponse.SC_PRECONDITION_FAILED);
          return false;
        }
      }
    }
  }
 catch (  IllegalArgumentException iae) {
    if (!response.isCommitted())     response.sendError(400,iae.getMessage());
    throw iae;
  }
  return true;
}
