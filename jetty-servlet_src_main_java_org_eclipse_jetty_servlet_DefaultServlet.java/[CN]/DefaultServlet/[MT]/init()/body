{
  _servletContext=getServletContext();
  ContextHandler.Context scontext=ContextHandler.getCurrentContext();
  if (scontext == null)   _contextHandler=((ContextHandler.Context)_servletContext).getContextHandler();
 else   _contextHandler=ContextHandler.getCurrentContext().getContextHandler();
  _mimeTypes=_contextHandler.getMimeTypes();
  _welcomes=_contextHandler.getWelcomeFiles();
  if (_welcomes == null)   _welcomes=new String[]{"index.html","index.jsp"};
  _acceptRanges=getInitBoolean("acceptRanges",_acceptRanges);
  _dirAllowed=getInitBoolean("dirAllowed",_dirAllowed);
  _redirectWelcome=getInitBoolean("redirectWelcome",_redirectWelcome);
  _gzip=getInitBoolean("gzip",_gzip);
  if ("exact".equals(getInitParameter("welcomeServlets"))) {
    _welcomeExactServlets=true;
    _welcomeServlets=false;
  }
 else   _welcomeServlets=getInitBoolean("welcomeServlets",_welcomeServlets);
  if (getInitParameter("aliases") != null)   _contextHandler.setAliases(getInitBoolean("aliases",false));
  boolean aliases=_contextHandler.isAliases();
  if (!aliases && !FileResource.getCheckAliases())   throw new IllegalStateException("Alias checking disabled");
  if (aliases)   _servletContext.log("Aliases are enabled");
  _useFileMappedBuffer=getInitBoolean("useFileMappedBuffer",_useFileMappedBuffer);
  _relativeResourceBase=getInitParameter("relativeResourceBase");
  String rb=getInitParameter("resourceBase");
  if (rb != null) {
    if (_relativeResourceBase != null)     throw new UnavailableException("resourceBase & relativeResourceBase");
    try {
      _resourceBase=_contextHandler.newResource(rb);
    }
 catch (    Exception e) {
      Log.warn(Log.EXCEPTION,e);
      throw new UnavailableException(e.toString());
    }
  }
  String t=getInitParameter("cacheControl");
  if (t != null)   _cacheControl=new ByteArrayBuffer(t);
  String resourceCache=getInitParameter("resourceCache");
  int max_cache_size=getInitInt("maxCacheSize",-2);
  int max_cached_file_size=getInitInt("maxCachedFileSize",-2);
  int max_cached_files=getInitInt("maxCachedFiles",-2);
  if (resourceCache != null) {
    if (max_cache_size != -1 || max_cached_file_size != -2 || max_cached_files != -2)     Log.debug("ignoring resource cache configuration, using resourceCache attribute");
    if (_relativeResourceBase != null || _resourceBase != null)     throw new UnavailableException("resourceCache specified with resource bases");
    _cache=(ResourceCache)_servletContext.getAttribute(resourceCache);
    if (_cache == null)     throw new UnavailableException("Could not find resourceCache " + resourceCache);
  }
 else {
    try {
      if (max_cached_files > 0) {
        _cache=new ResourceCache(this,_mimeTypes,_useFileMappedBuffer);
        if (max_cache_size > 0)         _cache.setMaxCacheSize(max_cache_size);
        if (max_cached_file_size >= -1)         _cache.setMaxCachedFileSize(max_cached_file_size);
        if (max_cached_files >= -1)         _cache.setMaxCachedFiles(max_cached_files);
      }
    }
 catch (    Exception e) {
      Log.warn(Log.EXCEPTION,e);
      throw new UnavailableException(e.toString());
    }
  }
  _servletHandler=(ServletHandler)_contextHandler.getChildHandlerByClass(ServletHandler.class);
  for (  ServletHolder h : _servletHandler.getServlets())   if (h.getServletInstance() == this)   _defaultHolder=h;
  if (Log.isDebugEnabled())   Log.debug("resource base = " + _resourceBase);
}
