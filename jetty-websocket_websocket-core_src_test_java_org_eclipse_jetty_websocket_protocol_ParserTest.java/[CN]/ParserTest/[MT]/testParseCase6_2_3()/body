{
  String utf8="Hello-\uC2B5@\uC39F\uC3A4\uC3BC\uC3A0\uC3A1-UTF-8!!";
  byte msg[]=StringUtil.getUtf8Bytes(utf8);
  List<WebSocketFrame> send=new ArrayList<>();
  int len=msg.length;
  byte opcode=OpCode.TEXT;
  byte mini[];
  for (int i=0; i < len; i++) {
    WebSocketFrame frame=new WebSocketFrame(opcode);
    mini=new byte[1];
    mini[0]=msg[i];
    frame.setPayload(mini);
    boolean isLast=(i >= (len - 1));
    frame.setFin(isLast);
    send.add(frame);
    opcode=OpCode.CONTINUATION;
  }
  send.add(new CloseInfo(StatusCode.NORMAL).asFrame());
  ByteBuffer completeBuf=UnitGenerator.generate(send);
  UnitParser parser=new UnitParser();
  IncomingFramesCapture capture=new IncomingFramesCapture();
  parser.setIncomingFramesHandler(capture);
  parser.parse(completeBuf);
  capture.assertErrorCount(0);
  capture.assertHasFrame(OpCode.TEXT,len);
  capture.assertHasFrame(OpCode.CLOSE,1);
}
