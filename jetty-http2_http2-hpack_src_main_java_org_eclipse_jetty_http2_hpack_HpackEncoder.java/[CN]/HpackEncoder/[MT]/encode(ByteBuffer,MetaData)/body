{
  if (LOG.isDebugEnabled())   LOG.debug(String.format("CtxTbl[%x] encoding",_context.hashCode()));
  int maxHeaderTableSize=Math.min(_remoteMaxHeaderTableSize,_localMaxHeaderTableSize);
  if (maxHeaderTableSize != _context.getMaxHeaderTableSize())   encodeMaxHeaderTableSize(buffer,maxHeaderTableSize);
  if (metadata.isRequest()) {
    MetaData.Request request=(MetaData.Request)metadata;
    String scheme=request.getURI().getScheme();
    encode(buffer,new HttpField(":scheme",scheme == null ? HttpScheme.HTTP.asString() : scheme));
    encode(buffer,new HttpField(":method",request.getMethod()));
    encode(buffer,new HttpField(":authority",request.getURI().getAuthority()));
    encode(buffer,new HttpField(":path",request.getURI().getPathQuery()));
  }
 else   if (metadata.isResponse()) {
    MetaData.Response response=(MetaData.Response)metadata;
    int code=response.getStatus();
    HttpField status=code < __status.length ? __status[code] : null;
    if (status == null)     status=new HttpField(":status",Integer.toString(code));
    encode(buffer,status);
  }
  for (  HttpField field : metadata) {
    encode(buffer,field);
  }
}
