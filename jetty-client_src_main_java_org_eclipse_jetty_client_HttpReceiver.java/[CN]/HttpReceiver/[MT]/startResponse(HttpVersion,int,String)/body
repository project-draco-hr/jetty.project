{
  if (updateState(State.IDLE,State.RECEIVE)) {
    HttpExchange exchange=connection.getExchange();
    if (exchange != null) {
      HttpConversation conversation=exchange.getConversation();
      HttpResponse response=exchange.getResponse();
      response.version(version).status(status).reason(reason);
      Response.Listener currentListener=exchange.getResponseListener();
      Response.Listener initialListener=conversation.getExchanges().peekFirst().getResponseListener();
      HttpClient client=connection.getHttpClient();
      ProtocolHandler protocolHandler=client.findProtocolHandler(exchange.getRequest(),response);
      Response.Listener handlerListener=protocolHandler == null ? null : protocolHandler.getResponseListener();
      if (handlerListener == null) {
        exchange.setLast(true);
        if (currentListener == initialListener)         conversation.setResponseListener(initialListener);
 else         conversation.setResponseListener(new DoubleResponseListener(responseNotifier,currentListener,initialListener));
      }
 else {
        LOG.debug("Found protocol handler {}",protocolHandler);
        if (currentListener == initialListener)         conversation.setResponseListener(handlerListener);
 else         conversation.setResponseListener(new DoubleResponseListener(responseNotifier,currentListener,handlerListener));
      }
      LOG.debug("Receiving {}",response);
      responseNotifier.notifyBegin(conversation.getResponseListener(),response);
    }
  }
  return false;
}
