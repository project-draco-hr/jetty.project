{
  HttpExchange exchange=connection.getExchange();
  if (exchange == null)   return false;
  AtomicMarkableReference<Result> completion=exchange.responseComplete(failure);
  if (!completion.isMarked())   return false;
  parser.close();
  decoder=null;
  while (true) {
    State current=state.get();
    if (updateState(current,State.FAILURE))     break;
  }
  exchange.terminateResponse();
  HttpResponse response=exchange.getResponse();
  HttpConversation conversation=exchange.getConversation();
  ResponseNotifier notifier=connection.getDestination().getResponseNotifier();
  notifier.notifyFailure(conversation.getResponseListeners(),response,failure);
  LOG.debug("Failed {} {}",response,failure);
  Result result=completion.getReference();
  if (result != null) {
    connection.complete(exchange,false);
    notifier.notifyComplete(conversation.getResponseListeners(),result);
  }
  return true;
}
