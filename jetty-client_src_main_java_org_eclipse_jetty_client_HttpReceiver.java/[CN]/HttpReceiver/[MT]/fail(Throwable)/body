{
  HttpExchange exchange=connection.getExchange();
  if (exchange == null)   return false;
  AtomicMarkableReference<Result> completion=exchange.responseComplete(failure);
  if (!completion.isMarked())   return false;
  parser.close();
  decoder=null;
  while (true) {
    State current=state.get();
    if (updateState(current,State.FAILURE))     break;
  }
  exchange.terminate();
  HttpResponse response=exchange.response();
  HttpConversation conversation=exchange.conversation();
  responseNotifier.notifyFailure(conversation.listener(),response,failure);
  LOG.debug("Failed {} {}",response,failure);
  Result result=completion.getReference();
  if (result != null) {
    connection.complete(exchange,false);
    responseNotifier.notifyComplete(conversation.listener(),result);
  }
  return true;
}
