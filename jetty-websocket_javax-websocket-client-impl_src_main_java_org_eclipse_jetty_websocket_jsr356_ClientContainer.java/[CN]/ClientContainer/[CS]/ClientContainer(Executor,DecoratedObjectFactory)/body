{
  this.objectFactory=objectFactory;
  this.endpointClientMetadataCache=new ConcurrentHashMap<>();
  this.decoderFactory=new DecoderFactory(PrimitiveDecoderMetadataSet.INSTANCE,null,objectFactory);
  this.encoderFactory=new EncoderFactory(PrimitiveEncoderMetadataSet.INSTANCE,null,objectFactory);
  EmptyClientEndpointConfig empty=new EmptyClientEndpointConfig();
  this.decoderFactory.init(empty);
  this.encoderFactory.init(empty);
  boolean trustAll=Boolean.getBoolean("org.eclipse.jetty.websocket.jsr356.ssl-trust-all");
  client=new WebSocketClient(new SslContextFactory(trustAll),executor);
  client.setEventDriverFactory(new JsrEventDriverFactory(client.getPolicy()));
  SessionFactory sessionFactory=new JsrSessionFactory(this,this,client);
  sessionFactory.setEnhancedInstantiator(objectFactory);
  client.setSessionFactory(sessionFactory);
  addBean(client);
  ShutdownThread.register(this);
}
