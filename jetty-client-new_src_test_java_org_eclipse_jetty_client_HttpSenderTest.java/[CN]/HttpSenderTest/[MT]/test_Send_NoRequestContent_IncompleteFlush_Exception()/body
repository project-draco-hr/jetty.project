{
  ByteArrayEndPoint endPoint=new ByteArrayEndPoint("",16);
  HttpConnection connection=new HttpConnection(client,endPoint,null);
  Request request=client.newRequest(URI.create("http://localhost/"));
  final CountDownLatch failureLatch=new CountDownLatch(2);
  request.listener(new Request.Listener.Adapter(){
    @Override public void onFailure(    Request request,    Throwable x){
      failureLatch.countDown();
    }
  }
);
  connection.send(request,new Response.Listener.Adapter(){
    @Override public void onFailure(    Response response,    Throwable failure){
      failureLatch.countDown();
    }
  }
);
  endPoint.shutdownOutput();
  endPoint.takeOutputString();
  Assert.assertTrue(failureLatch.await(5,TimeUnit.SECONDS));
}
