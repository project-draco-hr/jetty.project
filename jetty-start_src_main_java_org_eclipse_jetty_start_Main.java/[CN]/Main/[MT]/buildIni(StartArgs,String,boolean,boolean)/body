{
  Path start_d=baseHome.getBasePath("start.d");
  Modules modules=args.getAllModules();
  Module module=modules.get(name);
  if (module == null) {
    StartLog.warn("ERROR: No known module for %s",name);
    return;
  }
  boolean transitive=module.isEnabled() && (module.getSources().size() == 0);
  Path start_ini=baseHome.getBasePath("start.ini");
  String short_start_ini=baseHome.toShortForm(start_ini);
  Path startd_ini=start_d.resolve(name + ".ini");
  String short_startd_ini=baseHome.toShortForm(startd_ini);
  StartIni module_ini=null;
  if (FS.exists(startd_ini)) {
    module_ini=new StartIni(startd_ini);
    if (module_ini.getLineMatches(Pattern.compile("--module=(.*, *)*" + name)).size() == 0) {
      StartLog.warn("ERROR: %s is not enabled in %s!",name,short_startd_ini);
      return;
    }
  }
  if (!args.isApproveAllLicenses()) {
    if (!module.acknowledgeLicense()) {
      StartLog.warn(EXITING_LICENSE_NOT_ACKNOWLEDGED);
      System.exit(1);
    }
  }
  boolean buildIni=false;
  if (module.isEnabled()) {
    if (topLevel && !FS.exists(startd_ini) && !appendStartIni) {
      buildIni=true;
    }
 else     if (transitive) {
      if (module.hasDefaultConfig()) {
        buildIni=true;
        StartLog.info("%-15s initialised transitively",name);
      }
    }
 else {
      for (      String source : module.getSources()) {
        StartLog.info("%-15s initialised in %s",name,baseHome.toShortForm(source));
      }
    }
  }
 else {
    buildIni=true;
  }
  String source="<transitive>";
  if (buildIni) {
    BufferedWriter writer=null;
    PrintWriter out=null;
    try {
      if (appendStartIni) {
        source=short_start_ini;
        StartLog.info("%-15s initialised in %s (appended)",name,source);
        writer=Files.newBufferedWriter(start_ini,StandardCharsets.UTF_8,StandardOpenOption.CREATE,StandardOpenOption.APPEND);
        out=new PrintWriter(writer);
      }
 else {
        FS.ensureDirectoryExists(start_d);
        FS.ensureDirectoryWritable(start_d);
        source=short_startd_ini;
        StartLog.info("%-15s initialised in %s (created)",name,source);
        writer=Files.newBufferedWriter(startd_ini,StandardCharsets.UTF_8,StandardOpenOption.CREATE_NEW,StandardOpenOption.WRITE);
        out=new PrintWriter(writer);
      }
      if (appendStartIni) {
        out.println();
      }
      out.println("# --------------------------------------- ");
      out.println("# Module: " + name);
      out.println("--module=" + name);
      args.parse("--module=" + name,source);
      args.parseModule(module);
      for (      String line : module.getDefaultConfig()) {
        out.println(line);
      }
    }
  finally {
      if (out != null) {
        out.close();
      }
    }
  }
  modules.enable(name,Collections.singletonList(source));
  for (  String src : module.getSources()) {
    StartLog.debug("also enabled in: %s",src);
    if (!short_start_ini.equals(src)) {
      StartLog.info("%-15s enabled in     %s",name,baseHome.toShortForm(src));
    }
  }
  for (  String file : module.getFiles()) {
    initFile(args,new FileArg(module,file));
  }
  module.expandProperties(args.getProperties());
  modules.registerParentsIfMissing(module);
  modules.buildGraph();
  if (topLevel) {
    List<Module> depends=new ArrayList<>();
    for (    String depend : modules.resolveParentModulesOf(name)) {
      if (!name.equals(depend)) {
        Module m=modules.get(depend);
        m.setEnabled(true);
        depends.add(m);
      }
    }
    Collections.sort(depends,Collections.reverseOrder(new Module.DepthComparator()));
    Set<String> done=new HashSet<>(0);
    while (true) {
      boolean complete=true;
      for (      Module m : depends) {
        if (!done.contains(m.getName())) {
          complete=false;
          buildIni(args,m.getName(),false,appendStartIni);
          done.add(m.getName());
        }
      }
      if (complete) {
        break;
      }
      depends.clear();
      for (      String depend : modules.resolveParentModulesOf(name)) {
        if (!name.equals(depend)) {
          Module m=modules.get(depend);
          m.setEnabled(true);
          depends.add(m);
        }
      }
      Collections.sort(depends,Collections.reverseOrder(new Module.DepthComparator()));
    }
  }
}
