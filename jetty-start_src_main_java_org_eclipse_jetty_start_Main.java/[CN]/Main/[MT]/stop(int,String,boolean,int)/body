{
  int _port=port;
  String _key=key;
  try {
    if (_port <= 0) {
      System.err.println("STOP.PORT system property must be specified");
    }
    if (_key == null) {
      _key="";
      System.err.println("STOP.KEY system property must be specified");
      System.err.println("Using empty key");
    }
    Socket s=new Socket(InetAddress.getByName("127.0.0.1"),_port);
    if (wait && timeout > 0)     s.setSoTimeout(timeout * 1000);
    try {
      OutputStream out=s.getOutputStream();
      out.write((_key + "\r\nstop\r\n").getBytes());
      out.flush();
      if (wait) {
        System.err.println("Waiting" + (timeout > 0 ? (" " + timeout + "sec") : "") + " for jetty to stop");
        LineNumberReader lin=new LineNumberReader(new InputStreamReader(s.getInputStream()));
        String response=lin.readLine();
        if ("Stopped".equals(response))         System.err.println("Stopped");
      }
    }
  finally {
      s.close();
    }
  }
 catch (  SocketTimeoutException e) {
    System.err.println("Timed out waiting for stop confirmation");
    System.exit(ERR_UNKNOWN);
  }
catch (  ConnectException e) {
    usageExit(e,ERR_NOT_STOPPED);
  }
catch (  Exception e) {
    usageExit(e,ERR_UNKNOWN);
  }
}
