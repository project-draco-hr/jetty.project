{
  final String path="/foo";
  final CountDownLatch handlerLatch=new CountDownLatch(1);
  Session session=startClient(startHTTPServer(new AbstractHandler(){
    @Override public void handle(    String target,    Request request,    HttpServletRequest httpRequest,    HttpServletResponse httpResponse) throws IOException, ServletException {
      request.setHandled(true);
      Assert.assertEquals("GET",httpRequest.getMethod());
      Assert.assertEquals(path,target);
      Assert.assertEquals(path,httpRequest.getRequestURI());
      Assert.assertEquals("localhost:" + connector.getLocalPort(),httpRequest.getHeader("host"));
      handlerLatch.countDown();
    }
  }
),null);
  Headers headers=new Headers();
  headers.put("method","GET");
  headers.put("url",path);
  headers.put("version","HTTP/1.1");
  headers.put("scheme","http");
  headers.put("host","localhost:" + connector.getLocalPort());
  final CountDownLatch replyLatch=new CountDownLatch(1);
  session.syn(new SynInfo(headers,true),new StreamFrameListener.Adapter(){
    @Override public void onReply(    Stream stream,    ReplyInfo replyInfo){
      assertThat("replyInfo.isClose is true",replyInfo.isClose(),is(true));
      Headers replyHeaders=replyInfo.getHeaders();
      assertThat("status is 200",replyHeaders.get("status").value().contains("200"),is(true));
      replyLatch.countDown();
    }
  }
);
  Assert.assertTrue(handlerLatch.await(5000,TimeUnit.SECONDS));
  Assert.assertTrue(replyLatch.await(5,TimeUnit.SECONDS));
}
