{
  super(connector,endp,connector.getServer(),new NestedParser(),new NestedGenerator(connector.getResponseBuffers(),endp,outerResponse,nestedIn),new NestedRequest());
  ((NestedRequest)_request).setConnection(this);
  _request.setDispatcherType(DispatcherType.REQUEST);
  _request.setScheme(outerRequest.getScheme());
  _request.setMethod(outerRequest.getMethod());
  String uri=outerRequest.getQueryString() == null ? outerRequest.getRequestURI() : (outerRequest.getRequestURI() + "?" + outerRequest.getQueryString());
  _request.setUri(new HttpURI(uri));
  _request.setPathInfo(outerRequest.getRequestURI());
  _request.setQueryString(outerRequest.getQueryString());
  _request.setProtocol(outerRequest.getProtocol());
  _request.setAttribute("isSecure",new Boolean(outerRequest.isSecure()));
  HttpFields fields=getRequestFields();
  for (Enumeration<String> e=outerRequest.getHeaderNames(); e.hasMoreElements(); ) {
    String header=e.nextElement();
    String value=outerRequest.getHeader(header);
    fields.add(header,value);
  }
  _request.setCookies(outerRequest.getCookies());
  for (Enumeration<String> e=outerRequest.getAttributeNames(); e.hasMoreElements(); ) {
    String attr=e.nextElement();
    _request.setAttribute(attr,outerRequest.getAttribute(attr));
  }
}
