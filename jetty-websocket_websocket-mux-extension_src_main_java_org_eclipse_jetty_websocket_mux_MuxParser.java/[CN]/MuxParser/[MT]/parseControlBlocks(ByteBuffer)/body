{
  while (buffer.remaining() > 0) {
    byte b=buffer.get();
    byte opc=(byte)((byte)(b >> 5) & 0xFF);
    b=(byte)(b & 0x1F);
    try {
switch (opc) {
case MuxOp.ADD_CHANNEL_REQUEST:
{
          MuxAddChannelRequest op=new MuxAddChannelRequest();
          op.setRsv((byte)((b & 0x1C) >> 2));
          op.setEncoding((byte)(b & 0x03));
          op.setChannelId(readChannelId(buffer));
          long handshakeSize=read139EncodedSize(buffer);
          op.setHandshake(readBlock(buffer,handshakeSize));
          events.onMuxAddChannelRequest(op);
          break;
        }
case MuxOp.ADD_CHANNEL_RESPONSE:
{
        MuxAddChannelResponse op=new MuxAddChannelResponse();
        op.setFailed((b & 0x10) != 0);
        op.setRsv((byte)((byte)(b & 0x0C) >> 2));
        op.setEncoding((byte)(b & 0x03));
        op.setChannelId(readChannelId(buffer));
        long handshakeSize=read139EncodedSize(buffer);
        op.setHandshake(readBlock(buffer,handshakeSize));
        events.onMuxAddChannelResponse(op);
        break;
      }
case MuxOp.DROP_CHANNEL:
{
      int rsv=(b & 0x1F);
      long channelId=readChannelId(buffer);
      long reasonSize=read139EncodedSize(buffer);
      ByteBuffer reasonBuf=readBlock(buffer,reasonSize);
      MuxDropChannel op=MuxDropChannel.parse(channelId,reasonBuf);
      op.setRsv(rsv);
      events.onMuxDropChannel(op);
      break;
    }
case MuxOp.FLOW_CONTROL:
{
    MuxFlowControl op=new MuxFlowControl();
    op.setRsv((byte)(b & 0x1F));
    op.setChannelId(readChannelId(buffer));
    op.setSendQuotaSize(read139EncodedSize(buffer));
    events.onMuxFlowControl(op);
    break;
  }
case MuxOp.NEW_CHANNEL_SLOT:
{
  MuxNewChannelSlot op=new MuxNewChannelSlot();
  op.setRsv((byte)((b & 0x1E) >> 1));
  op.setFallback((b & 0x01) != 0);
  op.setNumberOfSlots(read139EncodedSize(buffer));
  op.setInitialSendQuota(read139EncodedSize(buffer));
  events.onMuxNewChannelSlot(op);
  break;
}
default :
{
String err=String.format("Unknown Mux Control Code OPC [0x%X]",opc);
throw new MuxException(err);
}
}
}
 catch (Throwable t) {
LOG.warn(t);
throw new MuxException(t);
}
}
}
