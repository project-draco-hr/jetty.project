{
  Server server=new Server();
  LocalConnector connector=new LocalConnector(server);
  server.setConnectors(new Connector[]{connector});
  ContextHandler root=new ContextHandler("/");
  root.setHandler(new AsyncHandler("root"));
  ContextHandler left=new ContextHandler("/left");
  left.setHandler(new AsyncHandler("left"));
  HandlerList centre=new HandlerList();
  ContextHandler centreLeft=new ContextHandler("/leftcentre");
  centreLeft.setHandler(new AsyncHandler("left of centre"));
  ContextHandler centreRight=new ContextHandler("/rightcentre");
  centreRight.setHandler(new AsyncHandler("right of centre"));
  centre.setHandlers(new Handler[]{centreLeft,new WrappedHandler(centreRight)});
  ContextHandler right=new ContextHandler("/right");
  right.setHandler(new AsyncHandler("right"));
  ContextHandlerCollection contexts=new ContextHandlerCollection();
  contexts.setHandlers(new Handler[]{root,left,centre,new WrappedHandler(right)});
  server.setHandler(contexts);
  server.start();
  String response=connector.getResponses("GET / HTTP/1.0\r\n\r\n");
  assertThat(response,startsWith("HTTP/1.1 200 OK"));
  assertThat(response,endsWith("root"));
  assertThat(response,not(containsString("Wrapped: TRUE")));
  response=connector.getResponses("GET /foobar/info HTTP/1.0\r\n\r\n");
  assertThat(response,startsWith("HTTP/1.1 200 OK"));
  assertThat(response,endsWith("root"));
  assertThat(response,not(containsString("Wrapped: TRUE")));
  response=connector.getResponses("GET /left/info HTTP/1.0\r\n\r\n");
  assertThat(response,startsWith("HTTP/1.1 200 OK"));
  assertThat(response,endsWith("left"));
  assertThat(response,not(containsString("Wrapped: TRUE")));
  response=connector.getResponses("GET /leftcentre/info HTTP/1.0\r\n\r\n");
  assertThat(response,startsWith("HTTP/1.1 200 OK"));
  assertThat(response,endsWith("left of centre"));
  assertThat(response,not(containsString("Wrapped: TRUE")));
  response=connector.getResponses("GET /rightcentre/info HTTP/1.0\r\n\r\n");
  assertThat(response,startsWith("HTTP/1.1 200 OK"));
  assertThat(response,endsWith("right of centre"));
  assertThat(response,containsString("Wrapped: ASYNC"));
  response=connector.getResponses("GET /right/info HTTP/1.0\r\n\r\n");
  assertThat(response,startsWith("HTTP/1.1 200 OK"));
  assertThat(response,endsWith("right"));
  assertThat(response,containsString("Wrapped: ASYNC"));
}
