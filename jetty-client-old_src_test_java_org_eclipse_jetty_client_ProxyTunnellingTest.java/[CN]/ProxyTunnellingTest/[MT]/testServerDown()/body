{
  startSSLServer(new ServerHandler());
  int serverPort=serverConnector.getLocalPort();
  stopServer();
  startProxy();
  HttpClient httpClient=new HttpClient();
  httpClient.setProxy(new Address("localhost",proxyPort()));
  httpClient.start();
  try {
    final CountDownLatch latch=new CountDownLatch(1);
    ContentExchange exchange=new ContentExchange(true){
      @Override protected void onException(      Throwable x){
        latch.countDown();
      }
    }
;
    exchange.setMethod(HttpMethod.GET);
    String body="BODY";
    exchange.setURL("https://localhost:" + serverPort + "/echo?body="+ URLEncoder.encode(body,"UTF-8"));
    httpClient.send(exchange);
    assertTrue("Server connect exception should have occurred",latch.await(serverConnectTimeout * 2,TimeUnit.MILLISECONDS));
  }
  finally {
    httpClient.stop();
  }
}
