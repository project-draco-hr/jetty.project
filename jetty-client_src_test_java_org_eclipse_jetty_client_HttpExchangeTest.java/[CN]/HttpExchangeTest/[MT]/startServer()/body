{
  newServer();
  _server.setHandler(new AbstractHandler(){
    public void handle(    String target,    Request baseRequest,    HttpServletRequest request,    HttpServletResponse response) throws IOException, ServletException {
      int i=0;
      try {
        baseRequest.setHandled(true);
        response.setStatus(200);
        _count.incrementAndGet();
        if (request.getServerName().equals("jetty.eclipse.org")) {
          response.getOutputStream().println("Proxy request: " + request.getRequestURL());
          response.getOutputStream().println(request.getHeader(HttpHeaders.PROXY_AUTHORIZATION));
        }
 else         if (request.getMethod().equalsIgnoreCase("GET")) {
          response.getOutputStream().println("<hello>");
          for (; i < 100; i++) {
            response.getOutputStream().println("  <world>" + i + "</world");
            if (i % 20 == 0)             response.getOutputStream().flush();
          }
          response.getOutputStream().println("</hello>");
        }
 else {
          response.setContentType(request.getContentType());
          int size=request.getContentLength();
          ByteArrayOutputStream bout=new ByteArrayOutputStream(size > 0 ? size : 32768);
          IO.copy(request.getInputStream(),bout);
          response.getOutputStream().write(bout.toByteArray());
        }
      }
 catch (      IOException e) {
        e.printStackTrace();
        throw e;
      }
catch (      Throwable e) {
        e.printStackTrace();
        throw new ServletException(e);
      }
 finally {
      }
    }
  }
);
  _server.start();
  _port=_connector.getLocalPort();
}
