{
  EndpointMetadata metadata=getClientEndpointMetadata(endpoint.getClass());
  ServerEndpointConfig cec=config;
  if (config == null) {
    if (metadata instanceof AnnotatedServerEndpointMetadata) {
      cec=((AnnotatedServerEndpointMetadata)metadata).getConfig();
    }
 else {
      cec=new EmptyServerEndpointConfig(endpoint.getClass(),path);
    }
  }
  return new EndpointInstance(endpoint,cec,metadata);
}
