{
  EndpointMetadata metadata=getClientEndpointMetadata(endpoint.getClass(),config);
  ServerEndpointConfig cec=config;
  if (config == null) {
    if (metadata instanceof AnnotatedServerEndpointMetadata) {
      cec=((AnnotatedServerEndpointMetadata)metadata).getConfig();
    }
 else {
      cec=new BasicServerEndpointConfig(endpoint.getClass(),path,enhancedInstantiator);
    }
  }
  return new EndpointInstance(endpoint,cec,metadata);
}
