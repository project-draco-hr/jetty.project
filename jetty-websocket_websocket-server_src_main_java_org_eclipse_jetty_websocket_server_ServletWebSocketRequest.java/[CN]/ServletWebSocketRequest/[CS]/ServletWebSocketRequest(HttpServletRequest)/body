{
  super(request.getRequestURI());
  cookieMap=new HashMap<String,String>();
  for (  Cookie cookie : request.getCookies()) {
    cookieMap.put(cookie.getName(),cookie.getValue());
  }
  Enumeration<String> protocols=request.getHeaders("Sec-WebSocket-Protocol");
  List<String> subProtocols=new ArrayList<>();
  String protocol=null;
  while ((protocol == null) && (protocols != null) && protocols.hasMoreElements()) {
    String candidate=protocols.nextElement();
    for (    String p : parseProtocols(candidate)) {
      subProtocols.add(p);
    }
  }
  setSubProtocols(subProtocols);
  extensions=new ArrayList<>();
  Enumeration<String> e=request.getHeaders("Sec-WebSocket-Extensions");
  while (e.hasMoreElements()) {
    QuotedStringTokenizer tok=new QuotedStringTokenizer(e.nextElement(),",");
    while (tok.hasMoreTokens()) {
      addExtensions(tok.nextToken());
    }
  }
}
