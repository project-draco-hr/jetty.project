{
synchronized (this) {
    if (closed)     throw new IOException("Stream is closed");
    closed=fin;
    BufferUtil.flipToFlush(buffer,0);
    LOG.debug("flush({}): {}",fin,BufferUtil.toDetailString(buffer));
    frame.setPayload(buffer);
    frame.setFin(fin);
    blocker.acquire();
    outgoing.outgoingFrame(frame,blocker,BatchMode.OFF);
    blocker.block();
    ++frameCount;
    frame.setIsContinuation();
    BufferUtil.flipToFill(buffer);
  }
}
