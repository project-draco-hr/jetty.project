{
  LOG.debug("write(byte[{}], {}, {})",b.length,off,len);
  int left=len;
  int offset=off;
  while (left > 0) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("buffer: {}",BufferUtil.toDetailString(buffer));
    }
    int space=buffer.remaining();
    assert(space > 0);
    int size=Math.min(space,left);
    buffer.put(b,offset,size);
    assert(size > 0);
    left-=size;
    if (left > 0) {
      flush(false);
    }
    offset+=size;
  }
}
