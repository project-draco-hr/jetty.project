{
  try {
    if (LOG.isDebugEnabled())     LOG.debug("Parsing {}",buffer);
    while (true) {
switch (state) {
case PREFACE:
{
          if (!prefaceParser.parse(buffer))           return;
          onPreface();
          state=State.FRAMES;
          break;
        }
case FRAMES:
{
        super.parse(buffer);
        return;
      }
default :
{
      throw new IllegalStateException();
    }
}
}
}
 catch (Throwable x) {
LOG.debug(x);
BufferUtil.clear(buffer);
notifyConnectionFailure(ErrorCode.PROTOCOL_ERROR.code,"parser_error");
}
}
