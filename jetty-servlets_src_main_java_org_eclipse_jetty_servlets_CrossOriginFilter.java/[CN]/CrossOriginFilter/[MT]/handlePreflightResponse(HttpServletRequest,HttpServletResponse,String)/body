{
  boolean methodAllowed=isMethodAllowed(request);
  if (!methodAllowed)   return;
  boolean headersAllowed=areHeadersAllowed(request);
  if (!headersAllowed)   return;
  response.setHeader(ACCESS_CONTROL_ALLOW_ORIGIN_HEADER,origin);
  if (!anyOriginAllowed)   response.addHeader("Vary",ORIGIN_HEADER);
  if (allowCredentials)   response.setHeader(ACCESS_CONTROL_ALLOW_CREDENTIALS_HEADER,"true");
  if (preflightMaxAge > 0)   response.setHeader(ACCESS_CONTROL_MAX_AGE_HEADER,String.valueOf(preflightMaxAge));
  response.setHeader(ACCESS_CONTROL_ALLOW_METHODS_HEADER,commify(allowedMethods));
  response.setHeader(ACCESS_CONTROL_ALLOW_HEADERS_HEADER,commify(allowedHeaders));
}
