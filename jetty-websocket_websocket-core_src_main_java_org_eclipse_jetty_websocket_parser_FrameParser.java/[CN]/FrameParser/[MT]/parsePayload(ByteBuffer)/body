{
  if (payloadLength == 0) {
    return true;
  }
  while (buffer.hasRemaining()) {
    if (payload == null) {
      getPolicy().assertValidPayloadLength(payloadLength);
      frame.assertValid();
      payload=ByteBuffer.allocate(payloadLength);
    }
    copyBuffer(buffer,payload,payload.remaining());
    if (payload.position() >= payloadLength) {
      BufferUtil.flipToFlush(payload,0);
      frame.setPayload(BufferUtil.toArray(payload));
      this.payload=null;
      return true;
    }
  }
  return false;
}
