{
  while (serverSocket != null) {
    Socket socket=null;
    try {
      socket=serverSocket.accept();
      socket.setSoLinger(false,0);
      LineNumberReader lin=new LineNumberReader(new InputStreamReader(socket.getInputStream()));
      String key=lin.readLine();
      System.err.println("Monitor: " + key);
      if (!stopKey.equals(key))       continue;
      String cmd=lin.readLine();
      if ("stop".equals(cmd)) {
        close(serverSocket);
        serverSocket=null;
        for (        Server s : servers) {
          try {
            TaskLog.log("Stopping server: " + s);
            s.stop();
            TaskLog.log("Stopped server: " + s);
          }
 catch (          Exception e) {
            TaskLog.log(e.getMessage());
          }
        }
        socket.getOutputStream().write("Stopped\r\n".getBytes());
      }
 else       TaskLog.log("Unsupported monitor operation: " + cmd);
    }
 catch (    Exception e) {
      TaskLog.log(e.getMessage());
    }
 finally {
      close(socket);
      socket=null;
      close(serverSocket);
    }
  }
}
