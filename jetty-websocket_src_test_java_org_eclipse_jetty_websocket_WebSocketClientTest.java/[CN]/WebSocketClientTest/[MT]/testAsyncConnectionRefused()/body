{
  WebSocketClient client=new WebSocketClient(_factory);
  final AtomicBoolean open=new AtomicBoolean();
  final AtomicInteger close=new AtomicInteger();
  Future<WebSocket.Connection> future=client.open(new URI("ws://127.0.0.1:1"),new WebSocket(){
    public void onOpen(    Connection connection){
      open.set(true);
    }
    public void onClose(    int closeCode,    String message){
      close.set(closeCode);
    }
  }
);
  Throwable error=null;
  try {
    future.get(1,TimeUnit.SECONDS);
    Assert.fail();
  }
 catch (  ExecutionException e) {
    error=e.getCause();
  }
  Assert.assertFalse(open.get());
  Assert.assertEquals(WebSocketConnectionD12.CLOSE_NOCLOSE,close.get());
  Assert.assertTrue(error instanceof ConnectException);
}
