{
  Map<String,Object> attributes=new HashMap<String,Object>();
  for (Enumeration<String> e=httpSession.getAttributeNames(); e.hasMoreElements(); ) {
    String name=e.nextElement();
    attributes.put(name,httpSession.getAttribute(name));
    httpSession.removeAttribute(name);
  }
  httpSession.invalidate();
  httpSession=request.getSession(true);
  if (authenticated)   httpSession.setAttribute(SESSION_KNOWN_ONLY_TO_AUTHENTICATED,Boolean.TRUE);
  for (  Map.Entry<String,Object> entry : attributes.entrySet())   httpSession.setAttribute(entry.getKey(),entry.getValue());
  return httpSession;
}
