{
  if (LOG.isDebugEnabled())   LOG.debug("onCloseRemote({})",close);
  ConnectionState event=null;
synchronized (this) {
    if (this.state == ConnectionState.CLOSED) {
      return;
    }
    closeInfo=close;
    inputAvailable=false;
    boolean in=inputAvailable;
    boolean out=outputAvailable;
    if (closeHandshakeSource == CloseHandshakeSource.NONE) {
      closeHandshakeSource=CloseHandshakeSource.REMOTE;
    }
    if (LOG.isDebugEnabled())     LOG.debug("onCloseRemote(), input={}, output={}",in,out);
    if (!in && !out) {
      LOG.debug("Close Handshake satisfied, disconnecting");
      cleanClose=true;
      state=ConnectionState.CLOSED;
      finalClose.compareAndSet(null,close);
      event=this.state;
    }
 else     if (this.state == ConnectionState.OPEN) {
      this.state=ConnectionState.CLOSING;
      event=this.state;
    }
  }
  if (event != null) {
    notifyStateListeners(event);
  }
}
