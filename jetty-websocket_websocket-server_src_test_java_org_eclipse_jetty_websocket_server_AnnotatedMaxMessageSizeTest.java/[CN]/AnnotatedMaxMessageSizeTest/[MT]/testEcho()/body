{
  BlockheadClient client=new BlockheadClient(serverUri);
  try {
    client.setProtocols("echo");
    client.connect();
    client.sendStandardRequest();
    client.expectUpgradeResponse();
    String msg="this is an echo ... cho ... ho ... o";
    client.write(WebSocketFrame.text(msg));
    IncomingFramesCapture capture=client.readFrames(1,TimeUnit.MILLISECONDS,500);
    WebSocketFrame tf=capture.getFrames().poll();
    Assert.assertThat("Text Frame.status code",tf.getPayloadAsUTF8(),is(msg));
  }
  finally {
    client.close();
  }
}
