{
  List<Bundle> res=new ArrayList<Bundle>();
  String requiredBundleHeader=(String)bundle.getHeaders().get("Require-Bundle");
  if (requiredBundleHeader == null) {
    return res;
  }
  StringTokenizer tokenizer=new StringTokenizer(requiredBundleHeader,",");
  while (tokenizer.hasMoreTokens()) {
    String tok=tokenizer.nextToken().trim();
    StringTokenizer tokenizer2=new StringTokenizer(tok,";");
    String symbolicName=tokenizer2.nextToken().trim();
    String versionRange=null;
    while (tokenizer2.hasMoreTokens()) {
      String next=tokenizer2.nextToken().trim();
      if (next.startsWith("bundle-version=")) {
        if (next.startsWith("bundle-version=\"") || next.startsWith("bundle-version='")) {
          versionRange=next.substring("bundle-version=\"".length(),next.length() - 1);
        }
 else {
          versionRange=next.substring("bundle-version=".length());
        }
      }
    }
    Bundle[] reqBundles=admin.getBundles(symbolicName,versionRange);
    if (reqBundles != null) {
      for (      Bundle b : reqBundles) {
        if (b.getState() == Bundle.ACTIVE || b.getState() == Bundle.STARTING) {
          res.add(b);
          break;
        }
      }
    }
  }
  return res;
}
