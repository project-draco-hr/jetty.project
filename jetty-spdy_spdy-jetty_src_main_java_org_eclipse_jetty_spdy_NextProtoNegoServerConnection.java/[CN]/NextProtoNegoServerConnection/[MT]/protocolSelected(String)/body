{
  NextProtoNego.remove(engine);
  ConnectionFactory connectionFactory=connector.getConnectionFactory(protocol);
  EndPoint endPoint=getEndPoint();
  Connection connection=connectionFactory.newConnection(connector,endPoint);
  endPoint.setConnection(connection);
  ((AbstractConnector)connector).connectionUpgraded(this,connection);
  completed=true;
}
