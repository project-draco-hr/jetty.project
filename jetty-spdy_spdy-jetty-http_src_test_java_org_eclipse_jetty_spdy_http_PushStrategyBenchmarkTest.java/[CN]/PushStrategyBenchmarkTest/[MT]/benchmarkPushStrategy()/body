{
  InetSocketAddress address=startHTTPServer(version(),new PushStrategyBenchmarkHandler());
  AsyncConnectionFactory dacf=new ServerHTTPAsyncConnectionFactory(connector);
  connector.setDefaultAsyncConnectionFactory(dacf);
  HttpClient httpClient=new HttpClient();
  httpClient.setMaxConnectionsPerAddress(6);
  httpClient.start();
  benchmarkHTTP(httpClient);
  httpClient.stop();
  PushStrategy pushStrategy=new PushStrategy.None();
  dacf=new ServerHTTPSPDYAsyncConnectionFactory(version(),connector.getByteBufferPool(),connector.getExecutor(),connector.getScheduler(),connector,pushStrategy);
  connector.setDefaultAsyncConnectionFactory(dacf);
  Session session=startClient(version(),address,new ClientSessionFrameListener());
  benchmarkSPDY(pushStrategy,session);
  session.goAway().get(5,TimeUnit.SECONDS);
  pushStrategy=new ReferrerPushStrategy();
  dacf=new ServerHTTPSPDYAsyncConnectionFactory(version(),connector.getByteBufferPool(),connector.getExecutor(),connector.getScheduler(),connector,pushStrategy);
  connector.setDefaultAsyncConnectionFactory(dacf);
  session=startClient(version(),address,new ClientSessionFrameListener());
  benchmarkSPDY(pushStrategy,session);
  session.goAway().get(5,TimeUnit.SECONDS);
}
