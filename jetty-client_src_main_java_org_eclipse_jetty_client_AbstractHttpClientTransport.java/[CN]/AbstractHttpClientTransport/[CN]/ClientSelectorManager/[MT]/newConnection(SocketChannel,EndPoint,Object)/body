{
  ConnectionCallback callback=(ConnectionCallback)attachment;
  HttpDestination destination=callback.destination;
  SslContextFactory sslContextFactory=client.getSslContextFactory();
  if (!destination.isProxied() && HttpScheme.HTTPS.is(destination.getScheme())) {
    if (sslContextFactory == null) {
      IOException failure=new ConnectException("Missing " + SslContextFactory.class.getSimpleName() + " for "+ destination.getScheme()+ " requests");
      callback.failed(failure);
      throw failure;
    }
 else {
      SslConnection sslConnection=createSslConnection(endPoint,destination);
      callback.succeeded((org.eclipse.jetty.client.api.Connection)sslConnection.getDecryptedEndPoint().getConnection());
      return sslConnection;
    }
  }
 else {
    Connection connection=AbstractHttpClientTransport.this.newConnection(endPoint,destination);
    callback.succeeded((org.eclipse.jetty.client.api.Connection)connection);
    return connection;
  }
}
