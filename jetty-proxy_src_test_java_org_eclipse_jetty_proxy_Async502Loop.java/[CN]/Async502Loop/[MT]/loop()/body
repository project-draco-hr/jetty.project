{
  startServer(new HttpServlet(){
    @Override protected void doPost(    HttpServletRequest req,    HttpServletResponse resp) throws ServletException, IOException {
      if (req.getHeader("Via") != null)       resp.addHeader(PROXIED_HEADER,"true");
      IO.copy(req.getInputStream(),resp.getOutputStream());
    }
  }
);
  startProxy();
  startClient();
  int clientCount=5;
  final CountDownLatch activeClientLatch=new CountDownLatch(clientCount);
  final AtomicBoolean atomicOk=new AtomicBoolean(true);
  for (int i=0; i < clientCount; i++) {
    ClientLoop r=new ClientLoop(activeClientLatch,atomicOk,client,"localhost",serverConnector.getLocalPort());
    String name="client-" + i;
    Thread thread=new Thread(r,name);
    thread.start();
  }
  activeClientLatch.await();
  dispose();
}
