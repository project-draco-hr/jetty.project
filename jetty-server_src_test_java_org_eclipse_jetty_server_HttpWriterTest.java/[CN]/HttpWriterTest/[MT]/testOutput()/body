{
  ByteBuffer sb=new ByteArrayBuffer(1500);
  ByteBuffer bb=new ByteArrayBuffer(8096);
  HttpFields fields=new HttpFields();
  ByteArrayEndPoint endp=new ByteArrayEndPoint(new byte[0],4096);
  HttpGenerator hb=new HttpGenerator(new SimpleBuffers(sb,bb),endp);
  hb.setResponse(200,"OK");
  AbstractHttpConnection connection=new AbstractHttpConnection(null,endp,new Server(),null,hb,null){
    @Override public AsyncConnection handle() throws IOException {
      return null;
    }
  }
;
  endp.setMaxIdleTime(10000);
  hb.setSendServerVersion(false);
  HttpOutput output=new HttpOutput(connection);
  HttpWriter writer=new HttpWriter(output);
  writer.setCharacterEncoding(StringUtil.__UTF8);
  char[] chars=new char[1024];
  for (int i=0; i < chars.length; i++)   chars[i]=(char)('0' + (i % 10));
  chars[0]='\u0553';
  writer.write(chars);
  hb.completeHeader(fields,true);
  hb.flush(10000);
  String response=new String(endp.getOut().asArray(),StringUtil.__UTF8);
  assertTrue(response.startsWith("HTTP/1.1 200 OK\r\nContent-Length: 1025\r\n\r\n\u05531234567890"));
}
