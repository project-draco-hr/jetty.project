{
  super(endpoint,timestamp);
  _context=Thread.currentThread().getContextClassLoader();
  _draft=draft;
  _endp.setMaxIdleTime(maxIdleTime);
  _webSocket=websocket;
  _onFrame=_webSocket instanceof OnFrame ? (OnFrame)_webSocket : null;
  _onTextMessage=_webSocket instanceof OnTextMessage ? (OnTextMessage)_webSocket : null;
  _onBinaryMessage=_webSocket instanceof OnBinaryMessage ? (OnBinaryMessage)_webSocket : null;
  _onControl=_webSocket instanceof OnControl ? (OnControl)_webSocket : null;
  _generator=new WebSocketGeneratorRFC6455(buffers,_endp,maskgen);
  _extensions=extensions;
  WebSocketParser.FrameHandler frameHandler=new WSFrameHandler();
  if (_extensions != null) {
    int e=0;
    for (    Extension extension : _extensions) {
      extension.bind(_connection,e == extensions.size() - 1 ? frameHandler : extensions.get(e + 1),e == 0 ? _generator : extensions.get(e - 1));
      e++;
    }
  }
  _outbound=(_extensions == null || _extensions.size() == 0) ? _generator : extensions.get(extensions.size() - 1);
  WebSocketParser.FrameHandler inbound=(_extensions == null || _extensions.size() == 0) ? frameHandler : extensions.get(0);
  _parser=new WebSocketParserD13(buffers,endpoint,inbound,maskgen == null);
  _protocol=protocol;
}
