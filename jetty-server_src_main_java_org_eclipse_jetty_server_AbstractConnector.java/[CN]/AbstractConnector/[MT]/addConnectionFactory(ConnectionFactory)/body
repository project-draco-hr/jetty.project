{
synchronized (_factories) {
    String key=StringUtil.asciiToLowerCase(factory.getProtocol());
    ConnectionFactory old=_factories.remove(key);
    if (old != null) {
      if (old.getProtocol().equals(_defaultProtocol))       _defaultProtocol=null;
      removeBean(old);
      if (LOG.isDebugEnabled())       LOG.debug("{} removed {}",this,old);
    }
    _factories.put(key,factory);
    addBean(factory);
    if (_defaultProtocol == null)     _defaultProtocol=factory.getProtocol();
    if (LOG.isDebugEnabled())     LOG.debug("{} added {}",this,factory);
  }
}
