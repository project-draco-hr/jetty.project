{
  HttpFields httpFields=request.getConnection().getRequestFields();
  if (getForwardedCipherSuiteHeader() != null) {
    String cipher_suite=httpFields.getStringField(getForwardedCipherSuiteHeader());
    if (cipher_suite != null)     request.setAttribute("javax.servlet.request.cipher_suite",cipher_suite);
  }
  if (getForwardedSslSessionIdHeader() != null) {
    String ssl_session_id=httpFields.getStringField(getForwardedSslSessionIdHeader());
    if (ssl_session_id != null) {
      request.setAttribute("javax.servlet.request.ssl_session_id",ssl_session_id);
      request.setScheme(HttpScheme.HTTPS.toString());
    }
  }
  String forwardedHost=getLeftMostFieldValue(httpFields,getForwardedHostHeader());
  String forwardedServer=getLeftMostFieldValue(httpFields,getForwardedServerHeader());
  String forwardedFor=getLeftMostFieldValue(httpFields,getForwardedForHeader());
  String forwardedProto=getLeftMostFieldValue(httpFields,getForwardedProtoHeader());
  if (_hostHeader != null) {
    httpFields.put(HttpHeader.HOST.toString(),_hostHeader);
    request.setServerName(null);
    request.setServerPort(-1);
    request.getServerName();
  }
 else   if (forwardedHost != null) {
    httpFields.put(HttpHeader.HOST.toString(),forwardedHost);
    request.setServerName(null);
    request.setServerPort(-1);
    request.getServerName();
  }
 else   if (forwardedServer != null) {
    request.setServerName(forwardedServer);
  }
  if (forwardedFor != null) {
    request.setRemoteAddr(forwardedFor);
    InetAddress inetAddress=null;
    if (_useDNS) {
      try {
        inetAddress=InetAddress.getByName(forwardedFor);
      }
 catch (      UnknownHostException e) {
        LOG.ignore(e);
      }
    }
    request.setRemoteHost(inetAddress == null ? forwardedFor : inetAddress.getHostName());
  }
  if (forwardedProto != null) {
    request.setScheme(forwardedProto);
  }
}
