{
  _server=server;
  _executor=executor != null ? executor : _server.getThreadPool();
  if (scheduler == null)   scheduler=_server.getBean(Scheduler.class);
  _scheduler=scheduler != null ? scheduler : new ScheduledExecutorScheduler();
  if (pool == null)   pool=_server.getBean(ByteBufferPool.class);
  _byteBufferPool=pool != null ? pool : new ArrayByteBufferPool();
  addBean(_server,false);
  addBean(_executor);
  if (executor == null)   unmanage(_executor);
  addBean(_scheduler);
  addBean(_byteBufferPool);
  for (  ConnectionFactory factory : factories)   addConnectionFactory(factory);
  if (acceptors <= 0)   acceptors=Math.max(1,(Runtime.getRuntime().availableProcessors()) / 2);
  if (acceptors > 2 * Runtime.getRuntime().availableProcessors())   LOG.warn("Acceptors should be <= 2*availableProcessors: " + this);
  _acceptors=new Thread[acceptors];
}
