{
  while (true) {
    State current=state.get();
switch (current) {
case IDLE:
case COMPLETED:
{
        if (state.compareAndSet(current,State.FAILED)) {
          abort(x);
          return;
        }
        break;
      }
default :
{
      throw new IllegalStateException(current.toString());
    }
}
}
}
