{
  ConnectionState state=connection.getIOState().getConnectionState();
  if ((state == ConnectionState.OPEN) || (state == ConnectionState.CONNECTED)) {
    return remote;
  }
  throw new WebSocketException("RemoteEndpoint unavailable, current state [" + state + "], expecting [OPEN or CONNECTED]");
}
