{
  HttpExchange exchange=connection.getExchange();
  if (exchange == null)   return false;
  AtomicMarkableReference<Result> completion=exchange.requestComplete(null);
  if (!completion.isMarked())   return false;
  generator.reset();
  if (!updateState(State.COMMIT,State.IDLE))   throw new IllegalStateException();
  exchange.terminateRequest();
  HttpDestination destination=connection.getDestination();
  Request request=exchange.getRequest();
  destination.getRequestNotifier().notifySuccess(request);
  LOG.debug("Sent {}",request);
  Result result=completion.getReference();
  if (result != null) {
    connection.complete(exchange,!result.isFailed());
    HttpConversation conversation=exchange.getConversation();
    destination.getResponseNotifier().notifyComplete(conversation.getResponseListeners(),result);
  }
  return true;
}
