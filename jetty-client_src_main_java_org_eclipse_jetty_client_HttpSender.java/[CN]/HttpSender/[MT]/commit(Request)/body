{
  while (true) {
    State current=state.get();
switch (current) {
case SEND:
      if (!updateState(current,State.COMMIT))       continue;
    LOG.debug("Committed {}",request);
  requestNotifier.notifyHeaders(request);
return true;
case COMMIT:
return updateState(current,State.COMMIT);
default :
return false;
}
}
}
