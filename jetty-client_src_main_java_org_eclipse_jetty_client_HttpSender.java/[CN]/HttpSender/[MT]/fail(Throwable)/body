{
  BufferUtil.clear(header);
  BufferUtil.clear(chunk);
  releaseBuffers();
  connection.getEndPoint().shutdownOutput();
  generator.abort();
  failed=true;
  HttpExchange exchange=connection.getExchange();
  LOG.debug("Failed {}",exchange.request());
  boolean exchangeCompleted=exchange.requestComplete(false);
  if (!exchangeCompleted && !committed)   exchangeCompleted=exchange.responseComplete(false);
  notifyRequestFailure(exchange.request(),failure);
  Response.Listener listener=exchange.conversation().listener();
  notifyResponseFailure(listener,failure);
  if (exchangeCompleted)   notifyComplete(listener,exchange.response(),failure);
}
