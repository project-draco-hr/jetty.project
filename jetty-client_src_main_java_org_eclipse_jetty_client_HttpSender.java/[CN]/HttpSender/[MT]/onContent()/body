{
  HttpExchange exchange=getHttpExchange();
  if (exchange == null)   return;
  while (true) {
    SenderState current=senderState.get();
switch (current) {
case IDLE:
{
        SenderState newSenderState=SenderState.SENDING;
        if (updateSenderState(current,newSenderState)) {
          LOG.debug("Deferred content available, {} -> {}",current,newSenderState);
          HttpContent content=this.content;
          if (content.advance())           sendContent(exchange,content,contentCallback);
 else           if (content.isConsumed())           sendContent(exchange,content,lastCallback);
 else           throw new IllegalStateException();
          return;
        }
        break;
      }
case SENDING:
{
      SenderState newSenderState=SenderState.SENDING_WITH_CONTENT;
      if (updateSenderState(current,newSenderState)) {
        LOG.debug("Deferred content available, {} -> {}",current,newSenderState);
        return;
      }
      break;
    }
case EXPECTING:
{
    SenderState newSenderState=SenderState.EXPECTING_WITH_CONTENT;
    if (updateSenderState(current,newSenderState)) {
      LOG.debug("Deferred content available, {} -> {}",current,newSenderState);
      return;
    }
    break;
  }
case PROCEEDING:
{
  SenderState newSenderState=SenderState.PROCEEDING_WITH_CONTENT;
  if (updateSenderState(current,newSenderState)) {
    LOG.debug("Deferred content available, {} -> {}",current,newSenderState);
    return;
  }
  break;
}
case SENDING_WITH_CONTENT:
case EXPECTING_WITH_CONTENT:
case PROCEEDING_WITH_CONTENT:
case WAITING:
{
LOG.debug("Deferred content available, {}",current);
return;
}
default :
{
throw new IllegalStateException(current.toString());
}
}
}
}
