{
  HttpExchange exchange=getHttpExchange();
  if (exchange == null)   return;
  Request request=exchange.getRequest();
  if (!headersToCommit(request))   return;
  HttpContent content=HttpSender.this.content;
  if (!content.hasContent()) {
    someToSuccess(exchange);
  }
 else {
    ByteBuffer contentBuffer=content.getContent();
    if (contentBuffer != null) {
      if (!someToContent(request,contentBuffer))       return;
    }
    while (true) {
      SenderState current=senderState.get();
switch (current) {
case SENDING:
{
          if (content.advance()) {
            sendContent(exchange,content,contentCallback);
          }
 else {
            if (content.isLast()) {
              sendContent(exchange,content,lastCallback);
            }
 else {
              if (!updateSenderState(current,SenderState.IDLE))               break;
              LOG.debug("Waiting for deferred content for {}",request);
            }
          }
          return;
        }
case EXPECTING:
{
        if (!updateSenderState(current,SenderState.WAITING))         break;
        return;
      }
case SCHEDULED:
{
      if (expects100Continue(request))       return;
      updateSenderState(current,SenderState.SENDING);
      break;
    }
default :
{
    throw new IllegalStateException();
  }
}
}
}
}
