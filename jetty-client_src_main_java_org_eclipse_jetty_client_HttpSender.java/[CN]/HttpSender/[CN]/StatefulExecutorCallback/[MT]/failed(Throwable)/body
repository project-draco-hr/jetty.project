{
  State previous=state.get();
  while (true) {
    if (state.compareAndSet(previous,State.FAILED))     break;
    previous=state.get();
  }
  if (previous == State.PENDING) {
    executor.execute(new Runnable(){
      @Override public void run(){
        onFailed(x);
      }
    }
);
  }
 else {
    onFailed(x);
  }
}
