{
  AnnotatedTextSocket socket=new AnnotatedTextSocket();
  EventDriver driver=wrap(socket);
  try (LocalWebSocketSession conn=new LocalWebSocketSession(testname,driver)){
    conn.open();
    driver.incomingError(new WebSocketException("oof"));
    driver.incomingFrame(new CloseInfo(StatusCode.NORMAL).asFrame());
    socket.capture.assertEventCount(3);
    socket.capture.assertEventStartsWith(0,"onConnect");
    socket.capture.assertEventStartsWith(1,"onError(WebSocketException: oof)");
    socket.capture.assertEventStartsWith(2,"onClose(1000,");
  }
 }
