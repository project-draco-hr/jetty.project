{
  LOG.debug("read()");
  try {
    if (closed.get()) {
      return -1;
    }
    while (activeBuffer == null || !activeBuffer.hasRemaining()) {
      if (timeoutMs < 0) {
        activeBuffer=buffers.take();
      }
 else {
        activeBuffer=buffers.poll(timeoutMs,TimeUnit.MILLISECONDS);
        if (activeBuffer == null) {
          throw new IOException(String.format("Read timeout: %,dms expired",timeoutMs));
        }
      }
      if (activeBuffer == EOF) {
        closed.set(true);
        return -1;
      }
    }
    return activeBuffer.get();
  }
 catch (  InterruptedException e) {
    LOG.warn(e);
    closed.set(true);
    return -1;
  }
}
