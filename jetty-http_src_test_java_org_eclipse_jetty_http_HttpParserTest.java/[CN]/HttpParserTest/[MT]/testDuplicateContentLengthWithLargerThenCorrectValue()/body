{
  ByteBuffer buffer=BufferUtil.toBuffer("POST / HTTP/1.1\015\012" + "Content-Length: 2\015\012" + "Content-Length: 1\015\012"+ "Connection: close\015\012"+ "\015\012"+ "X");
  HttpParser.RequestHandler handler=new Handler();
  HttpParser parser=new HttpParser(handler);
  parser.parseNext(buffer);
  assertEquals("POST",_methodOrVersion);
  assertEquals("Duplicate Content-Length",_bad);
  assertFalse(buffer.hasRemaining());
  assertEquals(HttpParser.State.CLOSE,parser.getState());
  parser.atEOF();
  parser.parseNext(BufferUtil.EMPTY_BUFFER);
  assertEquals(HttpParser.State.CLOSED,parser.getState());
}
