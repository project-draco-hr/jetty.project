{
  final byte[] data=new byte[dataSize];
  new Random().nextBytes(data);
  session=startClient(version,startHTTPServer(version,new AbstractHandler(){
    @Override public void handle(    String target,    Request request,    HttpServletRequest httpRequest,    HttpServletResponse httpResponse) throws IOException, ServletException {
      request.setHandled(true);
      assertEquals("GET",httpRequest.getMethod());
      assertThat("accept-encoding is set to gzip, even if client didn't set it",httpRequest.getHeader("accept-encoding"),containsString("gzip"));
      assertThat(httpRequest.getHeader("host"),is("localhost:" + connector.getLocalPort()));
      httpResponse.getOutputStream().write(data);
    }
  }
,0),null);
}
