{
synchronized (this) {
    if (_exchange != null) {
      if (_pipeline != null)       throw new IllegalStateException(this + " PIPELINED!!!  _exchange=" + _exchange);
      _pipeline=ex;
      return true;
    }
    if (!_endp.isOpen())     return false;
    _exchange=ex;
    _exchange.setStatus(HttpExchange.STATUS_WAITING_FOR_COMMIT);
    if (_endp.isBlocking()) {
      this.notify();
    }
 else {
      AsyncEndPoint scep=(AsyncEndPoint)_endp;
      scep.scheduleWrite();
    }
    long exchTimeout=_exchange.getTimeout();
    if (exchTimeout > 0) {
      _destination.getHttpClient().schedule(_timeout,exchTimeout);
    }
 else {
      _destination.getHttpClient().schedule(_timeout);
    }
    return true;
  }
}
