{
  boolean send=false;
  while (true) {
    int current=idleTimeoutGuard.get();
    if (current < 0)     break;
    if (idleTimeoutGuard.compareAndSet(current,current + 1)) {
      send=true;
      break;
    }
  }
  if (send) {
    HttpRequest request=exchange.getRequest();
    SendFailure result;
    if (channel.associate(exchange)) {
      channel.send();
      result=null;
    }
 else {
      channel.release();
      result=new SendFailure(new HttpRequestException("Could not associate request to connection",request),false);
    }
    idleTimeoutStamp=System.nanoTime();
    idleTimeoutGuard.decrementAndGet();
    return result;
  }
 else {
    return new SendFailure(new TimeoutException(),true);
  }
}
