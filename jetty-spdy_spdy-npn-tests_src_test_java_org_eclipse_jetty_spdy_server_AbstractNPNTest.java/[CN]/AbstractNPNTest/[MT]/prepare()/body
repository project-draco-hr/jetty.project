{
  server=new Server();
  connector=new SPDYServerConnector(server,newSslContextFactory(),null);
  connector.setPort(0);
  connector.setIdleTimeout(30000);
  server.addConnector(connector);
  server.start();
  QueuedThreadPool threadPool=new QueuedThreadPool();
  threadPool.setName(threadPool.getName() + "-client");
  clientFactory=new SPDYClient.Factory(threadPool);
  clientFactory.start();
  NextProtoNego.debug=true;
  return new InetSocketAddress("localhost",connector.getLocalPort());
}
