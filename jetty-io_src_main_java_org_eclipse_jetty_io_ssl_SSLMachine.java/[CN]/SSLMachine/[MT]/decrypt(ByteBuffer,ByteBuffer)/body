{
  while (true) {
    SSLEngineResult.HandshakeStatus handshakeStatus=engine.getHandshakeStatus();
    logger.debug("Reading from {}, handshake status: {}",netInput,handshakeStatus);
switch (handshakeStatus) {
case NEED_UNWRAP:
{
        ReadState result=unwrap(netInput,appInput);
        if (result == null)         break;
        return result;
      }
case NEED_TASK:
{
      executeTasks();
      break;
    }
case NEED_WRAP:
{
    writeForDecrypt(EMPTY_BUFFER);
    break;
  }
case NOT_HANDSHAKING:
{
  ReadState result=unwrap(netInput,appInput);
  if (result == null)   break;
  return result;
}
default :
throw new IllegalStateException();
}
}
}
