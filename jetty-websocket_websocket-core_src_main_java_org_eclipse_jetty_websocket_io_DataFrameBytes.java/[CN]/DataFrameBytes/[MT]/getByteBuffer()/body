{
  try {
    int windowSize=connection.getPolicy().getBufferSize();
    size=frame.getPayloadLength();
    if (size > windowSize) {
      size=windowSize;
    }
    buffer=connection.getGenerator().generate(size,frame);
    BufferUtil.flipToFlush(buffer,0);
    return buffer;
  }
 catch (  Throwable x) {
    failed(context,x);
    return null;
  }
}
