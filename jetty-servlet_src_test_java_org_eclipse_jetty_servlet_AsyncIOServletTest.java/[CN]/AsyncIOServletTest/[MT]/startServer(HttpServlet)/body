{
  server=new Server();
  connector=new ServerConnector(server);
  connector.setIdleTimeout(30000);
  connector.getConnectionFactory(HttpConnectionFactory.class).getHttpConfiguration().setDelayDispatchUntilContent(false);
  server.addConnector(connector);
  context=new ServletContextHandler(server,"/",false,false);
  ServletHolder holder=new ServletHolder(servlet);
  holder.setAsyncSupported(true);
  context.addServlet(holder,path);
  context.addEventListener(new ContextHandler.ContextScopeListener(){
    @Override public void enterScope(    Context context,    Request request,    Object reason){
      if (scope.get() != null)       throw new IllegalStateException();
      scope.set("SCOPPED");
    }
    @Override public void exitScope(    Context context,    Request request){
      if (scope.get() == null)       throw new IllegalStateException();
      scope.set(null);
    }
  }
);
  server.start();
}
