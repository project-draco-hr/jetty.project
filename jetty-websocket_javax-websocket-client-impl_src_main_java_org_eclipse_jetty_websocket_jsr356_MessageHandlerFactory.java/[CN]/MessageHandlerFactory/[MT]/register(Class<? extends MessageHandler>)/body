{
  List<MessageHandlerMetadata> metadatas=new ArrayList<>();
  boolean partial=false;
  if (MessageHandler.Partial.class.isAssignableFrom(handler)) {
    LOG.debug("supports Partial: {}",handler);
    partial=true;
    Class<?> onMessageClass=ReflectUtils.findGenericClassFor(handler,MessageHandler.Partial.class);
    LOG.debug("Partial message class: {}",onMessageClass);
    metadatas.add(new MessageHandlerMetadata(handler,onMessageClass,partial));
  }
  if (MessageHandler.Whole.class.isAssignableFrom(handler)) {
    LOG.debug("supports Whole: {}",handler.getName());
    partial=false;
    Class<?> onMessageClass=ReflectUtils.findGenericClassFor(handler,MessageHandler.Whole.class);
    LOG.debug("Whole message class: {}",onMessageClass);
    metadatas.add(new MessageHandlerMetadata(handler,onMessageClass,partial));
  }
  registered.put(handler,metadatas);
  return metadatas;
}
