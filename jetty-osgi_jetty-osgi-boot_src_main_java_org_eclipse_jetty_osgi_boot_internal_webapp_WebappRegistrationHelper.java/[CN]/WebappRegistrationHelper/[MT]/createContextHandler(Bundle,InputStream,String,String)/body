{
  ConfigurationManager _configMgr=getContextDeployerConfigurationManager();
  AttributesMap _contextAttributes=getContextDeployerContextAttributes();
  try {
    XmlConfiguration xmlConfiguration=new XmlConfiguration(contextInputStream);
    HashMap<String,Object> properties=new HashMap<String,Object>();
    properties.put("Server",_server);
    if (_configMgr != null) {
      properties.putAll(_configMgr.getProperties());
    }
    setThisBundleHomeProperty(bundle,properties,overrideBundleInstallLocation);
    xmlConfiguration.setProperties(properties);
    ContextHandler context=(ContextHandler)xmlConfiguration.configure();
    if (context instanceof WebAppContext) {
      ((WebAppContext)context).setExtraClasspath(extraClasspath);
    }
    context.setAttributes(new AttributesMap(_contextAttributes));
    context.setAttribute("osgi-bundlecontext",bundle.getBundleContext());
    return context;
  }
 catch (  FileNotFoundException e) {
    return null;
  }
catch (  SAXException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
  }
catch (  Throwable e) {
    e.printStackTrace();
  }
 finally {
    if (contextInputStream != null)     try {
      contextInputStream.close();
    }
 catch (    IOException ioe) {
    }
  }
  return null;
}
