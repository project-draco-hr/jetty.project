{
  _parser.setFakeFragments(false);
  _in.putUnmasked((byte)0x81);
  _in.putUnmasked((byte)(0x80 | 0x7E));
  _in.putUnmasked((byte)(2048 >> 8));
  _in.putUnmasked((byte)(2048 & 0xff));
  _in.sendMask();
  int progress=_parser.parseNext();
  assertTrue(progress > 0);
  assertEquals(WebSocketConnectionD13.CLOSE_POLICY_VIOLATION,_handler._code);
  for (int i=0; i < 2048; i++)   _in.put((byte)'a');
  progress=_parser.parseNext();
  assertEquals(2048,progress);
  assertEquals(0,_handler._data.size());
  assertEquals(0,_handler._utf8.length());
  _handler._code=0;
  _handler._message=null;
  _in.putUnmasked((byte)0x81);
  _in.putUnmasked((byte)0xFE);
  _in.putUnmasked((byte)(1024 >> 8));
  _in.putUnmasked((byte)(1024 & 0xff));
  _in.sendMask();
  for (int i=0; i < 1024; i++)   _in.put((byte)'a');
  progress=_parser.parseNext();
  assertTrue(progress > 0);
  assertEquals(1,_handler._data.size());
  assertEquals(1024,_handler._data.get(0).length());
}
