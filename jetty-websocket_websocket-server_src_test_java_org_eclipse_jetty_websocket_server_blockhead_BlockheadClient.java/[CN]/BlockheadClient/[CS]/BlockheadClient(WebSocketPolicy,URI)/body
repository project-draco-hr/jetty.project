{
  Assert.assertThat("Websocket URI scheme",destWebsocketURI.getScheme(),anyOf(is("ws"),is("wss")));
  this.destWebsocketURI=destWebsocketURI;
  String scheme="http";
  if (destWebsocketURI.getScheme().equals("wss")) {
    scheme="https";
  }
  this.destHttpURI=new URI(scheme,destWebsocketURI.getUserInfo(),destWebsocketURI.getHost(),destWebsocketURI.getPort(),destWebsocketURI.getPath(),destWebsocketURI.getQuery(),destWebsocketURI.getFragment());
  this.bufferPool=new MappedByteBufferPool(8192);
  this.generator=new Generator(policy,bufferPool);
  this.parser=new Parser(policy,bufferPool);
  this.parseCount=new AtomicInteger(0);
  this.incomingFrames=new IncomingFramesCapture();
  this.extensionFactory=new WebSocketExtensionFactory(policy,bufferPool);
  this.ioState=new IOState();
  this.ioState.addListener(this);
}
