{
  int startCount=incomingFrameQueue.size();
  long expireOn=System.currentTimeMillis() + TimeUnit.MILLISECONDS.convert(timeoutDuration,timeoutUnit);
  ByteBuffer buf=bufferPool.acquire(policy.getBufferSize(),false);
  BufferUtil.clearToFill(buf);
  try {
    int len=0;
    while (incomingFrameQueue.size() < (startCount + expectedCount)) {
      len=read(buf);
      if (len > 0) {
        LOG.debug("Read {} bytes",len);
        BufferUtil.flipToFlush(buf,0);
        parser.parse(buf);
      }
      if (!DEBUG && (System.currentTimeMillis() > expireOn)) {
        throw new TimeoutException("Timeout reading all of the desired frames");
      }
    }
  }
  finally {
    bufferPool.release(buf);
  }
  return incomingFrameQueue;
}
