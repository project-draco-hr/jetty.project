{
  ByteBuffer buf=bufferPool.acquire(policy.getBufferSize(),false);
  try {
    BufferUtil.flipToFill(buf);
    generator.generate(buf,frame);
    BufferUtil.flipToFlush(buf,0);
    out.write(BufferUtil.toArray(buf));
  }
  finally {
    bufferPool.release(buf);
  }
}
