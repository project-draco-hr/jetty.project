{
  ByteBuffer buf=generator.generate(frame);
  if (LOG.isDebugEnabled()) {
    LOG.debug("writing out: {}",BufferUtil.toDetailString(buf));
  }
  BufferUtil.writeTo(buf,out);
  out.flush();
  bufferPool.release(buf);
  if (frame.getType().getOpCode() == OpCode.CLOSE) {
    disconnect();
  }
  return FinishedFuture.INSTANCE;
}
