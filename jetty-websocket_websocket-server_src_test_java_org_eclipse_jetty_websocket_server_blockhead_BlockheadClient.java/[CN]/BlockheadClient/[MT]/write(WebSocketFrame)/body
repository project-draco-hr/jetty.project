{
  LOG.debug("write(Frame->{})",frame);
  ByteBuffer buf=bufferPool.acquire(policy.getBufferSize(),false);
  try {
    frame.setMask(clientmask);
    BufferUtil.flipToFill(buf);
    generator.generate(buf,frame);
    BufferUtil.flipToFlush(buf,0);
    BufferUtil.writeTo(buf,out);
  }
  finally {
    bufferPool.release(buf);
  }
}
