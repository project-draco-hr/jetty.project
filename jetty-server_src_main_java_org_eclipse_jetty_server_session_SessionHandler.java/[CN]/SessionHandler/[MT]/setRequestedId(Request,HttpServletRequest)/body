{
  String requested_session_id=request.getRequestedSessionId();
  if (!DispatcherType.REQUEST.equals(baseRequest.getDispatcherType()) || requested_session_id != null)   return;
  SessionManager sessionManager=getSessionManager();
  boolean requested_session_id_from_cookie=false;
  HttpSession session=null;
  if (_sessionManager.isUsingCookies()) {
    Cookie[] cookies=request.getCookies();
    if (cookies != null && cookies.length > 0) {
      for (int i=0; i < cookies.length; i++) {
        if (sessionManager.getSessionCookie().equalsIgnoreCase(cookies[i].getName())) {
          if (requested_session_id != null) {
            if (sessionManager.getHttpSession(requested_session_id) != null)             break;
          }
          requested_session_id=cookies[i].getValue();
          requested_session_id_from_cookie=true;
          if (Log.isDebugEnabled())           Log.debug("Got Session ID " + requested_session_id + " from cookie");
          session=sessionManager.getHttpSession(requested_session_id);
          if (session != null)           baseRequest.setSession(session);
        }
      }
    }
  }
  if (requested_session_id == null || session == null) {
    String uri=request.getRequestURI();
    int semi=uri.lastIndexOf(';');
    if (semi >= 0) {
      String param=sessionManager.getSessionIdPathParameterName();
      if (param != null) {
        int p=uri.indexOf(param,semi + 1);
        if (p > 0) {
          requested_session_id=uri.substring(p + param.length() + 1);
          requested_session_id_from_cookie=false;
          if (Log.isDebugEnabled())           Log.debug("Got Session ID " + requested_session_id + " from URL");
        }
      }
    }
  }
  baseRequest.setRequestedSessionId(requested_session_id);
  baseRequest.setRequestedSessionIdFromCookie(requested_session_id != null && requested_session_id_from_cookie);
}
