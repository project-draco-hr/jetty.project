{
  TrackingSocket wsocket=new TrackingSocket();
  WebSocketClient client=factory.newWebSocketClient(wsocket);
  URI wsUri=server.getWsUri();
  Future<UpgradeResponse> future=client.connect(wsUri);
  ServerConnection ssocket=server.accept();
  ssocket.upgrade();
  future.get(500,TimeUnit.MILLISECONDS);
  wsocket.assertIsOpen();
  ssocket.disconnect();
  Assert.assertThat("Close should have been detected",wsocket.closeLatch.await(10,TimeUnit.SECONDS),is(true));
}
