{
  String key="not sent";
  BufferedReader in=new BufferedReader(new InputStreamReader(connection.getInputStream()));
  for (String line=in.readLine(); line != null; line=in.readLine()) {
    if (line.length() == 0) {
      break;
    }
    if (line.startsWith("Sec-WebSocket-Key:")) {
      key=line.substring(18).trim();
    }
  }
  connection.getOutputStream().write(("HTTP/1.1 101 Upgrade\r\n" + "Sec-WebSocket-Accept: " + WebSocketConnectionRFC6455.hashKey(key) + "\r\n"+ "\r\n").getBytes());
}
