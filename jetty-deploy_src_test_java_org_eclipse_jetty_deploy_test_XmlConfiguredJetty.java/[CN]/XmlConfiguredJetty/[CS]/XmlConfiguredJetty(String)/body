{
  xmlConfigurations=new ArrayList<URL>();
  properties=new Properties();
  String jettyHomeBase=MavenTestingUtils.getTargetTestingDir(testname).getAbsolutePath();
  int idx=0;
  jettyHome=new File(jettyHomeBase + "#" + idx);
  while (jettyHome.exists()) {
    idx++;
    jettyHome=new File(jettyHomeBase + "#" + idx);
  }
  deleteContents(jettyHome);
  jettyHome.mkdirs();
  File logsDir=new File(jettyHome,"logs");
  logsDir.mkdirs();
  File etcDir=new File(jettyHome,"etc");
  etcDir.mkdirs();
  IO.copyFile(MavenTestingUtils.getTestResourceFile("etc/realm.properties"),new File(etcDir,"realm.properties"));
  IO.copyFile(MavenTestingUtils.getTestResourceFile("etc/webdefault.xml"),new File(etcDir,"webdefault.xml"));
  File contextsDir=new File(jettyHome,"contexts");
  if (contextsDir.exists()) {
    deleteContents(contextsDir);
  }
  contextsDir.mkdirs();
  File webappsDir=new File(jettyHome,"webapps");
  if (webappsDir.exists()) {
    deleteContents(webappsDir);
  }
  webappsDir.mkdirs();
  File tmpDir=new File(jettyHome,"tmp");
  tmpDir.mkdirs();
  System.setProperty("java.io.tmpdir",tmpDir.getAbsolutePath());
  properties.setProperty("jetty.home",jettyHome.getAbsolutePath());
  System.setProperty("jetty.home",jettyHome.getAbsolutePath());
  properties.setProperty("test.basedir",MavenTestingUtils.getBasedir().getAbsolutePath());
  properties.setProperty("test.resourcesdir",MavenTestingUtils.getTestResourcesDir().getAbsolutePath());
  properties.setProperty("test.webapps",webappsDir.getAbsolutePath());
  properties.setProperty("test.targetdir",MavenTestingUtils.getTargetDir().getAbsolutePath());
  File testConfig=MavenTestingUtils.getTargetFile("xml-configured-jetty.properties");
  FileOutputStream out=new FileOutputStream(testConfig);
  properties.store(out,"Generated by " + XmlConfiguredJetty.class.getName());
}
