{
  byte payload[]=new byte[65536];
  Arrays.fill(payload,(byte)'*');
  int segmentSize=997;
  List<WebSocketFrame> send=new ArrayList<>();
  send.add(WebSocketFrame.text().setPayload(payload));
  send.add(new CloseInfo(StatusCode.NORMAL).asFrame());
  List<WebSocketFrame> expect=new ArrayList<>();
  expect.add(WebSocketFrame.text().setPayload(payload));
  expect.add(new CloseInfo(StatusCode.NORMAL).asFrame());
  Fuzzer fuzzer=new Fuzzer(this);
  try {
    fuzzer.connect();
    fuzzer.setSendMode(SendMode.SLOW);
    fuzzer.setSlowSendSegmentSize(segmentSize);
    fuzzer.send(send);
    fuzzer.expect(expect,TimeUnit.SECONDS,2);
  }
  finally {
    fuzzer.close();
  }
}
