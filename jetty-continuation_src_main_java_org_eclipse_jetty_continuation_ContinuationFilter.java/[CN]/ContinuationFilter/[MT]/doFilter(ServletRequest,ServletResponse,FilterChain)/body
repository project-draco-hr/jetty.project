{
  if (_faux) {
    final FauxContinuation fc=new FauxContinuation(this,request,response);
    request.setAttribute(Continuation.ATTRIBUTE,fc);
    boolean complete=false;
    while (!complete) {
      try {
        chain.doFilter(request,response);
      }
 catch (      IOException e) {
        if (fc.isSuspended())         debug("ContinuationFilter caught ",e);
 else         throw e;
      }
catch (      ServletException e) {
        if (fc.isSuspended())         debug("ContinuationFilter caught ",e);
 else         throw e;
      }
 finally {
        complete=fc.handleSuspension();
      }
    }
    fc.onComplete();
  }
 else   if (_partial) {
    PartialContinuation c=(PartialContinuation)request.getAttribute(Continuation.ATTRIBUTE);
    try {
      if (c == null || c.enter())       chain.doFilter(request,response);
    }
  finally {
      if (c == null)       c=(PartialContinuation)request.getAttribute(Continuation.ATTRIBUTE);
      if (c != null)       c.exit();
    }
  }
 else   chain.doFilter(request,response);
}
