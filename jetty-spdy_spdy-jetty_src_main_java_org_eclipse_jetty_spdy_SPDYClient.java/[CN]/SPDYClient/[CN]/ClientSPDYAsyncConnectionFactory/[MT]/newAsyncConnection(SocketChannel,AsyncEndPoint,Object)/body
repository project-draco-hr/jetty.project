{
  SessionPromise sessionPromise=(SessionPromise)attachment;
  SPDYClient client=sessionPromise.client;
  Factory factory=client.factory;
  CompressionFactory compressionFactory=new StandardCompressionFactory();
  Parser parser=new Parser(compressionFactory.newDecompressor());
  Generator generator=new Generator(factory.bufferPool,compressionFactory.newCompressor());
  SPDYAsyncConnection connection=new ClientSPDYAsyncConnection(endPoint,factory.bufferPool,parser,factory);
  endPoint.setAsyncConnection(connection);
  FlowControlStrategy flowControlStrategy=client.newFlowControlStrategy();
  StandardSession session=new StandardSession(client.version,factory.bufferPool,factory.threadPool,factory.scheduler,connection,connection,1,sessionPromise.listener,generator,flowControlStrategy);
  session.setWindowSize(client.getInitialWindowSize());
  parser.addListener(session);
  sessionPromise.completed(session);
  connection.setSession(session);
  factory.sessionOpened(session);
  return connection;
}
