{
  BlockheadClient client=new BlockheadClient(server.getServerUri());
  client.setProtocols("fastclose");
  client.setTimeout(TimeUnit.SECONDS,1);
  try {
    client.connect();
    client.sendStandardRequest();
    client.expectUpgradeResponse();
    IncomingFramesCapture capture=client.readFrames(1,TimeUnit.SECONDS,1);
    WebSocketFrame frame=capture.getFrames().poll();
    Assert.assertThat("frames[0].opcode",frame.getOpCode(),is(OpCode.CLOSE));
    CloseInfo close=new CloseInfo(frame);
    Assert.assertThat("Close Status Code",close.getStatusCode(),is(StatusCode.NORMAL));
    client.write(close.asFrame());
    Assert.assertThat("Fast Close Latch",fastcloseSocket.closeLatch.await(1,TimeUnit.SECONDS),is(true));
    Assert.assertThat("Fast Close.statusCode",fastcloseSocket.closeStatusCode,is(StatusCode.NORMAL));
  }
  finally {
    client.close();
  }
}
