{
  final CountDownLatch latch=new CountDownLatch(1);
  InetSocketAddress address=startServer(new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      stream.reply(new ReplyInfo(true),new Callback.Adapter());
      return null;
    }
    @Override public void onGoAway(    Session session,    GoAwayResultInfo goAwayInfo){
      latch.countDown();
    }
  }
);
  QueuedThreadPool threadPool=new QueuedThreadPool();
  threadPool.setName(threadPool.getName() + "-client");
  clientFactory=newSPDYClientFactory(threadPool);
  SPDYClient client=clientFactory.newSPDYClient(SPDY.V2);
  client.setIdleTimeout(idleTimeout);
  Session session=client.connect(address,null);
  session.syn(new SynInfo(new Fields(),true),null);
  Assert.assertTrue(latch.await(2 * idleTimeout,TimeUnit.MILLISECONDS));
}
