{
  HttpFields fields=new HttpFields();
  fields.addSetCookie("minimal","value",null,null,-1,null,false,false,-1);
  assertEquals("minimal=value",fields.getStringField("Set-Cookie"));
  fields.clear();
  fields.addSetCookie("everything","wrong","domain","path",0,"to be replaced",true,true,0);
  fields.addSetCookie("everything","value","domain","path",0,"comment",true,true,0);
  assertEquals("everything=value;Version=1;Path=path;Domain=domain;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=comment",fields.getStringField("Set-Cookie"));
  Enumeration<String> e=fields.getValues("Set-Cookie");
  assertTrue(e.hasMoreElements());
  assertEquals("everything=value;Version=1;Path=path;Domain=domain;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=comment",e.nextElement());
  assertFalse(e.hasMoreElements());
  assertEquals("Thu, 01 Jan 1970 00:00:00 GMT",fields.getStringField("Expires"));
  assertFalse(e.hasMoreElements());
  fields.clear();
  fields.addSetCookie("everything","other","domain1","path",0,"blah",true,true,0);
  fields.addSetCookie("everything","value","domain2","path",0,"comment",true,true,0);
  e=fields.getValues("Set-Cookie");
  assertTrue(e.hasMoreElements());
  assertEquals("everything=other;Version=1;Path=path;Domain=domain1;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=blah",e.nextElement());
  assertTrue(e.hasMoreElements());
  assertEquals("everything=value;Version=1;Path=path;Domain=domain2;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=comment",e.nextElement());
  assertFalse(e.hasMoreElements());
  fields.clear();
  fields.addSetCookie("everything","other","domain1","path",0,"blah",true,true,0);
  fields.addSetCookie("everything","value","","path",0,"comment",true,true,0);
  e=fields.getValues("Set-Cookie");
  assertTrue(e.hasMoreElements());
  assertEquals("everything=other;Version=1;Path=path;Domain=domain1;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=blah",e.nextElement());
  assertTrue(e.hasMoreElements());
  assertEquals("everything=value;Version=1;Path=path;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=comment",e.nextElement());
  assertFalse(e.hasMoreElements());
  fields.clear();
  fields.addSetCookie("everything","other","domain1","path1",0,"blah",true,true,0);
  fields.addSetCookie("everything","value","domain1","path2",0,"comment",true,true,0);
  e=fields.getValues("Set-Cookie");
  assertTrue(e.hasMoreElements());
  assertEquals("everything=other;Version=1;Path=path1;Domain=domain1;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=blah",e.nextElement());
  assertTrue(e.hasMoreElements());
  assertEquals("everything=value;Version=1;Path=path2;Domain=domain1;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=comment",e.nextElement());
  assertFalse(e.hasMoreElements());
  fields.clear();
  fields.addSetCookie("everything","other","domain1","path1",0,"blah",true,true,0);
  fields.addSetCookie("everything","value","domain1","",0,"comment",true,true,0);
  e=fields.getValues("Set-Cookie");
  assertTrue(e.hasMoreElements());
  assertEquals("everything=other;Version=1;Path=path1;Domain=domain1;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=blah",e.nextElement());
  assertTrue(e.hasMoreElements());
  assertEquals("everything=value;Version=1;Domain=domain1;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=comment",e.nextElement());
  assertFalse(e.hasMoreElements());
  fields.clear();
  fields.addSetCookie("everything","other","","",0,"blah",true,true,0);
  fields.addSetCookie("everything","value","","",0,"comment",true,true,0);
  e=fields.getValues("Set-Cookie");
  assertTrue(e.hasMoreElements());
  assertEquals("everything=value;Version=1;Expires=Thu, 01-Jan-1970 00:00:00 GMT;Max-Age=0;Secure;HttpOnly;Comment=comment",e.nextElement());
  assertFalse(e.hasMoreElements());
  fields.clear();
  fields.addSetCookie("ev erything","va lue","do main","pa th",1,"co mment",true,true,1);
  String setCookie=fields.getStringField("Set-Cookie");
  assertThat(setCookie,Matchers.startsWith("\"ev erything\"=\"va lue\";Version=1;Path=\"pa th\";Domain=\"do main\";Expires="));
  assertThat(setCookie,Matchers.endsWith(" GMT;Max-Age=1;Secure;HttpOnly;Comment=\"co mment\""));
  fields.clear();
  fields.addSetCookie("name","value",null,null,-1,null,false,false,0);
  setCookie=fields.getStringField("Set-Cookie");
  assertEquals(-1,setCookie.indexOf("Version="));
  fields.clear();
  fields.addSetCookie("name","v a l u e",null,null,-1,null,false,false,0);
  setCookie=fields.getStringField("Set-Cookie");
  fields.clear();
  fields.addSetCookie("json","{\"services\":[\"cwa\", \"aa\"]}",null,null,-1,null,false,false,-1);
  assertEquals("json=\"{\\\"services\\\":[\\\"cwa\\\", \\\"aa\\\"]}\"",fields.getStringField("Set-Cookie"));
  fields.clear();
  fields.addSetCookie("name","value","domain",null,-1,null,false,false,-1);
  fields.addSetCookie("name","other","domain",null,-1,null,false,false,-1);
  assertEquals("name=other;Domain=domain",fields.getStringField("Set-Cookie"));
  fields.addSetCookie("name","more","domain",null,-1,null,false,false,-1);
  assertEquals("name=more;Domain=domain",fields.getStringField("Set-Cookie"));
  fields.addSetCookie("foo","bar","domain",null,-1,null,false,false,-1);
  fields.addSetCookie("foo","bob","domain",null,-1,null,false,false,-1);
  assertEquals("name=more;Domain=domain",fields.getStringField("Set-Cookie"));
  e=fields.getValues("Set-Cookie");
  assertEquals("name=more;Domain=domain",e.nextElement());
  assertEquals("foo=bob;Domain=domain",e.nextElement());
  fields=new HttpFields();
  fields.addSetCookie("name","value==",null,null,-1,null,false,false,0);
  setCookie=fields.getStringField("Set-Cookie");
  assertEquals("name=\"value==\";Version=1",setCookie);
}
