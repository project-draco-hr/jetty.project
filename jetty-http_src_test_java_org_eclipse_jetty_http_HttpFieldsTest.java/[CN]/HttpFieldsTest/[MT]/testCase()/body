{
  HttpFields fields=new HttpFields();
  Set s;
  byte[] b="Message-IDmessage-idvalueVALUE".getBytes();
  ByteArrayBuffer buf=new ByteArrayBuffer(512);
  buf.put(b);
  View headUC=new View.CaseInsensitive(buf);
  View headLC=new View.CaseInsensitive(buf);
  View valUC=new View(buf);
  View valLC=new View(buf);
  headUC.update(0,10);
  headLC.update(10,20);
  valUC.update(20,25);
  valLC.update(25,30);
  fields.add("header","value");
  fields.add(headUC,valLC);
  fields.add("other","data");
  s=enum2set(fields.getFieldNames());
  assertEquals(3,s.size());
  assertTrue(s.contains("message-id"));
  assertEquals("value",fields.getStringField("message-id").toLowerCase(Locale.ENGLISH));
  assertEquals("value",fields.getStringField("Message-ID").toLowerCase(Locale.ENGLISH));
  fields.clear();
  fields.add("header","value");
  fields.add(headLC,valLC);
  fields.add("other","data");
  s=enum2set(fields.getFieldNames());
  assertEquals(3,s.size());
  assertTrue(s.contains("message-id"));
  assertEquals("value",fields.getStringField("Message-ID").toLowerCase(Locale.ENGLISH));
  assertEquals("value",fields.getStringField("message-id").toLowerCase(Locale.ENGLISH));
  fields.clear();
  fields.add("header","value");
  fields.add(headUC,valUC);
  fields.add("other","data");
  s=enum2set(fields.getFieldNames());
  assertEquals(3,s.size());
  assertTrue(s.contains("message-id"));
  assertEquals("value",fields.getStringField("message-id").toLowerCase(Locale.ENGLISH));
  assertEquals("value",fields.getStringField("Message-ID").toLowerCase(Locale.ENGLISH));
  fields.clear();
  fields.add("header","value");
  fields.add(headLC,valUC);
  fields.add("other","data");
  s=enum2set(fields.getFieldNames());
  assertEquals(3,s.size());
  assertTrue(s.contains("message-id"));
  assertEquals("value",fields.getStringField("Message-ID").toLowerCase(Locale.ENGLISH));
  assertEquals("value",fields.getStringField("message-id").toLowerCase(Locale.ENGLISH));
}
