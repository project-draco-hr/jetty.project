{
  File testDir=MavenTestingUtils.getTargetTestingDir("saved");
  testDir.mkdirs();
  HashSessionManager manager=new HashSessionManager();
  manager.setStoreDirectory(testDir);
  manager.setMaxInactiveInterval(5);
  Assert.assertTrue(testDir.exists());
  Assert.assertTrue(testDir.canWrite());
  HashSessionIdManager idManager=new HashSessionIdManager();
  idManager.setWorkerName("foo");
  manager.setSessionIdManager(idManager);
  idManager.start();
  manager.start();
  HashedSession session=(HashedSession)manager.newHttpSession(new Request(null,null));
  String sessionId=session.getId();
  session.setAttribute("one",new Integer(1));
  session.setAttribute("two",new Integer(2));
  idManager.stop();
  manager.setMaxInactiveInterval(30);
  manager.stop();
  Assert.assertTrue("File should exist!",new File(testDir,session.getId()).exists());
  idManager.start();
  manager.start();
  HashedSession restoredSession=(HashedSession)manager.getSession(sessionId);
  Assert.assertNotNull(restoredSession);
  Object o=restoredSession.getAttribute("one");
  Assert.assertNotNull(o);
  Assert.assertEquals(1,((Integer)o).intValue());
  Assert.assertEquals(5,restoredSession.getMaxInactiveInterval());
}
