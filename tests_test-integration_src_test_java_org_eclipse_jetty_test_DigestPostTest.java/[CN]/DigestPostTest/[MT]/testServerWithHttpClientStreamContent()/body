{
  String srvUrl="http://127.0.0.1:" + ((NetworkConnector)_server.getConnectors()[0]).getLocalPort() + "/test/";
  HttpClient client=new HttpClient();
  try {
    AuthenticationStore authStore=client.getAuthenticationStore();
    authStore.addAuthentication(new DigestAuthentication(srvUrl,"test","testuser","password"));
    client.start();
    String sent=IO.toString(new FileInputStream("src/test/resources/message.txt"));
    Request request=client.newRequest(srvUrl);
    request.method(HttpMethod.POST);
    request.content(new StringContentProvider(sent));
    _received=null;
    ContentResponse response=request.send().get(5,TimeUnit.SECONDS);
    Assert.assertEquals(200,response.getStatus());
    Assert.assertEquals(sent,_received);
  }
  finally {
    client.stop();
  }
}
