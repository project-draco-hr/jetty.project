{
  Session session=(Session)_sessions.get(idInCluster);
synchronized (this) {
    try {
      SessionData data=null;
      long now=System.currentTimeMillis();
      if (Log.isDebugEnabled()) {
        if (session == null)         Log.debug("now=" + now + " lastSaved="+ (session == null ? 0 : session._data._lastSaved)+ " interval="+ (_saveIntervalSec * 1000));
 else         Log.debug("now=" + now + " lastSaved="+ (session == null ? 0 : session._data._lastSaved)+ " interval="+ (_saveIntervalSec * 1000)+ " lastNode="+ session._data.getLastNode()+ " thisNode="+ getIdManager().getWorkerName()+ " difference="+ (now - session._data._lastSaved));
      }
      if (session == null || ((now - session._data._lastSaved) >= (_saveIntervalSec * 1000))) {
        Log.debug("no session ",idInCluster);
        data=loadSession(idInCluster,canonicalize(_context.getContextPath()),getVirtualHost(_context));
      }
 else       if ((now - session._data._lastSaved) >= (_saveIntervalSec * 1000)) {
        Log.debug("old session",idInCluster);
        data=loadSession(idInCluster,canonicalize(_context.getContextPath()),getVirtualHost(_context));
      }
 else {
        data=session._data;
      }
      if (data != null) {
        if (!data.getLastNode().equals(getIdManager().getWorkerName()) || session == null) {
          if (data._expiryTime > now) {
            Log.debug("expired session",idInCluster);
            session=new Session(now,data);
            _sessions.put(idInCluster,session);
            session.didActivate();
            updateSessionNode(data);
          }
        }
 else         if (Log.isDebugEnabled())         Log.debug("Session not stale " + session._data);
      }
 else {
        session=null;
        if (Log.isDebugEnabled())         Log.debug("No session in database matching id=" + idInCluster);
      }
      return session;
    }
 catch (    Exception e) {
      Log.warn("Unable to load session from database",e);
      return null;
    }
  }
}
