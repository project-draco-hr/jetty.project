{
  while (true) {
    OutputState last=_state.get();
switch (last) {
case PENDING:
      if (!_state.compareAndSet(OutputState.PENDING,OutputState.ASYNC))       continue;
    break;
case UNREADY:
  if (!_state.compareAndSet(OutputState.UNREADY,OutputState.READY))   continue;
_channel.getState().onWritePossible();
break;
case CLOSED:
break;
default :
throw new IllegalStateException();
}
break;
}
}
