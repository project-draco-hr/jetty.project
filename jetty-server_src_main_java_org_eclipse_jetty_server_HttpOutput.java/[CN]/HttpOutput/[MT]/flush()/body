{
  while (true) {
switch (_state.get()) {
case OPEN:
      if (BufferUtil.hasContent(_aggregate))       _channel.write(_aggregate,false);
 else       _channel.write(BufferUtil.EMPTY_BUFFER,false);
    return;
case ASYNC:
  throw new IllegalStateException("isReady() not called");
case READY:
if (!_state.compareAndSet(OutputState.READY,OutputState.PENDING)) continue;
new AsyncFlush().iterate();
return;
case PENDING:
case UNREADY:
throw new WritePendingException();
case CLOSED:
return;
}
break;
}
}
