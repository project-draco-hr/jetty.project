{
  if (roleInfo == null)   return true;
  if (roleInfo.isForbidden())   return false;
  UserDataConstraint dataConstraint=roleInfo.getUserDataConstraint();
  if (dataConstraint == null || dataConstraint == UserDataConstraint.None)   return true;
  HttpChannelConfig httpConfig=HttpChannel.getCurrentHttpChannel().getHttpChannelConfig();
  if (dataConstraint == UserDataConstraint.Confidential || dataConstraint == UserDataConstraint.Integral) {
    if (request.isSecure())     return true;
    if (httpConfig.getSecurePort() > 0) {
      String url=httpConfig.getSecureScheme() + "://" + request.getServerName()+ ":"+ httpConfig.getSecurePort()+ request.getRequestURI();
      if (request.getQueryString() != null)       url+="?" + request.getQueryString();
      response.setContentLength(0);
      response.sendRedirect(url);
    }
 else     response.sendError(HttpStatus.FORBIDDEN_403,"!Secure");
    request.setHandled(true);
    return false;
  }
 else {
    throw new IllegalArgumentException("Invalid dataConstraint value: " + dataConstraint);
  }
}
