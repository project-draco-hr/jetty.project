{
  if (constraintInfo == null)   return true;
  RoleInfo roleInfo=(RoleInfo)constraintInfo;
  if (roleInfo.isForbidden())   return false;
  UserDataConstraint dataConstraint=roleInfo.getUserDataConstraint();
  if (dataConstraint == null || dataConstraint == UserDataConstraint.None) {
    return true;
  }
  HttpConnector connector=HttpChannel.getCurrentHttpChannel().getHttpConnector();
  if (dataConstraint == UserDataConstraint.Integral) {
    if (connector.isIntegral(request))     return true;
    if (connector.getIntegralPort() > 0) {
      String url=connector.getIntegralScheme() + "://" + request.getServerName()+ ":"+ connector.getIntegralPort()+ request.getRequestURI();
      if (request.getQueryString() != null)       url+="?" + request.getQueryString();
      response.setContentLength(0);
      response.sendRedirect(url);
    }
 else     response.sendError(Response.SC_FORBIDDEN,"!Integral");
    request.setHandled(true);
    return false;
  }
 else   if (dataConstraint == UserDataConstraint.Confidential) {
    if (connector.isConfidential(request))     return true;
    if (connector.getConfidentialPort() > 0) {
      String url=connector.getConfidentialScheme() + "://" + request.getServerName()+ ":"+ connector.getConfidentialPort()+ request.getRequestURI();
      if (request.getQueryString() != null)       url+="?" + request.getQueryString();
      response.setContentLength(0);
      response.sendRedirect(url);
    }
 else     response.sendError(Response.SC_FORBIDDEN,"!Confidential");
    request.setHandled(true);
    return false;
  }
 else {
    throw new IllegalArgumentException("Invalid dataConstraint value: " + dataConstraint);
  }
}
