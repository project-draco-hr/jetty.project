{
  if (constraintInfo == null)   return true;
  RoleInfo roleInfo=(RoleInfo)constraintInfo;
  if (roleInfo.isForbidden())   return false;
  UserDataConstraint dataConstraint=roleInfo.getUserDataConstraint();
  if (dataConstraint == null || dataConstraint == UserDataConstraint.None) {
    return true;
  }
  AbstractHttpConnection connection=AbstractHttpConnection.getCurrentConnection();
  Connector connector=connection.getConnector();
  if (dataConstraint == UserDataConstraint.Integral) {
    if (connector.isIntegral(request))     return true;
    if (connector.getIntegralPort() > 0) {
      String scheme=connector.getIntegralScheme();
      int port=connector.getIntegralPort();
      String url=(HttpSchemes.HTTPS.equalsIgnoreCase(scheme) && port == 443) ? "https://" + request.getServerName() + request.getRequestURI() : scheme + "://" + request.getServerName()+ ":"+ port+ request.getRequestURI();
      if (request.getQueryString() != null)       url+="?" + request.getQueryString();
      response.setContentLength(0);
      response.sendRedirect(url);
    }
 else     response.sendError(Response.SC_FORBIDDEN,"!Integral");
    request.setHandled(true);
    return false;
  }
 else   if (dataConstraint == UserDataConstraint.Confidential) {
    if (connector.isConfidential(request))     return true;
    if (connector.getConfidentialPort() > 0) {
      String scheme=connector.getConfidentialScheme();
      int port=connector.getConfidentialPort();
      String url=(HttpSchemes.HTTPS.equalsIgnoreCase(scheme) && port == 443) ? "https://" + request.getServerName() + request.getRequestURI() : scheme + "://" + request.getServerName()+ ":"+ port+ request.getRequestURI();
      if (request.getQueryString() != null)       url+="?" + request.getQueryString();
      response.setContentLength(0);
      response.sendRedirect(url);
    }
 else     response.sendError(Response.SC_FORBIDDEN,"!Confidential");
    request.setHandled(true);
    return false;
  }
 else {
    throw new IllegalArgumentException("Invalid dataConstraint value: " + dataConstraint);
  }
}
