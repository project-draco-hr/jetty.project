{
  while (true) {
    if (bytes != null) {
      if (index < bytes.length)       return bytes[index++];
      length.addAndGet(-index);
      bytes=null;
      index=0;
    }
    bytes=take();
    LOG.debug("Dequeued {}/{} bytes",bytes,bytes.length);
    if (bytes == EOF)     return -1;
    if (bytes == FAILURE) {
      if (failure instanceof IOException)       throw (IOException)failure;
 else       throw new IOException(failure);
    }
    signal();
  }
}
