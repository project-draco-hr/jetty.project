{
  if (!closed) {
    int remaining=content.remaining();
    if (remaining > 0) {
      byte[] bytes=new byte[remaining];
      content.get(bytes);
      if (LOG.isDebugEnabled())       LOG.debug("Queuing {}/{} bytes",bytes,remaining);
      queue.offer(bytes);
      long newLength=length.addAndGet(remaining);
      while (newLength >= maxBufferSize) {
        if (LOG.isDebugEnabled())         LOG.debug("Queued bytes limit {}/{} exceeded, waiting",newLength,maxBufferSize);
        if (!await())         break;
        newLength=length.get();
        if (LOG.isDebugEnabled())         LOG.debug("Queued bytes limit {}/{} exceeded, woken up",newLength,maxBufferSize);
      }
    }
 else {
      if (LOG.isDebugEnabled())       LOG.debug("Queuing skipped, empty content {}",content);
    }
  }
 else {
    LOG.debug("Queuing skipped, stream already closed");
  }
}
