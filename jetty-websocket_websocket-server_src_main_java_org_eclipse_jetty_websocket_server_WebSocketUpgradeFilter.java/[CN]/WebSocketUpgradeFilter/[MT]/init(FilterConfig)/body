{
  fname=config.getFilterName();
  try {
    WebSocketPolicy policy=factory.getPolicy();
    String max=config.getInitParameter("maxIdleTime");
    if (max != null) {
      policy.setIdleTimeout(Long.parseLong(max));
    }
    max=config.getInitParameter("maxTextMessageSize");
    if (max != null) {
      policy.setMaxTextMessageSize(Integer.parseInt(max));
    }
    max=config.getInitParameter("maxBinaryMessageSize");
    if (max != null) {
      policy.setMaxBinaryMessageSize(Integer.parseInt(max));
    }
    max=config.getInitParameter("inputBufferSize");
    if (max != null) {
      policy.setInputBufferSize(Integer.parseInt(max));
    }
    String key=config.getInitParameter(CONTEXT_ATTRIBUTE_KEY);
    if (key == null) {
      key=WebSocketUpgradeFilter.class.getName();
    }
    if (config.getServletContext().getAttribute(key) != null) {
      throw new ServletException(WebSocketUpgradeFilter.class.getName() + " is defined twice for the same context attribute key '" + key+ "'.  Make sure you have different init-param '"+ CONTEXT_ATTRIBUTE_KEY+ "' values set");
    }
    config.getServletContext().setAttribute(key,this);
    factory.start();
  }
 catch (  Exception x) {
    throw new ServletException(x);
  }
}
