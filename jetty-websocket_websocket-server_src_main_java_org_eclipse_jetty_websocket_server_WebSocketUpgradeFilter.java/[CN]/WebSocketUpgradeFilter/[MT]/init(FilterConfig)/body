{
  try {
    WebSocketPolicy policy=new WebSocketPolicy(WebSocketBehavior.SERVER);
    String max=config.getInitParameter("maxIdleTime");
    if (max != null) {
      policy.setIdleTimeout(Long.parseLong(max));
    }
    max=config.getInitParameter("maxTextMessageSize");
    if (max != null) {
      policy.setMaxTextMessageSize(Integer.parseInt(max));
    }
    max=config.getInitParameter("maxBinaryMessageSize");
    if (max != null) {
      policy.setMaxBinaryMessageSize(Integer.parseInt(max));
    }
    max=config.getInitParameter("inputBufferSize");
    if (max != null) {
      policy.setInputBufferSize(Integer.parseInt(max));
    }
    factory=WebSocketServletFactory.Loader.create(policy);
    factory.init();
  }
 catch (  Exception x) {
    throw new ServletException(x);
  }
}
