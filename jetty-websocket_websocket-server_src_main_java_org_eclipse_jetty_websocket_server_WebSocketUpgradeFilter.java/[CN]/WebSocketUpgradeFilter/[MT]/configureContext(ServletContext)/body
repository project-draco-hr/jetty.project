{
  WebSocketPolicy policy=new WebSocketPolicy(WebSocketBehavior.SERVER);
  WebSocketUpgradeFilter filter=new WebSocketUpgradeFilter(policy);
  String name="Jetty_Dynamic_WebSocketUpgradeFilter";
  String pathSpec="/*";
  EnumSet<DispatcherType> dispatcherTypes=EnumSet.of(DispatcherType.REQUEST);
  boolean isMatchAfter=false;
  String urlPatterns[]={pathSpec};
  FilterRegistration.Dynamic dyn=context.addFilter(name,filter);
  dyn.addMappingForUrlPatterns(dispatcherTypes,isMatchAfter,urlPatterns);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Adding [{}] {} mapped to {} to {}",name,filter,pathSpec,context);
  }
  context.setAttribute(WebSocketUpgradeFilter.class.getName(),filter);
  return filter;
}
