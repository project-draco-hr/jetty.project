{
  String[][] tests={{"/other/location?name=value","http://myhost:8888/other/location;jsessionid=12345?name=value"},{"/other/location","http://myhost:8888/other/location"},{"/other/l%20cation","http://myhost:8888/other/l%20cation"},{"location","http://myhost:8888/path/location"},{"./location","http://myhost:8888/path/location"},{"../location","http://myhost:8888/location"},{"/other/l%20cation","http://myhost:8888/other/l%20cation"},{"l%20cation","http://myhost:8888/path/l%20cation"},{"./l%20cation","http://myhost:8888/path/l%20cation"},{"../l%20cation","http://myhost:8888/l%20cation"},{"../locati%C3%abn","http://myhost:8888/locati%C3%ABn"},{"//foo.bar/some/location","http://foo.bar/some/location"}};
  for (int i=1; i < tests.length; i++) {
    Response response=newResponse();
    Request request=response.getHttpChannel().getRequest();
    request.setServerName("myhost");
    request.setServerPort(8888);
    request.setUri(new HttpURI("/path/info;param;jsessionid=12345?query=0&more=1#target"));
    request.setContextPath("/path");
    request.setRequestedSessionId("12345");
    request.setRequestedSessionIdFromCookie(i > 0);
    HashSessionManager manager=new HashSessionManager();
    manager.setSessionIdManager(new HashSessionIdManager());
    request.setSessionManager(manager);
    request.setSession(new TestSession(manager,"12345"));
    manager.setCheckingRemoteSessionIdEncoding(false);
    response.sendRedirect(tests[i][0]);
    String location=response.getHeader("Location");
    assertEquals(tests[i][0],tests[i][1],location);
  }
}
