{
  Bucket bucket=bucketFor(size,direct);
  ByteBuffer buffer=bucket == null ? null : bucket._queue.poll();
  if (buffer == null) {
    int capacity=bucket == null ? size : bucket._size;
    buffer=direct ? BufferUtil.allocateDirect(capacity) : BufferUtil.allocate(capacity);
  }
  return buffer;
}
