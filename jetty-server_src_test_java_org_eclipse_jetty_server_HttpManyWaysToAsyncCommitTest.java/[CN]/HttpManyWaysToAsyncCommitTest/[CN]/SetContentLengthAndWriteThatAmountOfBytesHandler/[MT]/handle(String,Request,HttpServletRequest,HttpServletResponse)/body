{
  if (request.getAttribute(CONTEXT_ATTRIBUTE) == null) {
    final AsyncContext asyncContext=baseRequest.startAsync();
    new Thread(new Runnable(){
      @Override public void run(){
        try {
          ServletResponse asyncContextResponse=asyncContext.getResponse();
          asyncContextResponse.setContentLength(3);
          asyncContextResponse.getWriter().write("foo");
        }
 catch (        IOException e) {
          e.printStackTrace();
        }
        if (dispatch) {
          request.setAttribute(CONTEXT_ATTRIBUTE,asyncContext);
          asyncContext.dispatch();
        }
 else         asyncContext.complete();
      }
    }
).run();
  }
  baseRequest.setHandled(true);
  super.handle(target,baseRequest,request,response);
}
