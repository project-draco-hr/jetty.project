{
  threadPool=Executors.newCachedThreadPool();
  server=new Server();
  SslSelectChannelConnector connector=new SslSelectChannelConnector(){
    @Override protected SslConnection newSslConnection(    AsyncEndPoint endPoint,    SSLEngine engine){
      return new SslConnection(engine,endPoint){
        @Override public Connection handle() throws IOException {
          sslHandles.incrementAndGet();
          return super.handle();
        }
        @Override protected SslEndPoint newSslEndPoint(){
          return new SslEndPoint(){
            @Override public int flush(            Buffer buffer) throws IOException {
              sslFlushes.incrementAndGet();
              return super.flush(buffer);
            }
          }
;
        }
      }
;
    }
    @Override protected AsyncConnection newPlainConnection(    SocketChannel channel,    AsyncEndPoint endPoint){
      return new org.eclipse.jetty.server.AsyncHttpConnection(this,endPoint,getServer()){
        @Override protected HttpParser newHttpParser(        Buffers requestBuffers,        EndPoint endPoint,        HttpParser.EventHandler requestHandler){
          return new HttpParser(requestBuffers,endPoint,requestHandler){
            @Override public int parseNext() throws IOException {
              httpParses.incrementAndGet();
              return super.parseNext();
            }
          }
;
        }
      }
;
    }
  }
;
  connector.setMaxIdleTime(5000);
  connector.setPort(0);
  File keyStore=MavenTestingUtils.getTestResourceFile("keystore");
  SslContextFactory cf=connector.getSslContextFactory();
  cf.setKeyStorePath(keyStore.getAbsolutePath());
  cf.setKeyStorePassword("storepwd");
  cf.setKeyManagerPassword("keypwd");
  server.addConnector(connector);
  server.setHandler(new AbstractHandler(){
    public void handle(    String target,    Request request,    HttpServletRequest httpRequest,    HttpServletResponse httpResponse) throws IOException, ServletException {
      request.setHandled(true);
      String contentLength=request.getHeader("Content-Length");
      if (contentLength != null) {
        int length=Integer.parseInt(contentLength);
        ServletInputStream input=httpRequest.getInputStream();
        ServletOutputStream output=httpResponse.getOutputStream();
        byte[] buffer=new byte[32 * 1024];
        for (int i=0; i < length; ++i) {
          int read=input.read(buffer);
          if ("/echo".equals(target))           output.write(buffer,0,read);
        }
      }
    }
  }
);
  server.start();
  int serverPort=connector.getLocalPort();
  sslContext=cf.getSslContext();
  proxy=new SimpleProxy(threadPool,"localhost",serverPort);
  proxy.start();
  logger.debug(":{} <==> :{}",proxy.getPort(),serverPort);
}
