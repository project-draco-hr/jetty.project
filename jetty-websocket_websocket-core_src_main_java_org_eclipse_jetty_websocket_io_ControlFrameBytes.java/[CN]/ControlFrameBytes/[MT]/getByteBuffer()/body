{
  if (buffer == null) {
    buffer=connection.getBufferPool().acquire(frame.getPayloadLength() + Generator.OVERHEAD,false);
    connection.getGenerator().generate(frame);
    BufferUtil.flipToFlush(buffer,0);
  }
  return buffer;
}
