{
  Pattern section=Pattern.compile("\\s*\\[([^]]*)\\]\\s*");
  if (!FS.canReadFile(file)) {
    StartLog.debug("Skipping read of missing file: %s",basehome.toShortForm(file));
    return;
  }
  try (FileReader reader=new FileReader(file)){
    try (BufferedReader buf=new BufferedReader(reader)){
      String line;
      String sectionType="";
      String switchProperty=null;
      String caseTag=null;
      String caseTagColon=null;
      boolean switched=false;
      while ((line=buf.readLine()) != null) {
        line=line.trim();
        if (caseTag != null) {
          if ("}".equals(line)) {
            if (!switched) {
              StartLog.warn("WARN: No matching case in %s for ${switch %s=%s ...}",basehome.toShortForm(file),switchProperty,caseTag);
            }
            caseTag=null;
            caseTagColon=null;
            switchProperty=null;
            continue;
          }
          if (switched) {
            continue;
          }
          if (!line.startsWith(caseTagColon) && !line.startsWith("*:")) {
            continue;
          }
          switched=true;
          line=line.substring(line.indexOf(':') + 1).trim();
        }
 else         if (line.startsWith("${switch ")) {
          switched=false;
          switchProperty=line.substring(9).trim();
          caseTag=System.getProperty(switchProperty);
          caseTagColon=caseTag + ":";
          continue;
        }
        Matcher sectionMatcher=section.matcher(line);
        if (sectionMatcher.matches()) {
          sectionType=sectionMatcher.group(1).trim().toUpperCase(Locale.ENGLISH);
        }
 else {
          if ((line.length() == 0) || line.startsWith("#")) {
            if ("INI-TEMPLATE".equals(sectionType)) {
              initialise.add(line);
            }
          }
 else {
switch (sectionType) {
case "DEPEND":
              parentNames.add(line);
            break;
case "LIB":
          libs.add(line);
        break;
case "XML":
      xmls.add(line);
    break;
case "OPTIONAL":
  optionalParentNames.add(line);
break;
case "FILES":
files.add(line);
break;
case "INI-TEMPLATE":
initialise.add(line);
break;
}
}
}
}
}
 }
 }
