{
  SettingsFrame settingsFrame=(SettingsFrame)frame;
  Settings settings=settingsFrame.getSettings();
  int size=settings.size();
  int frameBodyLength=4 + 8 * size;
  int totalLength=ControlFrame.HEADER_LENGTH + frameBodyLength;
  ByteBuffer buffer=ByteBuffer.allocate(totalLength);
  generateControlFrameHeader(settingsFrame,frameBodyLength,buffer);
  buffer.putInt(size);
  for (  Settings.Setting setting : settings) {
    int id=setting.getId().getCode();
    int flags=setting.getFlag().getCode();
    int idAndFlags=(id << 8) + flags;
    idAndFlags=convertIdAndFlags(frame.getVersion(),idAndFlags);
    buffer.putInt(idAndFlags);
    buffer.putInt(setting.getValue());
  }
  buffer.flip();
  return buffer;
}
