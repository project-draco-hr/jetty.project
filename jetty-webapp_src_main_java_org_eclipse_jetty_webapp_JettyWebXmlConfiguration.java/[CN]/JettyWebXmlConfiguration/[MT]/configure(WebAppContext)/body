{
  if (context.isStarted()) {
    if (Log.isDebugEnabled()) {
      Log.debug("Cannot configure webapp after it is started");
    }
    return;
  }
  if (Log.isDebugEnabled())   Log.debug("Configuring web-jetty.xml");
  Resource web_inf=context.getWebInf();
  if (web_inf != null && web_inf.isDirectory()) {
    Resource jetty=web_inf.addPath("jetty7-web.xml");
    if (!jetty.exists())     jetty=web_inf.addPath(JETTY_WEB_XML);
    if (!jetty.exists())     jetty=web_inf.addPath("web-jetty.xml");
    if (jetty.exists()) {
      String[] old_server_classes=context.getServerClasses();
      try {
        context.setServerClasses(null);
        if (Log.isDebugEnabled()) {
          Log.debug("Configure: " + jetty);
        }
        XmlConfiguration jetty_config=(XmlConfiguration)context.getAttribute(XML_CONFIGURATION);
        if (jetty_config == null) {
          String jettyXml=IO.toString(jetty.getURL().openStream());
          if (jettyXml.contains("org.mortbay.")) {
            Log.warn("Detected jetty 6 configuration, attempting to automatically convert");
            jettyXml=convertFromJetty6(jettyXml);
          }
          jetty_config=new XmlConfiguration(jettyXml);
        }
 else {
          context.removeAttribute(XML_CONFIGURATION);
        }
        setupXmlConfiguration(context,jetty_config,web_inf);
        jetty_config.configure(context);
      }
  finally {
        if (context.getServerClasses() == null)         context.setServerClasses(old_server_classes);
      }
    }
  }
}
