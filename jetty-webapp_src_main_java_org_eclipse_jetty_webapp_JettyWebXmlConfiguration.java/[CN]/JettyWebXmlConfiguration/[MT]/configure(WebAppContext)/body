{
  if (context.isStarted()) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Cannot configure webapp after it is started");
    }
    return;
  }
  if (LOG.isDebugEnabled())   LOG.debug("Configuring web-jetty.xml");
  Resource web_inf=context.getWebInf();
  if (web_inf != null && web_inf.isDirectory()) {
    Resource jetty=web_inf.addPath("jetty8-web.xml");
    if (!jetty.exists())     jetty=web_inf.addPath(JETTY_WEB_XML);
    if (!jetty.exists())     jetty=web_inf.addPath("web-jetty.xml");
    if (jetty.exists()) {
      String[] old_server_classes=context.getServerClasses();
      try {
        context.setServerClasses(null);
        if (LOG.isDebugEnabled()) {
          LOG.debug("Configure: " + jetty);
        }
        XmlConfiguration jetty_config=(XmlConfiguration)context.getAttribute(XML_CONFIGURATION);
        if (jetty_config == null) {
          jetty_config=new XmlConfiguration(jetty.getURL());
        }
 else {
          context.removeAttribute(XML_CONFIGURATION);
        }
        setupXmlConfiguration(context,jetty_config,web_inf);
        try {
          jetty_config.configure(context);
        }
 catch (        ClassNotFoundException e) {
          LOG.warn("Unable to process jetty-web.xml",e);
        }
      }
  finally {
        if (context.getServerClasses() == null)         context.setServerClasses(old_server_classes);
      }
    }
  }
}
