{
  final HttpChannelState async=connection.getRequest().getHttpChannelState();
  final HttpChannelState.AsyncEventState state=async.getAsyncEventState();
  final Request baseRequest=connection.getRequest();
  final String path=state.getPath();
  if (path != null) {
    ServletContext context=state.getServletContext();
    HttpURI uri=new HttpURI(context == null ? path : URIUtil.addPaths(context.getContextPath(),path));
    baseRequest.setUri(uri);
    baseRequest.setRequestURI(null);
    baseRequest.setPathInfo(baseRequest.getRequestURI());
    if (uri.getQuery() != null)     baseRequest.mergeQueryString(uri.getQuery());
  }
  final String target=baseRequest.getPathInfo();
  final HttpServletRequest request=(HttpServletRequest)async.getRequest();
  final HttpServletResponse response=(HttpServletResponse)async.getResponse();
  if (LOG.isDebugEnabled()) {
    LOG.debug(request.getDispatcherType() + " " + target+ " on "+ connection);
    handle(target,baseRequest,request,response);
    LOG.debug("RESPONSE " + target + "  "+ connection.getResponse().getStatus());
  }
 else   handle(target,baseRequest,request,response);
}
