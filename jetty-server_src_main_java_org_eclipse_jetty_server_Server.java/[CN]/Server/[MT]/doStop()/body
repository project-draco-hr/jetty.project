{
  if (isDumpBeforeStop())   dumpStdErr();
  MultiException mex=new MultiException();
  long gracefulTimeout=getGracefulShutdown();
  if (gracefulTimeout > 0) {
    for (    Connector connector : _connectors) {
      LOG.info("Graceful shutdown {}",connector);
      if (connector instanceof NetworkConnector)       ((NetworkConnector)connector).close();
    }
    Handler[] contexts=getChildHandlersByClass(Graceful.class);
    for (    Handler context : contexts) {
      Graceful graceful=(Graceful)context;
      LOG.info("Graceful shutdown {}",graceful);
      graceful.setShutdown(true);
    }
    Thread.sleep(gracefulTimeout);
  }
  for (  Connector connector : _connectors) {
    try {
      connector.stop();
    }
 catch (    Throwable e) {
      mex.add(e);
    }
  }
  try {
    super.doStop();
  }
 catch (  Throwable e) {
    mex.add(e);
  }
  mex.ifExceptionThrow();
  if (getStopAtShutdown())   ShutdownThread.deregister(this);
}
