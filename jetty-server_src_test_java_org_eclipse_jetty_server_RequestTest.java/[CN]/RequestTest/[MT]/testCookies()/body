{
  final ArrayList cookies=new ArrayList();
  _handler._checker=new RequestTester(){
    public boolean check(    HttpServletRequest request,    HttpServletResponse response) throws IOException {
      javax.servlet.http.Cookie[] ca=request.getCookies();
      if (ca != null)       cookies.addAll(Arrays.asList(ca));
      response.getOutputStream().println("Hello World");
      return true;
    }
  }
;
  String response;
  _connector.reopen();
  cookies.clear();
  response=_connector.getResponses("GET / HTTP/1.1\n" + "Host: whatever\n" + "\n");
  assertTrue(response.startsWith("HTTP/1.1 200 OK"));
  assertEquals(0,cookies.size());
  cookies.clear();
  response=_connector.getResponses("GET / HTTP/1.1\n" + "Host: whatever\n" + "Cookie: name=quoted=\\\"value\\\"\n"+ "\n");
  assertTrue(response.startsWith("HTTP/1.1 200 OK"));
  assertEquals(1,cookies.size());
  assertEquals("name",((Cookie)cookies.get(0)).getName());
  assertEquals("quoted=\\\"value\\\"",((Cookie)cookies.get(0)).getValue());
  cookies.clear();
  response=_connector.getResponses("GET / HTTP/1.1\n" + "Host: whatever\n" + "Cookie: name=value; other=\"quoted=;value\"\n"+ "\n");
  assertTrue(response.startsWith("HTTP/1.1 200 OK"));
  assertEquals(2,cookies.size());
  assertEquals("name",((Cookie)cookies.get(0)).getName());
  assertEquals("value",((Cookie)cookies.get(0)).getValue());
  assertEquals("other",((Cookie)cookies.get(1)).getName());
  assertEquals("quoted=;value",((Cookie)cookies.get(1)).getValue());
  cookies.clear();
  response=_connector.getResponses("GET /other HTTP/1.1\n" + "Host: whatever\n" + "Other: header\n"+ "Cookie: name=value; other=\"quoted=;value\"\n"+ "\n"+ "GET /other HTTP/1.1\n"+ "Host: whatever\n"+ "Other: header\n"+ "Cookie: name=value; other=\"quoted=;value\"\n"+ "\n");
  assertTrue(response.startsWith("HTTP/1.1 200 OK"));
  assertEquals(4,cookies.size());
  assertEquals("name",((Cookie)cookies.get(0)).getName());
  assertEquals("value",((Cookie)cookies.get(0)).getValue());
  assertEquals("other",((Cookie)cookies.get(1)).getName());
  assertEquals("quoted=;value",((Cookie)cookies.get(1)).getValue());
  assertTrue((Cookie)cookies.get(0) == (Cookie)cookies.get(2));
  assertTrue((Cookie)cookies.get(1) == (Cookie)cookies.get(3));
  cookies.clear();
  response=_connector.getResponses("GET /other HTTP/1.1\n" + "Host: whatever\n" + "Other: header\n"+ "Cookie: name=value; other=\"quoted=;value\"\n"+ "\n"+ "GET /other HTTP/1.1\n"+ "Host: whatever\n"+ "Other: header\n"+ "Cookie: name=value; other=\"othervalue\"\n"+ "\n");
  assertTrue(response.startsWith("HTTP/1.1 200 OK"));
  assertEquals(4,cookies.size());
  assertEquals("name",((Cookie)cookies.get(0)).getName());
  assertEquals("value",((Cookie)cookies.get(0)).getValue());
  assertEquals("other",((Cookie)cookies.get(1)).getName());
  assertEquals("quoted=;value",((Cookie)cookies.get(1)).getValue());
  assertTrue((Cookie)cookies.get(0) != (Cookie)cookies.get(2));
  assertTrue((Cookie)cookies.get(1) != (Cookie)cookies.get(3));
  cookies.clear();
  response=_connector.getResponses("POST / HTTP/1.1\r\n" + "Host: whatever\r\n" + "Cookie: name0=value0; name1 = value1 ; \"\\\"name2\\\"\"  =  \"\\\"value2\\\"\"  \n"+ "Cookie: name3=value3=value3; name4=; name5 =  ; name6\n"+ "Cookie: name7=value7;\n"+ "Connection: close\r\n"+ "\r\n");
  assertEquals("name0",((Cookie)cookies.get(0)).getName());
  assertEquals("value0",((Cookie)cookies.get(0)).getValue());
  assertEquals("name1",((Cookie)cookies.get(1)).getName());
  assertEquals("value1",((Cookie)cookies.get(1)).getValue());
  assertEquals("\"name2\"",((Cookie)cookies.get(2)).getName());
  assertEquals("\"value2\"",((Cookie)cookies.get(2)).getValue());
  assertEquals("name3",((Cookie)cookies.get(3)).getName());
  assertEquals("value3=value3",((Cookie)cookies.get(3)).getValue());
  assertEquals("name4",((Cookie)cookies.get(4)).getName());
  assertEquals("",((Cookie)cookies.get(4)).getValue());
  assertEquals("name5",((Cookie)cookies.get(5)).getName());
  assertEquals("",((Cookie)cookies.get(5)).getValue());
  assertEquals("name6",((Cookie)cookies.get(6)).getName());
  assertEquals("",((Cookie)cookies.get(6)).getValue());
  assertEquals("name7",((Cookie)cookies.get(7)).getName());
  assertEquals("value7",((Cookie)cookies.get(7)).getValue());
}
