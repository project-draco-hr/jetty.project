{
  LOG.debug("Starting Jetty Server ...");
  this.server=JettyServer.getInstance();
  applyJettyXml();
  Connector[] connectors=this.server.getConnectors();
  if (connectors == null || connectors.length == 0) {
    MavenServerConnector httpConnector=new MavenServerConnector();
    String tmp=System.getProperty(PORT_SYSPROPERTY,MavenServerConnector.DEFAULT_PORT_STR);
    httpConnector.setPort(Integer.parseInt(tmp.trim()));
    connectors=new Connector[]{httpConnector};
    this.server.setConnectors(connectors);
  }
  HandlerCollection handlers=(HandlerCollection)server.getChildHandlerByClass(HandlerCollection.class);
  if (handlers == null) {
    handlers=new HandlerCollection();
    server.setHandler(handlers);
  }
  this.server.configureHandlers();
  webApp=new JettyWebAppContext();
  configureWebApp();
  if (contextXml != null) {
    XmlConfiguration xmlConfiguration=new XmlConfiguration(Resource.toURL(contextXml));
    xmlConfiguration.getIdMap().put("Server",server);
    xmlConfiguration.configure(webApp);
  }
  this.server.addWebApplication(webApp);
  System.err.println("STOP PORT=" + stopPort + ", STOP KEY="+ stopKey);
  if (stopPort > 0 && stopKey != null) {
    monitor=new Monitor(stopPort,stopKey,new Server[]{server},true);
  }
}
