{
  int port=8080;
  int tlsPort=8443;
  SslContextFactory sslContextFactory=new SslContextFactory();
  sslContextFactory.setEndpointIdentificationAlgorithm("");
  sslContextFactory.setKeyStorePath("src/test/resources/keystore.jks");
  sslContextFactory.setKeyStorePassword("storepwd");
  sslContextFactory.setTrustStorePath("src/test/resources/truststore.jks");
  sslContextFactory.setTrustStorePassword("storepwd");
  Server server=new Server();
  HttpConfiguration config=new HttpConfiguration();
  HttpConfiguration https_config=new HttpConfiguration(config);
  https_config.addCustomizer(new SecureRequestCustomizer());
  HTTP2ServerConnectionFactory h2=new HTTP2ServerConnectionFactory(https_config);
  NegotiatingServerConnectionFactory.checkProtocolNegotiationAvailable();
  ALPNServerConnectionFactory alpn=new ALPNServerConnectionFactory();
  alpn.setDefaultProtocol(h2.getProtocol());
  SslConnectionFactory ssl=new SslConnectionFactory(sslContextFactory,alpn.getProtocol());
  ServerConnector http2Connector=new ServerConnector(server,ssl,alpn,h2,new HttpConnectionFactory(https_config));
  http2Connector.setPort(tlsPort);
  http2Connector.setIdleTimeout(15000);
  server.addConnector(http2Connector);
  String root="/home/simon/programs/wordpress-3.7.1";
  ServletContextHandler context=new ServletContextHandler(server,"/wp");
  context.setResourceBase(root);
  context.setWelcomeFiles(new String[]{"index.php"});
  ServletHolder defaultServlet=new ServletHolder("default",DefaultServlet.class);
  context.addServlet(defaultServlet,"/");
  FilterHolder tryFilesFilter=context.addFilter(TryFilesFilter.class,"/*",EnumSet.of(DispatcherType.REQUEST));
  tryFilesFilter.setInitParameter(TryFilesFilter.FILES_INIT_PARAM,"$path /index.php?p=$path");
  ServletHolder fcgiServlet=context.addServlet(FastCGIProxyServlet.class,"*.php");
  fcgiServlet.setInitParameter(FastCGIProxyServlet.SCRIPT_ROOT_INIT_PARAM,root);
  fcgiServlet.setInitParameter("proxyTo","http://localhost:9000");
  fcgiServlet.setInitParameter("prefix","/");
  fcgiServlet.setInitParameter(FastCGIProxyServlet.SCRIPT_PATTERN_INIT_PARAM,"(.+?\\.php)");
  server.start();
}
