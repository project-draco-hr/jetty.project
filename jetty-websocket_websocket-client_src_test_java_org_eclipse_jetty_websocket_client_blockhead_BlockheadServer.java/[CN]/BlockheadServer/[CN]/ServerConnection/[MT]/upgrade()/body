{
  String key="not sent";
  BufferedReader in=new BufferedReader(new InputStreamReader(getInputStream()));
  for (String line=in.readLine(); line != null; line=in.readLine()) {
    if (line.length() == 0) {
      break;
    }
    if (line.startsWith("Sec-WebSocket-Key:")) {
      key=line.substring(18).trim();
    }
  }
  StringBuilder resp=new StringBuilder();
  resp.append("HTTP/1.1 101 Upgrade\r\n");
  resp.append("Sec-WebSocket-Accept: ");
  resp.append(AcceptHash.hashKey(key)).append("\r\n");
  resp.append("\r\n");
  write(resp.toString().getBytes());
  parser.setIncomingFramesHandler(incomingFrames);
}
