{
  ByteBuffer buf=generator.generate(frame);
  if (LOG.isDebugEnabled()) {
    LOG.debug("writing out: {}",BufferUtil.toDetailString(buf));
  }
  try {
    BufferUtil.writeTo(buf,out);
    LOG.debug("flushing output");
    out.flush();
    LOG.debug("output flush complete");
    if (frame.getType().getOpCode() == OpCode.CLOSE) {
      disconnect();
    }
    return WriteResultFinishedFuture.INSTANCE;
  }
 catch (  Throwable t) {
    return new WriteResultFailedFuture(t);
  }
}
