{
  server=newServer();
  connector=newSPDYServerConnector(server,new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      try {
        Thread.sleep(2 * idleTimeout);
        stream.reply(new ReplyInfo(true));
        return null;
      }
 catch (      InterruptedException x) {
        Assert.fail();
        return null;
      }
    }
  }
);
  connector.setIdleTimeout(idleTimeout);
  final CountDownLatch latch=new CountDownLatch(1);
  Session session=startClient(startServer(null),new SessionFrameListener.Adapter(){
    @Override public void onGoAway(    Session session,    GoAwayInfo goAwayInfo){
      latch.countDown();
    }
  }
);
  final CountDownLatch replyLatch=new CountDownLatch(1);
  session.syn(new SynInfo(true),new StreamFrameListener.Adapter(){
    @Override public void onReply(    Stream stream,    ReplyInfo replyInfo){
      replyLatch.countDown();
    }
  }
);
  Assert.assertTrue(replyLatch.await(3 * idleTimeout,TimeUnit.MILLISECONDS));
  Assert.assertFalse(latch.await(1000,TimeUnit.MILLISECONDS));
}
