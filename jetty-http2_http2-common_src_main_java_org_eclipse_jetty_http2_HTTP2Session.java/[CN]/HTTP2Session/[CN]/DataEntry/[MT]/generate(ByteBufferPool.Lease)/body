{
  try {
    int flowControlLength=dataRemaining();
    int sessionWindowSize=getWindowSize();
    if (sessionWindowSize < 0)     throw new IllegalStateException();
    int streamWindowSize=stream.getWindowSize();
    if (streamWindowSize < 0)     throw new IllegalStateException();
    int windowSize=Math.min(streamWindowSize,sessionWindowSize);
    int length=this.length=Math.min(flowControlLength,windowSize);
    if (LOG.isDebugEnabled())     LOG.debug("Generated {}, length/window={}/{}",frame,length,windowSize);
    generator.data(lease,(DataFrame)frame,length);
    flowControl.onDataSending(stream,length);
    return null;
  }
 catch (  Throwable x) {
    if (LOG.isDebugEnabled())     LOG.debug("Failure generating frame " + frame,x);
    return x;
  }
}
