{
  long expired;
synchronized (this) {
    expired=request.getTimeStamp() - _maxNonceAgeMs;
  }
  Nonce nonce=_nonceQueue.peek();
  while (nonce != null && nonce._ts < expired) {
    _nonceQueue.remove(nonce);
    _nonceCount.remove(nonce._nonce);
    nonce=_nonceQueue.peek();
  }
  try {
    nonce=_nonceCount.get(digest.nonce);
    if (nonce == null)     return 0;
    long count=Long.parseLong(digest.nc,16);
    if (count > Integer.MAX_VALUE)     return 0;
    int old=nonce._nc.get();
    while (!nonce._nc.compareAndSet(old,(int)count))     old=nonce._nc.get();
    if (count <= old)     return -1;
    return 1;
  }
 catch (  Exception e) {
    LOG.ignore(e);
  }
  return -1;
}
