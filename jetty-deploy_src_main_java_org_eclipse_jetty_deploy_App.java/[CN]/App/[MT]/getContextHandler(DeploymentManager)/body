{
  if (handler == null) {
    if (FileID.isXmlFile(archivePath)) {
      this.handler=createContextFromXml(deployMgr);
    }
 else     if (FileID.isWebArchive(archivePath)) {
      this.handler=createContextDefault(deployMgr);
    }
 else {
      throw new IllegalStateException("Not an XML or Web Archive: " + archivePath.getAbsolutePath());
    }
    this.handler.setAttributes(new AttributesMap(deployMgr.getContextAttributes()));
  }
  return handler;
}
