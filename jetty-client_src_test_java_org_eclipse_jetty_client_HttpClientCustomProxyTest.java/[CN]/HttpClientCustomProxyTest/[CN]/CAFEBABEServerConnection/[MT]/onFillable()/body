{
  try {
    ByteBuffer buffer=BufferUtil.allocate(4);
    int filled=getEndPoint().fill(buffer);
    Assert.assertEquals(4,filled);
    Assert.assertArrayEquals(CAFE_BABE,buffer.array());
    getEndPoint().write(new Callback.Adapter(),buffer);
    ClientConnectionFactory.Helper.replaceConnection(this,connectionFactory.newConnection(connector,getEndPoint(),null));
  }
 catch (  Throwable x) {
    close();
  }
}
