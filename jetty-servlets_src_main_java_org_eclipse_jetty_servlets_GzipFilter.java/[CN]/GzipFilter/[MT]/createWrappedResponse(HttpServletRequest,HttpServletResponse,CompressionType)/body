{
  CompressedResponseWrapper wrappedResponse=null;
  if (compressionType.equals(CompressionType.GZIP)) {
    wrappedResponse=new GzipResponseWrapperImpl(request,response);
  }
 else   if (compressionType.equals(CompressionType.DEFLATE)) {
    wrappedResponse=new DeflateResponseWrapperImpl(request,response);
  }
 else {
    throw new IllegalStateException(compressionType + " not supported");
  }
  configureWrappedResponse(wrappedResponse);
  return wrappedResponse;
}
