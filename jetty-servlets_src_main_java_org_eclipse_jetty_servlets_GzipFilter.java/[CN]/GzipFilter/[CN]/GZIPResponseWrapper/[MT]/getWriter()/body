{
  if (_writer == null) {
    if (_gzStream != null)     throw new IllegalStateException("getOutputStream() called");
    if (getResponse().isCommitted() || _noGzip)     return getResponse().getWriter();
    _gzStream=newGzipStream(_request,(HttpServletResponse)getResponse(),_contentLength,_bufferSize,_minGzipSize);
    String encoding=getCharacterEncoding();
    _writer=encoding == null ? new PrintWriter(_gzStream) : new PrintWriter(new OutputStreamWriter(_gzStream,encoding));
  }
  return _writer;
}
