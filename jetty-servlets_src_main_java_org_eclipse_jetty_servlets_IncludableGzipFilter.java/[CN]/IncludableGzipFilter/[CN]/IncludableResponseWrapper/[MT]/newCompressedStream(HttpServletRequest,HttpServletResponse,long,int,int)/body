{
  String encodingHeader=request.getHeader("accept-encoding");
  CompressionType compressionType=CompressionType.getByEncodingHeader(encodingHeader);
  if (compressionType.equals(CompressionType.GZIP)) {
    return new IncludableGzipStream(request,response,contentLength,bufferSize,minGzipSize);
  }
 else   if (compressionType.equals(CompressionType.DEFLATE)) {
    return new IncludableDeflateStream(request,response,contentLength,bufferSize,minGzipSize);
  }
 else {
    throw new IllegalStateException(compressionType.name() + " not supported.");
  }
}
