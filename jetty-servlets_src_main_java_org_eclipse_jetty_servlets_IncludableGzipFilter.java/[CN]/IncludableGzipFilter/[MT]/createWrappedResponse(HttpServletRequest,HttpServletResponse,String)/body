{
  CompressedResponseWrapper wrappedResponse=null;
  if (compressionType.equals(GZIP)) {
    wrappedResponse=new IncludableResponseWrapper(request,response){
      @Override protected AbstractCompressedStream newCompressedStream(      HttpServletRequest request,      HttpServletResponse response,      long contentLength,      int bufferSize,      int minCompressSize) throws IOException {
        return new AbstractCompressedStream(compressionType,request,response,contentLength,bufferSize,minCompressSize){
          @Override protected DeflaterOutputStream createStream() throws IOException {
            return new GZIPOutputStream(_response.getOutputStream(),_bufferSize);
          }
        }
;
      }
    }
;
  }
 else   if (compressionType.equals(DEFLATE)) {
    wrappedResponse=new IncludableResponseWrapper(request,response){
      @Override protected AbstractCompressedStream newCompressedStream(      HttpServletRequest request,      HttpServletResponse response,      long contentLength,      int bufferSize,      int minCompressSize) throws IOException {
        return new AbstractCompressedStream(compressionType,request,response,contentLength,bufferSize,minCompressSize){
          @Override protected DeflaterOutputStream createStream() throws IOException {
            return new DeflaterOutputStream(_response.getOutputStream(),new Deflater(_deflateCompressionLevel,_deflateNoWrap));
          }
        }
;
      }
    }
;
  }
 else {
    throw new IllegalStateException(compressionType + " not supported");
  }
  configureWrappedResponse(wrappedResponse);
  return wrappedResponse;
}
