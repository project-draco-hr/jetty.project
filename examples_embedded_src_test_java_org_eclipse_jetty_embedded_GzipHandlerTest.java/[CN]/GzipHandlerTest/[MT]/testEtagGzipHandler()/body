{
  HttpTester.Request request=newRequest();
  HttpTester.Response response=HttpTester.parseResponse(_connector.getResponses(request.generate()));
  assertEquals(HttpServletResponse.SC_OK,response.getStatus());
  Assert.assertNull(response.get("Content-Encoding"));
  assertEquals(__content,response.getContent());
  String etag=response.get(HttpHeader.ETAG.asString());
  String etag_gzip=etag.substring(0,etag.length() - 1) + GzipHttpContent.ETAG_GZIP_QUOTE;
  request=newRequest();
  request.add(HttpHeader.IF_NONE_MATCH,"xxxx");
  response=HttpTester.parseResponse(_connector.getResponses(request.generate()));
  assertEquals(HttpServletResponse.SC_OK,response.getStatus());
  Assert.assertNull(response.get("Content-Encoding"));
  assertEquals(__content,response.getContent());
  request=newRequest();
  request.add(HttpHeader.IF_NONE_MATCH,etag);
  response=HttpTester.parseResponse(_connector.getResponses(request.generate()));
  assertEquals(HttpServletResponse.SC_NOT_MODIFIED,response.getStatus());
  assertEquals(etag,response.get(HttpHeader.ETAG.asString()));
  request=newRequest();
  request.setHeader("accept-encoding","gzip");
  request.add(HttpHeader.IF_NONE_MATCH,etag);
  response=HttpTester.parseResponse(_connector.getResponses(request.generate()));
  assertEquals(HttpServletResponse.SC_NOT_MODIFIED,response.getStatus());
  assertEquals(etag,response.get(HttpHeader.ETAG.asString()));
  request=newRequest();
  request.setHeader("accept-encoding","gzip");
  response=HttpTester.parseResponse(_connector.getResponses(request.generate()));
  assertEquals(HttpServletResponse.SC_OK,response.getStatus());
  assertTrue(response.get("Content-Encoding").equalsIgnoreCase("gzip"));
  InputStream testIn=new GZIPInputStream(new ByteArrayInputStream(response.getContentBytes()));
  ByteArrayOutputStream testOut=new ByteArrayOutputStream();
  IO.copy(testIn,testOut);
  assertEquals(__content,testOut.toString("UTF8"));
  assertEquals(etag_gzip,response.get(HttpHeader.ETAG.asString()));
  request=newRequest();
  request.setHeader("accept-encoding","gzip");
  request.add(HttpHeader.IF_NONE_MATCH,etag_gzip);
  response=HttpTester.parseResponse(_connector.getResponses(request.generate()));
  assertEquals(HttpServletResponse.SC_NOT_MODIFIED,response.getStatus());
  assertEquals(etag,response.get(HttpHeader.ETAG.asString()));
}
