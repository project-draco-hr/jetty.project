{
  Object endpoint=websocket;
  ClientEndpointConfig config=null;
  if (websocket instanceof ConfiguredEndpoint) {
    ConfiguredEndpoint ce=(ConfiguredEndpoint)websocket;
    endpoint=ce.getEndpoint();
    config=(ClientEndpointConfig)ce.getConfig();
  }
  Class<?> endpointClass=endpoint.getClass();
  JsrClientMetadata basemetadata=cache.get(endpointClass);
  if (basemetadata == null) {
    basemetadata=new JsrClientMetadata(endpointClass);
    AnnotatedEndpointScanner scanner=new AnnotatedEndpointScanner(basemetadata);
    scanner.scan();
    cache.put(endpointClass,basemetadata);
  }
  JsrEvents events=new JsrEvents(basemetadata);
  return new JsrClientAnnotatedEventDriver(container,policy,endpoint,events);
}
