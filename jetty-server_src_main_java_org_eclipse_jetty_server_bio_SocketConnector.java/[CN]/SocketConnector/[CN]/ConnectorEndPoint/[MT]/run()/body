{
  try {
    connectionOpened(_connection);
synchronized (_connections) {
      _connections.add(this);
    }
    while (isStarted() && !isClosed()) {
      if (_connection.isIdle()) {
        if (isLowResources()) {
          int lrmit=getLowResourceMaxIdleTime();
          if (lrmit >= 0 && _sotimeout != lrmit) {
            _sotimeout=lrmit;
            _socket.setSoTimeout(_sotimeout);
          }
        }
      }
      try {
        _connection.handle();
      }
 catch (      UpgradeConnectionException e) {
        Log.debug(e.toString());
        Log.ignore(e);
        setConnection(e.getConnection());
        continue;
      }
    }
  }
 catch (  EofException e) {
    Log.debug("EOF",e);
    try {
      close();
    }
 catch (    IOException e2) {
      Log.ignore(e2);
    }
  }
catch (  HttpException e) {
    Log.debug("BAD",e);
    try {
      close();
    }
 catch (    IOException e2) {
      Log.ignore(e2);
    }
  }
catch (  Exception e) {
    Log.warn("handle failed?",e);
    try {
      close();
    }
 catch (    IOException e2) {
      Log.ignore(e2);
    }
  }
 finally {
    connectionClosed(_connection);
synchronized (_connections) {
      _connections.remove(this);
    }
  }
}
