{
  WebSocketPolicy policy=WebSocketPolicy.newServerPolicy();
  WebkitDeflateFrameExtension ext=new WebkitDeflateFrameExtension();
  ext.setBufferPool(new MappedByteBufferPool());
  ext.setPolicy(policy);
  ExtensionConfig config=ExtensionConfig.parse("x-webkit-deflate-frame");
  ext.setConfig(config);
  ByteBufferPool bufferPool=new MappedByteBufferPool();
  boolean validating=true;
  Generator generator=new Generator(policy,bufferPool,validating);
  generator.configureFromExtensions(Collections.singletonList(ext));
  OutgoingNetworkBytesCapture capture=new OutgoingNetworkBytesCapture(generator);
  FrameHandler outgoingHandler=ext.createOutgoingFrameHandler(capture);
  WebSocketFrame frame=WebSocketFrame.text(text);
  outgoingHandler.handleFrame(frame);
  capture.assertBytes(0,expectedHex);
}
