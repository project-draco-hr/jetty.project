{
  ConnectHandler connectHandler=new ConnectHandler();
  final byte[] bytes="foo bar".getBytes();
  Buffer buffer=new ByteArrayBuffer(bytes.length * 2);
  buffer.put(bytes);
  when(endPoint.flush(buffer)).thenAnswer(new Answer<Object>(){
    public Object answer(    InvocationOnMock invocation){
      Object[] args=invocation.getArguments();
      Buffer buffer=(Buffer)args[0];
      int skip=bytes.length / 2;
      buffer.skip(skip);
      return skip;
    }
  }
);
  when(endPoint.blockWritable(anyInt())).thenReturn(true);
  connectHandler.write(endPoint,buffer,null);
  assertThat(buffer.length(),is(0));
}
