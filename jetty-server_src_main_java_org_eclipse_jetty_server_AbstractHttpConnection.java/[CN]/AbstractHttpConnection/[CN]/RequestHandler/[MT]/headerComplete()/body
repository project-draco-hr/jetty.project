{
  _requests++;
  _generator.setVersion(_version);
switch (_version) {
case HttpVersions.HTTP_0_9_ORDINAL:
    break;
case HttpVersions.HTTP_1_0_ORDINAL:
  _generator.setHead(_head);
if (_parser.isPersistent()) {
  _responseFields.add(HttpHeaders.CONNECTION_BUFFER,HttpHeaderValues.KEEP_ALIVE_BUFFER);
  _generator.setPersistent(true);
}
 else if (HttpMethods.CONNECT.equals(_request.getMethod())) {
  _generator.setPersistent(true);
  _parser.setPersistent(true);
}
if (_server.getSendDateHeader()) _generator.setDate(_request.getTimeStampBuffer());
break;
case HttpVersions.HTTP_1_1_ORDINAL:
_generator.setHead(_head);
if (!_parser.isPersistent()) {
_responseFields.add(HttpHeaders.CONNECTION_BUFFER,HttpHeaderValues.CLOSE_BUFFER);
_generator.setPersistent(false);
}
if (_server.getSendDateHeader()) _generator.setDate(_request.getTimeStampBuffer());
if (!_host) {
LOG.debug("!host {}",this);
_generator.setResponse(HttpStatus.BAD_REQUEST_400,null);
_responseFields.put(HttpHeaders.CONNECTION_BUFFER,HttpHeaderValues.CLOSE_BUFFER);
_generator.completeHeader(_responseFields,true);
_generator.complete();
return;
}
if (_expect) {
LOG.debug("!expectation {}",this);
_generator.setResponse(HttpStatus.EXPECTATION_FAILED_417,null);
_responseFields.put(HttpHeaders.CONNECTION_BUFFER,HttpHeaderValues.CLOSE_BUFFER);
_generator.completeHeader(_responseFields,true);
_generator.complete();
return;
}
break;
default :
}
if (_charset != null) _request.setCharacterEncodingUnchecked(_charset);
if ((((HttpParser)_parser).getContentLength() <= 0 && !((HttpParser)_parser).isChunking()) || _expect100Continue) handleRequest();
 else _delayedHandling=true;
}
