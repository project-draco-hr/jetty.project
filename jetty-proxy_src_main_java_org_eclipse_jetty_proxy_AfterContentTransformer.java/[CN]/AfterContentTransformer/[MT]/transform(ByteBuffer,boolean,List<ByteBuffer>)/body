{
  int remaining=input.remaining();
  if (remaining > 0) {
    inputBufferSize+=remaining;
    long max=getMaxInputBufferSize();
    if (max >= 0 && inputBufferSize > max) {
      overflow(input);
    }
 else {
      ByteBuffer copy=ByteBuffer.allocate(input.remaining());
      copy.put(input).flip();
      buffers.add(copy);
    }
  }
  if (finished) {
    Source source=new Source();
    Sink sink=new Sink();
    transform(source,sink);
    sink.drainTo(output);
  }
}
