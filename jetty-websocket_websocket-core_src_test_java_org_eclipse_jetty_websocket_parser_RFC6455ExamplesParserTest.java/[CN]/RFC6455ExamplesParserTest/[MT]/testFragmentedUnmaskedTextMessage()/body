{
  Debug.enableDebugLogging(Parser.class);
  Debug.enableDebugLogging(FrameParser.class);
  Debug.enableDebugLogging(TextPayloadParser.class);
  Parser parser=new Parser();
  FrameParseCapture capture=new FrameParseCapture();
  parser.addListener(capture);
  ByteBuffer buf=ByteBuffer.allocate(16);
  buf.put(new byte[]{(byte)0x01,(byte)0x03,0x48,(byte)0x65,0x6c});
  buf.flip();
  parser.parse(buf);
  buf.flip();
  buf.put(new byte[]{(byte)0x80,0x02,0x6c,0x6f});
  buf.flip();
  parser.parse(buf);
  capture.assertNoErrors();
  capture.assertHasFrame(TextFrame.class,2);
  TextFrame txt=(TextFrame)capture.getFrames().get(0);
  Assert.assertThat("TextFrame[0].data",txt.getData().toString(),is("Hel"));
  txt=(TextFrame)capture.getFrames().get(1);
  Assert.assertThat("TextFrame[1].data",txt.getData().toString(),is("lo"));
}
