{
  while (buffer.hasRemaining()) {
switch (state) {
case LENGTH:
{
        contentLength=getContentLength();
        state=State.CONTENT;
        break;
      }
case CONTENT:
{
      int length=Math.min(contentLength,buffer.remaining());
      int limit=buffer.limit();
      buffer.limit(buffer.position() + length);
      ByteBuffer slice=buffer.slice();
      onContent(slice);
      buffer.position(buffer.limit());
      buffer.limit(limit);
      contentLength-=length;
      if (contentLength > 0)       break;
      state=State.LENGTH;
      return true;
    }
default :
{
    throw new IllegalStateException();
  }
}
}
return false;
}
