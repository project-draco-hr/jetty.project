{
  try {
    Class oClass=o.getClass();
    Object mbean=null;
    while (mbean == null && oClass != null) {
      String pName=oClass.getPackage().getName();
      String cName=oClass.getName().substring(pName.length() + 1);
      String mName=pName + ".jmx." + cName+ "MBean";
      try {
        Class mClass=(Object.class.equals(oClass)) ? oClass=ObjectMBean.class : Loader.loadClass(oClass,mName,true);
        if (Log.isDebugEnabled())         Log.debug("mbeanFor " + o + " mClass="+ mClass);
        try {
          Constructor constructor=mClass.getConstructor(OBJ_ARG);
          mbean=constructor.newInstance(new Object[]{o});
        }
 catch (        Exception e) {
          Log.ignore(e);
          if (ModelMBean.class.isAssignableFrom(mClass)) {
            mbean=mClass.newInstance();
            ((ModelMBean)mbean).setManagedResource(o,"objectReference");
          }
        }
        if (Log.isDebugEnabled())         Log.debug("mbeanFor " + o + " is "+ mbean);
        return mbean;
      }
 catch (      ClassNotFoundException e) {
        String klass=e.getMessage().split("[ ]",2)[0];
        if (klass.endsWith("MBean"))         Log.ignore(e);
 else         Log.warn(e);
      }
catch (      Error e) {
        Log.warn(e);
        mbean=null;
      }
catch (      Exception e) {
        Log.warn(e);
        mbean=null;
      }
      oClass=oClass.getSuperclass();
    }
  }
 catch (  Exception e) {
    Log.ignore(e);
  }
  return null;
}
