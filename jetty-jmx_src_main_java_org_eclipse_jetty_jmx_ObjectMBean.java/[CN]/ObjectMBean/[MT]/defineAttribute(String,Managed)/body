{
  String description=fieldAnnotation.value();
  boolean writable=fieldAnnotation.readonly();
  boolean onMBean=fieldAnnotation.proxied();
  boolean convert=fieldAnnotation.managed();
  String uName=name.substring(0,1).toUpperCase() + name.substring(1);
  Class oClass=onMBean ? this.getClass() : _managed.getClass();
  if (LOG.isDebugEnabled())   LOG.debug("defineAttribute " + name + " "+ onMBean+ ":"+ writable+ ":"+ oClass+ ":"+ description);
  Class type=null;
  Method getter=null;
  Method setter=null;
  String declaredGetter=fieldAnnotation.getter();
  String declaredSetter=fieldAnnotation.setter();
  Method[] methods=oClass.getMethods();
  for (int m=0; m < methods.length; m++) {
    if ((methods[m].getModifiers() & Modifier.PUBLIC) == 0)     continue;
    if (methods[m].getName().equals(declaredGetter) && methods[m].getParameterTypes().length == 0) {
      if (getter != null) {
        LOG.warn("Multiple mbean getters for attr " + name + " in "+ oClass);
        continue;
      }
      getter=methods[m];
      if (type != null && !type.equals(methods[m].getReturnType())) {
        LOG.warn("Type conflict for mbean attr " + name + " in "+ oClass);
        continue;
      }
      type=methods[m].getReturnType();
      LOG.debug("Declared Getter: " + declaredGetter);
    }
    if (methods[m].getName().equals("get" + uName) && methods[m].getParameterTypes().length == 0) {
      if (getter != null) {
        LOG.warn("Multiple mbean getters for attr " + name + " in "+ oClass);
        continue;
      }
      getter=methods[m];
      if (type != null && !type.equals(methods[m].getReturnType())) {
        LOG.warn("Type conflict for mbean attr " + name + " in "+ oClass);
        continue;
      }
      type=methods[m].getReturnType();
    }
    if (methods[m].getName().equals("is" + uName) && methods[m].getParameterTypes().length == 0) {
      if (getter != null) {
        LOG.warn("Multiple mbean getters for attr " + name + " in "+ oClass);
        continue;
      }
      getter=methods[m];
      if (type != null && !type.equals(methods[m].getReturnType())) {
        LOG.warn("Type conflict for mbean attr " + name + " in "+ oClass);
        continue;
      }
      type=methods[m].getReturnType();
    }
    if (writable && methods[m].getName().equals(declaredSetter) && methods[m].getParameterTypes().length == 1) {
      if (setter != null) {
        LOG.warn("Multiple setters for mbean attr " + name + " in "+ oClass);
        continue;
      }
      setter=methods[m];
      if (type != null && !type.equals(methods[m].getParameterTypes()[0])) {
        LOG.warn("Type conflict for mbean attr " + name + " in "+ oClass);
        continue;
      }
      LOG.debug("Declared Setter: " + declaredSetter);
      type=methods[m].getParameterTypes()[0];
    }
    if (writable && methods[m].getName().equals("set" + uName) && methods[m].getParameterTypes().length == 1) {
      if (setter != null) {
        LOG.warn("Multiple setters for mbean attr " + name + " in "+ oClass);
        continue;
      }
      setter=methods[m];
      if (type != null && !type.equals(methods[m].getParameterTypes()[0])) {
        LOG.warn("Type conflict for mbean attr " + name + " in "+ oClass);
        continue;
      }
      type=methods[m].getParameterTypes()[0];
    }
  }
  if (convert) {
    if (type == null) {
      LOG.warn("No mbean type for " + name + " on "+ _managed.getClass());
      return null;
    }
    if (type.isPrimitive() && !type.isArray()) {
      LOG.warn("Cannot convert mbean primative " + name);
      return null;
    }
  }
  if (getter == null && setter == null) {
    LOG.warn("No mbean getter or setters found for " + name + " in "+ oClass);
    return null;
  }
  try {
    _getters.put(name,getter);
    _setters.put(name,setter);
    MBeanAttributeInfo info=null;
    if (convert) {
      _convert.add(name);
      if (type.isArray())       info=new MBeanAttributeInfo(name,OBJECT_NAME_ARRAY_CLASS,description,getter != null,setter != null,getter != null && getter.getName().startsWith("is"));
 else       info=new MBeanAttributeInfo(name,OBJECT_NAME_CLASS,description,getter != null,setter != null,getter != null && getter.getName().startsWith("is"));
    }
 else     info=new MBeanAttributeInfo(name,description,getter,setter);
    return info;
  }
 catch (  Exception e) {
    LOG.warn(e);
    throw new IllegalArgumentException(e.toString());
  }
}
