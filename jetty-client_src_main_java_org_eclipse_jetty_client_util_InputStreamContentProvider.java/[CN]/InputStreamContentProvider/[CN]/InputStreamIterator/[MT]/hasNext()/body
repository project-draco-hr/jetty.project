{
  try {
    if (hasNext != null)     return hasNext;
    byte[] bytes=new byte[bufferSize];
    int read=stream.read(bytes);
    LOG.debug("Read {} bytes from {}",read,stream);
    if (read > 0) {
      buffer=onRead(bytes,0,read);
      hasNext=Boolean.TRUE;
      return true;
    }
 else     if (read < 0) {
      hasNext=Boolean.FALSE;
      return false;
    }
 else {
      buffer=BufferUtil.EMPTY_BUFFER;
      hasNext=Boolean.TRUE;
      return true;
    }
  }
 catch (  Throwable x) {
    LOG.debug(x);
    if (failure == null) {
      failure=x;
      hasNext=Boolean.TRUE;
      return true;
    }
    throw new IllegalStateException();
  }
}
