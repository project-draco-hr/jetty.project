{
  loop:   while (true) {
    State state=_state.get();
switch (state) {
case PROCESSING:
{
        if (!_state.compareAndSet(State.PROCESSING,State.CALLED))         continue loop;
        break loop;
      }
case PENDING:
{
      if (!_state.compareAndSet(State.PENDING,State.PROCESSING))       continue loop;
      processing();
      break loop;
    }
case CLOSED:
{
    break loop;
  }
default :
{
  throw new IllegalStateException(toString());
}
}
}
}
