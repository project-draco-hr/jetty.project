{
  boolean failure=false;
  try (SpinLock.Lock lock=_lock.lock()){
switch (_state) {
case IDLE:
case SUCCEEDED:
case FAILED:
case PROCESSING:
      _state=State.CLOSED;
    break;
case CLOSED:
  break;
default :
_state=State.CLOSED;
failure=true;
}
}
 if (failure) onCompleteFailure(new ClosedChannelException());
}
