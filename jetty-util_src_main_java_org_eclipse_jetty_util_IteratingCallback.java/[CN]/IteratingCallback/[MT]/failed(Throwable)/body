{
  while (true) {
    State state=_state.get();
switch (state) {
case SUCCEEDED:
case FAILED:
case IDLE:
case CLOSED:
{
        return;
      }
default :
{
      if (_state.compareAndSet(state,State.FAILED)) {
        onCompleteFailure(x);
        return;
      }
    }
}
}
}
