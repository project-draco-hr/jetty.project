{
  while (_state.compareAndSet(State.INACTIVE,State.ITERATING)) {
    Action action=process();
switch (action) {
case IDLE:
{
        if (_state.compareAndSet(State.ITERATING,State.INACTIVE))         return true;
        if (_state.compareAndSet(State.ITERATE_AGAIN,State.INACTIVE))         continue;
        continue;
      }
case SCHEDULED:
{
      if (_state.compareAndSet(State.ITERATING,State.ACTIVE) || _state.compareAndSet(State.ITERATE_AGAIN,State.ACTIVE))       return true;
      continue;
    }
case SUCCEEDED:
{
    completeSuccess();
    return true;
  }
default :
{
  throw new IllegalStateException(toString());
}
}
}
return false;
}
