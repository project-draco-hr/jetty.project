{
  server=new Server();
  SelectChannelConnector connector=new SelectChannelConnector();
  connector.setPort(0);
  server.addConnector(connector);
  HashLoginService login=new HashLoginService();
  login.setName("Test Realm");
  File realmFile=MavenTestingUtils.getTestResourceFile("realm.properties");
  login.setConfig(realmFile.getAbsolutePath());
  server.addBean(login);
  ServletContextHandler context=new ServletContextHandler(ServletContextHandler.SESSIONS);
  context.setContextPath("/");
  File webappBase=MavenTestingUtils.getTestResourceDir("docroots/jsp");
  context.setResourceBase(webappBase.getAbsolutePath());
  URLClassLoader contextLoader=new URLClassLoader(new URL[]{},Server.class.getClassLoader());
  context.setClassLoader(contextLoader);
  ServletHolder defaultServHolder=context.addServlet(DefaultServlet.class,"/");
  defaultServHolder.setInitParameter("aliases","false");
  ServletHolder jsp=context.addServlet(JspServlet.class,"*.jsp");
  context.setAttribute("org.apache.catalina.jsp_classpath",context.getClassPath());
  jsp.setInitParameter("com.sun.appserv.jsp.classpath",Loader.getClassPath(Server.class.getClassLoader()));
  server.setHandler(context);
  server.start();
  serverURI=new URI("http://localhost:" + connector.getLocalPort() + "/");
}
