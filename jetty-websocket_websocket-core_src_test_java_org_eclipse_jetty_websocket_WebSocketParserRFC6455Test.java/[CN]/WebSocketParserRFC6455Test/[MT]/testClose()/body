{
  String string="Game Over";
  byte[] bytes=string.getBytes("UTF-8");
  _in.putUnmasked((byte)(0x80 | 0x08));
  _in.putUnmasked((byte)(0x80 | (2 + bytes.length)));
  _in.sendMask();
  _in.put((byte)(1000 / 0x100));
  _in.put((byte)(1000 % 0x100));
  _in.put(bytes);
  int progress=_parser.parseNext();
  assertTrue(progress > 0);
  assertEquals(string,_handler._data.get(0).substring(2));
  assertEquals(0x8,_handler._flags);
  assertEquals(0x8,_handler._opcode);
  _parser.returnBuffer();
  assertTrue(_parser.isBufferEmpty());
  assertTrue(_parser.getBuffer() == null);
  _in.clear();
  _in.put(bytes);
  _endPoint.setIn(_in);
  progress=_parser.parseNext();
  assertTrue(progress > 0);
  _endPoint.shutdownInput();
  progress=_parser.parseNext();
  assertEquals(-1,progress);
}
