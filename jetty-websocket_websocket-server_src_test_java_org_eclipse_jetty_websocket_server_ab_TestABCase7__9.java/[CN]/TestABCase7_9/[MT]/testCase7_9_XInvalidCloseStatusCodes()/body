{
  BlockheadClient client=new BlockheadClient(server.getServerUri());
  try {
    client.connect();
    client.sendStandardRequest();
    client.expectUpgradeResponse();
    client.write(new CloseFrame(invalidStatusCode){
      @Override public void assertValidPayload(      int statusCode,      String reason){
      }
    }
);
    Queue<BaseFrame> frames=client.readFrames(1,TimeUnit.MILLISECONDS,500);
    CloseFrame closeFrame=(CloseFrame)frames.remove();
    Assert.assertThat("CloseFrame.status code",closeFrame.getStatusCode(),is(1002));
  }
  finally {
    client.close();
  }
}
