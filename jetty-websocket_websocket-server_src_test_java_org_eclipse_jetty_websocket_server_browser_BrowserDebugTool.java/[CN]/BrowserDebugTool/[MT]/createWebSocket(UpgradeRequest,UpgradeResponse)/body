{
  LOG.debug("Creating BrowserSocket");
  if (req.getSubProtocols() != null) {
    if (!req.getSubProtocols().isEmpty()) {
      String subProtocol=req.getSubProtocols().get(0);
      resp.setAcceptedSubProtocol(subProtocol);
    }
  }
  String ua=req.getHeader("User-Agent");
  String rexts=req.getHeader("Sec-WebSocket-Extensions");
  BrowserSocket socket=new BrowserSocket(ua,rexts);
  return socket;
}
