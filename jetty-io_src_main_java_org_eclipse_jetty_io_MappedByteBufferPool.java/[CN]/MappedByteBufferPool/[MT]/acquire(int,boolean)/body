{
  int bucket=bucketFor(size);
  ConcurrentMap<Integer,Queue<ByteBuffer>> buffers=buffersFor(direct);
  ByteBuffer result=null;
  Queue<ByteBuffer> byteBuffers=buffers.get(bucket);
  if (byteBuffers != null)   result=byteBuffers.poll();
  if (result == null) {
    int capacity=bucket * factor;
    result=direct ? BufferUtil.allocateDirect(capacity) : BufferUtil.allocate(capacity);
  }
  BufferUtil.clear(result);
  return result;
}
