{
  int bucket=bucketFor(buffer.capacity());
  ConcurrentMap<Integer,Queue<ByteBuffer>> buffers=buffersFor(buffer.isDirect());
  Queue<ByteBuffer> byteBuffers=buffers.get(bucket);
  if (byteBuffers == null) {
    byteBuffers=new ConcurrentLinkedQueue<>();
    Queue<ByteBuffer> existing=buffers.putIfAbsent(bucket,byteBuffers);
    if (existing != null)     byteBuffers=existing;
  }
  buffer.clear();
  byteBuffers.offer(buffer);
}
