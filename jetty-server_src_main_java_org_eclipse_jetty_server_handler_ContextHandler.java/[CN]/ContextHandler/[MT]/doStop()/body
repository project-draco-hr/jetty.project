{
  _availability=Availability.UNAVAILABLE;
  ClassLoader old_classloader=null;
  Thread current_thread=null;
  Context old_context=__context.get();
  __context.set(_scontext);
  try {
    if (_classLoader != null) {
      current_thread=Thread.currentThread();
      old_classloader=current_thread.getContextClassLoader();
      current_thread.setContextClassLoader(_classLoader);
    }
    super.doStop();
    if (!_contextListeners.isEmpty()) {
      ServletContextEvent event=new ServletContextEvent(_scontext);
      for (      ServletContextListener listener : _contextListeners)       callContextDestroyed(listener,event);
    }
    if (_errorHandler != null)     _errorHandler.stop();
    Enumeration<String> e=_scontext.getAttributeNames();
    while (e.hasMoreElements()) {
      String name=e.nextElement();
      checkManagedAttribute(name,null);
    }
    for (    EventListener l : _programmaticListeners)     removeEventListener(l);
    _programmaticListeners.clear();
  }
  finally {
    LOG.info("stopped {}",this);
    __context.set(old_context);
    if (_classLoader != null && current_thread != null)     current_thread.setContextClassLoader(old_classloader);
  }
  _contextAttributes.clearAttributes();
}
