{
  String string="Hell\uFF4f Medium W\uFF4Frld ";
  for (int i=0; i < 4; i++)   string=string + string;
  string+=". The end.";
  byte[] bytes=string.getBytes(StringUtil.__UTF8);
  _in.sendMask();
  _in.put((byte)0x84);
  _in.put((byte)0x7E);
  _in.put((byte)(bytes.length >> 8));
  _in.put((byte)(bytes.length & 0xff));
  _in.put(bytes);
  int filled=_parser.parseNext();
  assertEquals(bytes.length + 8,filled);
  assertEquals(string,_handler._data.get(0));
  assertEquals(0x8,_handler._flags);
  assertEquals(0x4,_handler._opcode);
  assertTrue(_parser.isBufferEmpty());
  assertTrue(_parser.getBuffer() == null);
}
