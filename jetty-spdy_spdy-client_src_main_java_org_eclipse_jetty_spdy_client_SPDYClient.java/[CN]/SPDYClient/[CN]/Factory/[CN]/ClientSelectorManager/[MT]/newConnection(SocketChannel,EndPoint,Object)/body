{
  SessionContext context=(SessionContext)attachment;
  final SPDYClient client=context.client;
  try {
    if (sslContextFactory != null) {
      final SSLEngine engine=client.newSSLEngine(sslContextFactory,channel);
      SslConnection sslConnection=new SslConnection(bufferPool,getExecutor(),endPoint,engine);
      sslConnection.setRenegotiationAllowed(sslContextFactory.isRenegotiationAllowed());
      DecryptedEndPoint sslEndPoint=sslConnection.getDecryptedEndPoint();
      NextProtoNegoClientConnection connection=new NextProtoNegoClientConnection(sslEndPoint,getExecutor(),client,attachment,engine);
      sslEndPoint.setConnection(connection);
      return sslConnection;
    }
 else {
      return connectionFactory.newConnection(endPoint,attachment);
    }
  }
 catch (  RuntimeException x) {
    context.failed(x);
    throw x;
  }
}
