{
  if (!"GET".equalsIgnoreCase(request.getMethod())) {
    return false;
  }
  String connection=request.getHeader("connection");
  if (connection == null) {
    LOG.debug("No 'Connection' header found");
    return false;
  }
  boolean foundUpgradeToken=false;
  Iterator<String> iter=QuoteUtil.splitAt(connection,",");
  while (iter.hasNext()) {
    String token=iter.next();
    if ("upgrade".equalsIgnoreCase(token)) {
      foundUpgradeToken=true;
      break;
    }
  }
  if (!foundUpgradeToken) {
    LOG.debug("No a `Upgrade` token found in 'Connection' header (was [Connection: {}])",request.getHeader("connection"));
    return false;
  }
  String upgrade=request.getHeader("Upgrade");
  if (upgrade == null) {
    return false;
  }
  if (!"websocket".equalsIgnoreCase(upgrade)) {
    LOG.debug("Not a 'Upgrade: WebSocket' (was [Upgrade: " + upgrade + "])");
    return false;
  }
  if (!"HTTP/1.1".equals(request.getProtocol())) {
    LOG.debug("Not a 'HTTP/1.1' request (was [" + request.getProtocol() + "])");
    return false;
  }
  return true;
}
