{
  if (!"HTTP/1.1".equals(request.getProtocol())) {
    throw new IllegalStateException("Not a 'HTTP/1.1' request");
  }
  return ("websocket".equalsIgnoreCase(request.getHeader("Upgrade")));
}
