{
  List<String> serverProtocols=getProtocols();
  String negotiated=null;
  for (  String serverProtocol : serverProtocols) {
    if (clientProtocols.contains(serverProtocol)) {
      negotiated=serverProtocol;
      break;
    }
  }
  if (negotiated == null) {
    negotiated=getDefaultProtocol();
  }
  if (LOG.isDebugEnabled())   LOG.debug("{} protocol selected {}",this,negotiated);
  setProtocol(negotiated);
  ALPN.remove(getSSLEngine());
  return negotiated;
}
