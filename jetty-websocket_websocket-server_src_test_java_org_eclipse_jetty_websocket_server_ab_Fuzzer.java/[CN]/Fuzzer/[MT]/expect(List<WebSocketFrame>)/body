{
  int expectedCount=expect.size();
  IncomingFramesCapture capture=client.readFrames(expect.size(),TimeUnit.MILLISECONDS,500);
  if (LOG.isDebugEnabled()) {
    capture.dump();
  }
  String prefix="";
  for (int i=0; i < expectedCount; i++) {
    WebSocketFrame expected=expect.get(i);
    WebSocketFrame actual=capture.getFrames().pop();
    prefix="Frame[" + i + "]";
    Assert.assertThat(prefix + ".opcode",OpCode.name(actual.getOpCode()),is(OpCode.name(expected.getOpCode())));
    prefix+="/" + actual.getOpCode();
    if (expected.getOpCode() == OpCode.CLOSE) {
      CloseInfo expectedClose=new CloseInfo(expected);
      CloseInfo actualClose=new CloseInfo(actual);
      Assert.assertThat(prefix + ".statusCode",actualClose.getStatusCode(),is(expectedClose.getStatusCode()));
    }
 else {
      Assert.assertThat(prefix + ".payloadLength",actual.getPayloadLength(),is(expected.getPayloadLength()));
      ByteBufferAssert.assertEquals(prefix + ".payload",expected.getPayload(),actual.getPayload());
    }
  }
}
