{
  int buflen=0;
  for (  Frame f : send) {
    buflen+=f.getPayloadLength() + Generator.OVERHEAD;
  }
  ByteBuffer buf=ByteBuffer.allocate(buflen);
  BufferUtil.clearToFill(buf);
  for (  WebSocketFrame f : send) {
    setClientMask(f);
    generator.generateWholeFrame(f,buf);
  }
  BufferUtil.flipToFlush(buf,0);
  return buf;
}
