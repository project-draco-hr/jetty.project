{
  KeyStore keystore=null;
  if (storeStream != null || storePath != null) {
    InputStream inStream=storeStream;
    try {
      if (inStream == null) {
        inStream=Resource.newResource(storePath).getInputStream();
      }
      if (storeProvider != null) {
        keystore=KeyStore.getInstance(storeType,storeProvider);
      }
 else {
        keystore=KeyStore.getInstance(storeType);
      }
      keystore.load(inStream,storePassword == null ? null : storePassword.toCharArray());
    }
  finally {
      if (inStream != null) {
        inStream.close();
      }
    }
  }
  return keystore;
}
