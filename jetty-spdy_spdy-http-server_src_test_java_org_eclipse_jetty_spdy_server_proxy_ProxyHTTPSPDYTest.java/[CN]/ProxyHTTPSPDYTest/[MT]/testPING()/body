{
  InetSocketAddress proxyAddress=startProxy(startServer(new ServerSessionFrameListener.Adapter()));
  proxyConnector.addConnectionFactory(proxyConnector.getConnectionFactory("spdy/" + version));
  final CountDownLatch pingLatch=new CountDownLatch(1);
  Session client=factory.newSPDYClient(version).connect(proxyAddress,new SessionFrameListener.Adapter(){
    @Override public void onPing(    Session session,    PingResultInfo pingInfo){
      pingLatch.countDown();
    }
  }
).get(5,TimeUnit.SECONDS);
  client.ping(new PingInfo(5,TimeUnit.SECONDS));
  Assert.assertTrue(pingLatch.await(5,TimeUnit.SECONDS));
  client.goAway(new GoAwayInfo(5,TimeUnit.SECONDS));
}
