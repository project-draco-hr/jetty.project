{
  if (_sslContext == null) {
    SslContextFactory factory=_httpClient.getSslContextFactory();
    _sslContext=factory.getSslContext();
    _enableSslSessionCaching=factory.isEnableSessionCaching();
  }
  SSLEngine sslEngine=null;
  if (channel != null && _enableSslSessionCaching) {
    InetSocketAddress remoteAddr=(InetSocketAddress)channel.socket().getRemoteSocketAddress();
    String peerHost=remoteAddr.getHostName();
    int peerPort=remoteAddr.getPort();
    sslEngine=_sslContext.createSSLEngine(peerHost,peerPort);
  }
 else {
    sslEngine=_sslContext.createSSLEngine();
  }
  sslEngine.setUseClientMode(true);
  sslEngine.beginHandshake();
  return sslEngine;
}
