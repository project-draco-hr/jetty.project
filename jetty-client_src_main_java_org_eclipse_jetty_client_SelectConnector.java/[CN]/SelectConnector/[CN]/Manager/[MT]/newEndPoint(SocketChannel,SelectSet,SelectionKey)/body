{
  Timeout.Task connectTimeout=_connectingChannels.remove(channel);
  if (connectTimeout != null)   connectTimeout.cancel();
  if (LOG.isDebugEnabled())   LOG.debug("Channels with connection pending: {}",_connectingChannels.size());
  HttpDestination dest=(HttpDestination)key.attachment();
  AsyncEndPoint ep=null;
  SelectChannelEndPoint scep=new SelectChannelEndPoint(channel,selectSet,key,(int)_httpClient.getIdleTimeout());
  ep=scep;
  if (dest.isSecure()) {
    LOG.debug("secure to {}, proxied={}",channel,dest.isProxied());
    ep=new UpgradableEndPoint(ep,newSslEngine(channel));
  }
  AsyncConnection connection=selectSet.getManager().newConnection(channel,ep,key.attachment());
  ep.setConnection(connection);
  AbstractHttpConnection httpConnection=(AbstractHttpConnection)connection;
  httpConnection.setDestination(dest);
  if (dest.isSecure() && !dest.isProxied())   ((UpgradableEndPoint)ep).upgrade();
  dest.onNewConnection(httpConnection);
  return scep;
}
