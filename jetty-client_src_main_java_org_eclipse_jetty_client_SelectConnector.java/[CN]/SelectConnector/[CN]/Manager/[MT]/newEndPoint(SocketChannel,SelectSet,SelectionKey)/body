{
  Timeout.Task connectTimeout=_connectingChannels.remove(channel);
  if (connectTimeout != null)   connectTimeout.cancel();
  Log.debug("Channels with connection pending: {}",_connectingChannels.size());
  HttpDestination dest=(HttpDestination)key.attachment();
  SelectChannelEndPoint ep=null;
  if (dest.isSecure()) {
    if (dest.isProxied()) {
      SSLEngine engine=newSslEngine(channel);
      ep=new ProxySelectChannelEndPoint(channel,selectSet,key,_sslBuffers,engine,(int)_httpClient.getIdleTimeout());
    }
 else {
      SSLEngine engine=newSslEngine(channel);
      SslSelectChannelEndPoint sslEp=new SslSelectChannelEndPoint(_sslBuffers,channel,selectSet,key,engine,(int)_httpClient.getIdleTimeout());
      sslEp.setAllowRenegotiate(_httpClient.getSslContextFactory().isAllowRenegotiate());
      ep=sslEp;
    }
  }
 else {
    ep=new SelectChannelEndPoint(channel,selectSet,key,(int)_httpClient.getIdleTimeout());
  }
  HttpConnection connection=(HttpConnection)ep.getConnection();
  connection.setDestination(dest);
  dest.onNewConnection(connection);
  return ep;
}
