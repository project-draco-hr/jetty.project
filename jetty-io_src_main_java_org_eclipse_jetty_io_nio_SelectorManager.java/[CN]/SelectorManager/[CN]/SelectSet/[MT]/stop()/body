{
  try {
    for (int i=0; i < 100 && _selecting != null; i++) {
      wakeup();
      Thread.sleep(10);
    }
  }
 catch (  Exception e) {
    LOG.ignore(e);
  }
synchronized (this) {
    Selector selector=_selector;
    for (    SelectionKey key : selector.keys()) {
      if (key == null)       continue;
      Object att=key.attachment();
      if (att instanceof EndPoint) {
        EndPoint endpoint=(EndPoint)att;
        try {
          endpoint.close();
        }
 catch (        IOException e) {
          LOG.ignore(e);
        }
      }
    }
    _timeout.cancelAll();
    try {
      selector=_selector;
      if (selector != null)       selector.close();
    }
 catch (    IOException e) {
      LOG.ignore(e);
    }
    _selector=null;
  }
}
