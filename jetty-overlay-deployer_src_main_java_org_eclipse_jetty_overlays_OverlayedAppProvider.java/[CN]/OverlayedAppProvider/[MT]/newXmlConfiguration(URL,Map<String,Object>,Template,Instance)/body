{
  XmlConfiguration xmlc=new XmlConfiguration(url);
  xmlc.getProperties().put(OVERLAYS_DIR,_scanDir.getCanonicalPath());
  if (template != null) {
    xmlc.getProperties().put(OVERLAY_TEMPLATE,template.getTemplateName());
    xmlc.getProperties().put(OVERLAY_WEBAPP,template.getWebapp() == null ? null : template.getWebapp().getName());
  }
  if (_node != null)   xmlc.getProperties().put(OVERLAY_NODE,_node.getName());
  if (instance != null)   xmlc.getProperties().put(OVERLAY_INSTANCE,instance.getName());
  if (getConfigurationManager() != null)   xmlc.getProperties().putAll(getConfigurationManager().getProperties());
  xmlc.getIdMap().putAll(idMap);
  return xmlc;
}
