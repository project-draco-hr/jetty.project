{
  while (true) {
switch (_state.get()) {
case NOT_COMPRESSING:
      _factory=factory;
    if (_state.compareAndSet(GZState.NOT_COMPRESSING,GZState.MIGHT_COMPRESS)) {
      LOG.debug("{} might compress",this);
      return;
    }
  _factory=null;
break;
default :
throw new IllegalStateException(_state.get().toString());
}
}
}
