{
  if (frame.getType().isControl()) {
    nextOutgoingFrame(frame,callback);
    return;
  }
  ByteBuffer data=frame.getPayload();
  method.compress().input(data);
  while (!method.compress().isDone()) {
    ByteBuffer buf=method.compress().process();
    DataFrame out=new DataFrame(frame);
    out.setPayload(buf);
    out.setRsv1(true);
    if (!method.compress().isDone()) {
      out.setFin(false);
      nextOutgoingFrame(out,null);
    }
 else {
      nextOutgoingFrame(out,callback);
    }
  }
  if (frame.isFin()) {
    method.compress().end();
  }
}
