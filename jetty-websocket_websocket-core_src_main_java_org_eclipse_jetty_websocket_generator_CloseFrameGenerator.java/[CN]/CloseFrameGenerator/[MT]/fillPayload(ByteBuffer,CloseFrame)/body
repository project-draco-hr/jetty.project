{
  if (close.getStatusCode() != 0) {
    buffer.putChar((char)close.getStatusCode());
    if (close.hasPayload()) {
      if (close.hasReason()) {
        byte utf[]=close.getReason().getBytes(StringUtil.__UTF8_CHARSET);
        buffer.put(utf,0,utf.length);
      }
    }
  }
 else   if (close.hasPayload()) {
    throw new WebSocketException("Close frames require setting a status code if using payload.");
  }
}
