{
  byte[] data={0,1,2,3,4,5,6,7,8,9};
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  try (GZIPOutputStream gzipOutput=new GZIPOutputStream(baos)){
    gzipOutput.write(data);
  }
   byte[] gzip=baos.toByteArray();
  endPoint.setInput("" + "HTTP/1.1 200 OK\r\n" + "Content-Length: " + gzip.length + "\r\n"+ "Content-Encoding: gzip\r\n"+ "\r\n");
  HttpExchange exchange=newExchange();
  BlockingResponseListener listener=(BlockingResponseListener)exchange.listener();
  exchange.receive();
  endPoint.reset();
  ByteBuffer buffer=ByteBuffer.wrap(gzip);
  int fragment=buffer.limit() - 1;
  buffer.limit(fragment);
  endPoint.setInput(buffer);
  exchange.receive();
  endPoint.reset();
  buffer.limit(gzip.length);
  buffer.position(fragment);
  endPoint.setInput(buffer);
  exchange.receive();
  ContentResponse response=listener.get(5,TimeUnit.SECONDS);
  Assert.assertNotNull(response);
  Assert.assertEquals(200,response.status());
  Assert.assertArrayEquals(data,response.content());
}
