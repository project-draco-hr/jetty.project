{
  String packet=getTestHeader();
  byte[] src=TypeUtil.fromHexString(packet);
  ByteArrayBuffer buffer=new ByteArrayBuffer(Ajp13Packet.MAX_PACKET_SIZE);
  SimpleBuffers buffers=new SimpleBuffers(buffer,null);
  ByteArrayEndPoint endp=new ByteArrayEndPoint(src,Ajp13Packet.MAX_PACKET_SIZE);
  endp.setNonBlocking(true);
  final int count[]={0};
  Ajp13Generator gen=new Ajp13Generator(buffers,endp){
    public void getBodyChunk() throws IOException {
      count[0]++;
      super.getBodyChunk();
    }
  }
;
  Ajp13Parser parser=new Ajp13Parser(buffers,endp);
  parser.setEventHandler(new EH());
  parser.setGenerator(gen);
  parser.parseNext();
  assertEquals(1,parser.getState());
  assertEquals(0,count[0]);
  endp.setIn(new ByteArrayBuffer(TypeUtil.fromHexString(getTestShortBody())));
  parser.parseNext();
  assertEquals(1,parser.getState());
  assertEquals(1,count[0]);
  endp.setIn(new ByteArrayBuffer(TypeUtil.fromHexString(getTestTinyBody())));
  parser.parseNext();
  parser.parseNext();
  assertEquals(0,parser.getState());
  assertEquals(1,count[0]);
  assertTrue(true);
}
