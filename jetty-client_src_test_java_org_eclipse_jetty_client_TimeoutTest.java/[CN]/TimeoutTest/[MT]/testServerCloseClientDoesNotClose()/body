{
  final Socket client=newClient();
  final OutputStream clientOutput=client.getOutputStream();
  byte[] data=new byte[3 * 1024];
  Arrays.fill(data,(byte)'Y');
  String content=new String(data,"UTF-8");
  clientOutput.write(("" + "POST / HTTP/1.1\r\n" + "Host: localhost\r\n"+ "Content-Type: text/plain\r\n"+ "Content-Length: " + content.length() + "\r\n"+ "Connection: close\r\n"+ "\r\n"+ content).getBytes("UTF-8"));
  clientOutput.flush();
  System.out.println("Client output flushed");
  BufferedReader reader=new BufferedReader(new InputStreamReader(client.getInputStream(),"UTF-8"));
  String line=reader.readLine();
  Assert.assertNotNull(line);
  Assert.assertThat(line,startsWith("HTTP/1.1 200 "));
  while ((line=reader.readLine()) != null) {
    if (line.trim().length() == 0) {
      break;
    }
  }
  System.out.println("Got response header");
  int httpParseCount=httpParses.get();
  System.out.printf("Got %d http parses%n",httpParseCount);
  Assert.assertThat(httpParseCount,lessThan(50));
  TimeUnit.SECONDS.sleep(100);
  closeClient(client);
}
