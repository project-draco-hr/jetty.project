{
  List<Extension> extensions=new ArrayList<Extension>();
  for (  String rExt : requested) {
    QuotedStringTokenizer tok=new QuotedStringTokenizer(rExt,";");
    String extName=tok.nextToken().trim();
    Map<String,String> parameters=new HashMap<String,String>();
    while (tok.hasMoreTokens()) {
      QuotedStringTokenizer nv=new QuotedStringTokenizer(tok.nextToken().trim(),"=");
      String name=nv.nextToken().trim();
      String value=nv.hasMoreTokens() ? nv.nextToken().trim() : null;
      parameters.put(name,value);
    }
    Extension extension=newExtension(extName);
    if (extension == null)     continue;
    if (extension.init(parameters)) {
      if (extension.getDataOpcodes() <= maxDataOpcodes && extension.getControlOpcodes() <= maxControlOpcodes && extension.getReservedBits() <= maxReservedBits) {
        Log.debug("add {} {}",extName,parameters);
        extensions.add(extension);
        maxDataOpcodes-=extension.getDataOpcodes();
        maxControlOpcodes-=extension.getControlOpcodes();
        maxReservedBits-=extension.getReservedBits();
      }
    }
  }
  Log.debug("extensions={}",extensions);
  return extensions;
}
