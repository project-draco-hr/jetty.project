{
  _generator=new WebSocketGeneratorD12(_buffers,_endPoint,_maskGen);
  String string="Hell\uFF4F W\uFF4Frld";
  byte[] bytes=string.getBytes(StringUtil.__UTF8);
  _generator.addFrame((byte)0x8,(byte)0x04,bytes,0,bytes.length);
  _generator.flush();
  assertEquals((byte)0x84,_out.get());
  assertEquals(15,0x7f & _out.get());
  _out.get(_mask,0,4);
  assertEquals('H',getMasked());
  assertEquals('e',getMasked());
  assertEquals('l',getMasked());
  assertEquals('l',getMasked());
  assertEquals(0xEF,0xff & getMasked());
  assertEquals(0xBD,0xff & getMasked());
  assertEquals(0x8F,0xff & getMasked());
  assertEquals(' ',getMasked());
  assertEquals('W',getMasked());
  assertEquals(0xEF,0xff & getMasked());
  assertEquals(0xBD,0xff & getMasked());
  assertEquals(0x8F,0xff & getMasked());
  assertEquals('r',getMasked());
  assertEquals('l',getMasked());
  assertEquals('d',getMasked());
}
