{
  _generator=new WebSocketGeneratorD12(_buffers,_endPoint,_maskGen);
  byte[] b=new byte[150];
  for (int i=0; i < b.length; i++)   b[i]=(byte)('0' + (i % 10));
  _generator.addFrame((byte)0x8,(byte)0x04,b,0,b.length);
  _generator.flush();
  assertEquals((byte)0x84,_out.get());
  assertEquals((byte)126,0x7f & _out.get());
  assertEquals((byte)0,_out.get());
  assertEquals((byte)b.length,_out.get());
  _out.get(_mask,0,4);
  for (int i=0; i < b.length; i++)   assertEquals('0' + (i % 10),0xff & getMasked());
}
