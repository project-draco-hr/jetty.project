{
  long current=0;
  int n=0;
  int len=s.length();
  for (int i=0; i < len; i++) {
    char c=s.charAt(i);
    if (c >= 128)     throw new IllegalArgumentException();
    int code=CODES[c][0];
    int bits=CODES[c][1];
    current<<=bits;
    current|=code;
    n+=bits;
    while (n >= 8) {
      n-=8;
      buf.put((byte)(current >> n));
    }
  }
  if (n > 0) {
    current<<=(8 - n);
    current|=(0xFF >>> n);
    buf.put((byte)current);
  }
}
