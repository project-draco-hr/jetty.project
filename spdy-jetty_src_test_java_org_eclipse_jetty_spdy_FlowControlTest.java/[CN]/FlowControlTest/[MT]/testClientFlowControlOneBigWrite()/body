{
  final AtomicInteger bytes=new AtomicInteger();
  final CountDownLatch dataLatch=new CountDownLatch(1);
  Session session=startClient(startServer(new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      stream.reply(new ReplyInfo(false));
      return new StreamFrameListener.Adapter(){
        @Override public void onData(        Stream stream,        DataInfo dataInfo){
          bytes.addAndGet(dataInfo.getContentLength());
          if (dataInfo.isClose())           dataLatch.countDown();
        }
      }
;
    }
  }
),null);
  Stream stream=session.syn(new SynInfo(true),null).get();
  int length=128 * 1024;
  stream.data(new BytesDataInfo(new byte[length],true));
  Assert.assertTrue(dataLatch.await(5,TimeUnit.SECONDS));
  Assert.assertEquals(length,bytes.get());
}
