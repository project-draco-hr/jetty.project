{
  final int length=128 * 1024;
  Session session=startClient(startServer(new ServerSessionFrameListener.Adapter(){
    @Override public Stream.FrameListener onSyn(    Stream stream,    SynInfo synInfo){
      stream.reply(new ReplyInfo(false));
      stream.data(new BytesDataInfo(new byte[length],false));
      stream.data(new BytesDataInfo(new byte[length],true));
      return null;
    }
  }
),null);
  final AtomicInteger bytes=new AtomicInteger();
  final CountDownLatch dataLatch=new CountDownLatch(1);
  session.syn(new SynInfo(true),new Stream.FrameListener.Adapter(){
    @Override public void onData(    Stream stream,    DataInfo dataInfo){
      bytes.addAndGet(dataInfo.getBytesCount());
      if (dataInfo.isClose())       dataLatch.countDown();
    }
  }
);
  Assert.assertTrue(dataLatch.await(5,TimeUnit.SECONDS));
  Assert.assertEquals(2 * length,bytes.get());
}
