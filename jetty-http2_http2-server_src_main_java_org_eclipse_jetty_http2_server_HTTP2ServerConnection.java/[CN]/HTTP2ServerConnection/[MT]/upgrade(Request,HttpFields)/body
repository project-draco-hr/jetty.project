{
  if (HttpMethod.PRI.is(request.getMethod())) {
    ((ServerParser)getParser()).directUpgrade();
  }
 else {
    String value=request.getFields().getField(HttpHeader.HTTP2_SETTINGS).getValue();
    final byte[] settings=B64Code.decodeRFC4648URL(value);
    if (LOG.isDebugEnabled())     LOG.debug("{} settings {}",this,TypeUtil.toHexString(settings));
    SettingsFrame settingsFrame=SettingsBodyParser.parseBody(BufferUtil.toBuffer(settings));
    if (settingsFrame == null) {
      LOG.warn("Invalid {} header value: {}",HttpHeader.HTTP2_SETTINGS,value);
      throw new BadMessageException();
    }
    getSession().onFrame(settingsFrame);
    upgradeRequest=new HeadersFrame(1,request,null,true);
  }
  return true;
}
