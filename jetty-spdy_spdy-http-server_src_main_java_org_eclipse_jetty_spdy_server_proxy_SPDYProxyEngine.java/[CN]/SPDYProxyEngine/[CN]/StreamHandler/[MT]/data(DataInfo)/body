{
  Stream serverStream;
  DataInfoHandler dataInfoHandler=null;
  DataInfoHandler item=new DataInfoHandler(dataInfo);
synchronized (queue) {
    queue.offer(item);
    serverStream=this.serverStream;
    if (serverStream != null) {
      dataInfoHandler=queue.peek();
      if (dataInfoHandler.flushing) {
        logger.debug("Queued {}, flushing {}, queue size {}",dataInfo,dataInfoHandler.dataInfo,queue.size());
        serverStream=null;
      }
 else {
        dataInfoHandler.flushing=true;
        logger.debug("Queued {}, queue size {}",dataInfo,queue.size());
      }
    }
 else {
      logger.debug("Queued {}, SYN incomplete, queue size {}",dataInfo,queue.size());
    }
  }
  if (serverStream != null)   flush(serverStream,dataInfoHandler);
}
