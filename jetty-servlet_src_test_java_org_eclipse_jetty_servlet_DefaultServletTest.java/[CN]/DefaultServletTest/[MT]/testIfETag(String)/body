{
  testdir.ensureEmpty();
  File resBase=testdir.getFile("docroot");
  FS.ensureDirExists(resBase);
  File file=new File(resBase,"file.txt");
  String resBasePath=resBase.getAbsolutePath();
  ServletHolder defholder=context.addServlet(DefaultServlet.class,"/");
  defholder.setInitParameter("resourceBase",resBasePath);
  defholder.setInitParameter("maxCacheSize","4096");
  defholder.setInitParameter("maxCachedFileSize","25");
  defholder.setInitParameter("maxCachedFiles","100");
  defholder.setInitParameter("etags","true");
  String response;
  createFile(file,content);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\n\r\n");
  assertResponseContains("200",response);
  assertResponseContains("ETag",response);
  String etag=getHeaderValue("ETag",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-None-Match: " + etag + "\r\n\r\n");
  assertResponseContains("304",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-None-Match: wibble," + etag + ",wobble\r\n\r\n");
  assertResponseContains("304",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-None-Match: wibble\r\n\r\n");
  assertResponseContains("200",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-None-Match: wibble, wobble\r\n\r\n");
  assertResponseContains("200",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-Match: " + etag + "\r\n\r\n");
  assertResponseContains("200",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-Match: wibble," + etag + ",wobble\r\n\r\n");
  assertResponseContains("200",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-Match: wibble\r\n\r\n");
  assertResponseContains("412",response);
  response=connector.getResponses("GET /context/file.txt HTTP/1.1\r\nHost:test\r\nConnection:close\r\nIf-Match: wibble, wobble\r\n\r\n");
  assertResponseContains("412",response);
}
