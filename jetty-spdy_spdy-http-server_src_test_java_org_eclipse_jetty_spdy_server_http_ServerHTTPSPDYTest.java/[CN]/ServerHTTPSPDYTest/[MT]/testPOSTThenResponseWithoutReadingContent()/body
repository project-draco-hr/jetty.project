{
  final byte[] data=new byte[1000];
  final CountDownLatch latch=new CountDownLatch(1);
  Session session=startClient(version,startHTTPServer(version,new AbstractHandler(){
    @Override public void handle(    String target,    final Request request,    HttpServletRequest httpRequest,    HttpServletResponse httpResponse) throws IOException, ServletException {
      request.setHandled(true);
      latch.countDown();
    }
  }
),null);
  Fields headers=new Fields();
  headers.put(HTTPSPDYHeader.METHOD.name(version),"POST");
  headers.put(HTTPSPDYHeader.URI.name(version),"/foo");
  headers.put(HTTPSPDYHeader.VERSION.name(version),"HTTP/1.1");
  headers.put(HTTPSPDYHeader.SCHEME.name(version),"http");
  headers.put(HTTPSPDYHeader.HOST.name(version),"localhost:" + connector.getLocalPort());
  final CountDownLatch responseLatch=new CountDownLatch(1);
  Stream stream=session.syn(new SynInfo(headers,false),new StreamFrameListener.Adapter(){
    @Override public void onReply(    Stream stream,    ReplyInfo replyInfo){
      Fields replyHeaders=replyInfo.getHeaders();
      Assert.assertTrue(replyHeaders.get(HTTPSPDYHeader.STATUS.name(version)).value().contains("200"));
      responseLatch.countDown();
    }
  }
).get(5,TimeUnit.SECONDS);
  stream.data(new BytesDataInfo(data,false));
  stream.data(new BytesDataInfo(data,true)).get(5,TimeUnit.SECONDS);
  Assert.assertTrue(latch.await(5,TimeUnit.SECONDS));
  Assert.assertTrue(responseLatch.await(5,TimeUnit.SECONDS));
}
