{
  final String suffix="/redirect";
  final CountDownLatch handlerLatch=new CountDownLatch(1);
  Session session=startClient(version,startHTTPServer(version,new AbstractHandler(){
    @Override public void handle(    String target,    Request request,    HttpServletRequest httpRequest,    HttpServletResponse httpResponse) throws IOException, ServletException {
      request.setHandled(true);
      String location=httpResponse.encodeRedirectURL(String.format("%s://%s:%d%s",request.getScheme(),request.getLocalAddr(),request.getLocalPort(),target + suffix));
      httpResponse.sendRedirect(location);
      handlerLatch.countDown();
    }
  }
),null);
  Fields headers=createHeaders("GET");
  final CountDownLatch replyLatch=new CountDownLatch(1);
  session.syn(new SynInfo(headers,true),new StreamFrameListener.Adapter(){
    private final AtomicInteger replies=new AtomicInteger();
    @Override public void onReply(    Stream stream,    ReplyInfo replyInfo){
      Assert.assertEquals(1,replies.incrementAndGet());
      Assert.assertTrue(replyInfo.isClose());
      Fields replyHeaders=replyInfo.getHeaders();
      Assert.assertTrue(replyHeaders.get(HTTPSPDYHeader.STATUS.name(version)).value().contains("302"));
      Assert.assertTrue(replyHeaders.get("location").value().endsWith(suffix));
      replyLatch.countDown();
    }
  }
);
  Assert.assertTrue(handlerLatch.await(5,TimeUnit.SECONDS));
  Assert.assertTrue(replyLatch.await(5,TimeUnit.SECONDS));
}
