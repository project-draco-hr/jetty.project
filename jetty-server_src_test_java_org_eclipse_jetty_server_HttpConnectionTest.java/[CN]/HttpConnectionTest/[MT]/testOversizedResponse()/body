{
  String str="thisisastringthatshouldreachover1kbytes-";
  for (int i=0; i < 500; i++)   str+="xxxxxxxxxxxx";
  final String longstr=str;
  String response=null;
  server.stop();
  server.setHandler(new DumpHandler(){
    public void handle(    String target,    Request baseRequest,    HttpServletRequest request,    HttpServletResponse response) throws IOException, ServletException {
      try {
        baseRequest.setHandled(true);
        response.setHeader(HttpHeaders.CONTENT_TYPE,MimeTypes.TEXT_HTML);
        response.setHeader("LongStr",longstr);
        PrintWriter writer=response.getWriter();
        writer.write("<html><h1>FOO</h1></html>");
        writer.flush();
        writer.close();
        throw new RuntimeException("SHOULD NOT GET HERE");
      }
 catch (      Exception e) {
        LOG.debug(e);
        LOG.info("correctly ignored " + e);
      }
    }
  }
);
  server.start();
  try {
    int offset=0;
    response=connector.getResponses("GET / HTTP/1.1\n" + "Host: localhost\n" + "\015\012");
    offset=checkContains(response,offset,"HTTP/1.1 500");
  }
 catch (  Exception e) {
    e.printStackTrace();
    if (response != null)     System.err.println(response);
    fail("Exception");
  }
}
