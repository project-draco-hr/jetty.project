{
  _logger.debug("{}: begin reading from server",this);
  try {
    if (_data != null) {
      int written=write(_endp,_data,_context);
      _logger.debug("{}: written to server {} bytes",this,written);
      _data=null;
    }
    while (true) {
      int read=read(_endp,_buffer,_context);
      if (read == -1) {
        _logger.debug("{}: server closed connection {}",this,_endp);
        if (_endp.isOutputShutdown() || !_endp.isOpen())         _toClient.getEndPoint().close();
 else         _toClient.getEndPoint().shutdownOutput();
        break;
      }
      if (read == 0)       break;
      _logger.debug("{}: read from server {} bytes {}",this,read,_endp);
      int written=write(_toClient.getEndPoint(),_buffer,_context);
      _logger.debug("{}: written to {} {} bytes",this,_toClient,written);
    }
    return this;
  }
 catch (  ClosedChannelException x) {
    _logger.debug(x);
    throw x;
  }
catch (  IOException x) {
    _logger.warn(this + ": unexpected exception",x);
    close();
    throw x;
  }
catch (  RuntimeException x) {
    _logger.warn(this + ": unexpected exception",x);
    close();
    throw x;
  }
 finally {
    _logger.debug("{}: end reading from server",this);
  }
}
