{
  LOG.debug("{}: begin reading from client",this);
  try {
    if (_firstTime) {
      _firstTime=false;
      register(_channel,_toServer);
      LOG.debug("{}: registered channel {} with connection {}",this,_channel,_toServer);
    }
    while (true) {
      int read=read(_endPoint,_buffer,_context);
      if (read == -1) {
        LOG.debug("{}: client closed connection {}",this,_endPoint);
        if (_endPoint.isOutputShutdown() || !_endPoint.isOpen())         closeServer();
 else         _toServer.shutdownOutput();
        break;
      }
      if (read == 0)       break;
      LOG.debug("{}: read from client {} bytes {}",this,read,_endPoint);
      int written=write(_toServer._endPoint,_buffer,_context);
      LOG.debug("{}: written to {} {} bytes",this,_toServer,written);
    }
    return this;
  }
 catch (  ClosedChannelException x) {
    LOG.debug(x);
    closeServer();
    throw x;
  }
catch (  IOException x) {
    LOG.warn(this + ": unexpected exception",x);
    close();
    throw x;
  }
catch (  RuntimeException x) {
    LOG.warn(this + ": unexpected exception",x);
    close();
    throw x;
  }
 finally {
    LOG.debug("{}: end reading from client",this);
  }
}
