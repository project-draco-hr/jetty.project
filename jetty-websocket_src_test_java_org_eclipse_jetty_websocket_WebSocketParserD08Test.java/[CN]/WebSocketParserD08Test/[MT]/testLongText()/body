{
  WebSocketBuffers buffers=new WebSocketBuffers(0x20000);
  ByteArrayEndPoint endPoint=new ByteArrayEndPoint();
  WebSocketParserD08 parser=new WebSocketParserD08(buffers,endPoint,_handler,false);
  ByteArrayBuffer in=new ByteArrayBuffer(0x20000);
  endPoint.setIn(in);
  String string="Hell\uFF4f Big W\uFF4Frld ";
  for (int i=0; i < 12; i++)   string=string + string;
  string+=". The end.";
  byte[] bytes=string.getBytes("UTF-8");
  _in.sendMask();
  in.put((byte)0x84);
  in.put((byte)0x7F);
  in.put((byte)0x00);
  in.put((byte)0x00);
  in.put((byte)0x00);
  in.put((byte)0x00);
  in.put((byte)0x00);
  in.put((byte)(bytes.length >> 16));
  in.put((byte)((bytes.length >> 8) & 0xff));
  in.put((byte)(bytes.length & 0xff));
  in.put(bytes);
  int progress=parser.parseNext();
  parser.returnBuffer();
  assertEquals(bytes.length + 11,progress);
  assertEquals(string,_handler._data.get(0));
  assertTrue(parser.isBufferEmpty());
  assertTrue(parser.getBuffer() == null);
}
