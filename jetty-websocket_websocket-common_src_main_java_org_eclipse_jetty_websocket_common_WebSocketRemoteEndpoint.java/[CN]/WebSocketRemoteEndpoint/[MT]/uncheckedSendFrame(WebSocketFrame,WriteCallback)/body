{
  try {
    OutgoingFrames.FlushMode flushMode=OutgoingFrames.FlushMode.SEND;
    if (frame.isDataFrame() && isBatching())     flushMode=OutgoingFrames.FlushMode.AUTO;
    connection.getIOState().assertOutputOpen();
    outgoing.outgoingFrame(frame,callback,flushMode);
  }
 catch (  IOException e) {
    callback.writeFailed(e);
  }
}
