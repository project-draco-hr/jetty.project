{
  while (true) {
    MsgType was=msgType.get();
switch (was) {
case NONE:
      if (msgType.compareAndSet(MsgType.NONE,type))       return;
    break;
case BINARY:
case TEXT:
case PARTIAL_BINARY:
case PARTIAL_TEXT:
  throw new IllegalStateException(PRIORMSG_ERROR);
}
}
}
