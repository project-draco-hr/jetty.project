{
  for (  Module module : modules.values()) {
    for (    String parentName : module.getParentNames()) {
      Module parent=get(parentName);
      if (parent != null) {
        module.addParentEdge(parent);
        parent.addChildEdge(module);
      }
    }
    for (    String optionalParentName : module.getOptionalParentNames()) {
      Module optional=get(optionalParentName);
      if ((optional != null) && optional.isEnabled()) {
        module.addParentEdge(optional);
        optional.addChildEdge(module);
      }
    }
  }
  Stack<String> refs=new Stack<>();
  for (  Module module : modules.values()) {
    refs.push(module.getName());
    assertNoCycle(module,refs);
    refs.pop();
  }
  for (  Module module : modules.values()) {
    if (module.getParentEdges().isEmpty()) {
      bfsCalculateDepth(module,0);
    }
  }
}
