{
  Map<String,Module> active=new HashMap<String,Module>();
  for (  Module module : modules.values()) {
    if (module.isEnabled()) {
      findParents(module,active);
    }
  }
  assertModulesValid(active.values());
  List<Module> ordered=new ArrayList<>();
  ordered.addAll(active.values());
  Collections.sort(ordered,new Module.DepthComparator());
  return ordered;
}
