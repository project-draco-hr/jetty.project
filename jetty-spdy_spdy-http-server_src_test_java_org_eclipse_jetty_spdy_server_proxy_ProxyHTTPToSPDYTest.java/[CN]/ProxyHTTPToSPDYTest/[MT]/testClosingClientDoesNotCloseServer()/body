{
  final CountDownLatch closeLatch=new CountDownLatch(1);
  InetSocketAddress proxyAddress=startProxy(startServer(new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      Fields responseHeaders=new Fields();
      responseHeaders.put(HTTPSPDYHeader.VERSION.name(version),"HTTP/1.1");
      responseHeaders.put(HTTPSPDYHeader.STATUS.name(version),"200 OK");
      stream.reply(new ReplyInfo(responseHeaders,true),new Callback.Adapter());
      return null;
    }
    @Override public void onGoAway(    Session session,    GoAwayResultInfo goAwayInfo){
      closeLatch.countDown();
    }
  }
));
  Request request=httpClient.newRequest("localhost",proxyAddress.getPort()).method("GET");
  request.header("Connection","close");
  ContentResponse response=request.send();
  assertThat("response status is 200 OK",response.getStatus(),is(200));
  Assert.assertFalse(closeLatch.await(1,TimeUnit.SECONDS));
}
