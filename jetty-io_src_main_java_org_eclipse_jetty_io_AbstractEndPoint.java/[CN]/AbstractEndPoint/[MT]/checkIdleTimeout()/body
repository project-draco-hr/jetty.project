{
  if (isOpen()) {
    long idleTimestamp=getIdleTimestamp();
    long idleTimeout=getIdleTimeout();
    long idleElapsed=System.currentTimeMillis() - idleTimestamp;
    long idleLeft=idleTimeout - idleElapsed;
    LOG.debug("{} idle timeout check, elapsed: {} ms, remaining: {} ms",this,idleElapsed,idleLeft);
    if (isOutputShutdown() || _fillInterest.isInterested() || _writeFlusher.isInProgress()) {
      if (idleTimestamp != 0 && idleTimeout > 0) {
        if (idleLeft <= 0) {
          LOG.debug("{} idle timeout expired",this);
          TimeoutException timeout=new TimeoutException("Idle timeout expired: " + idleElapsed + "/"+ idleTimeout+ " ms");
          _fillInterest.onFail(timeout);
          _writeFlusher.onFail(timeout);
          if (isOutputShutdown())           close();
          notIdle();
        }
      }
    }
    return idleLeft >= 0 ? idleLeft : 0;
  }
  return -1;
}
