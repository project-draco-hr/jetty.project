{
  String delim=__COOKIE_DELIM;
  if (name == null || name.length() == 0)   throw new IllegalArgumentException("Bad cookie name");
  StringBuilder buf=new StringBuilder(128);
  String name_value_params;
  QuotedStringTokenizer.quoteIfNeeded(buf,name,delim);
  buf.append('=');
  String start=buf.toString();
  boolean hasDomain=false;
  boolean hasPath=false;
  if (value != null && value.length() > 0)   QuotedStringTokenizer.quoteIfNeeded(buf,value,delim);
  if (version != 0)   buf.append(";Version=").append(version);
  if (path != null && path.length() > 0) {
    hasPath=true;
    buf.append(";Path=");
    if (path.trim().startsWith("\""))     buf.append(path);
 else     QuotedStringTokenizer.quoteIfNeeded(buf,path,delim);
  }
  if (domain != null && domain.length() > 0) {
    hasDomain=true;
    buf.append(";Domain=");
    QuotedStringTokenizer.quoteIfNeeded(buf,domain.toLowerCase(Locale.ENGLISH),delim);
  }
  if (maxAge >= 0) {
    buf.append(";Expires=");
    if (maxAge == 0)     buf.append(__01Jan1970_COOKIE);
 else     formatCookieDate(buf,System.currentTimeMillis() + 1000L * maxAge);
    buf.append(";Max-Age=");
    buf.append(maxAge);
  }
  if (isSecure)   buf.append(";Secure");
  if (isHttpOnly)   buf.append(";HttpOnly");
  if (comment != null && comment.length() > 0) {
    buf.append(";Comment=");
    QuotedStringTokenizer.quoteIfNeeded(buf,comment,delim);
  }
  name_value_params=buf.toString();
  Iterator<HttpField> i=_fields.iterator();
  while (i.hasNext()) {
    HttpField field=i.next();
    if (field.getHeader() == HttpHeader.SET_COOKIE) {
      String val=(field.getValue() == null ? null : field.getValue().toString());
      if (val != null && val.startsWith(start)) {
        if (((!hasDomain && !val.contains("Domain")) || (hasDomain && val.contains("Domain=" + domain))) && ((!hasPath && !val.contains("Path")) || (hasPath && val.contains("Path=" + path)))) {
          i.remove();
        }
      }
    }
  }
  add(HttpHeader.SET_COOKIE.toString(),name_value_params);
  put(HttpHeader.EXPIRES.toString(),__01Jan1970);
}
