{
  int dataSize=1024 * 64;
  BinaryFrame binary=new BinaryFrame();
  binary.setFin(true);
  ByteBuffer payload=ByteBuffer.allocate(dataSize);
  for (int i=0; i < dataSize; i++) {
    payload.put((byte)0x44);
  }
  binary.setPayload(payload);
  WebSocketPolicy policy=WebSocketPolicy.newServerPolicy();
  BinaryFrameGenerator gen=new BinaryFrameGenerator(bufferPool,policy);
  ByteBuffer actual=gen.generate(binary);
  ByteBuffer expected=ByteBuffer.allocate(dataSize + 10);
  expected.put(new byte[]{(byte)0x82,(byte)0x7F});
  expected.putInt(0x0000000000010000);
  for (int i=0; i < dataSize; i++) {
    expected.put((byte)0x44);
  }
  actual.flip();
  expected.flip();
  ByteBufferAssert.assertEquals("binary buffers are not equal",expected,actual);
}
