{
  String invalidHostname="badHost.webtide.com";
  try {
    InetAddress address=InetAddress.getByName(invalidHostname);
    StringBuilder err=new StringBuilder();
    err.append("DNS Hijacking detected: ");
    err.append(invalidHostname).append(" should have not returned a valid IP address [");
    err.append(address.getHostAddress()).append("].  ");
    err.append("Fix your DNS provider to have this test pass.");
    err.append("\nFor more info see https://en.wikipedia.org/wiki/DNS_hijacking");
    Assert.assertNull(err.toString(),address);
  }
 catch (  UnknownHostException e) {
  }
  String hostPort=String.format("%s:%d",invalidHostname,serverConnector.getLocalPort());
  String request="" + "CONNECT " + hostPort + " HTTP/1.1\r\n"+ "Host: "+ hostPort+ "\r\n"+ "\r\n";
  Socket socket=newSocket();
  socket.setSoTimeout(30000);
  try {
    OutputStream output=socket.getOutputStream();
    BufferedReader input=new BufferedReader(new InputStreamReader(socket.getInputStream()));
    output.write(request.getBytes("UTF-8"));
    output.flush();
    SimpleHttpResponse response=readResponse(input);
    Assert.assertEquals("Response Code","500",response.getCode());
  }
  finally {
    socket.close();
  }
}
