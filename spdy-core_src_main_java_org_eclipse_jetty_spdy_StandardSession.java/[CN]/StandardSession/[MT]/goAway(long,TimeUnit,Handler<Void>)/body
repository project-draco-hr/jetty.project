{
  if (goAwaySent.compareAndSet(false,true)) {
    if (!goAwayReceived.get()) {
      try {
        GoAwayFrame frame=new GoAwayFrame(version,lastStreamId.get(),SessionStatus.OK.getCode());
        control(null,frame,timeout,unit,handler,null);
        return;
      }
 catch (      StreamException x) {
        handler.failed(x);
      }
    }
  }
  handler.completed(null);
}
