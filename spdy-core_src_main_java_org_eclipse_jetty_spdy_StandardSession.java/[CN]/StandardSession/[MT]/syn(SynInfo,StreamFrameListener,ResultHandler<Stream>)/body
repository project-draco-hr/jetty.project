{
synchronized (this) {
    if (synInfo.isUnidirectional()) {
      throw new UnsupportedOperationException();
    }
 else {
      int streamId=streamIds.getAndAdd(2);
      SynStreamFrame synStream=new SynStreamFrame(version,synInfo.getFlags(),streamId,0,synInfo.getPriority(),synInfo.getHeaders());
      final IStream stream=createStream(synStream,listener);
      try {
        control(stream,synStream,new Handler(){
          @Override public void completed(){
            handler.completed(stream);
          }
          @Override public void failed(          Throwable x){
            handler.failed(x);
          }
        }
);
        flush();
      }
 catch (      StreamException x) {
        removeStream(stream);
        handler.failed(x);
        throw new SPDYException(x);
      }
    }
  }
}
