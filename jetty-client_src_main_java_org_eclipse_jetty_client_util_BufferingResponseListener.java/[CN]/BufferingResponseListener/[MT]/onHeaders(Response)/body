{
  HttpFields headers=response.getHeaders();
  long length=headers.getLongField(HttpHeader.CONTENT_LENGTH.asString());
  if (length > maxLength)   response.abort(new IllegalArgumentException("Buffering capacity exceeded"));
  String contentType=headers.get(HttpHeader.CONTENT_TYPE);
  if (contentType != null) {
    String charset="charset=";
    int index=contentType.toLowerCase(Locale.ENGLISH).indexOf(charset);
    if (index > 0) {
      String encoding=contentType.substring(index + charset.length());
      index=encoding.indexOf(';');
      if (index > 0)       encoding=encoding.substring(0,index);
      this.encoding=encoding;
    }
  }
}
