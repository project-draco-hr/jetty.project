{
  Server server=new Server();
  ServletContextHandler context=new ServletContextHandler(server,"/",ServletContextHandler.SESSIONS);
  context.setResourceBase("/tmp");
  context.addFilter(PushCacheFilter.class,"/*",EnumSet.of(DispatcherType.REQUEST)).setInitParameter("ports","443,6443,8443");
  context.addServlet(new ServletHolder(servlet),"/test/*");
  context.addServlet(DefaultServlet.class,"/");
  server.setHandler(context);
  HttpConfiguration http_config=new HttpConfiguration();
  http_config.setSecureScheme("https");
  http_config.setSecurePort(8443);
  http_config.setSendXPoweredBy(true);
  http_config.setSendServerVersion(true);
  ServerConnector http=new ServerConnector(server,new HttpConnectionFactory(http_config));
  http.setPort(8080);
  server.addConnector(http);
  String jetty_distro=System.getProperty("jetty.distro","../../jetty-distribution/target/distribution");
  SslContextFactory sslContextFactory=new SslContextFactory();
  sslContextFactory.setKeyStorePath(jetty_distro + "/etc/keystore");
  sslContextFactory.setKeyStorePassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
  sslContextFactory.setKeyManagerPassword("OBF:1u2u1wml1z7s1z7a1wnl1u2g");
  HttpConfiguration https_config=new HttpConfiguration(http_config);
  https_config.addCustomizer(new SecureRequestCustomizer());
  HTTP2ServerConnectionFactory h2=new HTTP2ServerConnectionFactory(https_config);
  NegotiatingServerConnectionFactory.checkProtocolNegotiationAvailable();
  ALPNServerConnectionFactory alpn=new ALPNServerConnectionFactory(h2.getProtocol(),http.getDefaultProtocol());
  alpn.setDefaultProtocol(http.getDefaultProtocol());
  SslConnectionFactory ssl=new SslConnectionFactory(sslContextFactory,alpn.getProtocol());
  ServerConnector http2Connector=new ServerConnector(server,ssl,alpn,h2,new HttpConnectionFactory(https_config));
  http2Connector.setPort(8443);
  server.addConnector(http2Connector);
  ALPN.debug=true;
  server.start();
  server.dumpStdErr();
  server.join();
}
