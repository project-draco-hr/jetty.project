{
  Set<StateType> allowedNewStateTypes=__stateTransitions.get(currentState.getType());
  if (currentState.getType() == StateType.WRITING && newState.getType() == StateType.WRITING) {
    throw new WritePendingException();
  }
  if (!allowedNewStateTypes.contains(newState.getType())) {
    logger.debug("StateType update: {} -> {} not allowed",currentState,newState);
    return false;
  }
  return true;
}
