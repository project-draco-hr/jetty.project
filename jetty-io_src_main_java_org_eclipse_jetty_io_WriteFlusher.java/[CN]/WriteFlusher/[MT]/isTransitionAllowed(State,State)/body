{
  Set<StateType> allowedNewStateTypes=__stateTransitions.get(currentState.getType());
  if (currentState.getType() == StateType.WRITING && newState.getType() == StateType.WRITING) {
    logger.debug("WRITE PENDING EXCEPTION");
    throw new WritePendingException();
  }
  if (!allowedNewStateTypes.contains(newState.getType())) {
    logger.debug("{} -> {} not allowed.",currentState.getType(),newState.getType());
    return false;
  }
  return true;
}
