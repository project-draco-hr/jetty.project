{
  if (LOG.isDebugEnabled())   LOG.debug("write: {} {}",this,BufferUtil.toDetailString(buffers));
  if (callback == null)   throw new IllegalArgumentException();
  if (!updateState(__IDLE,__WRITING))   throw new WritePendingException();
  try {
    _endPoint.flush(buffers);
    for (    ByteBuffer b : buffers) {
      if (b.hasRemaining()) {
        PendingState<?> pending=new PendingState<>(buffers,context,callback);
        if (updateState(__WRITING,pending))         onIncompleteFlushed();
 else         fail(new PendingState<>(buffers,context,callback));
        return;
      }
    }
    if (!updateState(__WRITING,__IDLE))     ignoreFail();
    callback.completed(context);
  }
 catch (  IOException e) {
    if (updateState(__WRITING,__IDLE))     callback.failed(context,e);
 else     fail(new PendingState<>(buffers,context,callback));
  }
}
