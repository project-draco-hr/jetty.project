{
  logger.debug("write: starting write. {}",_state);
  if (callback == null)   throw new IllegalArgumentException();
  if (updateState(writingState) == null) {
    callback.failed(context,failure);
    return;
  }
  try {
    _endp.flush(buffers);
    for (    ByteBuffer b : buffers) {
      if (b.hasRemaining()) {
        if (updateState(new PendingState(buffers,context,(Callback<Object>)callback)) == null)         callback.failed(context,failure);
 else         onIncompleteFlushed();
        return;
      }
    }
    updateState(idleState);
    callback.completed(context);
  }
 catch (  IOException e) {
    updateState(failedState);
    callback.failed(context,e);
  }
}
