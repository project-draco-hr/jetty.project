{
  if (callback == null)   throw new IllegalArgumentException();
  logger.debug("write: {}",this);
  if (updateState(writingState) == null) {
    fail(context,callback,failure);
    return;
  }
  try {
    _endPoint.flush(buffers);
    for (    ByteBuffer b : buffers) {
      if (b.hasRemaining()) {
        if (updateState(new PendingState<>(buffers,context,callback)) == null)         fail(context,callback,failure);
 else         onIncompleteFlushed();
        return;
      }
    }
    updateState(idleState);
    callback.completed(context);
  }
 catch (  IOException e) {
    updateState(failedState);
    fail(context,callback,e);
  }
}
