{
  if (callback == null)   throw new IllegalArgumentException();
  if (!_writing.compareAndSet(false,true))   throw new WritePendingException();
  try {
    _endp.flush(buffers);
    for (    ByteBuffer b : buffers) {
      if (b.hasRemaining()) {
        _buffers=buffers;
        _context=context;
        _callback=(Callback<Object>)callback;
        _writing.set(true);
        onIncompleteFlushed();
        return;
      }
    }
    if (!_writing.compareAndSet(true,false))     throw new ConcurrentModificationException();
    callback.completed(context);
  }
 catch (  IOException e) {
    if (!_writing.compareAndSet(true,false))     throw new ConcurrentModificationException(e);
    callback.failed(context,e);
  }
}
