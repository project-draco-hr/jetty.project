{
  if (!_writing.compareAndSet(false,true))   throw new WritePendingException();
  try {
    _endp.flush(buffers);
    for (    ByteBuffer b : buffers) {
      if (b.hasRemaining()) {
        _buffers=buffers;
        _context=context;
        _callback=callback;
        if (canFlush())         completeWrite();
 else         _writing.set(true);
        return;
      }
    }
  }
 catch (  IOException e) {
    if (!_writing.compareAndSet(true,false))     throw new ConcurrentModificationException(e);
    callback.failed(context,e);
    return;
  }
  if (!_writing.compareAndSet(true,false))   throw new ConcurrentModificationException();
  callback.completed(context);
}
