{
  LOG.debug("failed: {} {}",this,cause);
  while (true) {
    State current=_state.get();
switch (current.getType()) {
case IDLE:
case FAILED:
      return;
case PENDING:
    PendingState<?> pending=(PendingState<?>)current;
  if (updateState(pending,__IDLE)) {
    pending.fail(cause);
    return;
  }
break;
default :
if (updateState(current,new FailedState(cause))) return;
break;
}
}
}
