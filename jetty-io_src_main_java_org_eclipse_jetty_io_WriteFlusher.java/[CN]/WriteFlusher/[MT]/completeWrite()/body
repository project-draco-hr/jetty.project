{
  State previous=_state.get();
  PendingState<?> pending=null;
  if (previous.getType() != StateType.PENDING)   return;
  pending=(PendingState<?>)previous;
  if (!updateState(pending,__COMPLETING))   return;
  try {
    ByteBuffer[] buffers=pending.getBuffers();
    _endPoint.flush(buffers);
    for (    ByteBuffer b : buffers) {
      if (b.hasRemaining()) {
        if (updateState(__COMPLETING,pending))         onIncompleteFlushed();
        return;
      }
    }
    if (updateState(__COMPLETING,__IDLE))     pending.complete();
 else     pendingFail(pending);
  }
 catch (  IOException e) {
    if (updateState(__COMPLETING,__IDLE))     pending.fail(e);
 else     pendingFail(pending);
  }
}
