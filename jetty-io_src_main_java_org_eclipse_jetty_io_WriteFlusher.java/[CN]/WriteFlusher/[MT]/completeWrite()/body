{
  if (!isWriting())   return false;
  try {
    retry:     while (true) {
      _buffers=compact(_buffers);
      _endp.flush(_buffers);
      for (      ByteBuffer b : _buffers) {
        if (b.hasRemaining()) {
          if (registerFlushInterest())           continue retry;
          return true;
        }
      }
      break;
    }
    Callback callback=_callback;
    Object context=_context;
    _buffers=null;
    _callback=null;
    _context=null;
    if (!_writing.compareAndSet(true,false))     throw new ConcurrentModificationException();
    callback.completed(context);
  }
 catch (  IOException e) {
    Callback callback=_callback;
    Object context=_context;
    _buffers=null;
    _callback=null;
    _context=null;
    if (!_writing.compareAndSet(true,false))     throw new ConcurrentModificationException();
    callback.failed(context,e);
  }
  return true;
}
