{
  LOG.debug("completeWrite: {}",this);
  State previous=_state.get();
  if (previous.getType() != StateType.PENDING)   return;
  PendingState<?> pending=(PendingState<?>)previous;
  if (!updateState(pending,__COMPLETING))   return;
  try {
    ByteBuffer[] buffers=pending.getBuffers();
    _endPoint.flush(buffers);
    for (    ByteBuffer b : buffers) {
      if (b.hasRemaining()) {
        if (updateState(__COMPLETING,pending))         onIncompleteFlushed();
 else         fail(pending);
        return;
      }
    }
    if (!updateState(__COMPLETING,__IDLE))     ignoreFail();
    pending.complete();
  }
 catch (  IOException e) {
    if (updateState(__COMPLETING,__IDLE))     pending.fail(e);
 else     fail(pending);
  }
}
