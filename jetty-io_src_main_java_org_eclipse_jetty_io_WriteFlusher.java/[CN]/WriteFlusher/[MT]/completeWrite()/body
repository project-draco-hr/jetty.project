{
  State currentState=updateState(completingState);
  if (currentState == null)   return;
  try {
    _endPoint.flush(currentState.getBuffers());
    for (    ByteBuffer b : currentState.getBuffers()) {
      if (b.hasRemaining()) {
        if (updateState(currentState) == null)         currentState.fail(failure);
 else         onIncompleteFlushed();
        return;
      }
    }
    updateState(idleState);
    currentState.complete();
  }
 catch (  IOException e) {
    updateState(failedState);
    currentState.fail(e);
  }
}
