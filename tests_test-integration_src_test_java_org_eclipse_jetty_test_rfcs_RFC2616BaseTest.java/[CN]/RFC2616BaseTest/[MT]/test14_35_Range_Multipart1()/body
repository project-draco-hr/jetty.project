{
  String rangedef="23-23,-2";
  StringBuffer req1=new StringBuffer();
  req1.append("GET /rfc2616-webapp/alpha.txt HTTP/1.1\n");
  req1.append("Host: localhost\n");
  req1.append("Range: ").append(rangedef).append("\n");
  req1.append("Connection: close\n");
  req1.append("\n");
  HttpTester.Response response=http.request(req1);
  String msg="Partial (Byte) Range: '" + rangedef + "'";
  assertEquals(msg,HttpStatus.PARTIAL_CONTENT_206,response.getStatus());
  String contentType=response.get("Content-Type");
  StringAssert.assertContains(msg + " Content-Type",contentType,"multipart/byteranges");
  String boundary=null;
  String parts[]=StringUtil.split(contentType,';');
  for (int i=0; i < parts.length; i++) {
    if (parts[i].trim().startsWith("boundary=")) {
      String boundparts[]=StringUtil.split(parts[i],'=');
      Assert.assertEquals(msg + " Boundary parts.length",2,boundparts.length);
      boundary=boundparts[1];
    }
  }
  Assert.assertNotNull(msg + " Should have found boundary in Content-Type header",boundary);
  List<HttpTester.Response> multiparts=HttpTesting.getParts(boundary,response);
  Assert.assertEquals(msg + " multiparts in body (count)",2,multiparts.size());
  HttpTester.Response multipart1=multiparts.get(0);
  assertEquals(msg + " Multipart 1","text/plain",multipart1.get("Content-Type"));
  assertEquals(msg + " Multipart 1","bytes 23-23/27",multipart1.get("Content-Range"));
  assertTrue(msg + " Multipart 1",multipart1.getContent().contains("X"));
  HttpTester.Response multipart2=multiparts.get(1);
  assertEquals(msg + " Multipart 2","text/plain",multipart2.get("Content-Type"));
  assertEquals(msg + " Multipart 2","bytes 25-26/27",multipart2.get("Content-Range"));
  assertTrue(msg + " Multipart 2",multipart2.getContent().contains("Z\n"));
}
