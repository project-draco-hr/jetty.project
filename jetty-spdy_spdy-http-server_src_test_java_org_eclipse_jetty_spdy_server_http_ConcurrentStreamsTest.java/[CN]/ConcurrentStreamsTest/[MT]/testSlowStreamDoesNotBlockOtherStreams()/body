{
  final CountDownLatch slowServerLatch=new CountDownLatch(1);
  final CountDownLatch fastServerLatch=new CountDownLatch(1);
  final String fastPath="/fast";
  final String slowPath="/slow";
  Session session=startClient(version,startHTTPServer(version,new AbstractHandler(){
    @Override public void handle(    String target,    Request request,    HttpServletRequest httpRequest,    HttpServletResponse httpResponse) throws IOException, ServletException {
      try {
        request.setHandled(true);
switch (target) {
case slowPath:
          Assert.assertTrue(fastServerLatch.await(10,TimeUnit.SECONDS));
        slowServerLatch.countDown();
      break;
case fastPath:
    fastServerLatch.countDown();
  break;
default :
Assert.fail();
break;
}
}
 catch (InterruptedException x) {
throw new ServletException(x);
}
}
}
,30000),null);
Fields headers=createHeaders(slowPath);
final CountDownLatch slowClientLatch=new CountDownLatch(1);
session.syn(new SynInfo(headers,true),new StreamFrameListener.Adapter(){
@Override public void onReply(Stream stream,ReplyInfo replyInfo){
Fields replyHeaders=replyInfo.getHeaders();
Assert.assertTrue(replyHeaders.get(HTTPSPDYHeader.STATUS.name(version)).value().contains("200"));
slowClientLatch.countDown();
}
}
);
headers=createHeaders(fastPath);
final CountDownLatch fastClientLatch=new CountDownLatch(1);
session.syn(new SynInfo(headers,true),new StreamFrameListener.Adapter(){
@Override public void onReply(Stream stream,ReplyInfo replyInfo){
Fields replyHeaders=replyInfo.getHeaders();
Assert.assertTrue(replyHeaders.get(HTTPSPDYHeader.STATUS.name(version)).value().contains("200"));
fastClientLatch.countDown();
}
}
);
Assert.assertTrue(fastServerLatch.await(5,TimeUnit.SECONDS));
Assert.assertTrue(slowServerLatch.await(5,TimeUnit.SECONDS));
Assert.assertTrue(fastClientLatch.await(5,TimeUnit.SECONDS));
Assert.assertTrue(slowClientLatch.await(5,TimeUnit.SECONDS));
}
