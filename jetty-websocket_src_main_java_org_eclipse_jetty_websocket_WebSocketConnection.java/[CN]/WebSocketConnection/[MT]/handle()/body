{
  boolean more=true;
  try {
    while (more) {
      int flushed=_generator.flush();
      int filled=_parser.parseNext();
      more=flushed > 0 || filled > 0 || !_parser.isBufferEmpty() || !_generator.isBufferEmpty();
      if (filled < 0 || flushed < 0)       _endp.close();
    }
  }
 catch (  IOException e) {
    System.err.println(e);
    throw e;
  }
 finally {
    if (!_endp.isOpen())     _websocket.onDisconnect();
  }
}
