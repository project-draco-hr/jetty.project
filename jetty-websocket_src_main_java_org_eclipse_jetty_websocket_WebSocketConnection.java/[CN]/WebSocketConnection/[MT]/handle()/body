{
  boolean progress=true;
  try {
    while (progress) {
      int flushed=_generator.flush();
      int filled=_parser.parseNext();
      progress=flushed > 0 || filled > 0;
      if (filled < 0 || flushed < 0) {
        _endp.close();
        break;
      }
    }
  }
 catch (  IOException e) {
    e.printStackTrace();
    throw e;
  }
 finally {
    if (_endp.isOpen()) {
      _idle.access(_endp);
      checkWriteable();
    }
 else     _websocket.onDisconnect();
  }
  return this;
}
