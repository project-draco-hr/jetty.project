{
  SafariD00 safari=new SafariD00(serverUri);
  try {
    safari.connect();
    safari.issueHandshake();
    safari.sendMessage("aa-0");
    safari.sendMessage("aa-1","aa-2","aa-3","aa-4");
    Assert.assertThat("Servlet.captureSockets.size",servlet.captures.size(),is(1));
    CaptureSocket socket=servlet.captures.get(0);
    Assert.assertThat("CaptureSocket",socket,notNullValue());
    Assert.assertThat("CaptureSocket.isConnected",socket.awaitConnected(10000),is(true));
    for (int i=0; i < 100 && socket.messages.size() < 5; i++)     threadSleep(100,TimeUnit.MILLISECONDS);
    Assert.assertThat("CaptureSocket.messages.size",socket.messages.size(),is(5));
  }
  finally {
    safari.disconnect();
  }
}
