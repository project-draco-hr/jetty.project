{
  if (getContentType() == null || !getContentType().startsWith("multipart/form-data"))   throw new ServletException("Content-Type != multipart/form-data");
  if (_multiPartInputStream == null) {
    MultipartConfigElement config=(MultipartConfigElement)getAttribute(__MULTIPART_CONFIG_ELEMENT);
    if (config == null)     throw new IllegalStateException("No multipart config for servlet");
    _multiPartInputStream=new MultiPartInputStream(getInputStream(),getContentType(),config,(_context != null ? (File)_context.getAttribute("javax.servlet.context.tempdir") : null));
    setAttribute(__MULTIPART_INPUT_STREAM,_multiPartInputStream);
    setAttribute(__MULTIPART_CONTEXT,_context);
    Collection<Part> parts=_multiPartInputStream.getParts();
    for (    Part p : parts) {
      MultiPartInputStream.MultiPart mp=(MultiPartInputStream.MultiPart)p;
      if (mp.getContentDispositionFilename() == null && mp.getFile() == null) {
        String charset=null;
        if (mp.getContentType() != null)         charset=MimeTypes.getCharsetFromContentType(new ByteArrayBuffer(mp.getContentType()));
        String content=new String(mp.getBytes(),charset == null ? StringUtil.__UTF8 : charset);
        getParameter("");
        getParameters().add(mp.getName(),content);
      }
    }
  }
  return _multiPartInputStream.getPart(name);
}
