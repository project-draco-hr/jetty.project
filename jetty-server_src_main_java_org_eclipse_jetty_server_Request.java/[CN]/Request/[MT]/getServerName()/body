{
  if (_serverName != null)   return _serverName;
  if (_uri == null)   throw new IllegalStateException("No uri");
  _serverName=_uri.getHost();
  _port=_uri.getPort();
  if (_serverName != null)   return _serverName;
  String hostPort=_fields.getStringField(HttpHeader.HOST);
  if (hostPort != null) {
    loop:     for (int i=hostPort.length(); i-- > 0; ) {
      char ch=(char)(0xff & hostPort.charAt(i));
switch (ch) {
case ']':
        break loop;
case ':':
      _serverName=hostPort.substring(0,i);
    try {
      _port=StringUtil.toInt(hostPort.substring(i + 1));
    }
 catch (    NumberFormatException e) {
      if (_channel != null)       _channel.commitError(HttpStatus.BAD_REQUEST_400,"Bad Host header",null);
    }
  return _serverName;
}
}
if (_serverName == null || _port < 0) {
_serverName=hostPort;
_port=0;
}
return _serverName;
}
if (_channel != null) {
_serverName=getLocalName();
_port=getLocalPort();
if (_serverName != null && !StringUtil.ALL_INTERFACES.equals(_serverName)) return _serverName;
}
try {
_serverName=InetAddress.getLocalHost().getHostAddress();
}
 catch (java.net.UnknownHostException e) {
LOG.ignore(e);
}
return _serverName;
}
