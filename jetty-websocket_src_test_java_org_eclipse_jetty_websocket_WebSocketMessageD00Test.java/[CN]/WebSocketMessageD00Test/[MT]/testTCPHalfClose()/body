{
  final Socket socket=new Socket("localhost",__connector.getLocalPort());
  socket.setSoTimeout(10000);
  OutputStream output=socket.getOutputStream();
  InputStream input=socket.getInputStream();
  output.write(("GET /test HTTP/1.1\r\n" + "Host: localhost\r\n" + "Upgrade: WebSocket\r\n"+ "Connection: Upgrade\r\n"+ "Sec-WebSocket-Protocol: onConnect\r\n"+ "Sec-WebSocket-Key1: 4 @1  46546xW%0l 1 5\r\n"+ "Sec-WebSocket-Key2: 12998 5 Y3 1  .P00\r\n"+ "\r\n"+ "^n:ds[4U").getBytes("ISO-8859-1"));
  output.flush();
  lookFor("HTTP/1.1 101 WebSocket Protocol Handshake\r\n",input);
  skipTo("\r\n\r\n",input);
  lookFor("8jKS'y:G*Co,Wxa-",input);
  assertTrue(__serverWebSocket.awaitConnected(1000));
  assertNotNull(__serverWebSocket.connection);
  __serverWebSocket.connection.setMaxIdleTime(250);
  assertEquals(0x00,input.read());
  lookFor("sent on connect",input);
  assertEquals(0xff,input.read());
  socket.shutdownOutput();
  assertTrue(__serverWebSocket.awaitDisconnected(500));
  assertEquals(-1,input.read());
  try {
    for (int i=0; i < 1000; i++)     output.write(0);
    Assert.fail();
  }
 catch (  SocketException e) {
  }
}
