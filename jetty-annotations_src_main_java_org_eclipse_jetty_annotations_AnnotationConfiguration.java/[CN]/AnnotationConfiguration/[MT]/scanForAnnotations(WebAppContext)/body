{
  AnnotationParser parser=createAnnotationParser();
  _parserTasks=new ArrayList<ParserTask>();
  long start=0;
  if (LOG.isDebugEnabled()) {
    LOG.debug("Scanning for annotations: webxml={}, metadatacomplete={}, configurationDiscovered={}, multiThreaded={}, maxScanWait={}",context.getServletContext().getEffectiveMajorVersion(),context.getMetaData().isMetaDataComplete(),context.isConfigurationDiscovered(),isUseMultiThreading(context),getMaxScanWait(context));
  }
  parseContainerPath(context,parser);
  parseWebInfClasses(context,parser);
  parseWebInfLib(context,parser);
  if (LOG.isDebugEnabled())   start=System.nanoTime();
  final Semaphore task_limit=(isUseMultiThreading(context) ? new Semaphore(Runtime.getRuntime().availableProcessors()) : new Semaphore(1));
  final CountDownLatch latch=new CountDownLatch(_parserTasks.size());
  final MultiException me=new MultiException();
  for (  final ParserTask p : _parserTasks) {
    task_limit.acquire();
    context.getServer().getThreadPool().execute(new Runnable(){
      @Override public void run(){
        try {
          p.call();
        }
 catch (        Exception e) {
          me.add(e);
        }
 finally {
          task_limit.release();
          latch.countDown();
        }
      }
    }
);
  }
  boolean timeout=!latch.await(getMaxScanWait(context),TimeUnit.SECONDS);
  if (LOG.isDebugEnabled())   LOG.debug("Annotation parsing millisec={}",(TimeUnit.MILLISECONDS.convert(System.nanoTime() - start,TimeUnit.NANOSECONDS)));
  if (timeout)   me.add(new Exception("Timeout scanning annotations"));
  me.ifExceptionThrow();
}
