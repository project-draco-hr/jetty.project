{
  ByteArrayBuffer buffer=new ByteArrayBuffer(1024);
  buffer.put(("GET /demo HTTP/1.1\r\n" + "Host: localhost\r\n" + "Upgrade: WebSocket\r\n"+ "Connection: Upgrade\r\n"+ "\r\n").getBytes(StringUtil.__ISO_8859_1));
  buffer.put((byte)0);
  buffer.put("Hello World".getBytes(StringUtil.__UTF8));
  buffer.put((byte)0xFF);
  ByteArrayBuffer out=_connector.getResponses(buffer,true);
  String response=StringUtil.printable(out.asArray());
  assertTrue(response.startsWith("HTTP/1.1 101 Web Socket Protocol Handshake"));
  assertTrue(response.contains("Upgrade: WebSocket"));
  assertTrue(response.contains("Connection: Upgrade"));
  assertTrue(response.contains("0x00Roger That0xFF"));
  assertEquals("Hello World",_websocket._utf8);
}
