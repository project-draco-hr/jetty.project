{
  byte buf[]=toByteArray("0x82 0x07 0x01 0x01","Hello","0x82 0x05 0x02 0x81","bye","0x82 0x08 0x01 0x80"," world");
  LinkedList<WebSocketFrame> frames=asFrames(buf);
  Assert.assertThat("Frame count",frames.size(),is(3));
  MuxEventCapture capture=parseMuxFrames(frames);
  capture.assertFrameCount(3);
  MuxedFrame mux;
  mux=capture.getFrames().pop();
  String prefix="MuxFrame[0]";
  Assert.assertThat(prefix + ".channelId",mux.getChannelId(),is(1L));
  Assert.assertThat(prefix + ".fin",mux.isFin(),is(false));
  Assert.assertThat(prefix + ".rsv1",mux.isRsv1(),is(false));
  Assert.assertThat(prefix + ".rsv2",mux.isRsv2(),is(false));
  Assert.assertThat(prefix + ".rsv3",mux.isRsv3(),is(false));
  Assert.assertThat(prefix + ".masked",mux.isMasked(),is(false));
  Assert.assertThat(prefix + ".continuation",mux.isContinuation(),is(false));
  Assert.assertThat(prefix + ".opcode",mux.getOpCode(),is(OpCode.TEXT));
  String payload=mux.getPayloadAsUTF8();
  Assert.assertThat(prefix + ".payload/text",payload,is("Hello"));
  mux=capture.getFrames().pop();
  prefix="MuxFrame[1]";
  Assert.assertThat(prefix + ".channelId",mux.getChannelId(),is(2L));
  Assert.assertThat(prefix + ".fin",mux.isFin(),is(true));
  Assert.assertThat(prefix + ".rsv1",mux.isRsv1(),is(false));
  Assert.assertThat(prefix + ".rsv2",mux.isRsv2(),is(false));
  Assert.assertThat(prefix + ".rsv3",mux.isRsv3(),is(false));
  Assert.assertThat(prefix + ".masked",mux.isMasked(),is(false));
  Assert.assertThat(prefix + ".continuation",mux.isContinuation(),is(false));
  Assert.assertThat(prefix + ".opcode",mux.getOpCode(),is(OpCode.TEXT));
  payload=mux.getPayloadAsUTF8();
  Assert.assertThat(prefix + ".payload/text",payload,is("bye"));
  mux=capture.getFrames().pop();
  prefix="MuxFrame[2]";
  Assert.assertThat(prefix + ".channelId",mux.getChannelId(),is(1L));
  Assert.assertThat(prefix + ".fin",mux.isFin(),is(true));
  Assert.assertThat(prefix + ".rsv1",mux.isRsv1(),is(false));
  Assert.assertThat(prefix + ".rsv2",mux.isRsv2(),is(false));
  Assert.assertThat(prefix + ".rsv3",mux.isRsv3(),is(false));
  Assert.assertThat(prefix + ".masked",mux.isMasked(),is(false));
  Assert.assertThat(prefix + ".continuation",mux.isContinuation(),is(true));
  Assert.assertThat(prefix + ".opcode",mux.getOpCode(),is(OpCode.TEXT));
  payload=mux.getPayloadAsUTF8();
  Assert.assertThat(prefix + ".payload/text",payload,is(" world"));
}
