{
  _lock.lock();
  try {
    System.err.println("onReadable");
    _last=System.currentTimeMillis();
    LOG.debug("onReadable {}",this);
    _netReadFuture=null;
    allocateBuffers();
    boolean progress=true;
    while (progress && !_appReadFuture.isDispatched()) {
      progress=false;
      if (!BufferUtil.isFull(_inNet)) {
        int filled=_endp.fill(_inNet);
        LOG.debug("filled {}",filled);
        if (filled > 0)         progress=true;
      }
      progress|=process(null);
    }
  }
 catch (  IOException e) {
    LOG.warn(e);
  }
 finally {
    releaseBuffers();
    if (!_appReadFuture.isComplete() && _netReadFuture == null && !BufferUtil.isFull(_inNet))     _netReadFuture=scheduleOnReadable();
    LOG.debug("!onReadable {} {}",this,_netReadFuture);
    _lock.unlock();
    _appReadFuture.run();
    _appWriteFuture.run();
  }
}
