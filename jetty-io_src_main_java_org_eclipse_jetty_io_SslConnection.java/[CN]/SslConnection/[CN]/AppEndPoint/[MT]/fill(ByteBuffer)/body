{
  int size=buffer.remaining();
  _lock.lock();
  try {
    if (!BufferUtil.hasContent(_inApp))     process(null);
    if (BufferUtil.hasContent(_inApp))     BufferUtil.flipPutFlip(_inApp,buffer);
  }
  finally {
    _lock.unlock();
  }
  int filled=buffer.remaining() - size;
  if (filled == 0 && isInputShutdown())   return -1;
  return filled;
}
