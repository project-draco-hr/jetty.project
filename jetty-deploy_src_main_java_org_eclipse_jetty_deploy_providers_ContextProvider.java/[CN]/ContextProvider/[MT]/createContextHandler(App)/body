{
  Resource resource=Resource.newResource(app.getArchivePath().toURI());
  if (resource.exists() && FileID.isXmlFile(app.getArchivePath())) {
    XmlConfiguration xmlc=new XmlConfiguration(resource.getURL());
    Map<String,Object> props=new HashMap<String,Object>();
    props.put("Server",getDeploymentManager().getServer());
    if (getConfigurationManager() != null)     props.putAll(getConfigurationManager().getProperties());
    xmlc.setProperties(props);
    return (ContextHandler)xmlc.configure();
  }
  throw new IllegalStateException("App resouce does not exist " + resource);
}
