{
  if (_cookies != null) {
    StringBuilder buf=null;
    for (    HttpCookie cookie : _cookies) {
      if (buf == null)       buf=new StringBuilder();
 else       buf.append("; ");
      buf.append(cookie.getName());
      buf.append("=");
      buf.append(cookie.getValue());
    }
    if (buf != null)     ex.addRequestHeader(HttpHeaders.COOKIE,buf.toString());
  }
  if (_authorizations != null) {
    Authentication auth=(Authentication)_authorizations.match(ex.getRequestURI());
    if (auth != null)     (auth).setCredentials(ex);
  }
  ex.scheduleTimeout(this);
  AbstractHttpConnection connection=getIdleConnection();
  if (connection != null) {
    send(connection,ex);
  }
 else {
    boolean startConnection=false;
synchronized (this) {
      if (_exchanges.size() == _maxQueueSize)       throw new RejectedExecutionException("Queue full for address " + _address);
      _exchanges.add(ex);
      if (_connections.size() + _pendingConnections < _maxConnections)       startConnection=true;
    }
    if (startConnection)     startNewConnection();
  }
}
