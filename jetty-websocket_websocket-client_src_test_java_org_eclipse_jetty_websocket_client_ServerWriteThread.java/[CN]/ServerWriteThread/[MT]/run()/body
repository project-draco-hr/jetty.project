{
  final AtomicInteger m=new AtomicInteger();
  try {
    while (m.get() < messageCount) {
      conn.write(new TextFrame().setPayload(message));
      if (exchanger != null) {
        exchanger.exchange(message);
      }
      m.incrementAndGet();
      if (slowness > 0) {
        TimeUnit.MILLISECONDS.sleep(slowness);
      }
    }
  }
 catch (  InterruptedException|IOException e) {
    LOG.warn(e);
  }
}
