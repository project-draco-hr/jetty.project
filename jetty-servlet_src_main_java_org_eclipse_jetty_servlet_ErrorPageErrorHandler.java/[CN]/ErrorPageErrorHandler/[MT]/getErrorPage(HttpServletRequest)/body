{
  String error_page=null;
  Class<?> exClass=(Class<?>)request.getAttribute(RequestDispatcher.ERROR_EXCEPTION_TYPE);
  if (ServletException.class.equals(exClass)) {
    error_page=(String)_errorPages.get(exClass.getName());
    if (error_page == null) {
      Throwable th=(Throwable)request.getAttribute(RequestDispatcher.ERROR_EXCEPTION);
      while (th instanceof ServletException)       th=((ServletException)th).getRootCause();
      if (th != null)       exClass=th.getClass();
    }
  }
  while (error_page == null && exClass != null) {
    error_page=(String)_errorPages.get(exClass.getName());
    exClass=exClass.getSuperclass();
  }
  if (error_page == null) {
    Integer code=(Integer)request.getAttribute(RequestDispatcher.ERROR_STATUS_CODE);
    if (code != null) {
      error_page=(String)_errorPages.get(Integer.toString(code));
      if ((error_page == null) && (_errorPageList != null)) {
        for (int i=0; i < _errorPageList.size(); i++) {
          ErrorCodeRange errCode=(ErrorCodeRange)_errorPageList.get(i);
          if (errCode.isInRange(code)) {
            error_page=errCode.getUri();
            break;
          }
        }
      }
    }
  }
  if (error_page == null) {
    error_page=_errorPages.get(GLOBAL_ERROR_PAGE);
  }
  return error_page;
}
