{
  MetaData.Request metaData=(MetaData.Request)request.getMetaData();
  boolean isHeadRequest=HttpMethod.HEAD.is(metaData.getMethod());
  boolean hasContent=BufferUtil.hasContent(content) && !isHeadRequest;
  boolean sendContent=hasContent || (info == null && lastContent);
  if (info != null) {
    if (commit.compareAndSet(false,true)) {
      boolean endStream=!hasContent && lastContent;
      commit(info,endStream,sendContent ? commitCallback : callback);
    }
 else {
      callback.failed(new IllegalStateException());
    }
  }
  if (sendContent) {
    send(content,lastContent,callback);
  }
}
