{
  MetaData.Request metaData=(MetaData.Request)request.getMetaData();
  boolean isHeadRequest=HttpMethod.HEAD.is(metaData.getMethod());
  boolean hasContent=BufferUtil.hasContent(content) && !isHeadRequest;
  if (commit.compareAndSet(false,true)) {
    boolean endStream=!hasContent && lastContent;
    commit(info,endStream,!hasContent ? callback : commitCallback);
  }
 else {
    callback.failed(new IllegalStateException());
  }
  if (hasContent) {
    send(content,lastContent,callback);
  }
}
