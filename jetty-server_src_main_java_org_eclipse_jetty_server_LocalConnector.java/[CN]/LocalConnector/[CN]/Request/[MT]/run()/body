{
  ByteArrayEndPoint endPoint=new ByteArrayEndPoint(requestsBuffer.asArray(),1024);
  endPoint.setGrowOutput(true);
  HttpConnection connection=new HttpConnection(LocalConnector.this,endPoint,getServer());
  connectionOpened(connection);
  boolean leaveOpen=keepOpen;
  try {
    while (endPoint.getIn().length() > 0)     connection.handle();
  }
 catch (  Exception x) {
    leaveOpen=false;
  }
 finally {
    if (!leaveOpen)     connectionClosed(connection);
    responsesBuffer=endPoint.getOut();
    if (latch != null)     latch.countDown();
  }
}
