{
  if (_in.space() < buf.length()) {
    ByteArrayBuffer n=new ByteArrayBuffer(_in.length() + buf.length());
    n.put(_in);
    _in=n;
    _endp.setIn(_in);
  }
  _in.put(buf);
synchronized (this) {
    _keepOpen=keepOpen;
    _accepting=true;
    this.notify();
    while (_accepting)     this.wait();
  }
  _out=_endp.getOut();
  return _out;
}
