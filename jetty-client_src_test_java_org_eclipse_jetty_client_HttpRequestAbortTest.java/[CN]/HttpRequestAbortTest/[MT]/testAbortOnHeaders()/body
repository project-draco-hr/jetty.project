{
  start(new EmptyServerHandler());
  final CountDownLatch aborted=new CountDownLatch(1);
  try {
    ContentResponse response=client.newRequest("localhost",connector.getLocalPort()).scheme(scheme).onRequestHeaders(new Request.HeadersListener(){
      @Override public void onHeaders(      Request request){
        if (request.abort(null))         aborted.countDown();
      }
    }
).send().get(5,TimeUnit.SECONDS);
    Assert.assertEquals(200,response.getStatus());
    Assert.assertFalse(aborted.await(1,TimeUnit.SECONDS));
  }
 catch (  ExecutionException x) {
    Assert.assertThat(x.getCause(),Matchers.instanceOf(HttpResponseException.class));
    Assert.assertTrue(aborted.await(5,TimeUnit.SECONDS));
  }
}
