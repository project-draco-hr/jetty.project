{
  start(new AbstractHandler(){
    @Override public void handle(    String target,    org.eclipse.jetty.server.Request baseRequest,    HttpServletRequest request,    HttpServletResponse response) throws IOException, ServletException {
      baseRequest.setHandled(true);
      if (!"/done".equals(request.getRequestURI()))       response.sendRedirect("/done");
    }
  }
);
  final Throwable cause=new Exception();
  client.getProtocolHandlers().clear();
  client.getProtocolHandlers().add(new RedirectProtocolHandler(client){
    @Override public void onComplete(    Result result){
      if (!result.isFailed())       result.getRequest().abort(cause);
      super.onComplete(result);
    }
  }
);
  try {
    client.newRequest("localhost",connector.getLocalPort()).scheme(scheme).path("/redirect").timeout(5,TimeUnit.SECONDS).send();
    Assert.fail();
  }
 catch (  ExecutionException x) {
    Assert.assertSame(cause,x.getCause());
  }
}
