{
  if (frame.getType().isControl()) {
    nextOutgoingFrame(frame,callback);
    return;
  }
  int length=frame.getPayloadLength();
  ByteBuffer payload=frame.getPayload().slice();
  int originalLimit=payload.limit();
  int currentPosition=payload.position();
  if (maxLength <= 0) {
    nextOutgoingFrame(frame,callback);
    return;
  }
  boolean continuation=false;
  while (length > maxLength) {
    DataFrame frag=new DataFrame(frame,continuation);
    frag.setFin(false);
    payload.position(currentPosition);
    payload.limit(Math.min(payload.position() + maxLength,originalLimit));
    frag.setPayload(payload);
    nextOutgoingFrame(frag,null);
    length-=maxLength;
    continuation=true;
    currentPosition=payload.limit();
  }
  DataFrame frag=new DataFrame(frame,continuation);
  frag.setFin(frame.isFin());
  payload.position(currentPosition);
  payload.limit(originalLimit);
  frag.setPayload(payload);
  nextOutgoingFrame(frag,callback);
}
