{
  Log.getLog().setDebugEnabled(false);
  ((StdErrLog)Log.getLog()).setSource(false);
  String jetty_root="..";
  Server server=new Server();
  server.setSendDateHeader(true);
  MBeanContainer mbContainer=new MBeanContainer(ManagementFactory.getPlatformMBeanServer());
  server.getContainer().addEventListener(mbContainer);
  server.addBean(mbContainer);
  mbContainer.addBean(Log.getLog());
  QueuedThreadPool threadPool=new QueuedThreadPool();
  threadPool.setMaxThreads(100);
  server.setThreadPool(threadPool);
  SelectChannelConnector connector0=new SelectChannelConnector();
  connector0.setPort(8080);
  connector0.setMaxIdleTime(30000);
  connector0.setConfidentialPort(8443);
  connector0.setUseDirectBuffers(true);
  server.addConnector(connector0);
  SelectChannelConnector connector1=new SelectChannelConnector();
  connector1.setPort(8081);
  connector1.setMaxIdleTime(30000);
  connector1.setConfidentialPort(8443);
  connector1.setUseDirectBuffers(false);
  server.addConnector(connector1);
  SocketConnector connector2=new SocketConnector();
  connector2.setPort(8082);
  connector2.setMaxIdleTime(30000);
  connector2.setConfidentialPort(8443);
  server.addConnector(connector2);
  BlockingChannelConnector connector3=new BlockingChannelConnector();
  connector3.setPort(8083);
  connector3.setMaxIdleTime(30000);
  connector3.setConfidentialPort(8443);
  server.addConnector(connector3);
  SslSelectChannelConnector ssl_connector=new SslSelectChannelConnector();
  ssl_connector.setPort(8443);
  SslContextFactory cf=ssl_connector.getSslContextFactory();
  cf.setKeyStore(jetty_root + "/jetty-server/src/main/config/etc/keystore");
  cf.setKeyStorePassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
  cf.setKeyManagerPassword("OBF:1u2u1wml1z7s1z7a1wnl1u2g");
  cf.setTrustStore(jetty_root + "/jetty-server/src/main/config/etc/keystore");
  cf.setTrustStorePassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
  server.addConnector(ssl_connector);
  HandlerCollection handlers=new HandlerCollection();
  ContextHandlerCollection contexts=new ContextHandlerCollection();
  RequestLogHandler requestLogHandler=new RequestLogHandler();
  handlers.setHandlers(new Handler[]{contexts,new DefaultHandler(),requestLogHandler});
  RestartHandler restart=new RestartHandler();
  restart.setHandler(handlers);
  server.setHandler(restart);
  HashLoginService login=new HashLoginService();
  login.setName("Test Realm");
  login.setConfig(jetty_root + "/test-jetty-webapp/src/main/config/etc/realm.properties");
  server.addBean(login);
  File log=File.createTempFile("jetty-yyyy_mm_dd","log");
  NCSARequestLog requestLog=new NCSARequestLog(log.toString());
  requestLog.setExtended(false);
  requestLogHandler.setRequestLog(requestLog);
  server.setStopAtShutdown(true);
  server.setSendServerVersion(true);
  WebAppContext webapp=new WebAppContext();
  webapp.setParentLoaderPriority(true);
  webapp.setResourceBase("./src/main/webapp");
  webapp.setAttribute("testAttribute","testValue");
  File sessiondir=File.createTempFile("sessions",null);
  if (sessiondir.exists())   sessiondir.delete();
  sessiondir.mkdir();
  sessiondir.deleteOnExit();
  ((HashSessionManager)webapp.getSessionHandler().getSessionManager()).setStoreDirectory(sessiondir);
  ((HashSessionManager)webapp.getSessionHandler().getSessionManager()).setSavePeriod(10);
  contexts.addHandler(webapp);
  server.start();
  server.join();
}
