{
  TestHttpExchange exchange=new TestHttpExchange(){
    @Override boolean setStatus(    int status){
      int oldStatus=getStatus();
      boolean set=super.setStatus(status);
      if (oldStatus == STATUS_START && getStatus() == HttpExchange.STATUS_WAITING_FOR_CONNECTION)       cancel();
      return set;
    }
  }
;
  exchange.setAddress(newAddress());
  exchange.setRequestURI("/");
  getHttpClient().send(exchange);
  int status=exchange.waitForDone();
  assertEquals(HttpExchange.STATUS_CANCELLED,status);
  assertFalse(exchange.isResponseCompleted());
  assertFalse(exchange.isFailed());
  assertFalse(exchange.isAssociated());
}
