{
  if (_class == null)   throw new UnavailableException("Servlet Not Initialized");
  Servlet servlet=_servlet;
synchronized (this) {
    if (!isStarted())     throw new UnavailableException("Servlet not initialized",-1);
    if (_unavailable != 0 || !_initOnStartup)     servlet=getServlet();
    if (servlet == null)     throw new UnavailableException("Could not instantiate " + _class);
  }
  boolean servlet_error=true;
  Object old_run_as=null;
  boolean suspendable=baseRequest.isAsyncSupported();
  try {
    if (_forcedPath != null)     request.setAttribute("org.apache.catalina.jsp_file",_forcedPath);
    if (_identityService != null)     old_run_as=_identityService.setRunAs(baseRequest.getResolvedUserIdentity(),_runAsToken);
    if (!isAsyncSupported())     baseRequest.setAsyncSupported(false);
    MultipartConfigElement mpce=((Registration)getRegistration()).getMultipartConfig();
    if (mpce != null)     request.setAttribute(Request.__MULTIPART_CONFIG_ELEMENT,mpce);
    servlet.service(request,response);
    servlet_error=false;
  }
 catch (  UnavailableException e) {
    makeUnavailable(e);
    throw _unavailableEx;
  }
 finally {
    baseRequest.setAsyncSupported(suspendable);
    if (_identityService != null)     _identityService.unsetRunAs(old_run_as);
    if (servlet_error)     request.setAttribute("javax.servlet.error.servlet_name",getName());
  }
}
