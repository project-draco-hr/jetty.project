{
  Object old_run_as=null;
  try {
    if (_servlet == null)     _servlet=newInstance();
    if (_config == null)     _config=new Config();
    if (_identityService != null) {
      old_run_as=_identityService.setRunAs(_identityService.getSystemUserIdentity(),_runAsToken);
    }
    if (isJspServlet(_servlet)) {
      ContextHandler ch=((ContextHandler.Context)getServletHandler().getServletContext()).getContextHandler();
      ch.setAttribute("org.apache.catalina.jsp_classpath",ch.getClassPath());
      setInitParameter("com.sun.appserv.jsp.classpath",Loader.getClassPath(ch.getClassLoader()));
      if ("?".equals(getInitParameter("classpath"))) {
        String classpath=ch.getClassPath();
        LOG.debug("classpath=" + classpath);
        if (classpath != null)         setInitParameter("classpath",classpath);
      }
    }
    _servlet.init(_config);
  }
 catch (  UnavailableException e) {
    makeUnavailable(e);
    _servlet=null;
    _config=null;
    throw e;
  }
catch (  ServletException e) {
    makeUnavailable(e.getCause() == null ? e : e.getCause());
    _servlet=null;
    _config=null;
    throw e;
  }
catch (  Exception e) {
    makeUnavailable(e);
    _servlet=null;
    _config=null;
    throw new ServletException(this.toString(),e);
  }
 finally {
    if (_identityService != null)     _identityService.unsetRunAs(old_run_as);
  }
}
