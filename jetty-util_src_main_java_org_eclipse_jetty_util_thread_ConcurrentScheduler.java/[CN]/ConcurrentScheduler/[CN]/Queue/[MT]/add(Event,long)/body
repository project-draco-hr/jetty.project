{
  if (event.compareAndSet(State.NEW,State.DELAYED)) {
    while (true) {
      QNode prev=_tail.prev();
      if (prev != null) {
        QNode node=new QNode(event,dequeue_at,prev,_tail);
        if (prev.compareAndSet(_tail,node)) {
          _tail._prev=node;
          event._node=node;
          return;
        }
      }
    }
  }
 else   throw new IllegalStateException();
}
