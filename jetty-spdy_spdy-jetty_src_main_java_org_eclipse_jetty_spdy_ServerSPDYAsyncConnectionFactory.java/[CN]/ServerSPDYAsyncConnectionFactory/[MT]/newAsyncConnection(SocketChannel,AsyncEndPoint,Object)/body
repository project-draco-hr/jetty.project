{
  CompressionFactory compressionFactory=new StandardCompressionFactory();
  Parser parser=new Parser(compressionFactory.newDecompressor());
  Generator generator=new Generator(bufferPool,compressionFactory.newCompressor());
  ServerSessionFrameListener listener=this.listener;
  if (listener == null)   listener=newServerSessionFrameListener(endPoint,attachment);
  SPDYServerConnector connector=(SPDYServerConnector)attachment;
  SPDYAsyncConnection connection=new ServerSPDYAsyncConnection(endPoint,bufferPool,parser,listener,connector);
  endPoint.setAsyncConnection(connection);
  final StandardSession session=new StandardSession(version,bufferPool,threadPool,scheduler,connection,connection,2,listener,generator);
  parser.addListener(session);
  connection.setSession(session);
  connector.sessionOpened(session);
  return connection;
}
