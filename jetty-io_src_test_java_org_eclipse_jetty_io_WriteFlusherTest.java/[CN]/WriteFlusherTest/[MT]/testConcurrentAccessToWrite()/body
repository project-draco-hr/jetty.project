{
  ExecutorService executor=Executors.newFixedThreadPool(16);
  final CountDownLatch writeCalledLatch=new CountDownLatch(2);
  final WriteFlusher writeFlusher=new WriteFlusher(_endPointMock){
    @Override protected void onIncompleteFlushed(){
    }
  }
;
  endPointFlushExpectation(writeCalledLatch);
  executor.submit(new Writer(writeFlusher,new FutureCallback()));
  try {
    executor.submit(new Writer(writeFlusher,new FutureCallback())).get();
  }
 catch (  ExecutionException e) {
    throw e.getCause();
  }
}
