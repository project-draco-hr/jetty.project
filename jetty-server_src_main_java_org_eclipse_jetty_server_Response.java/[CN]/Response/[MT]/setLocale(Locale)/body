{
  if (locale == null || isCommitted() || _channel.isIncluding())   return;
  _locale=locale;
  _fields.put(HttpHeader.CONTENT_LANGUAGE,locale.toString().replace('_','-'));
  if (_outputState != Output.NONE)   return;
  if (_channel.getRequest().getContext() == null)   return;
  String charset=_channel.getRequest().getContext().getContextHandler().getLocaleEncoding(locale);
  if (charset != null && charset.length() > 0 && _characterEncoding == null)   setCharacterEncoding(charset);
}
