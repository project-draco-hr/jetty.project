{
  if (isIncluding())   return;
  if (_outputType == OutputType.NONE && !isCommitted()) {
    if (encoding == null) {
      _explicitEncoding=false;
      if (_characterEncoding != null) {
        _characterEncoding=null;
        if (_contentType != null) {
          _contentType=MimeTypes.getContentTypeWithoutCharset(_contentType);
          HttpField field=HttpParser.CONTENT_TYPE.get(_contentType);
          if (field != null)           _fields.put(field);
 else           _fields.put(HttpHeader.CONTENT_TYPE,_contentType);
        }
      }
    }
 else {
      _explicitEncoding=explicit;
      _characterEncoding=StringUtil.normalizeCharset(encoding);
      if (_contentType != null) {
        _contentType=MimeTypes.getContentTypeWithoutCharset(_contentType) + ";charset=" + _characterEncoding;
        HttpField field=HttpParser.CONTENT_TYPE.get(_contentType);
        if (field != null)         _fields.put(field);
 else         _fields.put(HttpHeader.CONTENT_TYPE,_contentType);
      }
    }
  }
}
