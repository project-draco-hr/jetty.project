{
  if (_outputType == OutputType.STREAM)   throw new IllegalStateException("STREAM");
  if (_writer == null) {
    String encoding=_characterEncoding;
    if (encoding == null) {
      encoding=MimeTypes.inferCharsetFromContentType(_contentType);
      if (encoding == null)       encoding=StringUtil.__ISO_8859_1;
      setCharacterEncoding(encoding);
    }
    if (StringUtil.__ISO_8859_1.equalsIgnoreCase(encoding)) {
      _writer=new PrintWriter(new Iso88591HttpWriter(_out));
    }
 else     if (StringUtil.__UTF8.equalsIgnoreCase(encoding)) {
      _writer=new PrintWriter(new Utf8HttpWriter(_out));
    }
 else {
      _writer=new PrintWriter(new EncodingHttpWriter(_out,encoding));
    }
    _outputType=OutputType.WRITER;
  }
  return _writer;
}
