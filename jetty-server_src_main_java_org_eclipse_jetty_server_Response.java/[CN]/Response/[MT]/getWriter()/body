{
  if (_outputState != NONE && _outputState != WRITER)   throw new IllegalStateException("STREAM");
  if (_writer == null) {
    String encoding=_characterEncoding;
    if (encoding == null) {
      if (_cachedMimeType != null)       encoding=MimeTypes.getCharsetFromContentType(_cachedMimeType);
      if (encoding == null)       encoding=StringUtil.__ISO_8859_1;
      setCharacterEncoding(encoding);
    }
    _writer=_connection.getPrintWriter(encoding);
  }
  _outputState=WRITER;
  return _writer;
}
