{
  if (isCommitted() || isIncluding())   return;
  if (contentType == null) {
    if (isWriting() && _characterEncoding != null)     throw new IllegalSelectorException();
    if (_locale == null)     _characterEncoding=null;
    _mimeType=null;
    _contentType=null;
    _fields.remove(HttpHeader.CONTENT_TYPE);
  }
 else {
    _contentType=contentType;
    _mimeType=MimeTypes.CACHE.get(contentType);
    String charset;
    if (_mimeType != null && _mimeType.getCharset() != null)     charset=_mimeType.getCharset().toString();
 else     charset=MimeTypes.getCharsetFromContentType(contentType);
    if (charset == null) {
      if (_characterEncoding != null) {
        _contentType=contentType + ";charset=" + _characterEncoding;
        _mimeType=null;
      }
    }
 else     if (isWriting() && !charset.equals(_characterEncoding)) {
      _mimeType=null;
      _contentType=MimeTypes.getContentTypeWithoutCharset(_contentType);
      if (_characterEncoding != null)       _contentType=_contentType + ";charset=" + _characterEncoding;
    }
 else {
      _characterEncoding=charset;
    }
    HttpField field=HttpField.CONTENT_TYPE.get(_contentType);
    if (field != null)     _fields.put(field);
 else     _fields.put(HttpHeader.CONTENT_TYPE,_contentType);
  }
}
