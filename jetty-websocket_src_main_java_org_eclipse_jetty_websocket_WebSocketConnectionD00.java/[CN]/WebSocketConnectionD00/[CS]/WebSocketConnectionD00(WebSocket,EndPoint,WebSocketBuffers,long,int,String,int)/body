{
  super(endpoint,timestamp);
  if (endpoint instanceof AsyncEndPoint)   ((AsyncEndPoint)endpoint).cancelIdle();
  _endp.setMaxIdleTime(maxIdleTime);
  _websocket=websocket;
  _protocol=protocol;
switch (draft) {
case 1:
    _generator=new WebSocketGeneratorD01(buffers,_endp);
  _parser=new WebSocketParserD01(buffers,endpoint,new FrameHandlerD1(_websocket));
break;
default :
_generator=new WebSocketGeneratorD00(buffers,_endp);
_parser=new WebSocketParserD00(buffers,endpoint,new FrameHandlerD0(_websocket));
}
if (_endp instanceof SelectChannelEndPoint) {
final SelectChannelEndPoint scep=(SelectChannelEndPoint)_endp;
scep.cancelIdle();
_idle=new IdleCheck(){
public void access(EndPoint endp){
scep.scheduleIdle();
}
}
;
scep.scheduleIdle();
}
 else {
_idle=new IdleCheck(){
public void access(EndPoint endp){
}
}
;
}
}
