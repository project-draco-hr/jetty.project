{
  HTTP2ServerConnection connection=(HTTP2ServerConnection)super.newConnection(connector,endPoint,attachment);
  if (attachment instanceof MetaData.Request) {
    MetaData.Request request=(MetaData.Request)attachment;
    if (LOG.isDebugEnabled())     LOG.debug("{} upgraded {}",this,request.toString() + request.getFields());
    String value=request.getFields().getField(HttpHeader.HTTP2_SETTINGS).getValue();
    final byte[] settings=B64Code.decodeRFC4648URL(value);
    if (LOG.isDebugEnabled())     LOG.debug("{} settings {}",this,TypeUtil.toHexString(settings));
    SettingsFrame frame=SettingsBodyParser.parseBody(BufferUtil.toBuffer(settings));
    if (frame == null)     throw new IllegalArgumentException(String.format("Invalid %s header value: %s",HttpHeader.HTTP2_SETTINGS,value));
    HTTP2Session session=(HTTP2Session)connection.getSession();
    session.onSettings(frame,false);
  }
  return connection;
}
