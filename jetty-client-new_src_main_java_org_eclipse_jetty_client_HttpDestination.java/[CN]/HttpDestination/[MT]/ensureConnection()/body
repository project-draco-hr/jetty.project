{
  int maxConnections=client.getMaxConnectionsPerAddress();
  while (true) {
    int count=connectionCount.get();
    if (count >= maxConnections)     break;
    if (connectionCount.compareAndSet(count,count + 1)) {
      newConnection(new Callback<Connection>(){
        @Override public void completed(        Connection connection){
          dispatch(connection);
        }
        @Override public void failed(        Connection connection,        Throwable x){
        }
      }
);
      break;
    }
  }
}
