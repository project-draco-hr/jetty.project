{
  boolean beenOpened=opened.getAndSet(true);
  if (!beenOpened) {
    WebSocketSession session=getSession();
    ConnectionManager connectionManager=connectPromise.getClient().getConnectionManager();
    connectionManager.addSession(session);
    connectPromise.succeeded(session);
    ByteBuffer extraBuf=connectPromise.getResponse().getRemainingBuffer();
    setInitialBuffer(extraBuf);
    if (extraBuf.hasRemaining()) {
      LOG.debug("Parsing extra remaining buffer from UpgradeConnection");
      getParser().parse(extraBuf);
    }
  }
  super.onOpen();
}
