{
  AnnotationParser oparser=(AnnotationParser)parser;
  Bundle webbundle=(Bundle)context.getAttribute(OSGiWebappConstants.JETTY_OSGI_BUNDLE);
  Bundle[] fragAndRequiredBundles=PackageAdminServiceTracker.INSTANCE.getFragmentsAndRequiredBundles(webbundle);
  if (fragAndRequiredBundles != null) {
    for (    Bundle bundle : fragAndRequiredBundles) {
      Resource bundleRes=oparser.indexBundle(bundle);
      if (!context.getMetaData().getWebInfJars().contains(bundleRes)) {
        context.getMetaData().addWebInfJar(bundleRes);
      }
    }
    for (    Bundle fragmentBundle : fragAndRequiredBundles) {
      if (fragmentBundle.getHeaders().get(Constants.FRAGMENT_HOST) != null) {
        parseFragmentBundle(context,oparser,webbundle,fragmentBundle);
      }
    }
  }
  parseWebBundle(context,oparser,webbundle);
  super.parseWebInfLib(context,parser);
  if (fragAndRequiredBundles != null) {
    for (    Bundle requiredBundle : fragAndRequiredBundles) {
      if (requiredBundle.getHeaders().get(Constants.FRAGMENT_HOST) == null) {
        parseRequiredBundle(context,oparser,webbundle,requiredBundle);
      }
    }
  }
}
