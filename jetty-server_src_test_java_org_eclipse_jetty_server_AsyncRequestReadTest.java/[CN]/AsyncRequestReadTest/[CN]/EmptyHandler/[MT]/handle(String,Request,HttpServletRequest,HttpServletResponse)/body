{
  final Continuation continuation=ContinuationSupport.getContinuation(request);
  httpResponse.setStatus(500);
  request.setHandled(true);
  new Thread(){
    @Override public void run(){
      try {
        InputStream in=request.getInputStream();
        byte[] b=new byte[4 * 4096];
        int read;
        while ((read=in.read(b)) >= 0)         total+=read;
      }
 catch (      Exception e) {
        e.printStackTrace();
        total=-1;
      }
 finally {
        httpResponse.setStatus(200);
        continuation.complete();
      }
    }
  }
.start();
  continuation.suspend();
}
