{
  total=0;
  final Socket socket=new Socket("localhost",connector.getLocalPort());
  byte[] content=new byte[16 * 4096];
  Arrays.fill(content,(byte)120);
  OutputStream out=socket.getOutputStream();
  out.write("POST / HTTP/1.1\r\n".getBytes());
  out.write("Host: localhost\r\n".getBytes());
  out.write(("Content-Length: " + content.length + "\r\n").getBytes());
  out.write("Content-Type: bytes\r\n".getBytes());
  out.write("Connection: close\r\n".getBytes());
  out.write("\r\n".getBytes());
  out.flush();
  out.write(content,0,4 * 4096);
  Thread.sleep(100);
  out.write(content,8192,4 * 4096);
  Thread.sleep(100);
  out.write(content,8 * 4096,content.length - 8 * 4096);
  out.flush();
  InputStream in=socket.getInputStream();
  String response=IO.toString(in);
  assertTrue(response.indexOf("200 OK") > 0);
  assertEquals(content.length,total);
}
