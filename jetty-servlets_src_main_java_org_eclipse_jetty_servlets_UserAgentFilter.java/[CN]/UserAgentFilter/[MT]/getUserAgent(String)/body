{
  if (ua == null)   return null;
  String tag=_agentCache.get(ua);
  if (tag == null) {
    if (_pattern != null) {
      Matcher matcher=_pattern.matcher(ua);
      if (matcher.matches()) {
        if (matcher.groupCount() > 0) {
          for (int g=1; g <= matcher.groupCount(); g++) {
            String group=matcher.group(g);
            if (group != null)             tag=tag == null ? group : tag + group;
          }
        }
 else {
          tag=matcher.group();
        }
      }
    }
    if (tag == null)     tag=ua;
    if (_agentCache.size() >= _agentCacheSize)     _agentCache.clear();
    _agentCache.put(ua,tag);
  }
  return tag;
}
