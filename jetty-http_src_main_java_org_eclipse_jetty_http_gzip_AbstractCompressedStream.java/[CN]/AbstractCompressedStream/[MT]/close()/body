{
  if (_closed)   return;
  if (_request.getAttribute("javax.servlet.include.request_uri") != null)   flush();
 else {
    if (_bOut != null) {
      if (_contentLength < 0)       _contentLength=_bOut.getCount();
      if (_contentLength < _minCompressSize)       doNotCompress();
 else       doCompress();
    }
 else     if (_out == null) {
      doNotCompress();
    }
    if (_compressedOutputStream != null)     _compressedOutputStream.close();
 else     _out.close();
    _closed=true;
  }
}
