{
  if (_compressedOutputStream == null) {
    if (_response.isCommitted())     throw new IllegalStateException();
    setHeader("Content-Encoding",_encoding);
    if (_response.containsHeader("Content-Encoding")) {
      _out=_compressedOutputStream=createStream();
      if (_bOut != null) {
        _out.write(_bOut.getBuf(),0,_bOut.getCount());
        _bOut=null;
      }
    }
 else     doNotCompress();
  }
}
