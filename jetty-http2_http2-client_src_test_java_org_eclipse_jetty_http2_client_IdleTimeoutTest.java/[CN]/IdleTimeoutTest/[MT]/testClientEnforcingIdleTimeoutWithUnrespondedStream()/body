{
  final CountDownLatch closeLatch=new CountDownLatch(1);
  startServer(new ServerSessionListener.Adapter(){
    @Override public void onClose(    Session session,    GoAwayFrame frame){
      closeLatch.countDown();
    }
  }
);
  client.setIdleTimeout(idleTimeout);
  Session session=newClient(new Session.Listener.Adapter());
  MetaData.Request metaData=newRequest("GET",new HttpFields());
  HeadersFrame requestFrame=new HeadersFrame(0,metaData,null,true);
  session.newStream(requestFrame,new Promise.Adapter<Stream>(),new Stream.Listener.Adapter());
  Assert.assertTrue(closeLatch.await(2 * idleTimeout,TimeUnit.MILLISECONDS));
}
