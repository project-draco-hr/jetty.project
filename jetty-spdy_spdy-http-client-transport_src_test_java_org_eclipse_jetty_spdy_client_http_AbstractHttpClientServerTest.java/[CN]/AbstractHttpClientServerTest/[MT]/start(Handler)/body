{
  short version=SPDY.V3;
  HTTPSPDYServerConnectionFactory httpSPDY=new HTTPSPDYServerConnectionFactory(version,new HttpConfiguration());
  if (sslContextFactory != null) {
    sslContextFactory.setEndpointIdentificationAlgorithm("");
    sslContextFactory.setKeyStorePath("src/test/resources/keystore.jks");
    sslContextFactory.setKeyStorePassword("storepwd");
    sslContextFactory.setTrustStorePath("src/test/resources/truststore.jks");
    sslContextFactory.setTrustStorePassword("storepwd");
  }
  server=new Server();
  connector=new ServerConnector(server,AbstractConnectionFactory.getFactories(sslContextFactory,httpSPDY));
  server.addConnector(connector);
  server.setHandler(handler);
  server.start();
  QueuedThreadPool executor=new QueuedThreadPool();
  executor.setName(executor.getName() + "-client");
  factory=new SPDYClient.Factory(executor);
  factory.start();
  client=new HttpClient(new HttpClientTransportOverSPDY(factory.newSPDYClient(version)),sslContextFactory);
  client.setExecutor(executor);
  client.start();
}
