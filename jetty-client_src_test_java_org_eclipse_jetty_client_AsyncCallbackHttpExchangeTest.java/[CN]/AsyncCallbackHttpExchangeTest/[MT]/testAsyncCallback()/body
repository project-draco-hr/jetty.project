{
  ExecutorService executor=Executors.newCachedThreadPool();
  try {
    AtomicReference<Exception> failure=new AtomicReference<Exception>();
    TestHttpExchange exchange=new TestHttpExchange(executor,failure);
    exchange.setStatus(HttpExchange.STATUS_WAITING_FOR_COMMIT);
    exchange.setStatus(HttpExchange.STATUS_SENDING_REQUEST);
    exchange.setStatus(HttpExchange.STATUS_WAITING_FOR_RESPONSE);
    assertNull(failure.get());
  }
  finally {
    executor.shutdown();
  }
}
