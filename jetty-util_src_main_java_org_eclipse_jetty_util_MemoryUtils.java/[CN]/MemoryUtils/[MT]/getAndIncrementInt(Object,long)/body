{
  while (true) {
    int current=volatileGetInt(array,offset);
    int next=current + 1;
    if (compareAndSetInt(array,offset,current,next))     return current;
  }
}
