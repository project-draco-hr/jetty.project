{
  EndPoint endPoint=getEndPoint();
  try {
    while (true) {
      int filled=endPoint.fill(buffer);
      if (filled == 0) {
        return true;
      }
 else       if (filled < 0) {
        LOG.warn("read - EOF Reached");
        failUpgrade(new EOFException("Reading WebSocket Upgrade response"));
        return false;
      }
 else {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Filled {} bytes - {}",filled,BufferUtil.toDetailString(buffer));
        }
        ClientUpgradeResponse resp=(ClientUpgradeResponse)parser.parse(buffer);
        if (resp != null) {
          validateResponse(resp);
          notifyConnect(resp);
          upgradeConnection(resp);
          if (buffer.hasRemaining()) {
            LOG.debug("Has remaining client bytebuffer of {}",buffer.remaining());
          }
          return false;
        }
      }
    }
  }
 catch (  IOException|ParseException e) {
    UpgradeException ue=new UpgradeException(request.getRequestURI(),e);
    connectPromise.failed(ue);
    disconnect(false);
    return false;
  }
catch (  UpgradeException e) {
    connectPromise.failed(e);
    disconnect(false);
    return false;
  }
}
