{
  startServer(new WebSocket.OnTextMessage(){
    private Connection connection;
    @Override public void onClose(    int closeCode,    String message){
    }
    @Override public void onMessage(    String data){
      try {
        connection.sendMessage(data);
      }
 catch (      IOException x) {
        x.printStackTrace();
      }
    }
    @Override public void onOpen(    Connection connection){
      this.connection=connection;
    }
  }
);
  int count=1000;
  final CountDownLatch clientLatch=new CountDownLatch(count);
  startClient(new WebSocket.OnTextMessage(){
    @Override public void onClose(    int closeCode,    String message){
    }
    @Override public void onMessage(    String data){
      clientLatch.countDown();
    }
    @Override public void onOpen(    Connection connection){
    }
  }
);
  char[] chars=new char[256];
  Arrays.fill(chars,'x');
  String message=new String(chars);
  for (int i=0; i < count; ++i) {
    _connection.sendMessage(message);
  }
  Assert.assertTrue(clientLatch.await(20,TimeUnit.SECONDS));
  TimeUnit.SECONDS.sleep(1);
}
