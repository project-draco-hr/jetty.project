{
  final String message="message";
  final CountDownLatch serverLatch=new CountDownLatch(1);
  startServer(new WebSocketAdapter(){
    private Session session;
    @Override public void onWebSocketConnect(    Session session){
      this.session=session;
    }
    @Override public void onWebSocketText(    String message){
      Assert.assertEquals(message,message);
      session.getRemote().sendStringByFuture(message);
      serverLatch.countDown();
    }
  }
);
  final CountDownLatch clientLatch=new CountDownLatch(1);
  startClient(new WebSocketAdapter(){
    @Override public void onWebSocketText(    String data){
      Assert.assertEquals(message,data);
      clientLatch.countDown();
    }
  }
);
  _connection.write(message);
  Assert.assertTrue(serverLatch.await(5,TimeUnit.SECONDS));
  Assert.assertTrue(clientLatch.await(5,TimeUnit.SECONDS));
}
