{
  final String message="message";
  final CountDownLatch serverLatch=new CountDownLatch(1);
  startServer(new WebSocket.OnTextMessage(){
    private Connection connection;
    @Override public void onClose(    int closeCode,    String message){
    }
    @Override public void onMessage(    String data){
      try {
        Assert.assertEquals(message,data);
        connection.sendMessage(data);
        serverLatch.countDown();
      }
 catch (      IOException x) {
        x.printStackTrace();
      }
    }
    @Override public void onOpen(    Connection connection){
      this.connection=connection;
    }
  }
);
  final CountDownLatch clientLatch=new CountDownLatch(1);
  startClient(new WebSocket.OnTextMessage(){
    @Override public void onClose(    int closeCode,    String message){
    }
    @Override public void onMessage(    String data){
      Assert.assertEquals(message,data);
      clientLatch.countDown();
    }
    @Override public void onOpen(    Connection connection){
    }
  }
);
  _connection.sendMessage(message);
  Assert.assertTrue(serverLatch.await(5,TimeUnit.SECONDS));
  Assert.assertTrue(clientLatch.await(5,TimeUnit.SECONDS));
}
