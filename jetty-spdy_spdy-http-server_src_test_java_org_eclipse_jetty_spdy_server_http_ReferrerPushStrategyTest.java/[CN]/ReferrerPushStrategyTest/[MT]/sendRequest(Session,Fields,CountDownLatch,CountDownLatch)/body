{
  final CountDownLatch dataReceivedLatch=new CountDownLatch(1);
  final CountDownLatch received200OKLatch=new CountDownLatch(1);
  session.syn(new SynInfo(requestHeaders,true),new StreamFrameListener.Adapter(){
    @Override public StreamFrameListener onPush(    Stream stream,    PushInfo pushInfo){
      if (pushSynHeadersValid != null)       validateHeaders(pushInfo.getHeaders(),pushSynHeadersValid);
      assertThat("Stream is unidirectional",stream.isUnidirectional(),is(true));
      assertThat("URI header ends with css",pushInfo.getHeaders().get(HTTPSPDYHeader.URI.name(version)).value().endsWith("" + ".css"),is(true));
      stream.getSession().rst(new RstInfo(stream.getId(),StreamStatus.REFUSED_STREAM),new Callback.Adapter());
      return new StreamFrameListener.Adapter(){
        @Override public void onData(        Stream stream,        DataInfo dataInfo){
          dataInfo.consume(dataInfo.length());
          pushDataLatch.countDown();
        }
      }
;
    }
    @Override public void onReply(    Stream stream,    ReplyInfo replyInfo){
      if ("200 OK".equals(replyInfo.getHeaders().get(HTTPSPDYHeader.STATUS.name(version)).value()))       received200OKLatch.countDown();
      super.onReply(stream,replyInfo);
    }
    @Override public void onData(    Stream stream,    DataInfo dataInfo){
      dataInfo.consume(dataInfo.length());
      if (dataInfo.isClose())       dataReceivedLatch.countDown();
    }
  }
,new Promise.Adapter<Stream>());
  Assert.assertTrue(received200OKLatch.await(5,TimeUnit.SECONDS));
  Assert.assertTrue(dataReceivedLatch.await(5,TimeUnit.SECONDS));
}
