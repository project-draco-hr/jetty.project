{
  final CountDownLatch dataReceivedLatch=new CountDownLatch(1);
  final CountDownLatch received200OKLatch=new CountDownLatch(1);
  session.syn(new SynInfo(requestHeaders,true),new StreamFrameListener.Adapter(){
    @Override public void onReply(    Stream stream,    ReplyInfo replyInfo){
      if ("200 OK".equals(replyInfo.getHeaders().get(HTTPSPDYHeader.STATUS.name(version)).value()))       received200OKLatch.countDown();
      super.onReply(stream,replyInfo);
    }
    @Override public void onData(    Stream stream,    DataInfo dataInfo){
      dataInfo.consume(dataInfo.length());
      if (dataInfo.isClose())       dataReceivedLatch.countDown();
    }
  }
,new Promise.Adapter<Stream>());
  Assert.assertTrue(received200OKLatch.await(5,TimeUnit.SECONDS));
  Assert.assertTrue(dataReceivedLatch.await(5,TimeUnit.SECONDS));
}
