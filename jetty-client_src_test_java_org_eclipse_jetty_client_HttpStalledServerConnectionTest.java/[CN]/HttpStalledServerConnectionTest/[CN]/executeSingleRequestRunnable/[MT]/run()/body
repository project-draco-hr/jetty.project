{
  URI uri=URI.create("http://localhost:" + connector.getLocalPort());
  DeferredContentProvider deferredContentProvider=new DeferredContentProvider();
  org.eclipse.jetty.client.api.Request request=httpClient.newRequest(uri).method(HttpMethod.POST).content(deferredContentProvider);
  ArrayList<Response.ResponseListener> listeners=new ArrayList<>();
  final CountDownLatch responseLatch=new CountDownLatch(1);
  listeners.add(new Response.ContentListener(){
    @Override public void onContent(    Response response,    ByteBuffer content){
      assertThat("response status is 200",response.getStatus(),is(200));
      requestLatch.countDown();
      responseLatch.countDown();
      LOG.debug("#{} status={},response={}",requestLatch.getCount(),response.getStatus(),BufferUtil.toDetailString(content));
    }
  }
);
  httpClient.send(request,listeners);
  final String body=UUID.randomUUID().toString();
  deferredContentProvider.offer(BufferUtil.toBuffer(body.getBytes()));
  deferredContentProvider.close();
  try {
    responseLatch.await(5,TimeUnit.SECONDS);
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
}
