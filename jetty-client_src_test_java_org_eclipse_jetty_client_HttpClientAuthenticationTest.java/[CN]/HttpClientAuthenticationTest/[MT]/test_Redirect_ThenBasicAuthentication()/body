{
  startBasic(new AbstractHandler(){
    @Override public void handle(    String target,    org.eclipse.jetty.server.Request baseRequest,    HttpServletRequest request,    HttpServletResponse response) throws IOException, ServletException {
      baseRequest.setHandled(true);
      if (request.getRequestURI().endsWith("/redirect"))       response.sendRedirect(scheme + "://" + request.getServerName()+ ":"+ request.getServerPort()+ "/secure");
    }
  }
);
  client.getAuthenticationStore().addAuthentication(new BasicAuthentication(scheme + "://localhost:" + connector.getLocalPort(),realm,"basic","basic"));
  final AtomicInteger requests=new AtomicInteger();
  Request.Listener.Empty requestListener=new Request.Listener.Empty(){
    @Override public void onSuccess(    Request request){
      requests.incrementAndGet();
    }
  }
;
  client.getRequestListeners().add(requestListener);
  ContentResponse response=client.newRequest("localhost",connector.getLocalPort()).scheme(scheme).path("/redirect").send().get(5,TimeUnit.SECONDS);
  Assert.assertNotNull(response);
  Assert.assertEquals(200,response.status());
  Assert.assertEquals(3,requests.get());
  client.getRequestListeners().remove(requestListener);
}
