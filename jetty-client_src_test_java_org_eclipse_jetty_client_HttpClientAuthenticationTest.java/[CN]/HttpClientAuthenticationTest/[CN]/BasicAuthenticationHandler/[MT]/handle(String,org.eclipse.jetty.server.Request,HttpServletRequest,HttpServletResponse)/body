{
  try {
    String type=request.getParameter("type");
    String authorization=request.getHeader(HttpHeader.AUTHORIZATION.asString());
    if (authorization == null) {
      String realm=request.getParameter("realm");
      response.setStatus(401);
switch (type) {
case "Basic":
{
          response.setHeader("WWW-Authenticate","Basic realm=\"" + realm + "\"");
          break;
        }
default :
{
        throw new IllegalStateException();
      }
  }
}
 else {
switch (type) {
case "Basic":
{
      String user=request.getParameter("user");
      String password=request.getParameter("password");
      String expected="Basic " + B64Code.encode(user + ":" + password);
      if (!expected.equals(authorization))       throw new IOException(expected + " != " + authorization);
      IO.copy(request.getInputStream(),response.getOutputStream());
      break;
    }
default :
{
    throw new IllegalStateException();
  }
}
}
}
  finally {
baseRequest.setHandled(true);
}
}
