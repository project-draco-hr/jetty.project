{
  if (!_generator.isCommitted()) {
    if (_expect100Continue && _parser instanceof HttpParser) {
      HttpParser parser=(HttpParser)_parser;
      if ((parser.getHeaderBuffer() != null && parser.getHeaderBuffer().length() >= 2) || (parser.getBodyBuffer() != null && parser.getBodyBuffer().length() > 0))       _expect100Continue=false;
    }
    _generator.setResponse(_response.getStatus(),_response.getReason());
    try {
      _generator.completeHeader(_responseFields,last);
    }
 catch (    IOException io) {
      throw io;
    }
catch (    RuntimeException e) {
      Log.warn("header full: " + e);
      _response.reset();
      _generator.reset(true);
      _generator.setResponse(HttpStatus.INTERNAL_SERVER_ERROR_500,null);
      _generator.completeHeader(_responseFields,Generator.LAST);
      _generator.complete();
      throw new HttpException(HttpStatus.INTERNAL_SERVER_ERROR_500);
    }
  }
  if (last)   _generator.complete();
}
