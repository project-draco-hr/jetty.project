{
  if (streamId < 0)   throw new IllegalArgumentException("Invalid stream id: " + streamId);
  int paddingLength=paddingBytes == null ? 0 : paddingBytes.length;
  if (paddingLength > DataFrame.MAX_LENGTH - 3)   throw new IllegalArgumentException("Invalid padding length: " + paddingLength);
  int extraPaddingBytes=paddingLength > 0xFF ? 2 : paddingLength > 0 ? 1 : 0;
  int dataLength=data.remaining();
  Result result=new Result(byteBufferPool);
  if (dataLength + extraPaddingBytes + paddingLength <= DataFrame.MAX_LENGTH) {
    generateData(result,streamId,data,last,compress,extraPaddingBytes,paddingBytes);
  }
 else {
    int dataBytesPerFrame=DataFrame.MAX_LENGTH - extraPaddingBytes - paddingLength;
    int frames=dataLength / dataBytesPerFrame;
    if (frames * dataBytesPerFrame != dataLength) {
      ++frames;
    }
    int limit=data.limit();
    for (int i=1; i <= frames; ++i) {
      data.limit(Math.min(dataBytesPerFrame * i,limit));
      ByteBuffer slice=data.slice();
      data.position(data.limit());
      generateData(result,streamId,slice,i == frames && last,compress,extraPaddingBytes,paddingBytes);
    }
  }
  return result;
}
