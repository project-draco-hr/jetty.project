{
  if (OS.IS_WINDOWS) {
    return;
  }
  final AtomicInteger count=new AtomicInteger(0);
  PolicyMonitor monitor=new PolicyMonitor(new File(MavenTestingUtils.getTargetDir(),"test-classes/monitor-test-2").getAbsolutePath()){
    @Override public void onPolicyChange(    PolicyBlock grant){
      count.incrementAndGet();
    }
  }
;
  monitor.setScanInterval(1);
  monitor.start();
  while (!monitor.isInitialized()) {
    Thread.sleep(100);
  }
  File permFile=new File(MavenTestingUtils.getTargetDir(),"test-classes/monitor-test-2/global-all-permission.policy");
  Thread.sleep(10);
  permFile.setLastModified(System.currentTimeMillis());
  monitor.waitForScan();
  monitor.waitForScan();
  Assert.assertEquals(2,count.get());
  monitor.stop();
}
