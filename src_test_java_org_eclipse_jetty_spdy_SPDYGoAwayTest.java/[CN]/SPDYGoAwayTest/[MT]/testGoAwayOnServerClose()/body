{
  final short version=(short)2;
  ServerSessionFrameListener serverSessionFrameListener=new ServerSessionFrameListener.Adapter(){
    @Override public Stream.FrameListener onSyn(    Stream stream,    SynInfo synInfo){
      stream.reply(new ReplyInfo(true));
      stream.getSession().goAway(version);
      return null;
    }
  }
;
  final AtomicReference<GoAwayInfo> ref=new AtomicReference<>();
  final CountDownLatch latch=new CountDownLatch(1);
  Session.FrameListener clientSessionFrameListener=new Session.FrameListener.Adapter(){
    @Override public void onGoAway(    Session session,    GoAwayInfo goAwayInfo){
      ref.set(goAwayInfo);
      latch.countDown();
    }
  }
;
  Session session=startClient(startServer(serverSessionFrameListener),clientSessionFrameListener);
  Stream stream1=session.syn(version,new SynInfo(true),null);
  Assert.assertTrue(latch.await(5,TimeUnit.SECONDS));
  GoAwayInfo goAwayInfo=ref.get();
  Assert.assertNotNull(goAwayInfo);
  Assert.assertEquals(stream1.getId(),goAwayInfo.getLastStreamId());
  Assert.assertSame(SessionStatus.OK,goAwayInfo.getSessionStatus());
}
