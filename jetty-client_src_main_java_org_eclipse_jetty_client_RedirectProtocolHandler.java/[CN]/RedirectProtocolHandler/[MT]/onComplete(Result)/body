{
  if (!result.isFailed()) {
    Request request=result.getRequest();
    Response response=result.getResponse();
    URI location=URI.create(response.getHeaders().get("location"));
    int status=response.getStatus();
switch (status) {
case 301:
{
        if (request.getMethod() == HttpMethod.GET || request.getMethod() == HttpMethod.HEAD)         redirect(result,request.getMethod(),location);
 else         fail(result,new HttpResponseException("HTTP protocol violation: received 301 for non GET or HEAD request",response));
        break;
      }
case 302:
case 303:
{
      redirect(result,HttpMethod.GET,location);
      break;
    }
case 307:
{
    redirect(result,request.getMethod(),location);
    break;
  }
default :
{
  fail(result,new HttpResponseException("Unhandled HTTP status code " + status,response));
  break;
}
}
}
 else {
fail(result,result.getFailure());
}
}
