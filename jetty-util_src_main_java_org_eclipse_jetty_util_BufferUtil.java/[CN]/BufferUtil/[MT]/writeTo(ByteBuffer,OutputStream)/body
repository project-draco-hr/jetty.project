{
  if (buffer.hasArray())   out.write(buffer.array(),buffer.arrayOffset() + buffer.position(),buffer.remaining());
 else {
    byte[] bytes=new byte[TEMP_BUFFER_SIZE];
    int j=0;
    for (int i=buffer.position(); i < buffer.limit(); i++) {
      bytes[j]=buffer.get(i);
      j++;
      if (j == TEMP_BUFFER_SIZE) {
        out.write(bytes);
        j=0;
      }
    }
    out.write(bytes,0,j);
  }
}
