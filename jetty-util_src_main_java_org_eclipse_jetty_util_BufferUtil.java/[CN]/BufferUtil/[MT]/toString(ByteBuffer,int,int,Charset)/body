{
  if (buffer == null)   return null;
  byte[] array=buffer.hasArray() ? buffer.array() : null;
  if (array == null) {
    ByteBuffer slice=buffer.slice();
    slice.position(position);
    slice.limit(position + length);
    byte[] to=new byte[length];
    slice.get(to);
    return new String(to,0,to.length,charset);
  }
  return new String(array,buffer.arrayOffset() + position,length,charset);
}
