{
  if (LOG.isDebugEnabled()) {
    LOG.debug("{}.onFrame({})",websocket.getClass().getSimpleName(),frame);
  }
  onFrame(frame);
  try {
switch (frame.getType().getOpCode()) {
case OpCode.CLOSE:
{
        boolean validate=true;
        CloseInfo close=new CloseInfo(frame,validate);
        onClose(close);
        session.close(close.getStatusCode(),close.getReason());
        session.getConnection().onCloseHandshake(true,close);
        return;
      }
case OpCode.PING:
{
      ByteBuffer pongBuf=ByteBuffer.allocate(frame.getPayloadLength());
      if (frame.getPayloadLength() > 0) {
        BufferUtil.clearToFill(pongBuf);
        BufferUtil.put(frame.getPayload(),pongBuf);
        BufferUtil.flipToFlush(pongBuf,0);
      }
      session.getRemote().sendPong(pongBuf);
      break;
    }
case OpCode.BINARY:
{
    onBinaryFrame(frame.getPayload(),frame.isFin());
    return;
  }
case OpCode.TEXT:
{
  onTextFrame(frame.getPayload(),frame.isFin());
  return;
}
}
}
 catch (NotUtf8Exception e) {
terminateConnection(StatusCode.BAD_PAYLOAD,e.getMessage());
}
catch (CloseException e) {
terminateConnection(e.getStatusCode(),e.getMessage());
}
catch (Throwable t) {
unhandled(t);
}
}
