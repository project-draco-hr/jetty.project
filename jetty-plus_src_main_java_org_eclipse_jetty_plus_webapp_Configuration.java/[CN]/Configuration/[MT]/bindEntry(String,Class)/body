{
  String nameInEnvironment=name;
  boolean bound=false;
  Object scope=getWebAppContext();
  NamingEntry ne=NamingEntryUtil.lookupNamingEntry(scope,name);
  if (ne != null && (ne instanceof Link)) {
    nameInEnvironment=(String)((Link)ne).getObjectToBind();
    Link l=(Link)ne;
  }
  scope=getWebAppContext();
  bound=NamingEntryUtil.bindToENC(scope,name,nameInEnvironment);
  if (bound)   return;
  scope=getWebAppContext().getServer();
  bound=NamingEntryUtil.bindToENC(scope,name,nameInEnvironment);
  if (bound)   return;
  bound=NamingEntryUtil.bindToENC(null,name,nameInEnvironment);
  if (bound)   return;
  nameInEnvironment=typeClass.getName() + "/default";
  NamingEntry defaultNE=NamingEntryUtil.lookupNamingEntry(getWebAppContext().getServer(),nameInEnvironment);
  if (defaultNE == null)   defaultNE=NamingEntryUtil.lookupNamingEntry(null,nameInEnvironment);
  if (defaultNE != null)   defaultNE.bindToENC(name);
 else   throw new IllegalStateException("Nothing to bind for name " + nameInEnvironment);
}
