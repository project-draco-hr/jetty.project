{
  Socket socket=new Socket();
  SocketAddress endpoint=new InetSocketAddress(serverUri.getHost(),serverUri.getPort());
  socket.connect(endpoint);
  StringBuilder req=new StringBuilder();
  req.append("GET / HTTP/1.1\r\n");
  req.append(String.format("Host: %s:%d\r\n",serverUri.getHost(),serverUri.getPort()));
  req.append("Upgrade: WebSocket\r\n");
  req.append("Connection: Upgrade\r\n");
  req.append("Sec-WebSocket-Version: 29\r\n");
  req.append("\r\n");
  OutputStream out=null;
  InputStream in=null;
  try {
    out=socket.getOutputStream();
    in=socket.getInputStream();
    out.write(req.toString().getBytes());
    out.flush();
    String respHeader=readResponseHeader(in);
    System.out.println("RESPONSE: " + respHeader);
    Assert.assertThat("Response Code",respHeader,startsWith("HTTP/1.1 400 Unsupported websocket version specification"));
    Assert.assertThat("Response Header Versions",respHeader,containsString("Sec-WebSocket-Version: 13, 8, 6, 0\r\n"));
  }
  finally {
    IO.close(in);
    IO.close(out);
    socket.close();
  }
}
