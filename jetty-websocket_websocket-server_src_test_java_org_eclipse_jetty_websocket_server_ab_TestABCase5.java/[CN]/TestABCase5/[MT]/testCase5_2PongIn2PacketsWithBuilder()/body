{
  BlockheadClient client=new BlockheadClient(server.getServerUri());
  try {
    client.connect();
    client.sendStandardRequest();
    client.expectUpgradeResponse();
    String fragment1="fragment1";
    WebSocketFrame frame1=WebSocketFrame.pong().setFin(false).setPayload(fragment1);
    ByteBuffer buf1=laxGenerator.generate(frame1);
    client.writeRaw(buf1);
    String fragment2="fragment2";
    WebSocketFrame frame2=new WebSocketFrame(OpCode.CONTINUATION).setFin(false).setPayload(fragment2);
    ByteBuffer buf2=laxGenerator.generate(frame2);
    client.writeRaw(buf2);
    Queue<WebSocketFrame> frames=client.readFrames(1,TimeUnit.MILLISECONDS,500);
    WebSocketFrame frame=frames.remove();
    Assert.assertThat("frame should be close frame",frame.getOpCode(),is(OpCode.CLOSE));
    Assert.assertThat("CloseFrame.status code",new CloseInfo(frame).getStatusCode(),is(1002));
  }
  finally {
    client.close();
  }
}
