{
  setBufferTypes();
  _timeoutQ.setDuration(_timeout);
  _timeoutQ.setNow();
  _idleTimeoutQ.setDuration(_idleTimeout);
  _idleTimeoutQ.setNow();
  if (_threadPool == null) {
    QueuedThreadPool pool=new LocalQueuedThreadPool();
    pool.setMaxThreads(16);
    pool.setDaemon(true);
    pool.setName("HttpClient");
    _threadPool=pool;
    addBean(_threadPool,true);
  }
  _connector=(_connectorType == CONNECTOR_SELECT_CHANNEL) ? new SelectConnector(this) : new SocketConnector(this);
  addBean(_connector,true);
  super.doStart();
  _threadPool.dispatch(new Runnable(){
    public void run(){
      while (isRunning()) {
        _timeoutQ.tick(System.currentTimeMillis());
        _idleTimeoutQ.tick(_timeoutQ.getNow());
        try {
          Thread.sleep(200);
        }
 catch (        InterruptedException ignored) {
        }
      }
    }
  }
);
}
