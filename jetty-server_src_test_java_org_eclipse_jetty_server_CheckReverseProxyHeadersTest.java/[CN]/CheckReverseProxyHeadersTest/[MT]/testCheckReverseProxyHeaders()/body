{
  testRequest("Host: localhost:8080\n" + "X-Forwarded-For: 10.20.30.40\n" + "X-Forwarded-Host: example.com",new RequestValidator(){
    public void validate(    HttpServletRequest request){
      assertEquals("example.com",request.getServerName());
      assertEquals(80,request.getServerPort());
      assertEquals("10.20.30.40",request.getRemoteAddr());
      assertEquals("10.20.30.40",request.getRemoteHost());
      assertEquals("example.com",request.getHeader("Host"));
    }
  }
);
  testRequest("Host: localhost:8080\n" + "X-Forwarded-For: 10.20.30.40\n" + "X-Forwarded-Host: example.com:81\n"+ "X-Forwarded-Server: example.com",new RequestValidator(){
    public void validate(    HttpServletRequest request){
      assertEquals("example.com",request.getServerName());
      assertEquals(81,request.getServerPort());
      assertEquals("10.20.30.40",request.getRemoteAddr());
      assertEquals("10.20.30.40",request.getRemoteHost());
      assertEquals("example.com:81",request.getHeader("Host"));
    }
  }
);
  testRequest("Host: localhost:8080\n" + "X-Forwarded-For: 10.20.30.40, 10.0.0.1\n" + "X-Forwarded-Host: example.com, rp.example.com:82\n"+ "X-Forwarded-Server: example.com, rp.example.com",new RequestValidator(){
    public void validate(    HttpServletRequest request){
      assertEquals("example.com",request.getServerName());
      assertEquals(80,request.getServerPort());
      assertEquals("10.20.30.40",request.getRemoteAddr());
      assertEquals("10.20.30.40",request.getRemoteHost());
      assertEquals("example.com",request.getHeader("Host"));
    }
  }
);
}
