{
  if (_closed)   throw new IOException("CLOSED");
  if (_oshut)   throw new IOException("OSHUT");
  int flushed=0;
  for (  ByteBuffer b : buffers) {
    if (BufferUtil.hasContent(b)) {
      if (_growOutput && b.remaining() > BufferUtil.space(_out)) {
        BufferUtil.compact(_out);
        if (b.remaining() > BufferUtil.space(_out)) {
          ByteBuffer n=BufferUtil.allocate(_out.capacity() + b.remaining() * 2);
          BufferUtil.append(_out,n);
          _out=n;
        }
      }
      flushed+=BufferUtil.append(b,_out);
      if (BufferUtil.hasContent(b))       break;
    }
  }
  if (flushed > 0)   notIdle();
  return flushed;
}
