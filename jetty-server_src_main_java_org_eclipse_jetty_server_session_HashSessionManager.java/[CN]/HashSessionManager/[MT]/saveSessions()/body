{
  if (_storeDir == null || !_storeDir.exists()) {
    return;
  }
  if (!_storeDir.canWrite()) {
    Log.warn("Unable to save Sessions: Session persistence storage directory " + _storeDir.getAbsolutePath() + " is not writeable");
    return;
  }
  Runnable save=new Runnable(){
    public void run(){
synchronized (HashSessionManager.this) {
        Iterator<Map.Entry<String,HashedSession>> itor=_sessions.entrySet().iterator();
        while (itor.hasNext()) {
          Map.Entry<String,HashedSession> entry=itor.next();
          String id=(String)entry.getKey();
          HashedSession session=(HashedSession)entry.getValue();
          try {
            File file=new File(_storeDir,id);
            if (file.exists())             file.delete();
            file.createNewFile();
            FileOutputStream fos=new FileOutputStream(file);
            session.willPassivate();
            session.save(fos);
            session.didActivate();
            fos.close();
          }
 catch (          Exception e) {
            Log.warn("Problem persisting session " + id,e);
          }
        }
      }
    }
  }
;
  if (_context == null)   save.run();
 else   _context.getContextHandler().handle(save);
}
