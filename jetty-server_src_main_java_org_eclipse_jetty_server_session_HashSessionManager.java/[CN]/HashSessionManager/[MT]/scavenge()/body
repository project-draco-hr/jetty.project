{
  if (isStopping() || isStopped())   return;
  Thread thread=Thread.currentThread();
  ClassLoader old_loader=thread.getContextClassLoader();
  try {
    if (_loader != null)     thread.setContextClassLoader(_loader);
    long now=System.currentTimeMillis();
    for (Iterator<HashedSession> i=_sessions.values().iterator(); i.hasNext(); ) {
      HashedSession session=i.next();
      long idleTime=session.getMaxInactiveInterval() * 1000;
      if (idleTime > 0 && session.getAccessed() + idleTime < now) {
        session.timeout();
      }
 else       if (_idleSavePeriodMs > 0 && session.getAccessed() + _idleSavePeriodMs < now) {
        session.idle();
      }
    }
  }
 catch (  ThreadDeath e) {
    throw e;
  }
catch (  Throwable t) {
    __log.warn("Problem scavenging sessions",t);
  }
 finally {
    thread.setContextClassLoader(old_loader);
  }
}
