{
  if (isStopping() || isStopped())   return;
  Thread thread=Thread.currentThread();
  ClassLoader old_loader=thread.getContextClassLoader();
  try {
    if (_loader != null)     thread.setContextClassLoader(_loader);
    try {
      if (!_sessionsLoaded && _lazyLoad)       restoreSessions();
    }
 catch (    Exception e) {
      Log.debug(e);
    }
    Object stale=null;
    Object idle=null;
    long now=System.currentTimeMillis();
    for (Iterator<HashedSession> i=_sessions.values().iterator(); i.hasNext(); ) {
      HashedSession session=i.next();
      long idleTime=session._maxIdleMs;
      if (idleTime > 0 && session._accessed + idleTime < now) {
        session.timeout();
      }
 else       if (_idleSavePeriodMs > 0 && session._accessed + _idleSavePeriodMs < now) {
        session.idle();
      }
    }
  }
 catch (  Throwable t) {
    if (t instanceof ThreadDeath)     throw ((ThreadDeath)t);
 else     Log.warn("Problem scavenging sessions",t);
  }
 finally {
    thread.setContextClassLoader(old_loader);
  }
}
