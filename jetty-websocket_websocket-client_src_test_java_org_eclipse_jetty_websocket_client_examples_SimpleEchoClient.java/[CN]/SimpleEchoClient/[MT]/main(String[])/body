{
  String destUri="ws://echo.websocket.org";
  if (args.length > 0) {
    destUri=args[0];
  }
  WebSocketClientFactory factory=new WebSocketClientFactory();
  SimpleEchoSocket socket=new SimpleEchoSocket();
  try {
    factory.start();
    WebSocketClient client=factory.newWebSocketClient(socket);
    URI echoUri=new URI(destUri);
    System.out.printf("Connecting to : %s%n",echoUri);
    client.getUpgradeRequest().addExtensions("x-webkit-deflate-frame");
    client.connect(echoUri);
    socket.awaitClose(5,TimeUnit.SECONDS);
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
 finally {
    try {
      factory.stop();
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
}
