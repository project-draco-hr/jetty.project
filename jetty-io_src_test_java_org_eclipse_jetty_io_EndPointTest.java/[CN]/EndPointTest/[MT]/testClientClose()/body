{
  EndPointPair<T> c=newConnection();
  Buffer buffer=new IndirectNIOBuffer(4096);
  c.client.flush(new ByteArrayBuffer("request"));
  int len=c.server.fill(buffer);
  assertEquals(7,len);
  assertEquals("request",buffer.toString());
  assertTrue(c.client.isOpen());
  assertFalse(c.client.isInputShutdown());
  assertFalse(c.client.isOutputShutdown());
  assertTrue(c.server.isOpen());
  assertFalse(c.server.isInputShutdown());
  assertFalse(c.server.isOutputShutdown());
  c.client.close();
  assertFalse(c.client.isOpen());
  assertTrue(c.client.isInputShutdown());
  assertTrue(c.client.isOutputShutdown());
  assertTrue(c.server.isOpen());
  assertFalse(c.server.isInputShutdown());
  assertFalse(c.server.isOutputShutdown());
  len=c.server.fill(buffer);
  assertEquals(-1,len);
  if (!c.server.isOpen()) {
    assertFalse(c.client.isOpen());
    assertTrue(c.client.isInputShutdown());
    assertTrue(c.client.isOutputShutdown());
    assertFalse(c.server.isOpen());
    assertTrue(c.server.isInputShutdown());
    assertTrue(c.server.isOutputShutdown());
  }
 else {
    assertFalse(c.client.isOpen());
    assertTrue(c.client.isInputShutdown());
    assertTrue(c.client.isOutputShutdown());
    assertTrue(c.server.isOpen());
    assertTrue(c.server.isInputShutdown());
    assertFalse(c.server.isOutputShutdown());
    c.server.shutdownOutput();
    assertFalse(c.client.isOpen());
    assertTrue(c.client.isInputShutdown());
    assertTrue(c.client.isOutputShutdown());
    assertFalse(c.server.isOpen());
    assertTrue(c.server.isInputShutdown());
    assertTrue(c.server.isOutputShutdown());
  }
}
