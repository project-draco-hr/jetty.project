{
  long idleTimeout=1000;
  client.setIdleTimeout(idleTimeout);
  HttpDestination destination=new HttpDestination(client,"http","localhost",connector.getLocalPort());
  destination.acquire();
  Connection connection1=null;
  long start=System.nanoTime();
  while (connection1 == null && TimeUnit.NANOSECONDS.toSeconds(System.nanoTime() - start) < 5) {
    connection1=destination.idleConnections().peek();
    TimeUnit.MILLISECONDS.sleep(50);
  }
  Assert.assertNotNull(connection1);
  TimeUnit.MILLISECONDS.sleep(2 * idleTimeout);
  connection1=destination.idleConnections().poll();
  Assert.assertNull(connection1);
}
