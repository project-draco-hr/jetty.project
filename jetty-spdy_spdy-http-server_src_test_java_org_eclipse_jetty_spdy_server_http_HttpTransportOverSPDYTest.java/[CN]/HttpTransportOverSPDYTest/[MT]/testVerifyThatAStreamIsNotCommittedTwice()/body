{
  final CountDownLatch failedCalledLatch=new CountDownLatch(1);
  ByteBuffer content=createRandomByteBuffer();
  boolean lastContent=false;
  httpTransportOverSPDY.send(responseInfo,content,lastContent,callback);
  ArgumentCaptor<ReplyInfo> replyInfoCaptor=ArgumentCaptor.forClass(ReplyInfo.class);
  verify(stream,times(1)).reply(replyInfoCaptor.capture(),any(Callback.class));
  assertThat("ReplyInfo close is false",replyInfoCaptor.getValue().isClose(),is(false));
  httpTransportOverSPDY.send(HttpGenerator.RESPONSE_500_INFO,null,true,new Callback.Adapter(){
    @Override public void failed(    Throwable x){
      failedCalledLatch.countDown();
    }
  }
);
  verify(stream,times(1)).data(any(DataInfo.class),any(Callback.class));
  assertThat("callback.failed has been called",failedCalledLatch.await(5,TimeUnit.SECONDS),is(true));
}
