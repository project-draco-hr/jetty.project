{
  ServletContext targetContext=getServletConfig().getServletContext().getContext("/resource");
  RequestDispatcher dispatcher=targetContext.getRequestDispatcher(req.getPathInfo());
  if ("true".equals(req.getParameter("wrapped"))) {
    if (req.getParameter("type").equals("forward")) {
      dispatcher.forward(new ServletRequestWrapper(req),new ServletResponseWrapper(res));
    }
 else     if (req.getParameter("type").equals("include")) {
      dispatcher.include(new ServletRequestWrapper(req),new ServletResponseWrapper(res));
    }
 else {
      throw new ServletException("type of forward or include is required");
    }
  }
 else {
    if (req.getParameter("type").equals("forward")) {
      dispatcher.forward(req,res);
    }
 else     if (req.getParameter("type").equals("include")) {
      dispatcher.include(req,res);
    }
 else {
      throw new ServletException("type of forward or include is required");
    }
  }
}
