{
  int amt=Math.min(length,src.remaining());
  if (frame.isMasked()) {
    byte mask[]=frame.getMask();
    for (int i=0; i < amt; i++) {
      dest.put((byte)(src.get() ^ mask[i % 4]));
    }
  }
 else {
    byte b[]=new byte[amt];
    src.get(b,0,amt);
    dest.put(b,0,amt);
  }
  return amt;
}
