{
  boolean persistent;
  HttpVersion version=getHttpVersion();
switch (version) {
case HTTP_1_0:
{
      persistent=getRequest().getHttpFields().contains(HttpHeader.CONNECTION,HttpHeaderValue.KEEP_ALIVE.asString());
      if (!persistent)       persistent=HttpMethod.CONNECT.is(getRequest().getMethod());
      if (persistent)       getResponse().getHttpFields().add(HttpHeader.CONNECTION,HttpHeaderValue.KEEP_ALIVE);
      break;
    }
case HTTP_1_1:
{
    if (_expect) {
      badMessage(HttpStatus.EXPECTATION_FAILED_417,null);
      return true;
    }
    persistent=!getRequest().getHttpFields().contains(HttpHeader.CONNECTION,HttpHeaderValue.CLOSE.asString());
    if (!persistent)     persistent=HttpMethod.CONNECT.is(getRequest().getMethod());
    if (!persistent)     getResponse().getHttpFields().add(HttpHeader.CONNECTION,HttpHeaderValue.CLOSE);
    break;
  }
default :
{
  throw new IllegalStateException();
}
}
if (!persistent) _httpConnection._generator.setPersistent(false);
return super.headerComplete();
}
