{
  if (!CentralizedWebAppLoggingConfiguration.isLoggerConfigured()) {
    String loggerConfigFilename=MavenTestingUtils.getTestResourceFile("logger/testing.properties").getAbsolutePath();
    CentralizedWebAppLoggingConfiguration.setLoggerConfigurationFilename(loggerConfigFilename);
  }
  CentralLoggerConfig root=CentralizedWebAppLoggingConfiguration.getLoggerRoot();
  testAppender=(TestAppender)root.findAppender(TestAppender.class);
  testAppender.reset();
  Server server=new Server();
  List<Configuration> serverConfigs=new ArrayList<Configuration>();
  serverConfigs.add(new CentralizedWebAppLoggingConfiguration());
  server.setAttribute(WebAppContext.SERVER_CONFIG,serverConfigs);
  Connector connector=new SelectChannelConnector();
  connector.setPort(0);
  server.setConnectors(new Connector[]{connector});
  ContextHandlerCollection handlers=new ContextHandlerCollection();
  handlers.addHandler(createWebapp("/log4j","dummy-webapp-logging-log4j.war"));
  handlers.addHandler(createWebapp("/slf4j","dummy-webapp-logging-slf4j.war"));
  handlers.addHandler(createWebapp("/clogging","dummy-webapp-logging-commons.war"));
  handlers.addHandler(createWebapp("/javalogging","dummy-webapp-logging-java.war"));
  server.setHandler(handlers);
  server.start();
  SimpleRequest.get(server,"/log4j/logging");
  SimpleRequest.get(server,"/slf4j/logging");
  SimpleRequest.get(server,"/clogging/logging");
  SimpleRequest.get(server,"/javalogging/logging");
  server.stop();
  String prefix="LoggingServlet(commons-logging)";
  List<LogEvent> expectedLogs=new ArrayList<LogEvent>();
  expectedLogs.add(new LogEvent(Severity.INFO,LOGGING_SERVLET_ID,prefix + " GET requested"));
  expectedLogs.add(new LogEvent(Severity.WARN,LOGGING_SERVLET_ID,prefix + " Slightly warn, with a chance of log events"));
  expectedLogs.add(new LogEvent(Severity.ERROR,LOGGING_SERVLET_ID,prefix + " Nothing is (intentionally) being output by this Servlet"));
  expectedLogs.add(new LogEvent(Severity.ERROR,LOGGING_SERVLET_ID,prefix + " Whoops (intentionally) causing a Throwable").expectedThrowable(new FileNotFoundException("A file cannot be found")));
  prefix="LoggingServlet(log4j)";
  expectedLogs.add(new LogEvent(Severity.INFO,LOGGING_SERVLET_ID,prefix + " GET requested"));
  expectedLogs.add(new LogEvent(Severity.WARN,LOGGING_SERVLET_ID,prefix + " Slightly warn, with a chance of log events"));
  expectedLogs.add(new LogEvent(Severity.ERROR,LOGGING_SERVLET_ID,prefix + " Nothing is (intentionally) being output by this Servlet"));
  expectedLogs.add(new LogEvent(Severity.ERROR,LOGGING_SERVLET_ID,prefix + " Whoops (intentionally) causing a Throwable").expectedThrowable(new FileNotFoundException("A file cannot be found")));
  prefix="LoggingServlet(java)";
  expectedLogs.add(new LogEvent(Severity.INFO,LOGGING_SERVLET_ID,prefix + " GET requested"));
  expectedLogs.add(new LogEvent(Severity.WARN,LOGGING_SERVLET_ID,prefix + " Slightly warn, with a chance of log events"));
  expectedLogs.add(new LogEvent(Severity.WARN,LOGGING_SERVLET_ID,prefix + " Nothing is (intentionally) being output by this Servlet"));
  expectedLogs.add(new LogEvent(Severity.ERROR,LOGGING_SERVLET_ID,prefix + " Whoops (intentionally) causing a Throwable").expectedThrowable(new FileNotFoundException("A file cannot be found")));
  prefix="LoggingServlet(slf4j)";
  expectedLogs.add(new LogEvent(Severity.INFO,LOGGING_SERVLET_ID,prefix + " GET requested"));
  expectedLogs.add(new LogEvent(Severity.WARN,LOGGING_SERVLET_ID,prefix + " Slightly warn, with a chance of log events"));
  expectedLogs.add(new LogEvent(Severity.ERROR,LOGGING_SERVLET_ID,prefix + " Nothing is (intentionally) being output by this Servlet"));
  expectedLogs.add(new LogEvent(Severity.ERROR,LOGGING_SERVLET_ID,prefix + " Whoops (intentionally) causing a Throwable").expectedThrowable(new FileNotFoundException("A file cannot be found")));
  assertContainsLogEvents(testAppender,expectedLogs);
}
