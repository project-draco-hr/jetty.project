{
  Buffer bb=new ByteArrayBuffer(8096);
  Buffer sb=new ByteArrayBuffer(1500);
  ByteArrayEndPoint endp=new ByteArrayEndPoint(new byte[0],4096);
  HttpGenerator generator=new HttpGenerator(new SimpleBuffers(sb,bb),endp);
  generator.setRequest("GET","/usr");
  HttpFields fields=new HttpFields();
  fields.add("Header","Value");
  fields.add("Content-Type","text/plain");
  String content="The quick brown fox jumped over the lazy dog";
  generator.completeHeader(fields,false);
  generator.addContent(new ByteArrayBuffer(content).asMutableBuffer(),false);
  generator.flushBuffer();
  generator.complete();
  generator.flushBuffer();
  String result=endp.getOut().toString().replace("\r\n","|").replace('\r','|').replace('\n','|');
  assertEquals("GET /usr HTTP/1.1|Header: Value|Content-Type: text/plain|Transfer-Encoding: chunked||2C|" + content + "|0||",result);
}
