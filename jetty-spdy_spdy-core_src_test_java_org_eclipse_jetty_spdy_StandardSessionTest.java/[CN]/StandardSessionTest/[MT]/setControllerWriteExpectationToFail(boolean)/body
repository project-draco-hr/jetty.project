{
  when(controller.write(any(ByteBuffer.class),any(Handler.class),any(StandardSession.FrameBytes.class))).thenAnswer(new Answer<Integer>(){
    public Integer answer(    InvocationOnMock invocation){
      Object[] args=invocation.getArguments();
      Handler<StandardSession.FrameBytes> handler=(Handler<FrameBytes>)args[1];
      FrameBytes context=(FrameBytes)args[2];
      if (fail)       handler.failed(context,new ClosedChannelException());
 else       handler.completed(context);
      return 0;
    }
  }
);
}
