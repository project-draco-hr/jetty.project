{
  setControllerWriteExpectationToFail(false);
  IStream stream=createStream();
  Stream pushStream=createPushStream(stream);
  assertThatStreamIsNotHalfClosed(stream);
  assertThatStreamIsNotClosed(stream);
  assertThatPushStreamIsHalfClosed(pushStream);
  assertThatPushStreamIsNotClosed(pushStream);
  stream.updateCloseState(true,true);
  assertThatStreamIsHalfClosed(stream);
  assertThatStreamIsNotClosed(stream);
  assertThatPushStreamIsHalfClosed(pushStream);
  assertThatPushStreamIsNotClosed(pushStream);
  session.onControlFrame(new SynReplyFrame(SPDY.V2,SynInfo.FLAG_CLOSE,stream.getId(),null));
  assertThatStreamIsClosed(stream);
  assertThatPushStreamIsNotClosed(pushStream);
}
