{
  doAnswer(new Answer(){
    public Object answer(    InvocationOnMock invocation){
      Object[] args=invocation.getArguments();
      Callback callback=(Callback)args[0];
      if (fail)       callback.failed(new ClosedChannelException());
 else       callback.succeeded();
      return null;
    }
  }
).when(controller).write(any(Callback.class),any(ByteBuffer.class));
}
