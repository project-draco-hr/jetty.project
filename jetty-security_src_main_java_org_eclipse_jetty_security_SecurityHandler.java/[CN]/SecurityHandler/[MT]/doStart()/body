{
  ContextHandler.Context context=ContextHandler.getCurrentContext();
  if (context != null) {
    Enumeration<String> names=context.getInitParameterNames();
    while (names != null && names.hasMoreElements()) {
      String name=names.nextElement();
      if (name.startsWith("org.eclipse.jetty.security.") && getInitParameter(name) == null)       setInitParameter(name,context.getInitParameter(name));
    }
  }
  if (_loginService == null) {
    _loginService=findLoginService();
    if (_loginService != null)     _loginServiceShared=true;
  }
  if (_identityService == null) {
    if (_loginService != null)     _identityService=_loginService.getIdentityService();
    if (_identityService == null)     _identityService=findIdentityService();
    if (_identityService == null && _loginService != null)     _identityService=new DefaultIdentityService();
  }
  if (_loginService != null) {
    if (_loginService.getIdentityService() == null)     _loginService.setIdentityService(_identityService);
 else     if (_loginService.getIdentityService() != _identityService)     throw new IllegalStateException("LoginService has different IdentityService to " + this);
  }
  if (!_loginServiceShared && _loginService instanceof LifeCycle)   ((LifeCycle)_loginService).start();
  if (_authenticator == null && _authenticatorFactory != null && _identityService != null) {
    _authenticator=_authenticatorFactory.getAuthenticator(getServer(),ContextHandler.getCurrentContext(),this,_identityService,_loginService);
    if (_authenticator != null)     _authMethod=_authenticator.getAuthMethod();
  }
  if (_authenticator == null) {
    if (_realmName != null) {
      LOG.warn("No ServerAuthentication for " + this);
      throw new IllegalStateException("No ServerAuthentication");
    }
  }
 else {
    _authenticator.setConfiguration(this);
    if (_authenticator instanceof LifeCycle)     ((LifeCycle)_authenticator).start();
  }
  super.doStart();
}
