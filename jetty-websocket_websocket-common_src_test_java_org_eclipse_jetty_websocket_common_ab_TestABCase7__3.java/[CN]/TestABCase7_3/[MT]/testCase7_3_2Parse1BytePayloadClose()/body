{
  ByteBuffer expected=Hex.asByteBuffer("880100");
  UnitParser parser=new UnitParser(policy);
  IncomingFramesCapture capture=new IncomingFramesCapture();
  parser.setIncomingFramesHandler(capture);
  parser.parseQuietly(expected);
  Assert.assertEquals("error on invalid close payload",1,capture.getErrorCount(ProtocolException.class));
  ProtocolException known=(ProtocolException)capture.getErrors().get(0);
  Assert.assertThat("Payload.message",known.getMessage(),containsString("Invalid close frame payload length"));
}
