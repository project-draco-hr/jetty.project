{
  try {
synchronized (this) {
      ByteBuffer buffer=generator.control(frame);
      logger.debug("Queuing {} on {}",frame,stream);
      ControlFrameBytes<C> frameBytes=new ControlFrameBytes<>(stream,callback,context,frame,buffer);
      if (timeout > 0)       frameBytes.task=scheduler.schedule(frameBytes,timeout,unit);
      if (ControlFrameType.PING == frame.getType())       prepend(frameBytes);
 else       append(frameBytes);
    }
  }
 catch (  Exception x) {
    notifyCallbackFailed(callback,context,x);
  }
}
