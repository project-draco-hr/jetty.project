{
  try {
    ControlFrameBytes frameBytes;
    Throwable throwable;
synchronized (this) {
      ByteBuffer buffer=generator.control(frame);
      if (LOG.isDebugEnabled())       LOG.debug("Queuing {} on {}",frame,stream);
      frameBytes=new ControlFrameBytes(stream,callback,frame,buffer);
      if (timeout > 0)       frameBytes.task=scheduler.schedule(frameBytes,timeout,unit);
      if (ControlFrameType.PING == frame.getType())       throwable=flusher.prepend(frameBytes);
 else       throwable=flusher.append(frameBytes);
    }
    flush(frameBytes,throwable);
  }
 catch (  Exception x) {
    notifyCallbackFailed(callback,x);
  }
}
