{
  if (request.isSecure()) {
    String user_agent=request.getHeader(HttpHeaders.USER_AGENT);
    if (user_agent != null) {
      int msie=user_agent.indexOf("MSIE");
      if (msie > 0 && user_agent.length() - msie > 5) {
        int ieVersion=user_agent.charAt(msie + 5);
        if (ieVersion <= IEv5) {
          response.setHeader(HttpHeaders.CONNECTION,HttpHeaderValues.CLOSE);
          return target;
        }
        if (ieVersion == IEv6) {
          int windows=user_agent.indexOf("Windows",msie + 5);
          if (windows > 0) {
            int end=user_agent.indexOf(')',windows + 8);
            if (end < 0 || __IE6_BadOS.getEntry(user_agent,windows + 8,end - windows - 8) != null) {
              response.setHeader(HttpHeaders.CONNECTION,HttpHeaderValues.CLOSE);
              return target;
            }
          }
        }
      }
    }
  }
  return null;
}
