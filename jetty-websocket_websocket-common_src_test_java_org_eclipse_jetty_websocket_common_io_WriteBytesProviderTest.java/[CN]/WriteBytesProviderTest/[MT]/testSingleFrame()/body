{
  UnitGenerator generator=new UnitGenerator();
  TrackingCallback flushCallback=new TrackingCallback();
  bytesProvider=new WriteBytesProvider(generator,flushCallback);
  TrackingCallback frameCallback=new TrackingCallback();
  Frame frame=new TextFrame().setPayload("Test");
  bytesProvider.enqueue(frame,frameCallback);
  List<ByteBuffer> bytes=bytesProvider.getByteBuffers();
  Assert.assertThat("Number of buffers",bytes.size(),is(2));
  assertExpectedBytes(bytes,"810454657374");
  bytesProvider.succeeded();
  assertCallbackSuccessCount(flushCallback,1);
  assertCallbackSuccessCount(frameCallback,1);
}
