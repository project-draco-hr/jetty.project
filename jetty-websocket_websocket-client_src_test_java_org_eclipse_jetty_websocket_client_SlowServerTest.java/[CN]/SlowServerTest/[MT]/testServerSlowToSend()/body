{
  JettyTrackingSocket clientSocket=new JettyTrackingSocket();
  client.setMasker(new ZeroMasker());
  client.setMaxIdleTimeout(60000);
  URI wsUri=server.getWsUri();
  Future<Session> clientConnectFuture=client.connect(clientSocket,wsUri);
  IBlockheadServerConnection serverConn=server.accept();
  serverConn.setSoTimeout(60000);
  serverConn.upgrade();
  clientConnectFuture.get(500,TimeUnit.MILLISECONDS);
  clientSocket.waitForConnected(500,TimeUnit.MILLISECONDS);
  int messageCount=1000;
  ServerWriteThread writer=new ServerWriteThread(serverConn);
  writer.setMessageCount(messageCount);
  writer.setMessage("Hello");
  writer.setSlowness(10);
  writer.start();
  writer.join();
  Assert.assertThat("Message Receive Count",clientSocket.messageQueue.size(),is(messageCount));
  serverConn.close(StatusCode.NORMAL);
  Assert.assertTrue("Client Socket Closed",clientSocket.closeLatch.await(10,TimeUnit.SECONDS));
  clientSocket.assertCloseCode(StatusCode.NORMAL);
}
