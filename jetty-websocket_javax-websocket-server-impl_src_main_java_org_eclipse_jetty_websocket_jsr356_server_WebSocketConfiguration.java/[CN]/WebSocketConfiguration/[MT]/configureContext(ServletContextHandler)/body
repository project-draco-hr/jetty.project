{
  WebSocketUpgradeFilter filter=new WebSocketUpgradeFilter();
  FilterHolder fholder=new FilterHolder(filter);
  fholder.setName("Jetty_WebSocketUpgradeFilter");
  fholder.setDisplayName("WebSocket Upgrade Filter");
  String pathSpec="/*";
  context.addFilter(fholder,pathSpec,EnumSet.of(DispatcherType.REQUEST));
  LOG.debug("Adding {} mapped to {} to {}",filter,pathSpec,context);
  context.setAttribute(WebSocketUpgradeFilter.class.getName(),filter);
  context.setAttribute(DiscoveredEndpoints.class.getName(),new DiscoveredEndpoints());
  ServerContainer jettyContainer=new ServerContainer(filter);
  filter.setWebSocketServerFactoryListener(jettyContainer);
  context.addBean(jettyContainer,true);
  context.setAttribute(javax.websocket.server.ServerContainer.class.getName(),jettyContainer);
  return jettyContainer;
}
