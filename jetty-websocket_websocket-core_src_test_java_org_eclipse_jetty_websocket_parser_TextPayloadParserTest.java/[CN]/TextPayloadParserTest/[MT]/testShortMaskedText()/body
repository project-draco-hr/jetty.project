{
  Debug.enableDebugLogging(Parser.class);
  Debug.enableDebugLogging(TextPayloadParser.class);
  String expectedText="Hello World";
  ByteBuffer buf=ByteBuffer.allocate(24);
  buf.put((byte)0x81);
  buf.put((byte)(0x80 | expectedText.length()));
  writeMask(buf);
  writeMasked(buf,expectedText.getBytes(StringUtil.__UTF8));
  buf.flip();
  Parser parser=new Parser();
  FrameParseCapture capture=new FrameParseCapture();
  parser.addListener(capture);
  parser.parse(buf);
  capture.assertNoErrors();
  capture.assertHasFrame(TextFrame.class,1);
  TextFrame txt=(TextFrame)capture.getFrames().get(0);
  Assert.assertThat("TextFrame.data",txt.getData().toString(),is("Hello World"));
}
