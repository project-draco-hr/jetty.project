{
  ServerSessionFrameListener serverSessionFrameListener=new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      stream.reply(new ReplyInfo(true),new Callback.Adapter());
      stream.getSession().goAway(new GoAwayInfo(),new FutureCallback());
      return null;
    }
  }
;
  final AtomicReference<GoAwayReceivedInfo> ref=new AtomicReference<>();
  final CountDownLatch latch=new CountDownLatch(1);
  SessionFrameListener clientSessionFrameListener=new SessionFrameListener.Adapter(){
    @Override public void onGoAway(    Session session,    GoAwayReceivedInfo goAwayInfo){
      ref.set(goAwayInfo);
      latch.countDown();
    }
  }
;
  Session session=startClient(startServer(serverSessionFrameListener),clientSessionFrameListener);
  Stream stream1=session.syn(new SynInfo(5,TimeUnit.SECONDS,new Fields(),true,(byte)0),null);
  Assert.assertTrue(latch.await(5,TimeUnit.SECONDS));
  GoAwayReceivedInfo goAwayReceivedInfo=ref.get();
  Assert.assertNotNull(goAwayReceivedInfo);
  Assert.assertEquals(stream1.getId(),goAwayReceivedInfo.getLastStreamId());
  Assert.assertSame(SessionStatus.OK,goAwayReceivedInfo.getSessionStatus());
}
