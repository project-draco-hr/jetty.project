{
  Connection connection=null;
  boolean autocommit=true;
  if (_createTables) {
    try {
      connection=getConnection();
      autocommit=connection.getAutoCommit();
      connection.setAutoCommit(false);
      DatabaseMetaData metaData=connection.getMetaData();
      String tableName=(metaData.storesLowerCaseIdentifiers() ? _userTableName.toLowerCase() : (metaData.storesUpperCaseIdentifiers() ? _userTableName.toUpperCase() : _userTableName));
      ResultSet result=metaData.getTables(null,null,tableName,null);
      if (!result.next()) {
        connection.createStatement().executeUpdate("create table " + _userTableName + "("+ _userTableKey+ " integer,"+ _userTableUserField+ " varchar(100) not null unique,"+ _userTablePasswordField+ " varchar(20) not null, primary key("+ _userTableKey+ "))");
        if (Log.isDebugEnabled())         Log.debug("Created table " + _userTableName);
      }
      result.close();
      tableName=(metaData.storesLowerCaseIdentifiers() ? _roleTableName.toLowerCase() : (metaData.storesUpperCaseIdentifiers() ? _roleTableName.toUpperCase() : _roleTableName));
      result=metaData.getTables(null,null,tableName,null);
      if (!result.next()) {
        String str="create table " + _roleTableName + " ("+ _roleTableKey+ " integer, "+ _roleTableRoleField+ " varchar(100) not null unique, primary key("+ _roleTableKey+ "))";
        connection.createStatement().executeUpdate(str);
        if (Log.isDebugEnabled())         Log.debug("Created table " + _roleTableName);
      }
      result.close();
      tableName=(metaData.storesLowerCaseIdentifiers() ? _userRoleTableName.toLowerCase() : (metaData.storesUpperCaseIdentifiers() ? _userRoleTableName.toUpperCase() : _userRoleTableName));
      result=metaData.getTables(null,null,tableName,null);
      if (!result.next()) {
        connection.createStatement().executeUpdate("create table " + _userRoleTableName + " ("+ _userRoleTableUserKey+ " integer, "+ _userRoleTableRoleKey+ " integer, "+ "primary key ("+ _userRoleTableUserKey+ ", "+ _userRoleTableRoleKey+ "))");
        connection.createStatement().executeUpdate("create index indx_user_role on " + _userRoleTableName + "("+ _userRoleTableUserKey+ ")");
        if (Log.isDebugEnabled())         Log.debug("Created table " + _userRoleTableName + " and index");
      }
      result.close();
      connection.commit();
    }
  finally {
      if (connection != null) {
        try {
          connection.setAutoCommit(autocommit);
          connection.close();
        }
 catch (        SQLException e) {
          if (Log.isDebugEnabled())           Log.debug("Prepare tables",e);
        }
 finally {
          connection=null;
        }
      }
    }
  }
 else   if (Log.isDebugEnabled()) {
    Log.debug("createTables false");
  }
}
