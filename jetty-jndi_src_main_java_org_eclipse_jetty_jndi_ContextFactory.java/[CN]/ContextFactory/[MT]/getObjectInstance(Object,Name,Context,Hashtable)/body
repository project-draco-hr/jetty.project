{
  Context ctx=(Context)__threadContext.get();
  if (ctx != null) {
    if (__log.isDebugEnabled())     __log.debug("Using the Context that is bound on the thread");
    return ctx;
  }
  ClassLoader loader=null;
  loader=Thread.currentThread().getContextClassLoader();
  if (__log.isDebugEnabled() && loader != null)   __log.debug("Using thread context classloader");
  if (loader == null && ContextHandler.getCurrentContext() != null) {
    loader=ContextHandler.getCurrentContext().getContextHandler().getClassLoader();
    if (__log.isDebugEnabled() && loader != null)     __log.debug("Using classloader of current org.eclipse.jetty.server.handler.ContextHandler");
  }
  ctx=(Context)__contextMap.get(loader);
  if (ctx == null) {
    Reference ref=(Reference)obj;
    StringRefAddr parserAddr=(StringRefAddr)ref.get("parser");
    String parserClassName=(parserAddr == null ? null : (String)parserAddr.getContent());
    NameParser parser=(NameParser)(parserClassName == null ? null : loader.loadClass(parserClassName).newInstance());
    ctx=new NamingContext(env,name.get(0),(NamingContext)nameCtx,parser);
    if (__log.isDebugEnabled())     __log.debug("Made context " + name.get(0) + " for classloader: "+ loader);
    __contextMap.put(loader,ctx);
  }
  return ctx;
}
