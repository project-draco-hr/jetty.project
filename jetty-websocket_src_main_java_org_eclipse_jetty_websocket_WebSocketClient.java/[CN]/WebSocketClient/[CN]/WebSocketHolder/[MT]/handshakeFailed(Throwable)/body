{
  try {
    _timeout.cancel();
    ByteChannel channel=null;
synchronized (this) {
      if (_channel != null) {
        channel=_channel;
        _channel=null;
        _exception=ex;
      }
    }
    if (channel != null) {
      if (ex instanceof ProtocolException)       closeChannel(channel,WebSocketConnectionD10.CLOSE_PROTOCOL,ex.getMessage());
 else       closeChannel(channel,WebSocketConnectionD10.CLOSE_NOCLOSE,ex.getMessage());
    }
  }
  finally {
    _latch.countDown();
  }
}
