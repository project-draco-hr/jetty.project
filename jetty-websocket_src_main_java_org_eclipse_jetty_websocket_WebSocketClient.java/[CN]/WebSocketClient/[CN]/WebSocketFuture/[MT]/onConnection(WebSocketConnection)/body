{
  try {
    connection.getConnection().setMaxTextMessageSize(_maxTextMessageSize);
    connection.getConnection().setMaxBinaryMessageSize(_maxBinaryMessageSize);
synchronized (this) {
      if (_channel != null)       _connection=connection;
    }
    if (_connection != null) {
      if (_websocket instanceof WebSocket.OnFrame)       ((WebSocket.OnFrame)_websocket).onHandshake((WebSocket.FrameConnection)connection.getConnection());
      _websocket.onOpen(connection.getConnection());
    }
  }
  finally {
    _done.countDown();
  }
}
