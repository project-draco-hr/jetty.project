{
  while (_endp.isOpen() && !_parser.isComplete()) {
switch (_parser.parseAvailable()) {
case -1:
      _holder.cancel();
    _holder.getWebSocket().onError("EOF",new EOFException());
  return this;
case 0:
return this;
default :
break;
}
}
if (_error == null) {
if (_accept == null) _error="No Sec-WebSocket-Accept";
 else if (!WebSocketConnectionD10.hashKey(_key).equals(_accept)) _error="Bad Sec-WebSocket-Accept";
 else {
Buffer header=_parser.getHeaderBuffer();
WebSocketConnectionD10 connection=new WebSocketConnectionD10(_holder.getWebSocket(),_endp,_buffers,System.currentTimeMillis(),_holder.getMaxIdleTime(),_holder.getProtocol(),null,10,new WebSocketGeneratorD10.RandomMaskGen());
if (header.hasContent()) connection.fillBuffersFrom(header);
_buffers.returnBuffer(header);
if (_holder.getWebSocket() instanceof WebSocket.OnFrame) ((WebSocket.OnFrame)_holder.getWebSocket()).onHandshake((WebSocket.FrameConnection)connection.getConnection());
_holder.cancel();
_holder.getWebSocket().onOpen(connection.getConnection());
return connection;
}
}
_endp.close();
return this;
}
