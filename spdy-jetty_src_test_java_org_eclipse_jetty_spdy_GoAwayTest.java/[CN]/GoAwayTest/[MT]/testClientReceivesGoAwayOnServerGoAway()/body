{
  ServerSessionFrameListener serverSessionFrameListener=new ServerSessionFrameListener.Adapter(){
    @Override public StreamFrameListener onSyn(    Stream stream,    SynInfo synInfo){
      stream.reply(new ReplyInfo(true));
      stream.getSession().goAway();
      return null;
    }
  }
;
  final AtomicReference<GoAwayInfo> ref=new AtomicReference<>();
  final CountDownLatch latch=new CountDownLatch(1);
  SessionFrameListener clientSessionFrameListener=new SessionFrameListener.Adapter(){
    @Override public void onGoAway(    Session session,    GoAwayInfo goAwayInfo){
      ref.set(goAwayInfo);
      latch.countDown();
    }
  }
;
  Session session=startClient(startServer(serverSessionFrameListener),clientSessionFrameListener);
  Stream stream1=session.syn(new SynInfo(true),null).get();
  Assert.assertTrue(latch.await(5,TimeUnit.SECONDS));
  GoAwayInfo goAwayInfo=ref.get();
  Assert.assertNotNull(goAwayInfo);
  Assert.assertEquals(stream1.getId(),goAwayInfo.getLastStreamId());
  Assert.assertSame(SessionStatus.OK,goAwayInfo.getSessionStatus());
}
