{
  __server=new Server();
  __connector=new SelectChannelConnector();
  __server.addConnector(__connector);
  WebSocketHandler wsHandler=new WebSocketHandler(){
    public WebSocket doWebSocketConnect(    HttpServletRequest request,    String protocol){
      __textCount.set(0);
      __serverWebSocket=new TestWebSocket();
      __serverWebSocket._onConnect=("onConnect".equals(protocol));
      __serverWebSocket._echo=("echo".equals(protocol));
      __serverWebSocket._aggregate=("aggregate".equals(protocol));
      __serverWebSocket._latch=("latch".equals(protocol));
      if (__serverWebSocket._latch)       __latch=new CountDownLatch(1);
      return __serverWebSocket;
    }
  }
;
  wsHandler.setBufferSize(8192);
  wsHandler.setMaxIdleTime(1000);
  wsHandler.setHandler(new DefaultHandler());
  __server.setHandler(wsHandler);
  __server.start();
}
