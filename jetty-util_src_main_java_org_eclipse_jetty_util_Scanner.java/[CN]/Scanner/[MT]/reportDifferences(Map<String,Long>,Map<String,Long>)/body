{
  List<String> bulkChanges=new ArrayList<String>();
  Set<String> oldScanKeys=new HashSet<String>(oldScan.keySet());
  Iterator<Entry<String,Long>> itor=currentScan.entrySet().iterator();
  while (itor.hasNext()) {
    Map.Entry<String,Long> entry=itor.next();
    if (!oldScanKeys.contains(entry.getKey())) {
      Log.debug("File added: " + entry.getKey());
      reportAddition((String)entry.getKey());
      bulkChanges.add(entry.getKey());
    }
 else     if (!oldScan.get(entry.getKey()).equals(entry.getValue())) {
      Log.debug("File changed: " + entry.getKey());
      reportChange((String)entry.getKey());
      oldScanKeys.remove(entry.getKey());
      bulkChanges.add(entry.getKey());
    }
 else     oldScanKeys.remove(entry.getKey());
  }
  if (!oldScanKeys.isEmpty()) {
    Iterator<String> keyItor=oldScanKeys.iterator();
    while (keyItor.hasNext()) {
      String filename=(String)keyItor.next();
      Log.debug("File removed: " + filename);
      reportRemoval(filename);
      bulkChanges.add(filename);
    }
  }
  if (!bulkChanges.isEmpty())   reportBulkChanges(bulkChanges);
}
