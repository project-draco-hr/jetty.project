{
  StringBuffer buffer=new StringBuffer();
  int l=value.length();
  State state=State.VALUE;
  boolean quoted=false;
  boolean sloshed=false;
  int nws_length=0;
  int last_length=0;
  for (int i=0; i <= l; i++) {
    char c=i == l ? 0 : value.charAt(i);
    if (quoted && c != 0) {
      if (sloshed)       sloshed=false;
 else {
switch (c) {
case '\\':
          sloshed=true;
        if (!_keepQuotes)         continue;
      break;
case '"':
    quoted=false;
  if (!_keepQuotes)   continue;
break;
}
}
buffer.append(c);
nws_length=buffer.length();
continue;
}
switch (c) {
case ' ':
case '\t':
if (buffer.length() > last_length) buffer.append(c);
continue;
case '"':
quoted=true;
if (_keepQuotes) buffer.append(c);
nws_length=buffer.length();
continue;
case ';':
buffer.setLength(nws_length);
buffer.append(c);
last_length=++nws_length;
state=State.PARAM_NAME;
continue;
case ',':
case 0:
if (nws_length > 0) {
buffer.setLength(nws_length);
_values.add(buffer.toString());
}
buffer.setLength(0);
last_length=0;
nws_length=0;
state=State.VALUE;
continue;
default :
{
switch (state) {
case VALUE:
{
buffer.append(c);
nws_length=buffer.length();
continue;
}
case PARAM_NAME:
{
if (c == '=') {
buffer.setLength(nws_length);
buffer.append(c);
last_length=++nws_length;
state=State.PARAM_VALUE;
continue;
}
buffer.append(c);
nws_length=buffer.length();
continue;
}
case PARAM_VALUE:
{
buffer.append(c);
nws_length=buffer.length();
continue;
}
}
}
}
}
}
