{
  if (size == 0) {
    return null;
  }
  if (size > buffer.remaining()) {
    String err=String.format("Truncated data, expected %,d byte(s), but only %,d byte(s) remain",size,buffer.remaining());
    throw new MuxException(err);
  }
  if (size > Integer.MAX_VALUE) {
    String err=String.format("[Int-Sane!] Buffer size %,d is too large to be supported (max allowed is %,d)",size,Integer.MAX_VALUE);
    throw new MuxException(err);
  }
  ByteBuffer ret=ByteBuffer.allocateDirect((int)size);
  BufferUtil.put(buffer,ret);
  BufferUtil.flipToFlush(ret,0);
  return ret;
}
